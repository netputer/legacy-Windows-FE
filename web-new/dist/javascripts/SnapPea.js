//     Underscore.js 1.4.4
//     http://underscorejs.org
//     (c) 2009-2013 Jeremy Ashkenas, DocumentCloud Inc.
//     Underscore may be freely distributed under the MIT license.

/*!
 * jQuery JavaScript Library v2.0.2
 * http://jquery.com/
 *
 * Includes Sizzle.js
 * http://sizzlejs.com/
 *
 * Copyright 2005, 2013 jQuery Foundation, Inc. and other contributors
 * Released under the MIT license
 * http://jquery.org/license
 *
 * Date: 2013-05-30T21:25Z
 */

/*!
 * Sizzle CSS Selector Engine v1.9.4-pre
 * http://sizzlejs.com/
 *
 * Copyright 2013 jQuery Foundation, Inc. and other contributors
 * Released under the MIT license
 * http://jquery.org/license
 *
 * Date: 2013-05-27
 */

// doT.js
// 2011, Laura Doktorova, https://github.com/olado/doT
// Licensed under the MIT license.

//     (c) 2010-2013 Jeremy Ashkenas, DocumentCloud Inc.
//     Backbone may be freely distributed under the MIT license.
//     For all details and documentation:
//     http://backbonejs.org

/**
 * @license RequireJS text 2.0.7 Copyright (c) 2010-2012, The Dojo Foundation All Rights Reserved.
 * Available via the MIT or new BSD license.
 * see: http://github.com/requirejs/text for details
 */

/**
 * @license RequireJS i18n 2.0.2 Copyright (c) 2010-2012, The Dojo Foundation All Rights Reserved.
 * Available via the MIT or new BSD license.
 * see: http://github.com/requirejs/i18n for details
 */

/*!
 * 看我们的源码？不如来加入我们吧！豌豆实验室的前端团队正在寻找和您一样有好奇心的优秀前端工程师！
 *
 *   11
 *    01
 *    1001
 *     01111
 *     111111
 *      111111  1
 *      11111111
 *       11111111  01
 *        111111111
 *        1111111111  10                         111111    10       11111111111111      11    1
 *         11111111111 11                        111111 001000000   00111111111101  0000000100000001
 *          11111111111  101                      01111 01     10                       11 1  01
 *           111111111111  00                    10  10  01   11     001111111101     1 1 100 1 11
 *            111111111111    11                 101110 10 010100    0         01     101110111101
 *             1011111111111  101                 1  1  01 0 0 10    011111111101      01  0   01
 *               1111111111101    1               01 0  1 01 0 01     101111 001    1000110000101001
 *                111111111111111 11              1110   10  0         0     01         100 101
 *                      1        11              100001 00   0110  1111001110011101 100001    10000
 *              1111111  11111111 1011           11     1    1111  111111111111111  11            1
 *             01 11  11111  111 1 1100011
 *            101111111111111101111 001111
 *            10      11111      11 1
 *             11    101111      01
 *               110011  100111101
 *                         1111
 *
 *
 * http://www.wandoujia.com/join
 * @author Zeke Zhao
 * @mail wangye.zhao@wandoujia.com
 * @twitter @wangyezhao
 * @weibo @赵望野
 */

(function(){(function(){var e=this,t=e._,n={},r=Array.prototype,i=Object.prototype,s=Function.prototype,o=r.push,u=r.slice,a=r.concat,f=i.toString,l=i.hasOwnProperty,c=r.forEach,h=r.map,p=r.reduce,d=r.reduceRight,v=r.filter,m=r.every,g=r.some,y=r.indexOf,b=r.lastIndexOf,w=Array.isArray,E=Object.keys,S=s.bind,x=function(e){if(e instanceof x)return e;if(!(this instanceof x))return new x(e);this._wrapped=e};typeof exports!="undefined"?(typeof module!="undefined"&&module.exports&&(exports=module.exports=x),exports._=x):e._=x,x.VERSION="1.4.4";var T=x.each=x.forEach=function(e,t,r){if(e==null)return;if(c&&e.forEach===c)e.forEach(t,r);else if(e.length===+e.length){for(var i=0,s=e.length;i<s;i++)if(t.call(r,e[i],i,e)===n)return}else for(var o in e)if(x.has(e,o)&&t.call(r,e[o],o,e)===n)return};x.map=x.collect=function(e,t,n){var r=[];return e==null?r:h&&e.map===h?e.map(t,n):(T(e,function(e,i,s){r[r.length]=t.call(n,e,i,s)}),r)};var N="Reduce of empty array with no initial value";x.reduce=x.foldl=x.inject=function(e,t,n,r){var i=arguments.length>2;e==null&&(e=[]);if(p&&e.reduce===p)return r&&(t=x.bind(t,r)),i?e.reduce(t,n):e.reduce(t);T(e,function(e,s,o){i?n=t.call(r,n,e,s,o):(n=e,i=!0)});if(!i)throw new TypeError(N);return n},x.reduceRight=x.foldr=function(e,t,n,r){var i=arguments.length>2;e==null&&(e=[]);if(d&&e.reduceRight===d)return r&&(t=x.bind(t,r)),i?e.reduceRight(t,n):e.reduceRight(t);var s=e.length;if(s!==+s){var o=x.keys(e);s=o.length}T(e,function(u,a,f){a=o?o[--s]:--s,i?n=t.call(r,n,e[a],a,f):(n=e[a],i=!0)});if(!i)throw new TypeError(N);return n},x.find=x.detect=function(e,t,n){var r;return C(e,function(e,i,s){if(t.call(n,e,i,s))return r=e,!0}),r},x.filter=x.select=function(e,t,n){var r=[];return e==null?r:v&&e.filter===v?e.filter(t,n):(T(e,function(e,i,s){t.call(n,e,i,s)&&(r[r.length]=e)}),r)},x.reject=function(e,t,n){return x.filter(e,function(e,r,i){return!t.call(n,e,r,i)},n)},x.every=x.all=function(e,t,r){t||(t=x.identity);var i=!0;return e==null?i:m&&e.every===m?e.every(t,r):(T(e,function(e,s,o){if(!(i=i&&t.call(r,e,s,o)))return n}),!!i)};var C=x.some=x.any=function(e,t,r){t||(t=x.identity);var i=!1;return e==null?i:g&&e.some===g?e.some(t,r):(T(e,function(e,s,o){if(i||(i=t.call(r,e,s,o)))return n}),!!i)};x.contains=x.include=function(e,t){return e==null?!1:y&&e.indexOf===y?e.indexOf(t)!=-1:C(e,function(e){return e===t})},x.invoke=function(e,t){var n=u.call(arguments,2),r=x.isFunction(t);return x.map(e,function(e){return(r?t:e[t]).apply(e,n)})},x.pluck=function(e,t){return x.map(e,function(e){return e[t]})},x.where=function(e,t,n){return x.isEmpty(t)?n?null:[]:x[n?"find":"filter"](e,function(e){for(var n in t)if(t[n]!==e[n])return!1;return!0})},x.findWhere=function(e,t){return x.where(e,t,!0)},x.max=function(e,t,n){if(!t&&x.isArray(e)&&e[0]===+e[0]&&e.length<65535)return Math.max.apply(Math,e);if(!t&&x.isEmpty(e))return-Infinity;var r={computed:-Infinity,value:-Infinity};return T(e,function(e,i,s){var o=t?t.call(n,e,i,s):e;o>=r.computed&&(r={value:e,computed:o})}),r.value},x.min=function(e,t,n){if(!t&&x.isArray(e)&&e[0]===+e[0]&&e.length<65535)return Math.min.apply(Math,e);if(!t&&x.isEmpty(e))return Infinity;var r={computed:Infinity,value:Infinity};return T(e,function(e,i,s){var o=t?t.call(n,e,i,s):e;o<r.computed&&(r={value:e,computed:o})}),r.value},x.shuffle=function(e){var t,n=0,r=[];return T(e,function(e){t=x.random(n++),r[n-1]=r[t],r[t]=e}),r};var k=function(e){return x.isFunction(e)?e:function(t){return t[e]}};x.sortBy=function(e,t,n){var r=k(t);return x.pluck(x.map(e,function(e,t,i){return{value:e,index:t,criteria:r.call(n,e,t,i)}}).sort(function(e,t){var n=e.criteria,r=t.criteria;if(n!==r){if(n>r||n===void 0)return 1;if(n<r||r===void 0)return-1}return e.index<t.index?-1:1}),"value")};var L=function(e,t,n,r){var i={},s=k(t||x.identity);return T(e,function(t,o){var u=s.call(n,t,o,e);r(i,u,t)}),i};x.groupBy=function(e,t,n){return L(e,t,n,function(e,t,n){(x.has(e,t)?e[t]:e[t]=[]).push(n)})},x.countBy=function(e,t,n){return L(e,t,n,function(e,t){x.has(e,t)||(e[t]=0),e[t]++})},x.sortedIndex=function(e,t,n,r){n=n==null?x.identity:k(n);var i=n.call(r,t),s=0,o=e.length;while(s<o){var u=s+o>>>1;n.call(r,e[u])<i?s=u+1:o=u}return s},x.toArray=function(e){return e?x.isArray(e)?u.call(e):e.length===+e.length?x.map(e,x.identity):x.values(e):[]},x.size=function(e){return e==null?0:e.length===+e.length?e.length:x.keys(e).length},x.first=x.head=x.take=function(e,t,n){return e==null?void 0:t!=null&&!n?u.call(e,0,t):e[0]},x.initial=function(e,t,n){return u.call(e,0,e.length-(t==null||n?1:t))},x.last=function(e,t,n){return e==null?void 0:t!=null&&!n?u.call(e,Math.max(e.length-t,0)):e[e.length-1]},x.rest=x.tail=x.drop=function(e,t,n){return u.call(e,t==null||n?1:t)},x.compact=function(e){return x.filter(e,x.identity)};var A=function(e,t,n){return T(e,function(e){x.isArray(e)?t?o.apply(n,e):A(e,t,n):n.push(e)}),n};x.flatten=function(e,t){return A(e,t,[])},x.without=function(e){return x.difference(e,u.call(arguments,1))},x.uniq=x.unique=function(e,t,n,r){x.isFunction(t)&&(r=n,n=t,t=!1);var i=n?x.map(e,n,r):e,s=[],o=[];return T(i,function(n,r){if(t?!r||o[o.length-1]!==n:!x.contains(o,n))o.push(n),s.push(e[r])}),s},x.union=function(){return x.uniq(a.apply(r,arguments))},x.intersection=function(e){var t=u.call(arguments,1);return x.filter(x.uniq(e),function(e){return x.every(t,function(t){return x.indexOf(t,e)>=0})})},x.difference=function(e){var t=a.apply(r,u.call(arguments,1));return x.filter(e,function(e){return!x.contains(t,e)})},x.zip=function(){var e=u.call(arguments),t=x.max(x.pluck(e,"length")),n=new Array(t);for(var r=0;r<t;r++)n[r]=x.pluck(e,""+r);return n},x.object=function(e,t){if(e==null)return{};var n={};for(var r=0,i=e.length;r<i;r++)t?n[e[r]]=t[r]:n[e[r][0]]=e[r][1];return n},x.indexOf=function(e,t,n){if(e==null)return-1;var r=0,i=e.length;if(n){if(typeof n!="number")return r=x.sortedIndex(e,t),e[r]===t?r:-1;r=n<0?Math.max(0,i+n):n}if(y&&e.indexOf===y)return e.indexOf(t,n);for(;r<i;r++)if(e[r]===t)return r;return-1},x.lastIndexOf=function(e,t,n){if(e==null)return-1;var r=n!=null;if(b&&e.lastIndexOf===b)return r?e.lastIndexOf(t,n):e.lastIndexOf(t);var i=r?n:e.length;while(i--)if(e[i]===t)return i;return-1},x.range=function(e,t,n){arguments.length<=1&&(t=e||0,e=0),n=arguments[2]||1;var r=Math.max(Math.ceil((t-e)/n),0),i=0,s=new Array(r);while(i<r)s[i++]=e,e+=n;return s},x.bind=function(e,t){if(e.bind===S&&S)return S.apply(e,u.call(arguments,1));var n=u.call(arguments,2);return function(){return e.apply(t,n.concat(u.call(arguments)))}},x.partial=function(e){var t=u.call(arguments,1);return function(){return e.apply(this,t.concat(u.call(arguments)))}},x.bindAll=function(e){var t=u.call(arguments,1);return t.length===0&&(t=x.functions(e)),T(t,function(t){e[t]=x.bind(e[t],e)}),e},x.memoize=function(e,t){var n={};return t||(t=x.identity),function(){var r=t.apply(this,arguments);return x.has(n,r)?n[r]:n[r]=e.apply(this,arguments)}},x.delay=function(e,t){var n=u.call(arguments,2);return setTimeout(function(){return e.apply(null,n)},t)},x.defer=function(e){return x.delay.apply(x,[e,1].concat(u.call(arguments,1)))},x.throttle=function(e,t){var n,r,i,s,o=0,u=function(){o=new Date,i=null,s=e.apply(n,r)};return function(){var a=new Date,f=t-(a-o);return n=this,r=arguments,f<=0?(clearTimeout(i),i=null,o=a,s=e.apply(n,r)):i||(i=setTimeout(u,f)),s}},x.debounce=function(e,t,n){var r,i;return function(){var s=this,o=arguments,u=function(){r=null,n||(i=e.apply(s,o))},a=n&&!r;return clearTimeout(r),r=setTimeout(u,t),a&&(i=e.apply(s,o)),i}},x.once=function(e){var t=!1,n;return function(){return t?n:(t=!0,n=e.apply(this,arguments),e=null,n)}},x.wrap=function(e,t){return function(){var n=[e];return o.apply(n,arguments),t.apply(this,n)}},x.compose=function(){var e=arguments;return function(){var t=arguments;for(var n=e.length-1;n>=0;n--)t=[e[n].apply(this,t)];return t[0]}},x.after=function(e,t){return e<=0?t():function(){if(--e<1)return t.apply(this,arguments)}},x.keys=E||function(e){if(e!==Object(e))throw new TypeError("Invalid object");var t=[];for(var n in e)x.has(e,n)&&(t[t.length]=n);return t},x.values=function(e){var t=[];for(var n in e)x.has(e,n)&&t.push(e[n]);return t},x.pairs=function(e){var t=[];for(var n in e)x.has(e,n)&&t.push([n,e[n]]);return t},x.invert=function(e){var t={};for(var n in e)x.has(e,n)&&(t[e[n]]=n);return t},x.functions=x.methods=function(e){var t=[];for(var n in e)x.isFunction(e[n])&&t.push(n);return t.sort()},x.extend=function(e){return T(u.call(arguments,1),function(t){if(t)for(var n in t)e[n]=t[n]}),e},x.pick=function(e){var t={},n=a.apply(r,u.call(arguments,1));return T(n,function(n){n in e&&(t[n]=e[n])}),t},x.omit=function(e){var t={},n=a.apply(r,u.call(arguments,1));for(var i in e)x.contains(n,i)||(t[i]=e[i]);return t},x.defaults=function(e){return T(u.call(arguments,1),function(t){if(t)for(var n in t)e[n]==null&&(e[n]=t[n])}),e},x.clone=function(e){return x.isObject(e)?x.isArray(e)?e.slice():x.extend({},e):e},x.tap=function(e,t){return t(e),e};var O=function(e,t,n,r){if(e===t)return e!==0||1/e==1/t;if(e==null||t==null)return e===t;e instanceof x&&(e=e._wrapped),t instanceof x&&(t=t._wrapped);var i=f.call(e);if(i!=f.call(t))return!1;switch(i){case"[object String]":return e==String(t);case"[object Number]":return e!=+e?t!=+t:e==0?1/e==1/t:e==+t;case"[object Date]":case"[object Boolean]":return+e==+t;case"[object RegExp]":return e.source==t.source&&e.global==t.global&&e.multiline==t.multiline&&e.ignoreCase==t.ignoreCase}if(typeof e!="object"||typeof t!="object")return!1;var s=n.length;while(s--)if(n[s]==e)return r[s]==t;n.push(e),r.push(t);var o=0,u=!0;if(i=="[object Array]"){o=e.length,u=o==t.length;if(u)while(o--)if(!(u=O(e[o],t[o],n,r)))break}else{var a=e.constructor,l=t.constructor;if(a!==l&&!(x.isFunction(a)&&a instanceof a&&x.isFunction(l)&&l instanceof l))return!1;for(var c in e)if(x.has(e,c)){o++;if(!(u=x.has(t,c)&&O(e[c],t[c],n,r)))break}if(u){for(c in t)if(x.has(t,c)&&!(o--))break;u=!o}}return n.pop(),r.pop(),u};x.isEqual=function(e,t){return O(e,t,[],[])},x.isEmpty=function(e){if(e==null)return!0;if(x.isArray(e)||x.isString(e))return e.length===0;for(var t in e)if(x.has(e,t))return!1;return!0},x.isElement=function(e){return!!e&&e.nodeType===1},x.isArray=w||function(e){return f.call(e)=="[object Array]"},x.isObject=function(e){return e===Object(e)},T(["Arguments","Function","String","Number","Date","RegExp"],function(e){x["is"+e]=function(t){return f.call(t)=="[object "+e+"]"}}),x.isArguments(arguments)||(x.isArguments=function(e){return!!e&&!!x.has(e,"callee")}),typeof /./!="function"&&(x.isFunction=function(e){return typeof e=="function"}),x.isFinite=function(e){return isFinite(e)&&!isNaN(parseFloat(e))},x.isNaN=function(e){return x.isNumber(e)&&e!=+e},x.isBoolean=function(e){return e===!0||e===!1||f.call(e)=="[object Boolean]"},x.isNull=function(e){return e===null},x.isUndefined=function(e){return e===void 0},x.has=function(e,t){return l.call(e,t)},x.noConflict=function(){return e._=t,this},x.identity=function(e){return e},x.times=function(e,t,n){var r=Array(e);for(var i=0;i<e;i++)r[i]=t.call(n,i);return r},x.random=function(e,t){return t==null&&(t=e,e=0),e+Math.floor(Math.random()*(t-e+1))};var M={escape:{"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","/":"&#x2F;"}};M.unescape=x.invert(M.escape);var _={escape:new RegExp("["+x.keys(M.escape).join("")+"]","g"),unescape:new RegExp("("+x.keys(M.unescape).join("|")+")","g")};x.each(["escape","unescape"],function(e){x[e]=function(t){return t==null?"":(""+t).replace(_[e],function(t){return M[e][t]})}}),x.result=function(e,t){if(e==null)return null;var n=e[t];return x.isFunction(n)?n.call(e):n},x.mixin=function(e){T(x.functions(e),function(t){var n=x[t]=e[t];x.prototype[t]=function(){var e=[this._wrapped];return o.apply(e,arguments),j.call(this,n.apply(x,e))}})};var D=0;x.uniqueId=function(e){var t=++D+"";return e?e+t:t},x.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var P=/(.)^/,H={"'":"'","\\":"\\","\r":"r","\n":"n","	":"t","\u2028":"u2028","\u2029":"u2029"},B=/\\|'|\r|\n|\t|\u2028|\u2029/g;x.template=function(e,t,n){var r;n=x.defaults({},n,x.templateSettings);var i=new RegExp([(n.escape||P).source,(n.interpolate||P).source,(n.evaluate||P).source].join("|")+"|$","g"),s=0,o="__p+='";e.replace(i,function(t,n,r,i,u){return o+=e.slice(s,u).replace(B,function(e){return"\\"+H[e]}),n&&(o+="'+\n((__t=("+n+"))==null?'':_.escape(__t))+\n'"),r&&(o+="'+\n((__t=("+r+"))==null?'':__t)+\n'"),i&&(o+="';\n"+i+"\n__p+='"),s=u+t.length,t}),o+="';\n",n.variable||(o="with(obj||{}){\n"+o+"}\n"),o="var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};\n"+o+"return __p;\n";try{r=new Function(n.variable||"obj","_",o)}catch(u){throw u.source=o,u}if(t)return r(t,x);var a=function(e){return r.call(this,e,x)};return a.source="function("+(n.variable||"obj")+"){\n"+o+"}",a},x.chain=function(e){return x(e).chain()};var j=function(e){return this._chain?x(e).chain():e};x.mixin(x),T(["pop","push","reverse","shift","sort","splice","unshift"],function(e){var t=r[e];x.prototype[e]=function(){var n=this._wrapped;return t.apply(n,arguments),(e=="shift"||e=="splice")&&n.length===0&&delete n[0],j.call(this,n)}}),T(["concat","join","slice"],function(e){var t=r[e];x.prototype[e]=function(){return j.call(this,t.apply(this._wrapped,arguments))}}),x.extend(x.prototype,{chain:function(){return this._chain=!0,this},value:function(){return this._wrapped}})}).call(this),define("underscore",function(e){return function(){var t,n;return t||e._}}(this)),function(window,undefined){function isArraylike(e){var t=e.length,n=jQuery.type(e);return jQuery.isWindow(e)?!1:e.nodeType===1&&t?!0:n==="array"||n!=="function"&&(t===0||typeof t=="number"&&t>0&&t-1 in e)}function createOptions(e){var t=optionsCache[e]={};return jQuery.each(e.match(core_rnotwhite)||[],function(e,n){t[n]=!0}),t}function Data(){Object.defineProperty(this.cache={},0,{get:function(){return{}}}),this.expando=jQuery.expando+Math.random()}function dataAttr(e,t,n){var r;if(n===undefined&&e.nodeType===1){r="data-"+t.replace(rmultiDash,"-$1").toLowerCase(),n=e.getAttribute(r);if(typeof n=="string"){try{n=n==="true"?!0:n==="false"?!1:n==="null"?null:+n+""===n?+n:rbrace.test(n)?JSON.parse(n):n}catch(i){}data_user.set(e,t,n)}else n=undefined}return n}function returnTrue(){return!0}function returnFalse(){return!1}function safeActiveElement(){try{return document.activeElement}catch(e){}}function sibling(e,t){while((e=e[t])&&e.nodeType!==1);return e}function winnow(e,t,n){if(jQuery.isFunction(t))return jQuery.grep(e,function(e,r){return!!t.call(e,r,e)!==n});if(t.nodeType)return jQuery.grep(e,function(e){return e===t!==n});if(typeof t=="string"){if(isSimple.test(t))return jQuery.filter(t,e,n);t=jQuery.filter(t,e)}return jQuery.grep(e,function(e){return core_indexOf.call(t,e)>=0!==n})}function manipulationTarget(e,t){return jQuery.nodeName(e,"table")&&jQuery.nodeName(t.nodeType===1?t:t.firstChild,"tr")?e.getElementsByTagName("tbody")[0]||e.appendChild(e.ownerDocument.createElement("tbody")):e}function disableScript(e){return e.type=(e.getAttribute("type")!==null)+"/"+e.type,e}function restoreScript(e){var t=rscriptTypeMasked.exec(e.type);return t?e.type=t[1]:e.removeAttribute("type"),e}function setGlobalEval(e,t){var n=e.length,r=0;for(;r<n;r++)data_priv.set(e[r],"globalEval",!t||data_priv.get(t[r],"globalEval"))}function cloneCopyEvent(e,t){var n,r,i,s,o,u,a,f;if(t.nodeType!==1)return;if(data_priv.hasData(e)){s=data_priv.access(e),o=data_priv.set(t,s),f=s.events;if(f){delete o.handle,o.events={};for(i in f)for(n=0,r=f[i].length;n<r;n++)jQuery.event.add(t,i,f[i][n])}}data_user.hasData(e)&&(u=data_user.access(e),a=jQuery.extend({},u),data_user.set(t,a))}function getAll(e,t){var n=e.getElementsByTagName?e.getElementsByTagName(t||"*"):e.querySelectorAll?e.querySelectorAll(t||"*"):[];return t===undefined||t&&jQuery.nodeName(e,t)?jQuery.merge([e],n):n}function fixInput(e,t){var n=t.nodeName.toLowerCase();if(n==="input"&&manipulation_rcheckableType.test(e.type))t.checked=e.checked;else if(n==="input"||n==="textarea")t.defaultValue=e.defaultValue}function vendorPropName(e,t){if(t in e)return t;var n=t.charAt(0).toUpperCase()+t.slice(1),r=t,i=cssPrefixes.length;while(i--){t=cssPrefixes[i]+n;if(t in e)return t}return r}function isHidden(e,t){return e=t||e,jQuery.css(e,"display")==="none"||!jQuery.contains(e.ownerDocument,e)}function getStyles(e){return window.getComputedStyle(e,null)}function showHide(e,t){var n,r,i,s=[],o=0,u=e.length;for(;o<u;o++){r=e[o];if(!r.style)continue;s[o]=data_priv.get(r,"olddisplay"),n=r.style.display,t?(!s[o]&&n==="none"&&(r.style.display=""),r.style.display===""&&isHidden(r)&&(s[o]=data_priv.access(r,"olddisplay",css_defaultDisplay(r.nodeName)))):s[o]||(i=isHidden(r),(n&&n!=="none"||!i)&&data_priv.set(r,"olddisplay",i?n:jQuery.css(r,"display")))}for(o=0;o<u;o++){r=e[o];if(!r.style)continue;if(!t||r.style.display==="none"||r.style.display==="")r.style.display=t?s[o]||"":"none"}return e}function setPositiveNumber(e,t,n){var r=rnumsplit.exec(t);return r?Math.max(0,r[1]-(n||0))+(r[2]||"px"):t}function augmentWidthOrHeight(e,t,n,r,i){var s=n===(r?"border":"content")?4:t==="width"?1:0,o=0;for(;s<4;s+=2)n==="margin"&&(o+=jQuery.css(e,n+cssExpand[s],!0,i)),r?(n==="content"&&(o-=jQuery.css(e,"padding"+cssExpand[s],!0,i)),n!=="margin"&&(o-=jQuery.css(e,"border"+cssExpand[s]+"Width",!0,i))):(o+=jQuery.css(e,"padding"+cssExpand[s],!0,i),n!=="padding"&&(o+=jQuery.css(e,"border"+cssExpand[s]+"Width",!0,i)));return o}function getWidthOrHeight(e,t,n){var r=!0,i=t==="width"?e.offsetWidth:e.offsetHeight,s=getStyles(e),o=jQuery.support.boxSizing&&jQuery.css(e,"boxSizing",!1,s)==="border-box";if(i<=0||i==null){i=curCSS(e,t,s);if(i<0||i==null)i=e.style[t];if(rnumnonpx.test(i))return i;r=o&&(jQuery.support.boxSizingReliable||i===e.style[t]),i=parseFloat(i)||0}return i+augmentWidthOrHeight(e,t,n||(o?"border":"content"),r,s)+"px"}function css_defaultDisplay(e){var t=document,n=elemdisplay[e];if(!n){n=actualDisplay(e,t);if(n==="none"||!n)iframe=(iframe||jQuery("<iframe frameborder='0' width='0' height='0'/>").css("cssText","display:block !important")).appendTo(t.documentElement),t=(iframe[0].contentWindow||iframe[0].contentDocument).document,t.write("<!doctype html><html><body>"),t.close(),n=actualDisplay(e,t),iframe.detach();elemdisplay[e]=n}return n}function actualDisplay(e,t){var n=jQuery(t.createElement(e)).appendTo(t.body),r=jQuery.css(n[0],"display");return n.remove(),r}function buildParams(e,t,n,r){var i;if(jQuery.isArray(t))jQuery.each(t,function(t,i){n||rbracket.test(e)?r(e,i):buildParams(e+"["+(typeof i=="object"?t:"")+"]",i,n,r)});else if(!n&&jQuery.type(t)==="object")for(i in t)buildParams(e+"["+i+"]",t[i],n,r);else r(e,t)}function addToPrefiltersOrTransports(e){return function(t,n){typeof t!="string"&&(n=t,t="*");var r,i=0,s=t.toLowerCase().match(core_rnotwhite)||[];if(jQuery.isFunction(n))while(r=s[i++])r[0]==="+"?(r=r.slice(1)||"*",(e[r]=e[r]||[]).unshift(n)):(e[r]=e[r]||[]).push(n)}}function inspectPrefiltersOrTransports(e,t,n,r){function o(u){var a;return i[u]=!0,jQuery.each(e[u]||[],function(e,u){var f=u(t,n,r);if(typeof f=="string"&&!s&&!i[f])return t.dataTypes.unshift(f),o(f),!1;if(s)return!(a=f)}),a}var i={},s=e===transports;return o(t.dataTypes[0])||!i["*"]&&o("*")}function ajaxExtend(e,t){var n,r,i=jQuery.ajaxSettings.flatOptions||{};for(n in t)t[n]!==undefined&&((i[n]?e:r||(r={}))[n]=t[n]);return r&&jQuery.extend(!0,e,r),e}function ajaxHandleResponses(e,t,n){var r,i,s,o,u=e.contents,a=e.dataTypes;while(a[0]==="*")a.shift(),r===undefined&&(r=e.mimeType||t.getResponseHeader("Content-Type"));if(r)for(i in u)if(u[i]&&u[i].test(r)){a.unshift(i);break}if(a[0]in n)s=a[0];else{for(i in n){if(!a[0]||e.converters[i+" "+a[0]]){s=i;break}o||(o=i)}s=s||o}if(s)return s!==a[0]&&a.unshift(s),n[s]}function ajaxConvert(e,t,n,r){var i,s,o,u,a,f={},l=e.dataTypes.slice();if(l[1])for(o in e.converters)f[o.toLowerCase()]=e.converters[o];s=l.shift();while(s){e.responseFields[s]&&(n[e.responseFields[s]]=t),!a&&r&&e.dataFilter&&(t=e.dataFilter(t,e.dataType)),a=s,s=l.shift();if(s)if(s==="*")s=a;else if(a!=="*"&&a!==s){o=f[a+" "+s]||f["* "+s];if(!o)for(i in f){u=i.split(" ");if(u[1]===s){o=f[a+" "+u[0]]||f["* "+u[0]];if(o){o===!0?o=f[i]:f[i]!==!0&&(s=u[0],l.unshift(u[1]));break}}}if(o!==!0)if(o&&e["throws"])t=o(t);else try{t=o(t)}catch(c){return{state:"parsererror",error:o?c:"No conversion from "+a+" to "+s}}}}return{state:"success",data:t}}function createFxNow(){return setTimeout(function(){fxNow=undefined}),fxNow=jQuery.now()}function createTween(e,t,n){var r,i=(tweeners[t]||[]).concat(tweeners["*"]),s=0,o=i.length;for(;s<o;s++)if(r=i[s].call(n,t,e))return r}function Animation(e,t,n){var r,i,s=0,o=animationPrefilters.length,u=jQuery.Deferred().always(function(){delete a.elem}),a=function(){if(i)return!1;var t=fxNow||createFxNow(),n=Math.max(0,f.startTime+f.duration-t),r=n/f.duration||0,s=1-r,o=0,a=f.tweens.length;for(;o<a;o++)f.tweens[o].run(s);return u.notifyWith(e,[f,s,n]),s<1&&a?n:(u.resolveWith(e,[f]),!1)},f=u.promise({elem:e,props:jQuery.extend({},t),opts:jQuery.extend(!0,{specialEasing:{}},n),originalProperties:t,originalOptions:n,startTime:fxNow||createFxNow(),duration:n.duration,tweens:[],createTween:function(t,n){var r=jQuery.Tween(e,f.opts,t,n,f.opts.specialEasing[t]||f.opts.easing);return f.tweens.push(r),r},stop:function(t){var n=0,r=t?f.tweens.length:0;if(i)return this;i=!0;for(;n<r;n++)f.tweens[n].run(1);return t?u.resolveWith(e,[f,t]):u.rejectWith(e,[f,t]),this}}),l=f.props;propFilter(l,f.opts.specialEasing);for(;s<o;s++){r=animationPrefilters[s].call(f,e,l,f.opts);if(r)return r}return jQuery.map(l,createTween,f),jQuery.isFunction(f.opts.start)&&f.opts.start.call(e,f),jQuery.fx.timer(jQuery.extend(a,{elem:e,anim:f,queue:f.opts.queue})),f.progress(f.opts.progress).done(f.opts.done,f.opts.complete).fail(f.opts.fail).always(f.opts.always)}function propFilter(e,t){var n,r,i,s,o;for(n in e){r=jQuery.camelCase(n),i=t[r],s=e[n],jQuery.isArray(s)&&(i=s[1],s=e[n]=s[0]),n!==r&&(e[r]=s,delete e[n]),o=jQuery.cssHooks[r];if(o&&"expand"in o){s=o.expand(s),delete e[r];for(n in s)n in e||(e[n]=s[n],t[n]=i)}else t[r]=i}}function defaultPrefilter(e,t,n){var r,i,s,o,u,a,f=this,l={},c=e.style,h=e.nodeType&&isHidden(e),p=data_priv.get(e,"fxshow");n.queue||(u=jQuery._queueHooks(e,"fx"),u.unqueued==null&&(u.unqueued=0,a=u.empty.fire,u.empty.fire=function(){u.unqueued||a()}),u.unqueued++,f.always(function(){f.always(function(){u.unqueued--,jQuery.queue(e,"fx").length||u.empty.fire()})})),e.nodeType===1&&("height"in t||"width"in t)&&(n.overflow=[c.overflow,c.overflowX,c.overflowY],jQuery.css(e,"display")==="inline"&&jQuery.css(e,"float")==="none"&&(c.display="inline-block")),n.overflow&&(c.overflow="hidden",f.always(function(){c.overflow=n.overflow[0],c.overflowX=n.overflow[1],c.overflowY=n.overflow[2]}));for(r in t){i=t[r];if(rfxtypes.exec(i)){delete t[r],s=s||i==="toggle";if(i===(h?"hide":"show")){if(i!=="show"||!p||p[r]===undefined)continue;h=!0}l[r]=p&&p[r]||jQuery.style(e,r)}}if(!jQuery.isEmptyObject(l)){p?"hidden"in p&&(h=p.hidden):p=data_priv.access(e,"fxshow",{}),s&&(p.hidden=!h),h?jQuery(e).show():f.done(function(){jQuery(e).hide()}),f.done(function(){var t;data_priv.remove(e,"fxshow");for(t in l)jQuery.style(e,t,l[t])});for(r in l)o=createTween(h?p[r]:0,r,f),r in p||(p[r]=o.start,h&&(o.end=o.start,o.start=r==="width"||r==="height"?1:0))}}function Tween(e,t,n,r,i){return new Tween.prototype.init(e,t,n,r,i)}function genFx(e,t){var n,r={height:e},i=0;t=t?1:0;for(;i<4;i+=2-t)n=cssExpand[i],r["margin"+n]=r["padding"+n]=e;return t&&(r.opacity=r.width=e),r}function getWindow(e){return jQuery.isWindow(e)?e:e.nodeType===9&&e.defaultView}var rootjQuery,readyList,core_strundefined=typeof undefined,location=window.location,document=window.document,docElem=document.documentElement,_jQuery=window.jQuery,_$=window.$,class2type={},core_deletedIds=[],core_version="2.0.2",core_concat=core_deletedIds.concat,core_push=core_deletedIds.push,core_slice=core_deletedIds.slice,core_indexOf=core_deletedIds.indexOf,core_toString=class2type.toString,core_hasOwn=class2type.hasOwnProperty,core_trim=core_version.trim,jQuery=function(e,t){return new jQuery.fn.init(e,t,rootjQuery)},core_pnum=/[+-]?(?:\d*\.|)\d+(?:[eE][+-]?\d+|)/.source,core_rnotwhite=/\S+/g,rquickExpr=/^(?:\s*(<[\w\W]+>)[^>]*|#([\w-]*))$/,rsingleTag=/^<(\w+)\s*\/?>(?:<\/\1>|)$/,rmsPrefix=/^-ms-/,rdashAlpha=/-([\da-z])/gi,fcamelCase=function(e,t){return t.toUpperCase()},completed=function(){document.removeEventListener("DOMContentLoaded",completed,!1),window.removeEventListener("load",completed,!1),jQuery.ready()};jQuery.fn=jQuery.prototype={jquery:core_version,constructor:jQuery,init:function(e,t,n){var r,i;if(!e)return this;if(typeof e=="string"){e.charAt(0)==="<"&&e.charAt(e.length-1)===">"&&e.length>=3?r=[null,e,null]:r=rquickExpr.exec(e);if(r&&(r[1]||!t)){if(r[1]){t=t instanceof jQuery?t[0]:t,jQuery.merge(this,jQuery.parseHTML(r[1],t&&t.nodeType?t.ownerDocument||t:document,!0));if(rsingleTag.test(r[1])&&jQuery.isPlainObject(t))for(r in t)jQuery.isFunction(this[r])?this[r](t[r]):this.attr(r,t[r]);return this}return i=document.getElementById(r[2]),i&&i.parentNode&&(this.length=1,this[0]=i),this.context=document,this.selector=e,this}return!t||t.jquery?(t||n).find(e):this.constructor(t).find(e)}return e.nodeType?(this.context=this[0]=e,this.length=1,this):jQuery.isFunction(e)?n.ready(e):(e.selector!==undefined&&(this.selector=e.selector,this.context=e.context),jQuery.makeArray(e,this))},selector:"",length:0,toArray:function(){return core_slice.call(this)},get:function(e){return e==null?this.toArray():e<0?this[this.length+e]:this[e]},pushStack:function(e){var t=jQuery.merge(this.constructor(),e);return t.prevObject=this,t.context=this.context,t},each:function(e,t){return jQuery.each(this,e,t)},ready:function(e){return jQuery.ready.promise().done(e),this},slice:function(){return this.pushStack(core_slice.apply(this,arguments))},first:function(){return this.eq(0)},last:function(){return this.eq(-1)},eq:function(e){var t=this.length,n=+e+(e<0?t:0);return this.pushStack(n>=0&&n<t?[this[n]]:[])},map:function(e){return this.pushStack(jQuery.map(this,function(t,n){return e.call(t,n,t)}))},end:function(){return this.prevObject||this.constructor(null)},push:core_push,sort:[].sort,splice:[].splice},jQuery.fn.init.prototype=jQuery.fn,jQuery.extend=jQuery.fn.extend=function(){var e,t,n,r,i,s,o=arguments[0]||{},u=1,a=arguments.length,f=!1;typeof o=="boolean"&&(f=o,o=arguments[1]||{},u=2),typeof o!="object"&&!jQuery.isFunction(o)&&(o={}),a===u&&(o=this,--u);for(;u<a;u++)if((e=arguments[u])!=null)for(t in e){n=o[t],r=e[t];if(o===r)continue;f&&r&&(jQuery.isPlainObject(r)||(i=jQuery.isArray(r)))?(i?(i=!1,s=n&&jQuery.isArray(n)?n:[]):s=n&&jQuery.isPlainObject(n)?n:{},o[t]=jQuery.extend(f,s,r)):r!==undefined&&(o[t]=r)}return o},jQuery.extend({expando:"jQuery"+(core_version+Math.random()).replace(/\D/g,""),noConflict:function(e){return window.$===jQuery&&(window.$=_$),e&&window.jQuery===jQuery&&(window.jQuery=_jQuery),jQuery},isReady:!1,readyWait:1,holdReady:function(e){e?jQuery.readyWait++:jQuery.ready(!0)},ready:function(e){if(e===!0?--jQuery.readyWait:jQuery.isReady)return;jQuery.isReady=!0;if(e!==!0&&--jQuery.readyWait>0)return;readyList.resolveWith(document,[jQuery]),jQuery.fn.trigger&&jQuery(document).trigger("ready").off("ready")},isFunction:function(e){return jQuery.type(e)==="function"},isArray:Array.isArray,isWindow:function(e){return e!=null&&e===e.window},isNumeric:function(e){return!isNaN(parseFloat(e))&&isFinite(e)},type:function(e){return e==null?String(e):typeof e=="object"||typeof e=="function"?class2type[core_toString.call(e)]||"object":typeof e},isPlainObject:function(e){if(jQuery.type(e)!=="object"||e.nodeType||jQuery.isWindow(e))return!1;try{if(e.constructor&&!core_hasOwn.call(e.constructor.prototype,"isPrototypeOf"))return!1}catch(t){return!1}return!0},isEmptyObject:function(e){var t;for(t in e)return!1;return!0},error:function(e){throw new Error(e)},parseHTML:function(e,t,n){if(!e||typeof e!="string")return null;typeof t=="boolean"&&(n=t,t=!1),t=t||document;var r=rsingleTag.exec(e),i=!n&&[];return r?[t.createElement(r[1])]:(r=jQuery.buildFragment([e],t,i),i&&jQuery(i).remove(),jQuery.merge([],r.childNodes))},parseJSON:JSON.parse,parseXML:function(e){var t,n;if(!e||typeof e!="string")return null;try{n=new DOMParser,t=n.parseFromString(e,"text/xml")}catch(r){t=undefined}return(!t||t.getElementsByTagName("parsererror").length)&&jQuery.error("Invalid XML: "+e),t},noop:function(){},globalEval:function(code){var script,indirect=eval;code=jQuery.trim(code),code&&(code.indexOf("use strict")===1?(script=document.createElement("script"),script.text=code,document.head.appendChild(script).parentNode.removeChild(script)):indirect(code))},camelCase:function(e){return e.replace(rmsPrefix,"ms-").replace(rdashAlpha,fcamelCase)},nodeName:function(e,t){return e.nodeName&&e.nodeName.toLowerCase()===t.toLowerCase()},each:function(e,t,n){var r,i=0,s=e.length,o=isArraylike(e);if(n)if(o)for(;i<s;i++){r=t.apply(e[i],n);if(r===!1)break}else for(i in e){r=t.apply(e[i],n);if(r===!1)break}else if(o)for(;i<s;i++){r=t.call(e[i],i,e[i]);if(r===!1)break}else for(i in e){r=t.call(e[i],i,e[i]);if(r===!1)break}return e},trim:function(e){return e==null?"":core_trim.call(e)},makeArray:function(e,t){var n=t||[];return e!=null&&(isArraylike(Object(e))?jQuery.merge(n,typeof e=="string"?[e]:e):core_push.call(n,e)),n},inArray:function(e,t,n){return t==null?-1:core_indexOf.call(t,e,n)},merge:function(e,t){var n=t.length,r=e.length,i=0;if(typeof n=="number")for(;i<n;i++)e[r++]=t[i];else while(t[i]!==undefined)e[r++]=t[i++];return e.length=r,e},grep:function(e,t,n){var r,i=[],s=0,o=e.length;n=!!n;for(;s<o;s++)r=!!t(e[s],s),n!==r&&i.push(e[s]);return i},map:function(e,t,n){var r,i=0,s=e.length,o=isArraylike(e),u=[];if(o)for(;i<s;i++)r=t(e[i],i,n),r!=null&&(u[u.length]=r);else for(i in e)r=t(e[i],i,n),r!=null&&(u[u.length]=r);return core_concat.apply([],u)},guid:1,proxy:function(e,t){var n,r,i;return typeof t=="string"&&(n=e[t],t=e,e=n),jQuery.isFunction(e)?(r=core_slice.call(arguments,2),i=function(){return e.apply(t||this,r.concat(core_slice.call(arguments)))},i.guid=e.guid=e.guid||jQuery.guid++,i):undefined},access:function(e,t,n,r,i,s,o){var u=0,a=e.length,f=n==null;if(jQuery.type(n)==="object"){i=!0;for(u in n)jQuery.access(e,t,u,n[u],!0,s,o)}else if(r!==undefined){i=!0,jQuery.isFunction(r)||(o=!0),f&&(o?(t.call(e,r),t=null):(f=t,t=function(e,t,n){return f.call(jQuery(e),n)}));if(t)for(;u<a;u++)t(e[u],n,o?r:r.call(e[u],u,t(e[u],n)))}return i?e:f?t.call(e):a?t(e[0],n):s},now:Date.now,swap:function(e,t,n,r){var i,s,o={};for(s in t)o[s]=e.style[s],e.style[s]=t[s];i=n.apply(e,r||[]);for(s in t)e.style[s]=o[s];return i}}),jQuery.ready.promise=function(e){return readyList||(readyList=jQuery.Deferred(),document.readyState==="complete"?setTimeout(jQuery.ready):(document.addEventListener("DOMContentLoaded",completed,!1),window.addEventListener("load",completed,!1))),readyList.promise(e)},jQuery.each("Boolean Number String Function Array Date RegExp Object Error".split(" "),function(e,t){class2type["[object "+t+"]"]=t.toLowerCase()}),rootjQuery=jQuery(document),function(e,t){function st(e,t,n,i){var s,o,u,a,f,l,p,m,g,E;(t?t.ownerDocument||t:w)!==h&&c(t),t=t||h,n=n||[];if(!e||typeof e!="string")return n;if((a=t.nodeType)!==1&&a!==9)return[];if(d&&!i){if(s=Y.exec(e))if(u=s[1]){if(a===9){o=t.getElementById(u);if(!o||!o.parentNode)return n;if(o.id===u)return n.push(o),n}else if(t.ownerDocument&&(o=t.ownerDocument.getElementById(u))&&y(t,o)&&o.id===u)return n.push(o),n}else{if(s[2])return P.apply(n,t.getElementsByTagName(e)),n;if((u=s[3])&&r.getElementsByClassName&&t.getElementsByClassName)return P.apply(n,t.getElementsByClassName(u)),n}if(r.qsa&&(!v||!v.test(e))){m=p=b,g=t,E=a===9&&e;if(a===1&&t.nodeName.toLowerCase()!=="object"){l=yt(e),(p=t.getAttribute("id"))?m=p.replace(tt,"\\$&"):t.setAttribute("id",m),m="[id='"+m+"'] ",f=l.length;while(f--)l[f]=m+bt(l[f]);g=V.test(e)&&t.parentNode||t,E=l.join(",")}if(E)try{return P.apply(n,g.querySelectorAll(E)),n}catch(S){}finally{p||t.removeAttribute("id")}}}return kt(e.replace(z,"$1"),t,n,i)}function ot(e){return G.test(e+"")}function ut(){function t(n,r){return e.push(n+=" ")>s.cacheLength&&delete t[e.shift()],t[n]=r}var e=[];return t}function at(e){return e[b]=!0,e}function ft(e){var t=h.createElement("div");try{return!!e(t)}catch(n){return!1}finally{t.parentNode&&t.parentNode.removeChild(t),t=null}}function lt(e,t,n){e=e.split("|");var r,i=e.length,o=n?null:t;while(i--)if(!(r=s.attrHandle[e[i]])||r===t)s.attrHandle[e[i]]=o}function ct(e,t){var n=e.getAttributeNode(t);return n&&n.specified?n.value:e[t]===!0?t.toLowerCase():null}function ht(e,t){return e.getAttribute(t,t.toLowerCase()==="type"?1:2)}function pt(e){if(e.nodeName.toLowerCase()==="input")return e.defaultValue}function dt(e,t){var n=t&&e,r=n&&e.nodeType===1&&t.nodeType===1&&(~t.sourceIndex||A)-(~e.sourceIndex||A);if(r)return r;if(n)while(n=n.nextSibling)if(n===t)return-1;return e?1:-1}function vt(e){return function(t){var n=t.nodeName.toLowerCase();return n==="input"&&t.type===e}}function mt(e){return function(t){var n=t.nodeName.toLowerCase();return(n==="input"||n==="button")&&t.type===e}}function gt(e){return at(function(t){return t=+t,at(function(n,r){var i,s=e([],n.length,t),o=s.length;while(o--)n[i=s[o]]&&(n[i]=!(r[i]=n[i]))})})}function yt(e,t){var n,r,i,o,u,a,f,l=T[e+" "];if(l)return t?0:l.slice(0);u=e,a=[],f=s.preFilter;while(u){if(!n||(r=W.exec(u)))r&&(u=u.slice(r[0].length)||u),a.push(i=[]);n=!1;if(r=X.exec(u))n=r.shift(),i.push({value:n,type:r[0].replace(z," ")}),u=u.slice(n.length);for(o in s.filter)(r=Q[o].exec(u))&&(!f[o]||(r=f[o](r)))&&(n=r.shift(),i.push({value:n,type:o,matches:r}),u=u.slice(n.length));if(!n)break}return t?u.length:u?st.error(e):T(e,a).slice(0)}function bt(e){var t=0,n=e.length,r="";for(;t<n;t++)r+=e[t].value;return r}function wt(e,t,n){var r=t.dir,s=n&&r==="parentNode",o=S++;return t.first?function(t,n,i){while(t=t[r])if(t.nodeType===1||s)return e(t,n,i)}:function(t,n,u){var a,f,l,c=E+" "+o;if(u){while(t=t[r])if(t.nodeType===1||s)if(e(t,n,u))return!0}else while(t=t[r])if(t.nodeType===1||s){l=t[b]||(t[b]={});if((f=l[r])&&f[0]===c){if((a=f[1])===!0||a===i)return a===!0}else{f=l[r]=[c],f[1]=e(t,n,u)||i;if(f[1]===!0)return!0}}}}function Et(e){return e.length>1?function(t,n,r){var i=e.length;while(i--)if(!e[i](t,n,r))return!1;return!0}:e[0]}function St(e,t,n,r,i){var s,o=[],u=0,a=e.length,f=t!=null;for(;u<a;u++)if(s=e[u])if(!n||n(s,r,i))o.push(s),f&&t.push(u);return o}function xt(e,t,n,r,i,s){return r&&!r[b]&&(r=xt(r)),i&&!i[b]&&(i=xt(i,s)),at(function(s,o,u,a){var f,l,c,h=[],p=[],d=o.length,v=s||Ct(t||"*",u.nodeType?[u]:u,[]),m=e&&(s||!t)?St(v,h,e,u,a):v,g=n?i||(s?e:d||r)?[]:o:m;n&&n(m,g,u,a);if(r){f=St(g,p),r(f,[],u,a),l=f.length;while(l--)if(c=f[l])g[p[l]]=!(m[p[l]]=c)}if(s){if(i||e){if(i){f=[],l=g.length;while(l--)(c=g[l])&&f.push(m[l]=c);i(null,g=[],f,a)}l=g.length;while(l--)(c=g[l])&&(f=i?B.call(s,c):h[l])>-1&&(s[f]=!(o[f]=c))}}else g=St(g===o?g.splice(d,g.length):g),i?i(null,o,g,a):P.apply(o,g)})}function Tt(e){var t,n,r,i=e.length,o=s.relative[e[0].type],u=o||s.relative[" "],a=o?1:0,l=wt(function(e){return e===t},u,!0),c=wt(function(e){return B.call(t,e)>-1},u,!0),h=[function(e,n,r){return!o&&(r||n!==f)||((t=n).nodeType?l(e,n,r):c(e,n,r))}];for(;a<i;a++)if(n=s.relative[e[a].type])h=[wt(Et(h),n)];else{n=s.filter[e[a].type].apply(null,e[a].matches);if(n[b]){r=++a;for(;r<i;r++)if(s.relative[e[r].type])break;return xt(a>1&&Et(h),a>1&&bt(e.slice(0,a-1).concat({value:e[a-2].type===" "?"*":""})).replace(z,"$1"),n,a<r&&Tt(e.slice(a,r)),r<i&&Tt(e=e.slice(r)),r<i&&bt(e))}h.push(n)}return Et(h)}function Nt(e,t){var n=0,r=t.length>0,o=e.length>0,u=function(u,a,l,c,p){var d,v,m,g=[],y=0,b="0",w=u&&[],S=p!=null,x=f,T=u||o&&s.find.TAG("*",p&&a.parentNode||a),N=E+=x==null?1:Math.random()||.1;S&&(f=a!==h&&a,i=n);for(;(d=T[b])!=null;b++){if(o&&d){v=0;while(m=e[v++])if(m(d,a,l)){c.push(d);break}S&&(E=N,i=++n)}r&&((d=!m&&d)&&y--,u&&w.push(d))}y+=b;if(r&&b!==y){v=0;while(m=t[v++])m(w,g,a,l);if(u){if(y>0)while(b--)!w[b]&&!g[b]&&(g[b]=_.call(c));g=St(g)}P.apply(c,g),S&&!u&&g.length>0&&y+t.length>1&&st.uniqueSort(c)}return S&&(E=N,f=x),w};return r?at(u):u}function Ct(e,t,n){var r=0,i=t.length;for(;r<i;r++)st(e,t[r],n);return n}function kt(e,t,n,i){var o,u,f,l,c,h=yt(e);if(!i&&h.length===1){u=h[0]=h[0].slice(0);if(u.length>2&&(f=u[0]).type==="ID"&&r.getById&&t.nodeType===9&&d&&s.relative[u[1].type]){t=(s.find.ID(f.matches[0].replace(nt,rt),t)||[])[0];if(!t)return n;e=e.slice(u.shift().value.length)}o=Q.needsContext.test(e)?0:u.length;while(o--){f=u[o];if(s.relative[l=f.type])break;if(c=s.find[l])if(i=c(f.matches[0].replace(nt,rt),V.test(u[0].type)&&t.parentNode||t)){u.splice(o,1),e=i.length&&bt(u);if(!e)return P.apply(n,i),n;break}}}return a(e,h)(i,t,!d,n,V.test(e)),n}function Lt(){}var n,r,i,s,o,u,a,f,l,c,h,p,d,v,m,g,y,b="sizzle"+ -(new Date),w=e.document,E=0,S=0,x=ut(),T=ut(),N=ut(),C=!1,k=function(){return 0},L=typeof t,A=1<<31,O={}.hasOwnProperty,M=[],_=M.pop,D=M.push,P=M.push,H=M.slice,B=M.indexOf||function(e){var t=0,n=this.length;for(;t<n;t++)if(this[t]===e)return t;return-1},j="checked|selected|async|autofocus|autoplay|controls|defer|disabled|hidden|ismap|loop|multiple|open|readonly|required|scoped",F="[\\x20\\t\\r\\n\\f]",I="(?:\\\\.|[\\w-]|[^\\x00-\\xa0])+",q=I.replace("w","w#"),R="\\["+F+"*("+I+")"+F+"*(?:([*^$|!~]?=)"+F+"*(?:(['\"])((?:\\\\.|[^\\\\])*?)\\3|("+q+")|)|)"+F+"*\\]",U=":("+I+")(?:\\(((['\"])((?:\\\\.|[^\\\\])*?)\\3|((?:\\\\.|[^\\\\()[\\]]|"+R.replace(3,8)+")*)|.*)\\)|)",z=new RegExp("^"+F+"+|((?:^|[^\\\\])(?:\\\\.)*)"+F+"+$","g"),W=new RegExp("^"+F+"*,"+F+"*"),X=new RegExp("^"+F+"*([>+~]|"+F+")"+F+"*"),V=new RegExp(F+"*[+~]"),$=new RegExp("="+F+"*([^\\]'\"]*)"+F+"*\\]","g"),J=new RegExp(U),K=new RegExp("^"+q+"$"),Q={ID:new RegExp("^#("+I+")"),CLASS:new RegExp("^\\.("+I+")"),TAG:new RegExp("^("+I.replace("w","w*")+")"),ATTR:new RegExp("^"+R),PSEUDO:new RegExp("^"+U),CHILD:new RegExp("^:(only|first|last|nth|nth-last)-(child|of-type)(?:\\("+F+"*(even|odd|(([+-]|)(\\d*)n|)"+F+"*(?:([+-]|)"+F+"*(\\d+)|))"+F+"*\\)|)","i"),bool:new RegExp("^(?:"+j+")$","i"),needsContext:new RegExp("^"+F+"*[>+~]|:(even|odd|eq|gt|lt|nth|first|last)(?:\\("+F+"*((?:-\\d)?\\d*)"+F+"*\\)|)(?=[^-]|$)","i")},G=/^[^{]+\{\s*\[native \w/,Y=/^(?:#([\w-]+)|(\w+)|\.([\w-]+))$/,Z=/^(?:input|select|textarea|button)$/i,et=/^h\d$/i,tt=/'|\\/g,nt=new RegExp("\\\\([\\da-f]{1,6}"+F+"?|("+F+")|.)","ig"),rt=function(e,t,n){var r="0x"+t-65536;return r!==r||n?t:r<0?String.fromCharCode(r+65536):String.fromCharCode(r>>10|55296,r&1023|56320)};try{P.apply(M=H.call(w.childNodes),w.childNodes),M[w.childNodes.length].nodeType}catch(it){P={apply:M.length?function(e,t){D.apply(e,H.call(t))}:function(e,t){var n=e.length,r=0;while(e[n++]=t[r++]);e.length=n-1}}}u=st.isXML=function(e){var t=e&&(e.ownerDocument||e).documentElement;return t?t.nodeName!=="HTML":!1},r=st.support={},c=st.setDocument=function(e){var t=e?e.ownerDocument||e:w,n=t.parentWindow;if(t===h||t.nodeType!==9||!t.documentElement)return h;h=t,p=t.documentElement,d=!u(t),n&&n.frameElement&&n.attachEvent("onbeforeunload",function(){c()}),r.attributes=ft(function(e){return e.innerHTML="<a href='#'></a>",lt("type|href|height|width",ht,e.firstChild.getAttribute("href")==="#"),lt(j,ct,e.getAttribute("disabled")==null),e.className="i",!e.getAttribute("className")}),r.input=ft(function(e){return e.innerHTML="<input>",e.firstChild.setAttribute("value",""),e.firstChild.getAttribute("value")===""}),lt("value",pt,r.attributes&&r.input),r.getElementsByTagName=ft(function(e){return e.appendChild(t.createComment("")),!e.getElementsByTagName("*").length}),r.getElementsByClassName=ft(function(e){return e.innerHTML="<div class='a'></div><div class='a i'></div>",e.firstChild.className="i",e.getElementsByClassName("i").length===2}),r.getById=ft(function(e){return p.appendChild(e).id=b,!t.getElementsByName||!t.getElementsByName(b).length}),r.getById?(s.find.ID=function(e,t){if(typeof t.getElementById!==L&&d){var n=t.getElementById(e);return n&&n.parentNode?[n]:[]}},s.filter.ID=function(e){var t=e.replace(nt,rt);return function(e){return e.getAttribute("id")===t}}):(delete s.find.ID,s.filter.ID=function(e){var t=e.replace(nt,rt);return function(e){var n=typeof e.getAttributeNode!==L&&e.getAttributeNode("id");return n&&n.value===t}}),s.find.TAG=r.getElementsByTagName?function(e,t){if(typeof t.getElementsByTagName!==L)return t.getElementsByTagName(e)}:function(e,t){var n,r=[],i=0,s=t.getElementsByTagName(e);if(e==="*"){while(n=s[i++])n.nodeType===1&&r.push(n);return r}return s},s.find.CLASS=r.getElementsByClassName&&function(e,t){if(typeof t.getElementsByClassName!==L&&d)return t.getElementsByClassName(e)},m=[],v=[];if(r.qsa=ot(t.querySelectorAll))ft(function(e){e.innerHTML="<select><option selected=''></option></select>",e.querySelectorAll("[selected]").length||v.push("\\["+F+"*(?:value|"+j+")"),e.querySelectorAll(":checked").length||v.push(":checked")}),ft(function(e){var n=t.createElement("input");n.setAttribute("type","hidden"),e.appendChild(n).setAttribute("t",""),e.querySelectorAll("[t^='']").length&&v.push("[*^$]="+F+"*(?:''|\"\")"),e.querySelectorAll(":enabled").length||v.push(":enabled",":disabled"),e.querySelectorAll("*,:x"),v.push(",.*:")});return(r.matchesSelector=ot(g=p.webkitMatchesSelector||p.mozMatchesSelector||p.oMatchesSelector||p.msMatchesSelector))&&ft(function(e){r.disconnectedMatch=g.call(e,"div"),g.call(e,"[s!='']:x"),m.push("!=",U)}),v=v.length&&new RegExp(v.join("|")),m=m.length&&new RegExp(m.join("|")),y=ot(p.contains)||p.compareDocumentPosition?function(e,t){var n=e.nodeType===9?e.documentElement:e,r=t&&t.parentNode;return e===r||!!r&&r.nodeType===1&&!!(n.contains?n.contains(r):e.compareDocumentPosition&&e.compareDocumentPosition(r)&16)}:function(e,t){if(t)while(t=t.parentNode)if(t===e)return!0;return!1},r.sortDetached=ft(function(e){return e.compareDocumentPosition(t.createElement("div"))&1}),k=p.compareDocumentPosition?function(e,n){if(e===n)return C=!0,0;var i=n.compareDocumentPosition&&e.compareDocumentPosition&&e.compareDocumentPosition(n);if(i)return i&1||!r.sortDetached&&n.compareDocumentPosition(e)===i?e===t||y(w,e)?-1:n===t||y(w,n)?1:l?B.call(l,e)-B.call(l,n):0:i&4?-1:1;return e.compareDocumentPosition?-1:1}:function(e,n){var r,i=0,s=e.parentNode,o=n.parentNode,u=[e],a=[n];if(e===n)return C=!0,0;if(!s||!o)return e===t?-1:n===t?1:s?-1:o?1:l?B.call(l,e)-B.call(l,n):0;if(s===o)return dt(e,n);r=e;while(r=r.parentNode)u.unshift(r);r=n;while(r=r.parentNode)a.unshift(r);while(u[i]===a[i])i++;return i?dt(u[i],a[i]):u[i]===w?-1:a[i]===w?1:0},t},st.matches=function(e,t){return st(e,null,null,t)},st.matchesSelector=function(e,t){(e.ownerDocument||e)!==h&&c(e),t=t.replace($,"='$1']");if(r.matchesSelector&&d&&(!m||!m.test(t))&&(!v||!v.test(t)))try{var n=g.call(e,t);if(n||r.disconnectedMatch||e.document&&e.document.nodeType!==11)return n}catch(i){}return st(t,h,null,[e]).length>0},st.contains=function(e,t){return(e.ownerDocument||e)!==h&&c(e),y(e,t)},st.attr=function(e,n){(e.ownerDocument||e)!==h&&c(e);var i=s.attrHandle[n.toLowerCase()],o=i&&O.call(s.attrHandle,n.toLowerCase())?i(e,n,!d):t;return o===t?r.attributes||!d?e.getAttribute(n):(o=e.getAttributeNode(n))&&o.specified?o.value:null:o},st.error=function(e){throw new Error("Syntax error, unrecognized expression: "+e)},st.uniqueSort=function(e){var t,n=[],i=0,s=0;C=!r.detectDuplicates,l=!r.sortStable&&e.slice(0),e.sort(k);if(C){while(t=e[s++])t===e[s]&&(i=n.push(s));while(i--)e.splice(n[i],1)}return e},o=st.getText=function(e){var t,n="",r=0,i=e.nodeType;if(!i)for(;t=e[r];r++)n+=o(t);else if(i===1||i===9||i===11){if(typeof e.textContent=="string")return e.textContent;for(e=e.firstChild;e;e=e.nextSibling)n+=o(e)}else if(i===3||i===4)return e.nodeValue;return n},s=st.selectors={cacheLength:50,createPseudo:at,match:Q,attrHandle:{},find:{},relative:{">":{dir:"parentNode",first:!0}," ":{dir:"parentNode"},"+":{dir:"previousSibling",first:!0},"~":{dir:"previousSibling"}},preFilter:{ATTR:function(e){return e[1]=e[1].replace(nt,rt),e[3]=(e[4]||e[5]||"").replace(nt,rt),e[2]==="~="&&(e[3]=" "+e[3]+" "),e.slice(0,4)},CHILD:function(e){return e[1]=e[1].toLowerCase(),e[1].slice(0,3)==="nth"?(e[3]||st.error(e[0]),e[4]=+(e[4]?e[5]+(e[6]||1):2*(e[3]==="even"||e[3]==="odd")),e[5]=+(e[7]+e[8]||e[3]==="odd")):e[3]&&st.error(e[0]),e},PSEUDO:function(e){var n,r=!e[5]&&e[2];return Q.CHILD.test(e[0])?null:(e[3]&&e[4]!==t?e[2]=e[4]:r&&J.test(r)&&(n=yt(r,!0))&&(n=r.indexOf(")",r.length-n)-r.length)&&(e[0]=e[0].slice(0,n),e[2]=r.slice(0,n)),e.slice(0,3))}},filter:{TAG:function(e){var t=e.replace(nt,rt).toLowerCase();return e==="*"?function(){return!0}:function(e){return e.nodeName&&e.nodeName.toLowerCase()===t}},CLASS:function(e){var t=x[e+" "];return t||(t=new RegExp("(^|"+F+")"+e+"("+F+"|$)"))&&x(e,function(e){return t.test(typeof e.className=="string"&&e.className||typeof e.getAttribute!==L&&e.getAttribute("class")||"")})},ATTR:function(e,t,n){return function(r){var i=st.attr(r,e);return i==null?t==="!=":t?(i+="",t==="="?i===n:t==="!="?i!==n:t==="^="?n&&i.indexOf(n)===0:t==="*="?n&&i.indexOf(n)>-1:t==="$="?n&&i.slice(-n.length)===n:t==="~="?(" "+i+" ").indexOf(n)>-1:t==="|="?i===n||i.slice(0,n.length+1)===n+"-":!1):!0}},CHILD:function(e,t,n,r,i){var s=e.slice(0,3)!=="nth",o=e.slice(-4)!=="last",u=t==="of-type";return r===1&&i===0?function(e){return!!e.parentNode}:function(t,n,a){var f,l,c,h,p,d,v=s!==o?"nextSibling":"previousSibling",m=t.parentNode,g=u&&t.nodeName.toLowerCase(),y=!a&&!u;if(m){if(s){while(v){c=t;while(c=c[v])if(u?c.nodeName.toLowerCase()===g:c.nodeType===1)return!1;d=v=e==="only"&&!d&&"nextSibling"}return!0}d=[o?m.firstChild:m.lastChild];if(o&&y){l=m[b]||(m[b]={}),f=l[e]||[],p=f[0]===E&&f[1],h=f[0]===E&&f[2],c=p&&m.childNodes[p];while(c=++p&&c&&c[v]||(h=p=0)||d.pop())if(c.nodeType===1&&++h&&c===t){l[e]=[E,p,h];break}}else if(y&&(f=(t[b]||(t[b]={}))[e])&&f[0]===E)h=f[1];else while(c=++p&&c&&c[v]||(h=p=0)||d.pop())if((u?c.nodeName.toLowerCase()===g:c.nodeType===1)&&++h){y&&((c[b]||(c[b]={}))[e]=[E,h]);if(c===t)break}return h-=i,h===r||h%r===0&&h/r>=0}}},PSEUDO:function(e,t){var n,r=s.pseudos[e]||s.setFilters[e.toLowerCase()]||st.error("unsupported pseudo: "+e);return r[b]?r(t):r.length>1?(n=[e,e,"",t],s.setFilters.hasOwnProperty(e.toLowerCase())?at(function(e,n){var i,s=r(e,t),o=s.length;while(o--)i=B.call(e,s[o]),e[i]=!(n[i]=s[o])}):function(e){return r(e,0,n)}):r}},pseudos:{not:at(function(e){var t=[],n=[],r=a(e.replace(z,"$1"));return r[b]?at(function(e,t,n,i){var s,o=r(e,null,i,[]),u=e.length;while(u--)if(s=o[u])e[u]=!(t[u]=s)}):function(e,i,s){return t[0]=e,r(t,null,s,n),!n.pop()}}),has:at(function(e){return function(t){return st(e,t).length>0}}),contains:at(function(e){return function(t){return(t.textContent||t.innerText||o(t)).indexOf(e)>-1}}),lang:at(function(e){return K.test(e||"")||st.error("unsupported lang: "+e),e=e.replace(nt,rt).toLowerCase(),function(t){var n;do if(n=d?t.lang:t.getAttribute("xml:lang")||t.getAttribute("lang"))return n=n.toLowerCase(),n===e||n.indexOf(e+"-")===0;while((t=t.parentNode)&&t.nodeType===1);return!1}}),target:function(t){var n=e.location&&e.location.hash;return n&&n.slice(1)===t.id},root:function(e){return e===p},focus:function(e){return e===h.activeElement&&(!h.hasFocus||h.hasFocus())&&!!(e.type||e.href||~e.tabIndex)},enabled:function(e){return e.disabled===!1},disabled:function(e){return e.disabled===!0},checked:function(e){var t=e.nodeName.toLowerCase();return t==="input"&&!!e.checked||t==="option"&&!!e.selected},selected:function(e){return e.parentNode&&e.parentNode.selectedIndex,e.selected===!0},empty:function(e){for(e=e.firstChild;e;e=e.nextSibling)if(e.nodeName>"@"||e.nodeType===3||e.nodeType===4)return!1;return!0},parent:function(e){return!s.pseudos.empty(e)},header:function(e){return et.test(e.nodeName)},input:function(e){return Z.test(e.nodeName)},button:function(e){var t=e.nodeName.toLowerCase();return t==="input"&&e.type==="button"||t==="button"},text:function(e){var t;return e.nodeName.toLowerCase()==="input"&&e.type==="text"&&((t=e.getAttribute("type"))==null||t.toLowerCase()===e.type)},first:gt(function(){return[0]}),last:gt(function(e,t){return[t-1]}),eq:gt(function(e,t,n){return[n<0?n+t:n]}),even:gt(function(e,t){var n=0;for(;n<t;n+=2)e.push(n);return e}),odd:gt(function(e,t){var n=1;for(;n<t;n+=2)e.push(n);return e}),lt:gt(function(e,t,n){var r=n<0?n+t:n;for(;--r>=0;)e.push(r);return e}),gt:gt(function(e,t,n){var r=n<0?n+t:n;for(;++r<t;)e.push(r);return e})}};for(n in{radio:!0,checkbox:!0,file:!0,password:!0,image:!0})s.pseudos[n]=vt(n);for(n in{submit:!0,reset:!0})s.pseudos[n]=mt(n);a=st.compile=function(e,t){var n,r=[],i=[],s=N[e+" "];if(!s){t||(t=yt(e)),n=t.length;while(n--)s=Tt(t[n]),s[b]?r.push(s):i.push(s);s=N(e,Nt(i,r))}return s},s.pseudos.nth=s.pseudos.eq,Lt.prototype=s.filters=s.pseudos,s.setFilters=new Lt,r.sortStable=b.split("").sort(k).join("")===b,c(),[0,0].sort(k),r.detectDuplicates=C,jQuery.find=st,jQuery.expr=st.selectors,jQuery.expr[":"]=jQuery.expr.pseudos,jQuery.unique=st.uniqueSort,jQuery.text=st.getText,jQuery.isXMLDoc=st.isXML,jQuery.contains=st.contains}(window);var optionsCache={};jQuery.Callbacks=function(e){e=typeof e=="string"?optionsCache[e]||createOptions(e):jQuery.extend({},e);var t,n,r,i,s,o,u=[],a=!e.once&&[],f=function(c){t=e.memory&&c,n=!0,o=i||0,i=0,s=u.length,r=!0;for(;u&&o<s;o++)if(u[o].apply(c[0],c[1])===!1&&e.stopOnFalse){t=!1;break}r=!1,u&&(a?a.length&&f(a.shift()):t?u=[]:l.disable())},l={add:function(){if(u){var n=u.length;(function o(t){jQuery.each(t,function(t,n){var r=jQuery.type(n);r==="function"?(!e.unique||!l.has(n))&&u.push(n):n&&n.length&&r!=="string"&&o(n)})})(arguments),r?s=u.length:t&&(i=n,f(t))}return this},remove:function(){return u&&jQuery.each(arguments,function(e,t){var n;while((n=jQuery.inArray(t,u,n))>-1)u.splice(n,1),r&&(n<=s&&s--,n<=o&&o--)}),this},has:function(e){return e?jQuery.inArray(e,u)>-1:!!u&&!!u.length},empty:function(){return u=[],s=0,this},disable:function(){return u=a=t=undefined,this},disabled:function(){return!u},lock:function(){return a=undefined,t||l.disable(),this},locked:function(){return!a},fireWith:function(e,t){return t=t||[],t=[e,t.slice?t.slice():t],u&&(!n||a)&&(r?a.push(t):f(t)),this},fire:function(){return l.fireWith(this,arguments),this},fired:function(){return!!n}};return l},jQuery.extend({Deferred:function(e){var t=[["resolve","done",jQuery.Callbacks("once memory"),"resolved"],["reject","fail",jQuery.Callbacks("once memory"),"rejected"],["notify","progress",jQuery.Callbacks("memory")]],n="pending",r={state:function(){return n},always:function(){return i.done(arguments).fail(arguments),this},then:function(){var e=arguments;return jQuery.Deferred(function(n){jQuery.each(t,function(t,s){var o=s[0],u=jQuery.isFunction(e[t])&&e[t];i[s[1]](function(){var e=u&&u.apply(this,arguments);e&&jQuery.isFunction(e.promise)?e.promise().done(n.resolve).fail(n.reject).progress(n.notify):n[o+"With"](this===r?n.promise():this,u?[e]:arguments)})}),e=null}).promise()},promise:function(e){return e!=null?jQuery.extend(e,r):r}},i={};return r.pipe=r.then,jQuery.each(t,function(e,s){var o=s[2],u=s[3];r[s[1]]=o.add,u&&o.add(function(){n=u},t[e^1][2].disable,t[2][2].lock),i[s[0]]=function(){return i[s[0]+"With"](this===i?r:this,arguments),this},i[s[0]+"With"]=o.fireWith}),r.promise(i),e&&e.call(i,i),i},when:function(e){var t=0,n=core_slice.call(arguments),r=n.length,i=r!==1||e&&jQuery.isFunction(e.promise)?r:0,s=i===1?e:jQuery.Deferred(),o=function(e,t,n){return function(r){t[e]=this,n[e]=arguments.length>1?core_slice.call(arguments):r,n===u?s.notifyWith(t,n):--i||s.resolveWith(t,n)}},u,a,f;if(r>1){u=new Array(r),a=new Array(r),f=new Array(r);for(;t<r;t++)n[t]&&jQuery.isFunction(n[t].promise)?n[t].promise().done(o(t,f,n)).fail(s.reject).progress(o(t,a,u)):--i}return i||s.resolveWith(f,n),s.promise()}}),jQuery.support=function(e){var t=document.createElement("input"),n=document.createDocumentFragment(),r=document.createElement("div"),i=document.createElement("select"),s=i.appendChild(document.createElement("option"));return t.type?(t.type="checkbox",e.checkOn=t.value!=="",e.optSelected=s.selected,e.reliableMarginRight=!0,e.boxSizingReliable=!0,e.pixelPosition=!1,t.checked=!0,e.noCloneChecked=t.cloneNode(!0).checked,i.disabled=!0,e.optDisabled=!s.disabled,t=document.createElement("input"),t.value="t",t.type="radio",e.radioValue=t.value==="t",t.setAttribute("checked","t"),t.setAttribute("name","t"),n.appendChild(t),e.checkClone=n.cloneNode(!0).cloneNode(!0).lastChild.checked,e.focusinBubbles="onfocusin"in window,r.style.backgroundClip="content-box",r.cloneNode(!0).style.backgroundClip="",e.clearCloneStyle=r.style.backgroundClip==="content-box",jQuery(function(){var t,n,i="padding:0;margin:0;border:0;display:block;-webkit-box-sizing:content-box;-moz-box-sizing:content-box;box-sizing:content-box",s=document.getElementsByTagName("body")[0];if(!s)return;t=document.createElement("div"),t.style.cssText="border:0;width:0;height:0;position:absolute;top:0;left:-9999px;margin-top:1px",s.appendChild(t).appendChild(r),r.innerHTML="",r.style.cssText="-webkit-box-sizing:border-box;-moz-box-sizing:border-box;box-sizing:border-box;padding:1px;border:1px;display:block;width:4px;margin-top:1%;position:absolute;top:1%",jQuery.swap(s,s.style.zoom!=null?{zoom:1}:{},function(){e.boxSizing=r.offsetWidth===4}),window.getComputedStyle&&(e.pixelPosition=(window.getComputedStyle(r,null)||{}).top!=="1%",e.boxSizingReliable=(window.getComputedStyle(r,null)||{width:"4px"}).width==="4px",n=r.appendChild(document.createElement("div")),n.style.cssText=r.style.cssText=i,n.style.marginRight=n.style.width="0",r.style.width="1px",e.reliableMarginRight=!parseFloat((window.getComputedStyle(n,null)||{}).marginRight)),s.removeChild(t)}),e):e}({});var data_user,data_priv,rbrace=/(?:\{[\s\S]*\}|\[[\s\S]*\])$/,rmultiDash=/([A-Z])/g;Data.uid=1,Data.accepts=function(e){return e.nodeType?e.nodeType===1||e.nodeType===9:!0},Data.prototype={key:function(e){if(!Data.accepts(e))return 0;var t={},n=e[this.expando];if(!n){n=Data.uid++;try{t[this.expando]={value:n},Object.defineProperties(e,t)}catch(r){t[this.expando]=n,jQuery.extend(e,t)}}return this.cache[n]||(this.cache[n]={}),n},set:function(e,t,n){var r,i=this.key(e),s=this.cache[i];if(typeof t=="string")s[t]=n;else if(jQuery.isEmptyObject(s))jQuery.extend(this.cache[i],t);else for(r in t)s[r]=t[r];return s},get:function(e,t){var n=this.cache[this.key(e)];return t===undefined?n:n[t]},access:function(e,t,n){return t===undefined||t&&typeof t=="string"&&n===undefined?this.get(e,t):(this.set(e,t,n),n!==undefined?n:t)},remove:function(e,t){var n,r,i,s=this.key(e),o=this.cache[s];if(t===undefined)this.cache[s]={};else{jQuery.isArray(t)?r=t.concat(t.map(jQuery.camelCase)):(i=jQuery.camelCase(t),t in o?r=[t,i]:(r=i,r=r in o?[r]:r.match(core_rnotwhite)||[])),n=r.length;while(n--)delete o[r[n]]}},hasData:function(e){return!jQuery.isEmptyObject(this.cache[e[this.expando]]||{})},discard:function(e){e[this.expando]&&delete this.cache[e[this.expando]]}},data_user=new Data,data_priv=new Data,jQuery.extend({acceptData:Data.accepts,hasData:function(e){return data_user.hasData(e)||data_priv.hasData(e)},data:function(e,t,n){return data_user.access(e,t,n)},removeData:function(e,t){data_user.remove(e,t)},_data:function(e,t,n){return data_priv.access(e,t,n)},_removeData:function(e,t){data_priv.remove(e,t)}}),jQuery.fn.extend({data:function(e,t){var n,r,i=this[0],s=0,o=null;if(e===undefined){if(this.length){o=data_user.get(i);if(i.nodeType===1&&!data_priv.get(i,"hasDataAttrs")){n=i.attributes;for(;s<n.length;s++)r=n[s].name,r.indexOf("data-")===0&&(r=jQuery.camelCase(r.slice(5)),dataAttr(i,r,o[r]));data_priv.set(i,"hasDataAttrs",!0)}}return o}return typeof e=="object"?this.each(function(){data_user.set(this,e)}):jQuery.access(this,function(t){var n,r=jQuery.camelCase(e);if(i&&t===undefined){n=data_user.get(i,e);if(n!==undefined)return n;n=data_user.get(i,r);if(n!==undefined)return n;n=dataAttr(i,r,undefined);if(n!==undefined)return n;return}this.each(function(){var n=data_user.get(this,r);data_user.set(this,r,t),e.indexOf("-")!==-1&&n!==undefined&&data_user.set(this,e,t)})},null,t,arguments.length>1,null,!0)},removeData:function(e){return this.each(function(){data_user.remove(this,e)})}}),jQuery.extend({queue:function(e,t,n){var r;if(e)return t=(t||"fx")+"queue",r=data_priv.get(e,t),n&&(!r||jQuery.isArray(n)?r=data_priv.access(e,t,jQuery.makeArray(n)):r.push(n)),r||[]},dequeue:function(e,t){t=t||"fx";var n=jQuery.queue(e,t),r=n.length,i=n.shift(),s=jQuery._queueHooks(e,t),o=function(){jQuery.dequeue(e,t)};i==="inprogress"&&(i=n.shift(),r--),i&&(t==="fx"&&n.unshift("inprogress"),delete s.stop,i.call(e,o,s)),!r&&s&&s.empty.fire()},_queueHooks:function(e,t){var n=t+"queueHooks";return data_priv.get(e,n)||data_priv.access(e,n,{empty:jQuery.Callbacks("once memory").add(function(){data_priv.remove(e,[t+"queue",n])})})}}),jQuery.fn.extend({queue:function(e,t){var n=2;return typeof e!="string"&&(t=e,e="fx",n--),arguments.length<n?jQuery.queue(this[0],e):t===undefined?this:this.each(function(){var n=jQuery.queue(this,e,t);jQuery._queueHooks(this,e),e==="fx"&&n[0]!=="inprogress"&&jQuery.dequeue(this,e)})},dequeue:function(e){return this.each(function(){jQuery.dequeue(this,e)})},delay:function(e,t){return e=jQuery.fx?jQuery.fx.speeds[e]||e:e,t=t||"fx",this.queue(t,function(t,n){var r=setTimeout(t,e);n.stop=function(){clearTimeout(r)}})},clearQueue:function(e){return this.queue(e||"fx",[])},promise:function(e,t){var n,r=1,i=jQuery.Deferred(),s=this,o=this.length,u=function(){--r||i.resolveWith(s,[s])};typeof e!="string"&&(t=e,e=undefined),e=e||"fx";while(o--)n=data_priv.get(s[o],e+"queueHooks"),n&&n.empty&&(r++,n.empty.add(u));return u(),i.promise(t)}});var nodeHook,boolHook,rclass=/[\t\r\n\f]/g,rreturn=/\r/g,rfocusable=/^(?:input|select|textarea|button)$/i;jQuery.fn.extend({attr:function(e,t){return jQuery.access(this,jQuery.attr,e,t,arguments.length>1)},removeAttr:function(e){return this.each(function(){jQuery.removeAttr(this,e)})},prop:function(e,t){return jQuery.access(this,jQuery.prop,e,t,arguments.length>1)},removeProp:function(e){return this.each(function(){delete this[jQuery.propFix[e]||e]})},addClass:function(e){var t,n,r,i,s,o=0,u=this.length,a=typeof e=="string"&&e;if(jQuery.isFunction(e))return this.each(function(t){jQuery(this).addClass(e.call(this,t,this.className))});if(a){t=(e||"").match(core_rnotwhite)||[];for(;o<u;o++){n=this[o],r=n.nodeType===1&&(n.className?(" "+n.className+" ").replace(rclass," "):" ");if(r){s=0;while(i=t[s++])r.indexOf(" "+i+" ")<0&&(r+=i+" ");n.className=jQuery.trim(r)}}}return this},removeClass:function(e){var t,n,r,i,s,o=0,u=this.length,a=arguments.length===0||typeof e=="string"&&e;if(jQuery.isFunction(e))return this.each(function(t){jQuery(this).removeClass(e.call(this,t,this.className))});if(a){t=(e||"").match(core_rnotwhite)||[];for(;o<u;o++){n=this[o],r=n.nodeType===1&&(n.className?(" "+n.className+" ").replace(rclass," "):"");if(r){s=0;while(i=t[s++])while(r.indexOf(" "+i+" ")>=0)r=r.replace(" "+i+" "," ");n.className=e?jQuery.trim(r):""}}}return this},toggleClass:function(e,t){var n=typeof e,r=typeof t=="boolean";return jQuery.isFunction(e)?this.each(function(n){jQuery(this).toggleClass(e.call(this,n,this.className,t),t)}):this.each(function(){if(n==="string"){var i,s=0,o=jQuery(this),u=t,a=e.match(core_rnotwhite)||[];while(i=a[s++])u=r?u:!o.hasClass(i),o[u?"addClass":"removeClass"](i)}else if(n===core_strundefined||n==="boolean")this.className&&data_priv.set(this,"__className__",this.className),this.className=this.className||e===!1?"":data_priv.get(this,"__className__")||""})},hasClass:function(e){var t=" "+e+" ",n=0,r=this.length;for(;n<r;n++)if(this[n].nodeType===1&&(" "+this[n].className+" ").replace(rclass," ").indexOf(t)>=0)return!0;return!1},val:function(e){var t,n,r,i=this[0];if(!arguments.length){if(i)return t=jQuery.valHooks[i.type]||jQuery.valHooks[i.nodeName.toLowerCase()],t&&"get"in t&&(n=t.get(i,"value"))!==undefined?n:(n=i.value,typeof n=="string"?n.replace(rreturn,""):n==null?"":n);return}return r=jQuery.isFunction(e),this.each(function(n){var i;if(this.nodeType!==1)return;r?i=e.call(this,n,jQuery(this).val()):i=e,i==null?i="":typeof i=="number"?i+="":jQuery.isArray(i)&&(i=jQuery.map(i,function(e){return e==null?"":e+""})),t=jQuery.valHooks[this.type]||jQuery.valHooks[this.nodeName.toLowerCase()];if(!t||!("set"in t)||t.set(this,i,"value")===undefined)this.value=i})}}),jQuery.extend({valHooks:{option:{get:function(e){var t=e.attributes.value;return!t||t.specified?e.value:e.text}},select:{get:function(e){var t,n,r=e.options,i=e.selectedIndex,s=e.type==="select-one"||i<0,o=s?null:[],u=s?i+1:r.length,a=i<0?u:s?i:0;for(;a<u;a++){n=r[a];if((n.selected||a===i)&&(jQuery.support.optDisabled?!n.disabled:n.getAttribute("disabled")===null)&&(!n.parentNode.disabled||!jQuery.nodeName(n.parentNode,"optgroup"))){t=jQuery(n).val();if(s)return t;o.push(t)}}return o},set:function(e,t){var n,r,i=e.options,s=jQuery.makeArray(t),o=i.length;while(o--){r=i[o];if(r.selected=jQuery.inArray(jQuery(r).val(),s)>=0)n=!0}return n||(e.selectedIndex=-1),s}}},attr:function(e,t,n){var r,i,s=e.nodeType;if(!e||s===3||s===8||s===2)return;if(typeof e.getAttribute===core_strundefined)return jQuery.prop(e,t,n);if(s!==1||!jQuery.isXMLDoc(e))t=t.toLowerCase(),r=jQuery.attrHooks[t]||(jQuery.expr.match.bool.test(t)?boolHook:nodeHook);if(n===undefined)return r&&"get"in r&&(i=r.get(e,t))!==null?i:(i=jQuery.find.attr(e,t),i==null?undefined:i);if(n!==null)return r&&"set"in r&&(i=r.set(e,n,t))!==undefined?i:(e.setAttribute(t,n+""),n);jQuery.removeAttr(e,t)},removeAttr:function(e,t){var n,r,i=0,s=t&&t.match(core_rnotwhite);if(s&&e.nodeType===1)while(n=s[i++])r=jQuery.propFix[n]||n,jQuery.expr.match.bool.test(n)&&(e[r]=!1),e.removeAttribute(n)},attrHooks:{type:{set:function(e,t){if(!jQuery.support.radioValue&&t==="radio"&&jQuery.nodeName(e,"input")){var n=e.value;return e.setAttribute("type",t),n&&(e.value=n),t}}}},propFix:{"for":"htmlFor","class":"className"},prop:function(e,t,n){var r,i,s,o=e.nodeType;if(!e||o===3||o===8||o===2)return;return s=o!==1||!jQuery.isXMLDoc(e),s&&(t=jQuery.propFix[t]||t,i=jQuery.propHooks[t]),n!==undefined?i&&"set"in i&&(r=i.set(e,n,t))!==undefined?r:e[t]=n:i&&"get"in i&&(r=i.get(e,t))!==null?r:e[t]},propHooks:{tabIndex:{get:function(e){return e.hasAttribute("tabindex")||rfocusable.test(e.nodeName)||e.href?e.tabIndex:-1}}}}),boolHook={set:function(e,t,n){return t===!1?jQuery.removeAttr(e,n):e.setAttribute(n,n),n}},jQuery.each(jQuery.expr.match.bool.source.match(/\w+/g),function(e,t){var n=jQuery.expr.attrHandle[t]||jQuery.find.attr;jQuery.expr.attrHandle[t]=function(e,t,r){var i=jQuery.expr.attrHandle[t],s=r?undefined:(jQuery.expr.attrHandle[t]=undefined)!=n(e,t,r)?t.toLowerCase():null;return jQuery.expr.attrHandle[t]=i,s}}),jQuery.support.optSelected||(jQuery.propHooks.selected={get:function(e){var t=e.parentNode;return t&&t.parentNode&&t.parentNode.selectedIndex,null}}),jQuery.each(["tabIndex","readOnly","maxLength","cellSpacing","cellPadding","rowSpan","colSpan","useMap","frameBorder","contentEditable"],function(){jQuery.propFix[this.toLowerCase()]=this}),jQuery.each(["radio","checkbox"],function(){jQuery.valHooks[this]={set:function(e,t){if(jQuery.isArray(t))return e.checked=jQuery.inArray(jQuery(e).val(),t)>=0}},jQuery.support.checkOn||(jQuery.valHooks[this].get=function(e){return e.getAttribute("value")===null?"on":e.value})});var rkeyEvent=/^key/,rmouseEvent=/^(?:mouse|contextmenu)|click/,rfocusMorph=/^(?:focusinfocus|focusoutblur)$/,rtypenamespace=/^([^.]*)(?:\.(.+)|)$/;jQuery.event={global:{},add:function(e,t,n,r,i){var s,o,u,a,f,l,c,h,p,d,v,m=data_priv.get(e);if(!m)return;n.handler&&(s=n,n=s.handler,i=s.selector),n.guid||(n.guid=jQuery.guid++),(a=m.events)||(a=m.events={}),(o=m.handle)||(o=m.handle=function(e){return typeof jQuery===core_strundefined||!!e&&jQuery.event.triggered===e.type?undefined:jQuery.event.dispatch.apply(o.elem,arguments)},o.elem=e),t=(t||"").match(core_rnotwhite)||[""],f=t.length;while(f--){u=rtypenamespace.exec(t[f])||[],p=v=u[1],d=(u[2]||"").split(".").sort();if(!p)continue;c=jQuery.event.special[p]||{},p=(i?c.delegateType:c.bindType)||p,c=jQuery.event.special[p]||{},l=jQuery.extend({type:p,origType:v,data:r,handler:n,guid:n.guid,selector:i,needsContext:i&&jQuery.expr.match.needsContext.test(i),namespace:d.join(".")},s),(h=a[p])||(h=a[p]=[],h.delegateCount=0,(!c.setup||c.setup.call(e,r,d,o)===!1)&&e.addEventListener&&e.addEventListener(p,o,!1)),c.add&&(c.add.call(e,l),l.handler.guid||(l.handler.guid=n.guid)),i?h.splice(h.delegateCount++,0,l):h.push(l),jQuery.event.global[p]=!0}e=null},remove:function(e,t,n,r,i){var s,o,u,a,f,l,c,h,p,d,v,m=data_priv.hasData(e)&&data_priv.get(e);if(!m||!(a=m.events))return;t=(t||"").match(core_rnotwhite)||[""],f=t.length;while(f--){u=rtypenamespace.exec(t[f])||[],p=v=u[1],d=(u[2]||"").split(".").sort();if(!p){for(p in a)jQuery.event.remove(e,p+t[f],n,r,!0);continue}c=jQuery.event.special[p]||{},p=(r?c.delegateType:c.bindType)||p,h=a[p]||[],u=u[2]&&new RegExp("(^|\\.)"+d.join("\\.(?:.*\\.|)")+"(\\.|$)"),o=s=h.length;while(s--)l=h[s],(i||v===l.origType)&&(!n||n.guid===l.guid)&&(!u||u.test(l.namespace))&&(!r||r===l.selector||r==="**"&&l.selector)&&(h.splice(s,1),l.selector&&h.delegateCount--,c.remove&&c.remove.call(e,l));o&&!h.length&&((!c.teardown||c.teardown.call(e,d,m.handle)===!1)&&jQuery.removeEvent(e,p,m.handle),delete a[p])}jQuery.isEmptyObject(a)&&(delete m.handle,data_priv.remove(e,"events"))},trigger:function(e,t,n,r){var i,s,o,u,a,f,l,c=[n||document],h=core_hasOwn.call(e,"type")?e.type:e,p=core_hasOwn.call(e,"namespace")?e.namespace.split("."):[];s=o=n=n||document;if(n.nodeType===3||n.nodeType===8)return;if(rfocusMorph.test(h+jQuery.event.triggered))return;h.indexOf(".")>=0&&(p=h.split("."),h=p.shift(),p.sort()),a=h.indexOf(":")<0&&"on"+h,e=e[jQuery.expando]?e:new jQuery.Event(h,typeof e=="object"&&e),e.isTrigger=r?2:3,e.namespace=p.join("."),e.namespace_re=e.namespace?new RegExp("(^|\\.)"+p.join("\\.(?:.*\\.|)")+"(\\.|$)"):null,e.result=undefined,e.target||(e.target=n),t=t==null?[e]:jQuery.makeArray(t,[e]),l=jQuery.event.special[h]||{};if(!r&&l.trigger&&l.trigger.apply(n,t)===!1)return;if(!r&&!l.noBubble&&!jQuery.isWindow(n)){u=l.delegateType||h,rfocusMorph.test(u+h)||(s=s.parentNode);for(;s;s=s.parentNode)c.push(s),o=s;o===(n.ownerDocument||document)&&c.push(o.defaultView||o.parentWindow||window)}i=0;while((s=c[i++])&&!e.isPropagationStopped())e.type=i>1?u:l.bindType||h,f=(data_priv.get(s,"events")||{})[e.type]&&data_priv.get(s,"handle"),f&&f.apply(s,t),f=a&&s[a],f&&jQuery.acceptData(s)&&f.apply&&f.apply(s,t)===!1&&e.preventDefault();return e.type=h,!r&&!e.isDefaultPrevented()&&(!l._default||l._default.apply(c.pop(),t)===!1)&&jQuery.acceptData(n)&&a&&jQuery.isFunction(n[h])&&!jQuery.isWindow(n)&&(o=n[a],o&&(n[a]=null),jQuery.event.triggered=h,n[h](),jQuery.event.triggered=undefined,o&&(n[a]=o)),e.result},dispatch:function(e){e=jQuery.event.fix(e);var t,n,r,i,s,o=[],u=core_slice.call(arguments),a=(data_priv.get(this,"events")||{})[e.type]||[],f=jQuery.event.special[e.type]||{};u[0]=e,e.delegateTarget=this;if(f.preDispatch&&f.preDispatch.call(this,e)===!1)return;o=jQuery.event.handlers.call(this,e,a),t=0;while((i=o[t++])&&!e.isPropagationStopped()){e.currentTarget=i.elem,n=0;while((s=i.handlers[n++])&&!e.isImmediatePropagationStopped())if(!e.namespace_re||e.namespace_re.test(s.namespace))e.handleObj=s,e.data=s.data,r=((jQuery.event.special[s.origType]||{}).handle||s.handler).apply(i.elem,u),r!==undefined&&(e.result=r)===!1&&(e.preventDefault(),e.stopPropagation())}return f.postDispatch&&f.postDispatch.call(this,e),e.result},handlers:function(e,t){var n,r,i,s,o=[],u=t.delegateCount,a=e.target;if(u&&a.nodeType&&(!e.button||e.type!=="click"))for(;a!==this;a=a.parentNode||this)if(a.disabled!==!0||e.type!=="click"){r=[];for(n=0;n<u;n++)s=t[n],i=s.selector+" ",r[i]===undefined&&(r[i]=s.needsContext?jQuery(i,this).index(a)>=0:jQuery.find(i,this,null,[a]).length),r[i]&&r.push(s);r.length&&o.push({elem:a,handlers:r})}return u<t.length&&o.push({elem:this,handlers:t.slice(u)}),o},props:"altKey bubbles cancelable ctrlKey currentTarget eventPhase metaKey relatedTarget shiftKey target timeStamp view which".split(" "),fixHooks:{},keyHooks:{props:"char charCode key keyCode".split(" "),filter:function(e,t){return e.which==null&&(e.which=t.charCode!=null?t.charCode:t.keyCode),e}},mouseHooks:{props:"button buttons clientX clientY offsetX offsetY pageX pageY screenX screenY toElement".split(" "),filter:function(e,t){var n,r,i,s=t.button;return e.pageX==null&&t.clientX!=null&&(n=e.target.ownerDocument||document,r=n.documentElement,i=n.body,e.pageX=t.clientX+(r&&r.scrollLeft||i&&i.scrollLeft||0)-(r&&r.clientLeft||i&&i.clientLeft||0),e.pageY=t.clientY+(r&&r.scrollTop||i&&i.scrollTop||0)-(r&&r.clientTop||i&&i.clientTop||0)),!e.which&&s!==undefined&&(e.which=s&1?1:s&2?3:s&4?2:0),e}},fix:function(e){if(e[jQuery.expando])return e;var t,n,r,i=e.type,s=e,o=this.fixHooks[i];o||(this.fixHooks[i]=o=rmouseEvent.test(i)?this.mouseHooks:rkeyEvent.test(i)?this.keyHooks:{}),r=o.props?this.props.concat(o.props):this.props,e=new jQuery.Event(s),t=r.length;while(t--)n=r[t],e[n]=s[n];return e.target||(e.target=document),e.target.nodeType===3&&(e.target=e.target.parentNode),o.filter?o.filter(e,s):e},special:{load:{noBubble:!0},focus:{trigger:function(){if(this!==safeActiveElement()&&this.focus)return this.focus(),!1},delegateType:"focusin"},blur:{trigger:function(){if(this===safeActiveElement()&&this.blur)return this.blur(),!1},delegateType:"focusout"},click:{trigger:function(){if(this.type==="checkbox"&&this.click&&jQuery.nodeName(this,"input"))return this.click(),!1},_default:function(e){return jQuery.nodeName(e.target,"a")}},beforeunload:{postDispatch:function(e){e.result!==undefined&&(e.originalEvent.returnValue=e.result)}}},simulate:function(e,t,n,r){var i=jQuery.extend(new jQuery.Event,n,{type:e,isSimulated:!0,originalEvent:{}});r?jQuery.event.trigger(i,null,t):jQuery.event.dispatch.call(t,i),i.isDefaultPrevented()&&n.preventDefault()}},jQuery.removeEvent=function(e,t,n){e.removeEventListener&&e.removeEventListener(t,n,!1)},jQuery.Event=function(e,t){if(!(this instanceof jQuery.Event))return new jQuery.Event(e,t);e&&e.type?(this.originalEvent=e,this.type=e.type,this.isDefaultPrevented=e.defaultPrevented||e.getPreventDefault&&e.getPreventDefault()?returnTrue:returnFalse):this.type=e,t&&jQuery.extend(this,t),this.timeStamp=e&&e.timeStamp||jQuery.now(),this[jQuery.expando]=!0},jQuery.Event.prototype={isDefaultPrevented:returnFalse,isPropagationStopped:returnFalse,isImmediatePropagationStopped:returnFalse,preventDefault:function(){var e=this.originalEvent;this.isDefaultPrevented=returnTrue,e&&e.preventDefault&&e.preventDefault()},stopPropagation:function(){var e=this.originalEvent;this.isPropagationStopped=returnTrue,e&&e.stopPropagation&&e.stopPropagation()},stopImmediatePropagation:function(){this.isImmediatePropagationStopped=returnTrue,this.stopPropagation()}},jQuery.each({mouseenter:"mouseover",mouseleave:"mouseout"},function(e,t){jQuery.event.special[e]={delegateType:t,bindType:t,handle:function(e){var n,r=this,i=e.relatedTarget,s=e.handleObj;if(!i||i!==r&&!jQuery.contains(r,i))e.type=s.origType,n=s.handler.apply(this,arguments),e.type=t;return n}}}),jQuery.support.focusinBubbles||jQuery.each({focus:"focusin",blur:"focusout"},function(e,t){var n=0,r=function(e){jQuery.event.simulate(t,e.target,jQuery.event.fix(e),!0)};jQuery.event.special[t]={setup:function(){n++===0&&document.addEventListener(e,r,!0)},teardown:function(){--n===0&&document.removeEventListener(e,r,!0)}}}),jQuery.fn.extend({on:function(e,t,n,r,i){var s,o;if(typeof e=="object"){typeof t!="string"&&(n=n||t,t=undefined);for(o in e)this.on(o,t,n,e[o],i);return this}n==null&&r==null?(r=t,n=t=undefined):r==null&&(typeof t=="string"?(r=n,n=undefined):(r=n,n=t,t=undefined));if(r===!1)r=returnFalse;else if(!r)return this;return i===1&&(s=r,r=function(e){return jQuery().off(e),s.apply(this,arguments)},r.guid=s.guid||(s.guid=jQuery.guid++)),this.each(function(){jQuery.event.add(this,e,r,n,t)})},one:function(e,t,n,r){return this.on(e,t,n,r,1)},off:function(e,t,n){var r,i;if(e&&e.preventDefault&&e.handleObj)return r=e.handleObj,jQuery(e.delegateTarget).off(r.namespace?r.origType+"."+r.namespace:r.origType,r.selector,r.handler),this;if(typeof e=="object"){for(i in e)this.off(i,t,e[i]);return this}if(t===!1||typeof t=="function")n=t,t=undefined;return n===!1&&(n=returnFalse),this.each(function(){jQuery.event.remove(this,e,n,t)})},trigger:function(e,t){return this.each(function(){jQuery.event.trigger(e,t,this)})},triggerHandler:function(e,t){var n=this[0];if(n)return jQuery.event.trigger(e,t,n,!0)}});var isSimple=/^.[^:#\[\.,]*$/,rparentsprev=/^(?:parents|prev(?:Until|All))/,rneedsContext=jQuery.expr.match.needsContext,guaranteedUnique={children:!0,contents:!0,next:!0,prev:!0};jQuery.fn.extend({find:function(e){var t,n=[],r=this,i=r.length;if(typeof e!="string")return this.pushStack(jQuery(e).filter(function(){for(t=0;t<i;t++)if(jQuery.contains(r[t],this))return!0}));for(t=0;t<i;t++)jQuery.find(e,r[t],n);return n=this.pushStack(i>1?jQuery.unique(n):n),n.selector=this.selector?this.selector+" "+e:e,n},has:function(e){var t=jQuery(e,this),n=t.length;return this.filter(function(){var e=0;for(;e<n;e++)if(jQuery.contains(this,t[e]))return!0})},not:function(e){return this.pushStack(winnow(this,e||[],!0))},filter:function(e){return this.pushStack(winnow(this,e||[],!1))},is:function(e){return!!winnow(this,typeof e=="string"&&rneedsContext.test(e)?jQuery(e):e||[],!1).length},closest:function(e,t){var n,r=0,i=this.length,s=[],o=rneedsContext.test(e)||typeof e!="string"?jQuery(e,t||this.context):0;for(;r<i;r++)for(n=this[r];n&&n!==t;n=n.parentNode)if(n.nodeType<11&&(o?o.index(n)>-1:n.nodeType===1&&jQuery.find.matchesSelector(n,e))){n=s.push(n);break}return this.pushStack(s.length>1?jQuery.unique(s):s)},index:function(e){return e?typeof e=="string"?core_indexOf.call(jQuery(e),this[0]):core_indexOf.call(this,e.jquery?e[0]:e):this[0]&&this[0].parentNode?this.first().prevAll().length:-1},add:function(e,t){var n=typeof e=="string"?jQuery(e,t):jQuery.makeArray(e&&e.nodeType?[e]:e),r=jQuery.merge(this.get(),n);return this.pushStack(jQuery.unique(r))},addBack:function(e){return this.add(e==null?this.prevObject:this.prevObject.filter(e))}}),jQuery.each({parent:function(e){var t=e.parentNode;return t&&t.nodeType!==11?t:null},parents:function(e){return jQuery.dir(e,"parentNode")},parentsUntil:function(e,t,n){return jQuery.dir(e,"parentNode",n)},next:function(e){return sibling(e,"nextSibling")},prev:function(e){return sibling(e,"previousSibling")},nextAll:function(e){return jQuery.dir(e,"nextSibling")},prevAll:function(e){return jQuery.dir(e,"previousSibling")},nextUntil:function(e,t,n){return jQuery.dir(e,"nextSibling",n)},prevUntil:function(e,t,n){return jQuery.dir(e,"previousSibling",n)},siblings:function(e){return jQuery.sibling((e.parentNode||{}).firstChild,e)},children:function(e){return jQuery.sibling(e.firstChild)},contents:function(e){return e.contentDocument||jQuery.merge([],e.childNodes)}},function(e,t){jQuery.fn[e]=function(n,r){var i=jQuery.map(this,t,n);return e.slice(-5)!=="Until"&&(r=n),r&&typeof r=="string"&&(i=jQuery.filter(r,i)),this.length>1&&(guaranteedUnique[e]||jQuery.unique(i),rparentsprev.test(e)&&i.reverse()),this.pushStack(i)}}),jQuery.extend({filter:function(e,t,n){var r=t[0];return n&&(e=":not("+e+")"),t.length===1&&r.nodeType===1?jQuery.find.matchesSelector(r,e)?[r]:[]:jQuery.find.matches(e,jQuery.grep(t,function(e){return e.nodeType===1}))},dir:function(e,t,n){var r=[],i=n!==undefined;while((e=e[t])&&e.nodeType!==9)if(e.nodeType===1){if(i&&jQuery(e).is(n))break;r.push(e)}return r},sibling:function(e,t){var n=[];for(;e;e=e.nextSibling)e.nodeType===1&&e!==t&&n.push(e);return n}});var rxhtmlTag=/<(?!area|br|col|embed|hr|img|input|link|meta|param)(([\w:]+)[^>]*)\/>/gi,rtagName=/<([\w:]+)/,rhtml=/<|&#?\w+;/,rnoInnerhtml=/<(?:script|style|link)/i,manipulation_rcheckableType=/^(?:checkbox|radio)$/i,rchecked=/checked\s*(?:[^=]|=\s*.checked.)/i,rscriptType=/^$|\/(?:java|ecma)script/i,rscriptTypeMasked=/^true\/(.*)/,rcleanScript=/^\s*<!(?:\[CDATA\[|--)|(?:\]\]|--)>\s*$/g,wrapMap={option:[1,"<select multiple='multiple'>","</select>"],thead:[1,"<table>","</table>"],col:[2,"<table><colgroup>","</colgroup></table>"],tr:[2,"<table><tbody>","</tbody></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],_default:[0,"",""]};wrapMap.optgroup=wrapMap.option,wrapMap.tbody=wrapMap.tfoot=wrapMap.colgroup=wrapMap.caption=wrapMap.thead,wrapMap.th=wrapMap.td,jQuery.fn.extend({text:function(e){return jQuery.access(this,function(e){return e===undefined?jQuery.text(this):this.empty().append((this[0]&&this[0].ownerDocument||document).createTextNode(e))},null,e,arguments.length)},append:function(){return this.domManip(arguments,function(e){if(this.nodeType===1||this.nodeType===11||this.nodeType===9){var t=manipulationTarget(this,e);t.appendChild(e)}})},prepend:function(){return this.domManip(arguments,function(e){if(this.nodeType===1||this.nodeType===11||this.nodeType===9){var t=manipulationTarget(this,e);t.insertBefore(e,t.firstChild)}})},before:function(){return this.domManip(arguments,function(e){this.parentNode&&this.parentNode.insertBefore(e,this)})},after:function(){return this.domManip(arguments,function(e){this.parentNode&&this.parentNode.insertBefore(e,this.nextSibling)})},remove:function(e,t){var n,r=e?jQuery.filter(e,this):this,i=0;for(;(n=r[i])!=null;i++)!t&&n.nodeType===1&&jQuery.cleanData(getAll(n)),n.parentNode&&(t&&jQuery.contains(n.ownerDocument,n)&&setGlobalEval(getAll(n,"script")),n.parentNode.removeChild(n));return this},empty:function(){var e,t=0;for(;(e=this[t])!=null;t++)e.nodeType===1&&(jQuery.cleanData(getAll(e,!1)),e.textContent="");return this},clone:function(e,t){return e=e==null?!1:e,t=t==null?e:t,this.map(function(){return jQuery.clone(this,e,t)})},html:function(e){return jQuery.access(this,function(e){var t=this[0]||{},n=0,r=this.length;if(e===undefined&&t.nodeType===1)return t.innerHTML;if(typeof e=="string"&&!rnoInnerhtml.test(e)&&!wrapMap[(rtagName.exec(e)||["",""])[1].toLowerCase()]){e=e.replace(rxhtmlTag,"<$1></$2>");try{for(;n<r;n++)t=this[n]||{},t.nodeType===1&&(jQuery.cleanData(getAll(t,!1)),t.innerHTML=e);t=0}catch(i){}}t&&this.empty().append(e)},null,e,arguments.length)},replaceWith:function(){var e=jQuery.map(this,function(e){return[e.nextSibling,e.parentNode]}),t=0;return this.domManip(arguments,function(n){var r=e[t++],s=e[t++];s&&(r&&r.parentNode!==s&&(r=this.nextSibling),jQuery(this).remove(),s.insertBefore(n,r))},!0),t?this:this.remove()},detach:function(e){return this.remove(e,!0)},domManip:function(e,t,n){e=core_concat.apply([],e);var r,i,s,o,u,a,f=0,l=this.length,c=this,h=l-1,p=e[0],d=jQuery.isFunction(p);if(d||!(l<=1||typeof p!="string"||jQuery.support.checkClone||!rchecked.test(p)))return this.each(function(r){var i=c.eq(r);d&&(e[0]=p.call(this,r,i.html())),i.domManip(e,t,n)});if(l){r=jQuery.buildFragment(e,this[0].ownerDocument,!1,!n&&this),i=r.firstChild,r.childNodes.length===1&&(r=i);if(i){s=jQuery.map(getAll(r,"script"),disableScript),o=s.length;for(;f<l;f++)u=r,f!==h&&(u=jQuery.clone(u,!0,!0),o&&jQuery.merge(s,getAll(u,"script"))),t.call(this[f],u,f);if(o){a=s[s.length-1].ownerDocument,jQuery.map(s,restoreScript);for(f=0;f<o;f++)u=s[f],rscriptType.test(u.type||"")&&!data_priv.access(u,"globalEval")&&jQuery.contains(a,u)&&(u.src?jQuery._evalUrl(u.src):jQuery.globalEval(u.textContent.replace(rcleanScript,"")))}}}return this}}),jQuery.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(e,t){jQuery.fn[e]=function(e){var n,r=[],i=jQuery(e),s=i.length-1,o=0;for(;o<=s;o++)n=o===s?this:this.clone(!0),jQuery(i[o])[t](n),core_push.apply(r,n.get());return this.pushStack(r)}}),jQuery.extend({clone:function(e,t,n){var r,i,s,o,u=e.cloneNode(!0),a=jQuery.contains(e.ownerDocument,e);if(!jQuery.support.noCloneChecked&&(e.nodeType===1||e.nodeType===11)&&!jQuery.isXMLDoc(e)){o=getAll(u),s=getAll(e);for(r=0,i=s.length;r<i;r++)fixInput(s[r],o[r])}if(t)if(n){s=s||getAll(e),o=o||getAll(u);for(r=0,i=s.length;r<i;r++)cloneCopyEvent(s[r],o[r])}else cloneCopyEvent(e,u);return o=getAll(u,"script"),o.length>0&&setGlobalEval(o,!a&&getAll(e,"script")),u},buildFragment:function(e,t,n,r){var i,s,o,u,a,f,l=0,c=e.length,h=t.createDocumentFragment(),p=[];for(;l<c;l++){i=e[l];if(i||i===0)if(jQuery.type(i)==="object")jQuery.merge(p,i.nodeType?[i]:i);else if(!rhtml.test(i))p.push(t.createTextNode(i));else{s=s||h.appendChild(t.createElement("div")),o=(rtagName.exec(i)||["",""])[1].toLowerCase(),u=wrapMap[o]||wrapMap._default,s.innerHTML=u[1]+i.replace(rxhtmlTag,"<$1></$2>")+u[2],f=u[0];while(f--)s=s.firstChild;jQuery.merge(p,s.childNodes),s=h.firstChild,s.textContent=""}}h.textContent="",l=0;while(i=p[l++]){if(r&&jQuery.inArray(i,r)!==-1)continue;a=jQuery.contains(i.ownerDocument,i),s=getAll(h.appendChild(i),"script"),a&&setGlobalEval(s);if(n){f=0;while(i=s[f++])rscriptType.test(i.type||"")&&n.push(i)}}return h},cleanData:function(e){var t,n,r,i,s,o,u=jQuery.event.special,a=0;for(;(n=e[a])!==undefined;a++){if(Data.accepts(n)){s=n[data_priv.expando];if(s&&(t=data_priv.cache[s])){r=Object.keys(t.events||{});if(r.length)for(o=0;(i=r[o])!==undefined;o++)u[i]?jQuery.event.remove(n,i):jQuery.removeEvent(n,i,t.handle);data_priv.cache[s]&&delete data_priv.cache[s]}}delete data_user.cache[n[data_user.expando]]}},_evalUrl:function(e){return jQuery.ajax({url:e,type:"GET",dataType:"script",async:!1,global:!1,"throws":!0})}}),jQuery.fn.extend({wrapAll:function(e){var t;return jQuery.isFunction(e)?this.each(function(t){jQuery(this).wrapAll(e.call(this,t))}):(this[0]&&(t=jQuery(e,this[0].ownerDocument).eq(0).clone(!0),this[0].parentNode&&t.insertBefore(this[0]),t.map(function(){var e=this;while(e.firstElementChild)e=e.firstElementChild;return e}).append(this)),this)},wrapInner:function(e){return jQuery.isFunction(e)?this.each(function(t){jQuery(this).wrapInner(e.call(this,t))}):this.each(function(){var t=jQuery(this),n=t.contents();n.length?n.wrapAll(e):t.append(e)})},wrap:function(e){var t=jQuery.isFunction(e);return this.each(function(n){jQuery(this).wrapAll(t?e.call(this,n):e)})},unwrap:function(){return this.parent().each(function(){jQuery.nodeName(this,"body")||jQuery(this).replaceWith(this.childNodes)}).end()}});var curCSS,iframe,rdisplayswap=/^(none|table(?!-c[ea]).+)/,rmargin=/^margin/,rnumsplit=new RegExp("^("+core_pnum+")(.*)$","i"),rnumnonpx=new RegExp("^("+core_pnum+")(?!px)[a-z%]+$","i"),rrelNum=new RegExp("^([+-])=("+core_pnum+")","i"),elemdisplay={BODY:"block"},cssShow={position:"absolute",visibility:"hidden",display:"block"},cssNormalTransform={letterSpacing:0,fontWeight:400},cssExpand=["Top","Right","Bottom","Left"],cssPrefixes=["Webkit","O","Moz","ms"];jQuery.fn.extend({css:function(e,t){return jQuery.access(this,function(e,t,n){var r,i,s={},o=0;if(jQuery.isArray(t)){r=getStyles(e),i=t.length;for(;o<i;o++)s[t[o]]=jQuery.css(e,t[o],!1,r);return s}return n!==undefined?jQuery.style(e,t,n):jQuery.css(e,t)},e,t,arguments.length>1)},show:function(){return showHide(this,!0)},hide:function(){return showHide(this)},toggle:function(e){var t=typeof e=="boolean";return this.each(function(){(t?e:isHidden(this))?jQuery(this).show():jQuery(this).hide()})}}),jQuery.extend({cssHooks:{opacity:{get:function(e,t){if(t){var n=curCSS(e,"opacity");return n===""?"1":n}}}},cssNumber:{columnCount:!0,fillOpacity:!0,fontWeight:!0,lineHeight:!0,opacity:!0,orphans:!0,widows:!0,zIndex:!0,zoom:!0},cssProps:{"float":"cssFloat"},style:function(e,t,n,r){if(!e||e.nodeType===3||e.nodeType===8||!e.style)return;var i,s,o,u=jQuery.camelCase(t),a=e.style;t=jQuery.cssProps[u]||(jQuery.cssProps[u]=vendorPropName(a,u)),o=jQuery.cssHooks[t]||jQuery.cssHooks[u];if(n===undefined)return o&&"get"in o&&(i=o.get(e,!1,r))!==undefined?i:a[t];s=typeof n,s==="string"&&(i=rrelNum.exec(n))&&(n=(i[1]+1)*i[2]+parseFloat(jQuery.css(e,t)),s="number");if(n==null||s==="number"&&isNaN(n))return;s==="number"&&!jQuery.cssNumber[u]&&(n+="px"),!jQuery.support.clearCloneStyle&&n===""&&t.indexOf("background")===0&&(a[t]="inherit");if(!o||!("set"in o)||(n=o.set(e,n,r))!==undefined)a[t]=n},css:function(e,t,n,r){var i,s,o,u=jQuery.camelCase(t);return t=jQuery.cssProps[u]||(jQuery.cssProps[u]=vendorPropName(e.style,u)),o=jQuery.cssHooks[t]||jQuery.cssHooks[u],o&&"get"in o&&(i=o.get(e,!0,n)),i===undefined&&(i=curCSS(e,t,r)),i==="normal"&&t in cssNormalTransform&&(i=cssNormalTransform[t]),n===""||n?(s=parseFloat(i),n===!0||jQuery.isNumeric(s)?s||0:i):i}}),curCSS=function(e,t,n){var r,i,s,o=n||getStyles(e),u=o?o.getPropertyValue(t)||o[t]:undefined,a=e.style;return o&&(u===""&&!jQuery.contains(e.ownerDocument,e)&&(u=jQuery.style(e,t)),rnumnonpx.test(u)&&rmargin.test(t)&&(r=a.width,i=a.minWidth,s=a.maxWidth,a.minWidth=a.maxWidth=a.width=u,u=o.width,a.width=r,a.minWidth=i,a.maxWidth=s)),u},jQuery.each(["height","width"],function(e,t){jQuery.cssHooks[t]={get:function(e,n,r){if(n)return e.offsetWidth===0&&rdisplayswap.test(jQuery.css(e,"display"))?jQuery.swap(e,cssShow,function(){return getWidthOrHeight(e,t,r)}):getWidthOrHeight(e,t,r)},set:function(e,n,r){var i=r&&getStyles(e);return setPositiveNumber(e,n,r?augmentWidthOrHeight(e,t,r,jQuery.support.boxSizing&&jQuery.css(e,"boxSizing",!1,i)==="border-box",i):0)}}}),jQuery(function(){jQuery.support.reliableMarginRight||(jQuery.cssHooks.marginRight={get:function(e,t){if(t)return jQuery.swap(e,{display:"inline-block"},curCSS,[e,"marginRight"])}}),!jQuery.support.pixelPosition&&jQuery.fn.position&&jQuery.each(["top","left"],function(e,t){jQuery.cssHooks[t]={get:function(e,n){if(n)return n=curCSS(e,t),rnumnonpx.test(n)?jQuery(e).position()[t]+"px":n}}})}),jQuery.expr&&jQuery.expr.filters&&(jQuery.expr.filters.hidden=function(e){return e.offsetWidth<=0&&e.offsetHeight<=0},jQuery.expr.filters.visible=function(e){return!jQuery.expr.filters.hidden(e)}),jQuery.each({margin:"",padding:"",border:"Width"},function(e,t){jQuery.cssHooks[e+t]={expand:function(n){var r=0,i={},s=typeof n=="string"?n.split(" "):[n];for(;r<4;r++)i[e+cssExpand[r]+t]=s[r]||s[r-2]||s[0];return i}},rmargin.test(e)||(jQuery.cssHooks[e+t].set=setPositiveNumber)});var r20=/%20/g,rbracket=/\[\]$/,rCRLF=/\r?\n/g,rsubmitterTypes=/^(?:submit|button|image|reset|file)$/i,rsubmittable=/^(?:input|select|textarea|keygen)/i;jQuery.fn.extend({serialize:function(){return jQuery.param(this.serializeArray())},serializeArray:function(){return this.map(function(){var e=jQuery.prop(this,"elements");return e?jQuery.makeArray(e):this}).filter(function(){var e=this.type;return this.name&&!jQuery(this).is(":disabled")&&rsubmittable.test(this.nodeName)&&!rsubmitterTypes.test(e)&&(this.checked||!manipulation_rcheckableType.test(e))}).map(function(e,t){var n=jQuery(this).val();return n==null?null:jQuery.isArray(n)?jQuery.map(n,function(e){return{name:t.name,value:e.replace(rCRLF,"\r\n")}}):{name:t.name,value:n.replace(rCRLF,"\r\n")}}).get()}}),jQuery.param=function(e,t){var n,r=[],i=function(e,t){t=jQuery.isFunction(t)?t():t==null?"":t,r[r.length]=encodeURIComponent(e)+"="+encodeURIComponent(t)};t===undefined&&(t=jQuery.ajaxSettings&&jQuery.ajaxSettings.traditional);if(jQuery.isArray(e)||e.jquery&&!jQuery.isPlainObject(e))jQuery.each(e,function(){i(this.name,this.value)});else for(n in e)buildParams(n,e[n],t,i);return r.join("&").replace(r20,"+")},jQuery.each("blur focus focusin focusout load resize scroll unload click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select submit keydown keypress keyup error contextmenu".split(" "),function(e,t){jQuery.fn[t]=function(e,n){return arguments.length>0?this.on(t,null,e,n):this.trigger(t)}}),jQuery.fn.extend({hover:function(e,t){return this.mouseenter(e).mouseleave(t||e)},bind:function(e,t,n){return this.on(e,null,t,n)},unbind:function(e,t){return this.off(e,null,t)},delegate:function(e,t,n,r){return this.on(t,e,n,r)},undelegate:function(e,t,n){return arguments.length===1?this.off(e,"**"):this.off(t,e||"**",n)}});var ajaxLocParts,ajaxLocation,ajax_nonce=jQuery.now(),ajax_rquery=/\?/,rhash=/#.*$/,rts=/([?&])_=[^&]*/,rheaders=/^(.*?):[ \t]*([^\r\n]*)$/mg,rlocalProtocol=/^(?:about|app|app-storage|.+-extension|file|res|widget):$/,rnoContent=/^(?:GET|HEAD)$/,rprotocol=/^\/\//,rurl=/^([\w.+-]+:)(?:\/\/([^\/?#:]*)(?::(\d+)|)|)/,_load=jQuery.fn.load,prefilters={},transports={},allTypes="*/".concat("*");try{ajaxLocation=location.href}catch(e){ajaxLocation=document.createElement("a"),ajaxLocation.href="",ajaxLocation=ajaxLocation.href}ajaxLocParts=rurl.exec(ajaxLocation.toLowerCase())||[],jQuery.fn.load=function(e,t,n){if(typeof e!="string"&&_load)return _load.apply(this,arguments);var r,i,s,o=this,u=e.indexOf(" ");return u>=0&&(r=e.slice(u),e=e.slice(0,u)),jQuery.isFunction(t)?(n=t,t=undefined):t&&typeof t=="object"&&(i="POST"),o.length>0&&jQuery.ajax({url:e,type:i,dataType:"html",data:t}).done(function(e){s=arguments,o.html(r?jQuery("<div>").append(jQuery.parseHTML(e)).find(r):e)}).complete(n&&function(e,t){o.each(n,s||[e.responseText,t,e])}),this},jQuery.each(["ajaxStart","ajaxStop","ajaxComplete","ajaxError","ajaxSuccess","ajaxSend"],function(e,t){jQuery.fn[t]=function(e){return this.on(t,e)}}),jQuery.extend({active:0,lastModified:{},etag:{},ajaxSettings:{url:ajaxLocation,type:"GET",isLocal:rlocalProtocol.test(ajaxLocParts[1]),global:!0,processData:!0,async:!0,contentType:"application/x-www-form-urlencoded; charset=UTF-8",accepts:{"*":allTypes,text:"text/plain",html:"text/html",xml:"application/xml, text/xml",json:"application/json, text/javascript"},contents:{xml:/xml/,html:/html/,json:/json/},responseFields:{xml:"responseXML",text:"responseText",json:"responseJSON"},converters:{"* text":String,"text html":!0,"text json":jQuery.parseJSON,"text xml":jQuery.parseXML},flatOptions:{url:!0,context:!0}},ajaxSetup:function(e,t){return t?ajaxExtend(ajaxExtend(e,jQuery.ajaxSettings),t):ajaxExtend(jQuery.ajaxSettings,e)},ajaxPrefilter:addToPrefiltersOrTransports(prefilters),ajaxTransport:addToPrefiltersOrTransports(transports),ajax:function(e,t){function S(e,t,s,u){var f,m,g,b,E,S=t;if(y===2)return;y=2,o&&clearTimeout(o),n=undefined,i=u||"",w.readyState=e>0?4:0,f=e>=200&&e<300||e===304,s&&(b=ajaxHandleResponses(l,w,s)),b=ajaxConvert(l,b,w,f);if(f)l.ifModified&&(E=w.getResponseHeader("Last-Modified"),E&&(jQuery.lastModified[r]=E),E=w.getResponseHeader("etag"),E&&(jQuery.etag[r]=E)),e===204||l.type==="HEAD"?S="nocontent":e===304?S="notmodified":(S=b.state,m=b.data,g=b.error,f=!g);else{g=S;if(e||!S)S="error",e<0&&(e=0)}w.status=e,w.statusText=(t||S)+"",f?p.resolveWith(c,[m,S,w]):p.rejectWith(c,[w,S,g]),w.statusCode(v),v=undefined,a&&h.trigger(f?"ajaxSuccess":"ajaxError",[w,l,f?m:g]),d.fireWith(c,[w,S]),a&&(h.trigger("ajaxComplete",[w,l]),--jQuery.active||jQuery.event.trigger("ajaxStop"))}typeof e=="object"&&(t=e,e=undefined),t=t||{};var n,r,i,s,o,u,a,f,l=jQuery.ajaxSetup({},t),c=l.context||l,h=l.context&&(c.nodeType||c.jquery)?jQuery(c):jQuery.event,p=jQuery.Deferred(),d=jQuery.Callbacks("once memory"),v=l.statusCode||{},m={},g={},y=0,b="canceled",w={readyState:0,getResponseHeader:function(e){var t;if(y===2){if(!s){s={};while(t=rheaders.exec(i))s[t[1].toLowerCase()]=t[2]}t=s[e.toLowerCase()]}return t==null?null:t},getAllResponseHeaders:function(){return y===2?i:null},setRequestHeader:function(e,t){var n=e.toLowerCase();return y||(e=g[n]=g[n]||e,m[e]=t),this},overrideMimeType:function(e){return y||(l.mimeType=e),this},statusCode:function(e){var t;if(e)if(y<2)for(t in e)v[t]=[v[t],e[t]];else w.always(e[w.status]);return this},abort:function(e){var t=e||b;return n&&n.abort(t),S(0,t),this}};p.promise(w).complete=d.add,w.success=w.done,w.error=w.fail,l.url=((e||l.url||ajaxLocation)+"").replace(rhash,"").replace(rprotocol,ajaxLocParts[1]+"//"),l.type=t.method||t.type||l.method||l.type,l.dataTypes=jQuery.trim(l.dataType||"*").toLowerCase().match(core_rnotwhite)||[""],l.crossDomain==null&&(u=rurl.exec(l.url.toLowerCase()),l.crossDomain=!(!u||u[1]===ajaxLocParts[1]&&u[2]===ajaxLocParts[2]&&(u[3]||(u[1]==="http:"?"80":"443"))===(ajaxLocParts[3]||(ajaxLocParts[1]==="http:"?"80":"443")))),l.data&&l.processData&&typeof l.data!="string"&&(l.data=jQuery.param(l.data,l.traditional)),inspectPrefiltersOrTransports(prefilters,l,t,w);if(y===2)return w;a=l.global,a&&jQuery.active++===0&&jQuery.event.trigger("ajaxStart"),l.type=l.type.toUpperCase(),l.hasContent=!rnoContent.test(l.type),r=l.url,l.hasContent||(l.data&&(r=l.url+=(ajax_rquery.test(r)?"&":"?")+l.data,delete l.data),l.cache===!1&&(l.url=rts.test(r)?r.replace(rts,"$1_="+ajax_nonce++):r+(ajax_rquery.test(r)?"&":"?")+"_="+ajax_nonce++)),l.ifModified&&(jQuery.lastModified[r]&&w.setRequestHeader("If-Modified-Since",jQuery.lastModified[r]),jQuery.etag[r]&&w.setRequestHeader("If-None-Match",jQuery.etag[r])),(l.data&&l.hasContent&&l.contentType!==!1||t.contentType)&&w.setRequestHeader("Content-Type",l.contentType),w.setRequestHeader("Accept",l.dataTypes[0]&&l.accepts[l.dataTypes[0]]?l.accepts[l.dataTypes[0]]+(l.dataTypes[0]!=="*"?", "+allTypes+"; q=0.01":""):l.accepts["*"]);for(f in l.headers)w.setRequestHeader(f,l.headers[f]);if(!l.beforeSend||l.beforeSend.call(c,w,l)!==!1&&y!==2){b="abort";for(f in{success:1,error:1,complete:1})w[f](l[f]);n=inspectPrefiltersOrTransports(transports,l,t,w);if(!n)S(-1,"No Transport");else{w.readyState=1,a&&h.trigger("ajaxSend",[w,l]),l.async&&l.timeout>0&&(o=setTimeout(function(){w.abort("timeout")},l.timeout));try{y=1,n.send(m,S)}catch(E){if(!(y<2))throw E;S(-1,E)}}return w}return w.abort()},getJSON:function(e,t,n){return jQuery.get(e,t,n,"json")},getScript:function(e,t){return jQuery.get(e,undefined,t,"script")}}),jQuery.each(["get","post"],function(e,t){jQuery[t]=function(e,n,r,i){return jQuery.isFunction(n)&&(i=i||r,r=n,n=undefined),jQuery.ajax({url:e,type:t,dataType:i,data:n,success:r})}}),jQuery.ajaxSetup({accepts:{script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"},contents:{script:/(?:java|ecma)script/},converters:{"text script":function(e){return jQuery.globalEval(e),e}}}),jQuery.ajaxPrefilter("script",function(e){e.cache===undefined&&(e.cache=!1),e.crossDomain&&(e.type="GET")}),jQuery.ajaxTransport("script",function(e){if(e.crossDomain){var t,n;return{send:function(r,i){t=jQuery("<script>").prop({async:!0,charset:e.scriptCharset,src:e.url}).on("load error",n=function(e){t.remove(),n=null,e&&i(e.type==="error"?404:200,e.type)}),document.head.appendChild(t[0])},abort:function(){n&&n()}}}});var oldCallbacks=[],rjsonp=/(=)\?(?=&|$)|\?\?/;jQuery.ajaxSetup({jsonp:"callback",jsonpCallback:function(){var e=oldCallbacks.pop()||jQuery.expando+"_"+ajax_nonce++;return this[e]=!0,e}}),jQuery.ajaxPrefilter("json jsonp",function(e,t,n){var r,i,s,o=e.jsonp!==!1&&(rjsonp.test(e.url)?"url":typeof e.data=="string"&&!(e.contentType||"").indexOf("application/x-www-form-urlencoded")&&rjsonp.test(e.data)&&"data");if(o||e.dataTypes[0]==="jsonp")return r=e.jsonpCallback=jQuery.isFunction(e.jsonpCallback)?e.jsonpCallback():e.jsonpCallback,o?e[o]=e[o].replace(rjsonp,"$1"+r):e.jsonp!==!1&&(e.url+=(ajax_rquery.test(e.url)?"&":"?")+e.jsonp+"="+r),e.converters["script json"]=function(){return s||jQuery.error(r+" was not called"),s[0]},e.dataTypes[0]="json",i=window[r],window[r]=function(){s=arguments},n.always(function(){window[r]=i,e[r]&&(e.jsonpCallback=t.jsonpCallback,oldCallbacks.push(r)),s&&jQuery.isFunction(i)&&i(s[0]),s=i=undefined}),"script"}),jQuery.ajaxSettings.xhr=function(){try{return new XMLHttpRequest}catch(e){}};var xhrSupported=jQuery.ajaxSettings.xhr(),xhrSuccessStatus={0:200,1223:204},xhrId=0,xhrCallbacks={};window.ActiveXObject&&jQuery(window).on("unload",function(){for(var e in xhrCallbacks)xhrCallbacks[e]();xhrCallbacks=undefined}),jQuery.support.cors=!!xhrSupported&&"withCredentials"in xhrSupported,jQuery.support.ajax=xhrSupported=!!xhrSupported,jQuery.ajaxTransport(function(e){var t;if(jQuery.support.cors||xhrSupported&&!e.crossDomain)return{send:function(n,r){var i,s,o=e.xhr();o.open(e.type,e.url,e.async,e.username,e.password);if(e.xhrFields)for(i in e.xhrFields)o[i]=e.xhrFields[i];e.mimeType&&o.overrideMimeType&&o.overrideMimeType(e.mimeType),!e.crossDomain&&!n["X-Requested-With"]&&(n["X-Requested-With"]="XMLHttpRequest");for(i in n)o.setRequestHeader(i,n[i]);t=function(e){return function(){t&&(delete xhrCallbacks[s],t=o.onload=o.onerror=null,e==="abort"?o.abort():e==="error"?r(o.status||404,o.statusText):r(xhrSuccessStatus[o.status]||o.status,o.statusText,typeof o.responseText=="string"?{text:o.responseText}:undefined,o.getAllResponseHeaders()))}},o.onload=t(),o.onerror=t("error"),t=xhrCallbacks[s=xhrId++]=t("abort"),o.send(e.hasContent&&e.data||null)},abort:function(){t&&t()}}});var fxNow,timerId,rfxtypes=/^(?:toggle|show|hide)$/,rfxnum=new RegExp("^(?:([+-])=|)("+core_pnum+")([a-z%]*)$","i"),rrun=/queueHooks$/,animationPrefilters=[defaultPrefilter],tweeners={"*":[function(e,t){var n=this.createTween(e,t),r=n.cur(),i=rfxnum.exec(t),s=i&&i[3]||(jQuery.cssNumber[e]?"":"px"),o=(jQuery.cssNumber[e]||s!=="px"&&+r)&&rfxnum.exec(jQuery.css(n.elem,e)),u=1,a=20;if(o&&o[3]!==s){s=s||o[3],i=i||[],o=+r||1;do u=u||".5",o/=u,jQuery.style(n.elem,e,o+s);while(u!==(u=n.cur()/r)&&u!==1&&--a)}return i&&(o=n.start=+o||+r||0,n.unit=s,n.end=i[1]?o+(i[1]+1)*i[2]:+i[2]),n}]};jQuery.Animation=jQuery.extend(Animation,{tweener:function(e,t){jQuery.isFunction(e)?(t=e,e=["*"]):e=e.split(" ");var n,r=0,i=e.length;for(;r<i;r++)n=e[r],tweeners[n]=tweeners[n]||[],tweeners[n].unshift(t)},prefilter:function(e,t){t?animationPrefilters.unshift(e):animationPrefilters.push(e)}}),jQuery.Tween=Tween,Tween.prototype={constructor:Tween,init:function(e,t,n,r,i,s){this.elem=e,this.prop=n,this.easing=i||"swing",this.options=t,this.start=this.now=this.cur(),this.end=r,this.unit=s||(jQuery.cssNumber[n]?"":"px")},cur:function(){var e=Tween.propHooks[this.prop];return e&&e.get?e.get(this):Tween.propHooks._default.get(this)},run:function(e){var t,n=Tween.propHooks[this.prop];return this.options.duration?this.pos=t=jQuery.easing[this.easing](e,this.options.duration*e,0,1,this.options.duration):this.pos=t=e,this.now=(this.end-this.start)*t+this.start,this.options.step&&this.options.step.call(this.elem,this.now,this),n&&n.set?n.set(this):Tween.propHooks._default.set(this),this}},Tween.prototype.init.prototype=Tween.prototype,Tween.propHooks={_default:{get:function(e){var t;return e.elem[e.prop]==null||!!e.elem.style&&e.elem.style[e.prop]!=null?(t=jQuery.css(e.elem,e.prop,""),!t||t==="auto"?0:t):e.elem[e.prop]},set:function(e){jQuery.fx.step[e.prop]?jQuery.fx.step[e.prop](e):e.elem.style&&(e.elem.style[jQuery.cssProps[e.prop]]!=null||jQuery.cssHooks[e.prop])?jQuery.style(e.elem,e.prop,e.now+e.unit):e.elem[e.prop]=e.now}}},Tween.propHooks.scrollTop=Tween.propHooks.scrollLeft={set:function(e){e.elem.nodeType&&e.elem.parentNode&&(e.elem[e.prop]=e.now)}},jQuery.each(["toggle","show","hide"],function(e,t){var n=jQuery.fn[t];jQuery.fn[t]=function(e,r,i){return e==null||typeof e=="boolean"?n.apply(this,arguments):this.animate(genFx(t,!0),e,r,i)}}),jQuery.fn.extend({fadeTo:function(e,t,n,r){return this.filter(isHidden).css("opacity",0).show().end().animate({opacity:t},e,n,r)},animate:function(e,t,n,r){var i=jQuery.isEmptyObject(e),s=jQuery.speed(t,n,r),o=function(){var t=Animation(this,jQuery.extend({},e),s);(i||data_priv.get(this,"finish"))&&t.stop(!0)};return o.finish=o,i||s.queue===!1?this.each(o):this.queue(s.queue,o)},stop:function(e,t,n){var r=function(e){var t=e.stop;delete e.stop,t(n)};return typeof e!="string"&&(n=t,t=e,e=undefined),t&&e!==!1&&this.queue(e||"fx",[]),this.each(function(){var t=!0,i=e!=null&&e+"queueHooks",s=jQuery.timers,o=data_priv.get(this);if(i)o[i]&&o[i].stop&&r(o[i]);else for(i in o)o[i]&&o[i].stop&&rrun.test(i)&&r(o[i]);for(i=s.length;i--;)s[i].elem===this&&(e==null||s[i].queue===e)&&(s[i].anim.stop(n),t=!1,s.splice(i,1));(t||!n)&&jQuery.dequeue(this,e)})},finish:function(e){return e!==!1&&(e=e||"fx"),this.each(function(){var t,n=data_priv.get(this),r=n[e+"queue"],i=n[e+"queueHooks"],s=jQuery.timers,o=r?r.length:0;n.finish=!0,jQuery.queue(this,e,[]),i&&i.stop&&i.stop.call(this,!0);for(t=s.length;t--;)s[t].elem===this&&s[t].queue===e&&(s[t].anim.stop(!0),s.splice(t,1));for(t=0;t<o;t++)r[t]&&r[t].finish&&r[t].finish.call(this);delete n.finish})}}),jQuery.each({slideDown:genFx("show"),slideUp:genFx("hide"),slideToggle:genFx("toggle"),fadeIn:{opacity:"show"},fadeOut:{opacity:"hide"},fadeToggle:{opacity:"toggle"}},function(e,t){jQuery.fn[e]=function(e,n,r){return this.animate(t,e,n,r)}}),jQuery.speed=function(e,t,n){var r=e&&typeof e=="object"?jQuery.extend({},e):{complete:n||!n&&t||jQuery.isFunction(e)&&e,duration:e,easing:n&&t||t&&!jQuery.isFunction(t)&&t};r.duration=jQuery.fx.off?0:typeof r.duration=="number"?r.duration:r.duration in jQuery.fx.speeds?jQuery.fx.speeds[r.duration]:jQuery.fx.speeds._default;if(r.queue==null||r.queue===!0)r.queue="fx";return r.old=r.complete,r.complete=function(){jQuery.isFunction(r.old)&&r.old.call(this),r.queue&&jQuery.dequeue(this,r.queue)},r},jQuery.easing={linear:function(e){return e},swing:function(e){return.5-Math.cos(e*Math.PI)/2}},jQuery.timers=[],jQuery.fx=Tween.prototype.init,jQuery.fx.tick=function(){var e,t=jQuery.timers,n=0;fxNow=jQuery.now();for(;n<t.length;n++)e=t[n],!e()&&t[n]===e&&t.splice(n--,1);t.length||jQuery.fx.stop(),fxNow=undefined},jQuery.fx.timer=function(e){e()&&jQuery.timers.push(e)&&jQuery.fx.start()},jQuery.fx.interval=13,jQuery.fx.start=function(){timerId||(timerId=setInterval(jQuery.fx.tick,jQuery.fx.interval))},jQuery.fx.stop=function(){clearInterval(timerId),timerId=null},jQuery.fx.speeds={slow:600,fast:200,_default:400},jQuery.fx.step={},jQuery.expr&&jQuery.expr.filters&&(jQuery.expr.filters.animated=function(e){return jQuery.grep(jQuery.timers,function(t){return e===t.elem}).length}),jQuery.fn.offset=function(e){if(arguments.length)return e===undefined?this:this.each(function(t){jQuery.offset.setOffset(this,e,t)});var t,n,r=this[0],i={top:0,left:0},s=r&&r.ownerDocument;if(!s)return;return t=s.documentElement,jQuery.contains(t,r)?(typeof r.getBoundingClientRect!==core_strundefined&&(i=r.getBoundingClientRect()),n=getWindow(s),{top:i.top+n.pageYOffset-t.clientTop,left:i.left+n.pageXOffset-t.clientLeft}):i},jQuery.offset={setOffset:function(e,t,n){var r,i,s,o,u,a,f,l=jQuery.css(e,"position"),c=jQuery(e),h={};l==="static"&&(e.style.position="relative"),u=c.offset(),s=jQuery.css(e,"top"),a=jQuery.css(e,"left"),f=(l==="absolute"||l==="fixed")&&(s+a).indexOf("auto")>-1,f?(r=c.position(),o=r.top,i=r.left):(o=parseFloat(s)||0,i=parseFloat(a)||0),jQuery.isFunction(t)&&(t=t.call(e,n,u)),t.top!=null&&(h.top=t.top-u.top+o),t.left!=null&&(h.left=t.left-u.left+i),"using"in t?t.using.call(e,h):c.css(h)}},jQuery.fn.extend({position:function(){if(!this[0])return;var e,t,n=this[0],r={top:0,left:0};return jQuery.css(n,"position")==="fixed"?t=n.getBoundingClientRect():(e=this.offsetParent(),t=this.offset(),jQuery.nodeName(e[0],"html")||(r=e.offset()),r.top+=jQuery.css(e[0],"borderTopWidth",!0),r.left+=jQuery.css(e[0],"borderLeftWidth",!0)),{top:t.top-r.top-jQuery.css(n,"marginTop",!0),left:t.left-r.left-jQuery.css(n,"marginLeft",!0)}},offsetParent:function(){return this.map(function(){var e=this.offsetParent||docElem;while(e&&!jQuery.nodeName(e,"html")&&jQuery.css(e,"position")==="static")e=e.offsetParent;return e||docElem})}}),jQuery.each({scrollLeft:"pageXOffset",scrollTop:"pageYOffset"},function(e,t){var n="pageYOffset"===t;jQuery.fn[e]=function(r){return jQuery.access(this,function(e,r,i){var s=getWindow(e);if(i===undefined)return s?s[t]:e[r];s?s.scrollTo(n?window.pageXOffset:i,n?i:window.pageYOffset):e[r]=i},e,r,arguments.length,null)}}),jQuery.each({Height:"height",Width:"width"},function(e,t){jQuery.each({padding:"inner"+e,content:t,"":"outer"+e},function(n,r){jQuery.fn[r]=function(r,i){var s=arguments.length&&(n||typeof r!="boolean"),o=n||(r===!0||i===!0?"margin":"border");return jQuery.access(this,function(t,n,r){var i;return jQuery.isWindow(t)?t.document.documentElement["client"+e]:t.nodeType===9?(i=t.documentElement,Math.max(t.body["scroll"+e],i["scroll"+e],t.body["offset"+e],i["offset"+e],i["client"+e])):r===undefined?jQuery.css(t,n,o):jQuery.style(t,n,r,o)},t,s?r:undefined,s,null)}})}),jQuery.fn.size=function(){return this.length},jQuery.fn.andSelf=jQuery.fn.addBack,typeof module=="object"&&module&&typeof module.exports=="object"?module.exports=jQuery:typeof define=="function"&&define.amd&&define("jquery",[],function(){return jQuery}),typeof window=="object"&&typeof window.document=="object"&&(window.jQuery=window.$=jQuery)}(window),function(){function encodeHTMLSource(){var e={"&":"&#38;","<":"&#60;",">":"&#62;",'"':"&#34;","'":"&#39;","/":"&#47;"},t=/&(?!#?\w+;)|<|>|"|'|\//g;return function(){return this?this.replace(t,function(t){return e[t]||t}):this}}function resolveDefs(e,t,n){return(typeof t=="string"?t:t.toString()).replace(e.define||skip,function(t,r,i,s){return r.indexOf("def.")===0&&(r=r.substring(4)),r in n||(i===":"?(e.defineParams&&s.replace(e.defineParams,function(e,t,i){n[r]={arg:t,text:i}}),r in n||(n[r]=s)):(new Function("def","def['"+r+"']="+s))(n)),""}).replace(e.use||skip,function(t,r){e.useParams&&(r=r.replace(e.useParams,function(e,t,r,i){if(n[r]&&n[r].arg&&i){var s=(r+":"+i).replace(/'|\\/g,"_");return n.__exp=n.__exp||{},n.__exp[s]=n[r].text.replace(new RegExp("(^|[^\\w$])"+n[r].arg+"([^\\w$])","g"),"$1"+i+"$2"),t+"def.__exp['"+s+"']"}}));var i=(new Function("def","return "+r))(n);return i?resolveDefs(e,i,n):i})}function unescape(e){return e.replace(/\\('|\\)/g,"$1").replace(/[\r\t\n]/g," ")}var doT={version:"1.0.0",templateSettings:{evaluate:/\{\{([\s\S]+?\}?)\}\}/g,interpolate:/\{\{=([\s\S]+?)\}\}/g,encode:/\{\{!([\s\S]+?)\}\}/g,use:/\{\{#([\s\S]+?)\}\}/g,useParams:/(^|[^\w$])def(?:\.|\[[\'\"])([\w$\.]+)(?:[\'\"]\])?\s*\:\s*([\w$\.]+|\"[^\"]+\"|\'[^\']+\'|\{[^\}]+\})/g,define:/\{\{##\s*([\w\.$]+)\s*(\:|=)([\s\S]+?)#\}\}/g,defineParams:/^\s*([\w$]+):([\s\S]+)/,conditional:/\{\{\?(\?)?\s*([\s\S]*?)\s*\}\}/g,iterate:/\{\{~\s*(?:\}\}|([\s\S]+?)\s*\:\s*([\w$]+)\s*(?:\:\s*([\w$]+))?\s*\}\})/g,varname:"it",strip:!0,append:!0,selfcontained:!1},template:undefined,compile:undefined};typeof module!="undefined"&&module.exports?module.exports=doT:typeof define=="function"&&define.amd?define("doT",[],function(){return doT}):function(){return this||(0,eval)("this")}().doT=doT,String.prototype.encodeHTML=encodeHTMLSource();var startend={append:{start:"'+(",end:")+'",endencode:"||'').toString().encodeHTML()+'"},split:{start:"';out+=(",end:");out+='",endencode:"||'').toString().encodeHTML();out+='"}},skip=/$^/;doT.template=function(e,t,n){t=t||doT.templateSettings;var r=t.append?startend.append:startend.split,i,s=0,o,u=t.use||t.define?resolveDefs(t,e,n||{}):e;u=("var out='"+(t.strip?u.replace(/(^|\r|\n)\t* +| +\t*(\r|\n|$)/g," ").replace(/\r|\n|\t|\/\*[\s\S]*?\*\//g,""):u).replace(/'|\\/g,"\\$&").replace(t.interpolate||skip,function(e,t){return r.start+unescape(t)+r.end}).replace(t.encode||skip,function(e,t){return i=!0,r.start+unescape(t)+r.endencode}).replace(t.conditional||skip,function(e,t,n){return t?n?"';}else if("+unescape(n)+"){out+='":"';}else{out+='":n?"';if("+unescape(n)+"){out+='":"';}out+='"}).replace(t.iterate||skip,function(e,t,n,r){return t?(s+=1,o=r||"i"+s,t=unescape(t),"';var arr"+s+"="+t+";if(arr"+s+"){var "+n+","+o+"=-1,l"+s+"=arr"+s+".length-1;while("+o+"<l"+s+"){"+n+"=arr"+s+"["+o+"+=1];out+='"):"';} } out+='"}).replace(t.evaluate||skip,function(e,t){return"';"+unescape(t)+"out+='"})+"';return out;").replace(/\n/g,"\\n").replace(/\t/g,"\\t").replace(/\r/g,"\\r").replace(/(\s|;|\}|^|\{)out\+='';/g,"$1").replace(/\+''/g,"").replace(/(\s|;|\}|^|\{)out\+=''\+/g,"$1out+="),i&&t.selfcontained&&(u="String.prototype.encodeHTML=("+encodeHTMLSource.toString()+"());"+u);try{return new Function(t.varname,u)}catch(a){throw typeof console!="undefined"&&console.log("Could not create a template function: "+u),a}},doT.compile=function(e,t){return doT.template(e,null,t)}}(),function(e,t){define("utilities/MD5",[],function(){var e=function(e){function t(e,t){return e<<t|e>>>32-t}function n(e,t){var n,r,i,s,o;return i=e&2147483648,s=t&2147483648,n=e&1073741824,r=t&1073741824,o=(e&1073741823)+(t&1073741823),n&r?o^2147483648^i^s:n|r?o&1073741824?o^3221225472^i^s:o^1073741824^i^s:o^i^s}function r(e,t,n){return e&t|~e&n}function i(e,t,n){return e&n|t&~n}function s(e,t,n){return e^t^n}function o(e,t,n){return t^(e|~n)}function u(e,i,s,o,u,a,f){return e=n(e,n(n(r(i,s,o),u),f)),n(t(e,a),i)}function a(e,r,s,o,u,a,f){return e=n(e,n(n(i(r,s,o),u),f)),n(t(e,a),r)}function f(e,r,i,o,u,a,f){return e=n(e,n(n(s(r,i,o),u),f)),n(t(e,a),r)}function l(e,r,i,s,u,a,f){return e=n(e,n(n(o(r,i,s),u),f)),n(t(e,a),r)}function c(e){var t,n=e.length,r=n+8,i=(r-r%64)/64,s=(i+1)*16,o=Array(s-1),u=0,a=0;while(a<n)t=(a-a%4)/4,u=a%4*8,o[t]=o[t]|e.charCodeAt(a)<<u,a++;return t=(a-a%4)/4,u=a%4*8,o[t]=o[t]|128<<u,o[s-2]=n<<3,o[s-1]=n>>>29,o}function h(e){var t="",n="",r,i;for(i=0;i<=3;i++)r=e>>>i*8&255,n="0"+r.toString(16),t+=n.substr(n.length-2,2);return t}function p(e){e=e.replace(/\r\n/g,"\n");var t="";for(var n=0;n<e.length;n++){var r=e.charCodeAt(n);r<128?t+=String.fromCharCode(r):r>127&&r<2048?(t+=String.fromCharCode(r>>6|192),t+=String.fromCharCode(r&63|128)):(t+=String.fromCharCode(r>>12|224),t+=String.fromCharCode(r>>6&63|128),t+=String.fromCharCode(r&63|128))}return t}var d=Array(),v,m,g,y,b,w,E,S,x,T=7,N=12,C=17,k=22,L=5,A=9,O=14,M=20,_=4,D=11,P=16,H=23,B=6,j=10,F=15,I=21;e=p(e),d=c(e),w=1732584193,E=4023233417,S=2562383102,x=271733878;for(v=0;v<d.length;v+=16)m=w,g=E,y=S,b=x,w=u(w,E,S,x,d[v+0],T,3614090360),x=u(x,w,E,S,d[v+1],N,3905402710),S=u(S,x,w,E,d[v+2],C,606105819),E=u(E,S,x,w,d[v+3],k,3250441966),w=u(w,E,S,x,d[v+4],T,4118548399),x=u(x,w,E,S,d[v+5],N,1200080426),S=u(S,x,w,E,d[v+6],C,2821735955),E=u(E,S,x,w,d[v+7],k,4249261313),w=u(w,E,S,x,d[v+8],T,1770035416),x=u(x,w,E,S,d[v+9],N,2336552879),S=u(S,x,w,E,d[v+10],C,4294925233),E=u(E,S,x,w,d[v+11],k,2304563134),w=u(w,E,S,x,d[v+12],T,1804603682),x=u(x,w,E,S,d[v+13],N,4254626195),S=u(S,x,w,E,d[v+14],C,2792965006),E=u(E,S,x,w,d[v+15],k,1236535329),w=a(w,E,S,x,d[v+1],L,4129170786),x=a(x,w,E,S,d[v+6],A,3225465664),S=a(S,x,w,E,d[v+11],O,643717713),E=a(E,S,x,w,d[v+0],M,3921069994),w=a(w,E,S,x,d[v+5],L,3593408605),x=a(x,w,E,S,d[v+10],A,38016083),S=a(S,x,w,E,d[v+15],O,3634488961),E=a(E,S,x,w,d[v+4],M,3889429448),w=a(w,E,S,x,d[v+9],L,568446438),x=a(x,w,E,S,d[v+14],A,3275163606),S=a(S,x,w,E,d[v+3],O,4107603335),E=a(E,S,x,w,d[v+8],M,1163531501),w=a(w,E,S,x,d[v+13],L,2850285829),x=a(x,w,E,S,d[v+2],A,4243563512),S=a(S,x,w,E,d[v+7],O,1735328473),E=a(E,S,x,w,d[v+12],M,2368359562),w=f(w,E,S,x,d[v+5],_,4294588738),x=f(x,w,E,S,d[v+8],D,2272392833),S=f(S,x,w,E,d[v+11],P,1839030562),E=f(E,S,x,w,d[v+14],H,4259657740),w=f(w,E,S,x,d[v+1],_,2763975236),x=f(x,w,E,S,d[v+4],D,1272893353),S=f(S,x,w,E,d[v+7],P,4139469664),E=f(E,S,x,w,d[v+10],H,3200236656),w=f(w,E,S,x,d[v+13],_,681279174),x=f(x,w,E,S,d[v+0],D,3936430074),S=f(S,x,w,E,d[v+3],P,3572445317),E=f(E,S,x,w,d[v+6],H,76029189),w=f(w,E,S,x,d[v+9],_,3654602809),x=f(x,w,E,S,d[v+12],D,3873151461),S=f(S,x,w,E,d[v+15],P,530742520),E=f(E,S,x,w,d[v+2],H,3299628645),w=l(w,E,S,x,d[v+0],B,4096336452),x=l(x,w,E,S,d[v+7],j,1126891415),S=l(S,x,w,E,d[v+14],F,2878612391),E=l(E,S,x,w,d[v+5],I,4237533241),w=l(w,E,S,x,d[v+12],B,1700485571),x=l(x,w,E,S,d[v+3],j,2399980690),S=l(S,x,w,E,d[v+10],F,4293915773),E=l(E,S,x,w,d[v+1],I,2240044497),w=l(w,E,S,x,d[v+8],B,1873313359),x=l(x,w,E,S,d[v+15],j,4264355552),S=l(S,x,w,E,d[v+6],F,2734768916),E=l(E,S,x,w,d[v+13],I,1309151649),w=l(w,E,S,x,d[v+4],B,4149444226),x=l(x,w,E,S,d[v+11],j,3174756917),S=l(S,x,w,E,d[v+2],F,718787259),E=l(E,S,x,w,d[v+9],I,3951481745),w=n(w,m),E=n(E,g),S=n(S,y),x=n(x,b);var q=h(w)+h(E)+h(S)+h(x);return q.toLowerCase()};return String.MD5=String.MD5||e,e})}(this),function(e,t){define("utilities/ValidateURL",[],function(){var e=/(ftp|http|https):\/\/(\w+:{0,1}\w*@)?(\S+)(:[0-9]+)?(\/|\/([\w#!:.?+=&%@!\-\/]))?/,t=function(t){return e.test(t)};return t})}(this),function(e,t){define("utilities/FormatString",[],function(){var e=function(e){var e=arguments[0];if(typeof arguments[1]=="object"){var t=arguments[1];return e.replace(/\{(\w+)\}/g,function(){return t[arguments[1]]})}var n=arguments;return e.replace(/\{(\d+)\}/g,function(){return n[arguments[1]]})};return e})}(this),function(e,t){define("utilities/ReadableSize",[],function(){var e=function(e){e=parseInt(e,10);var t=["B","KB","MB","GB","TB"];e=Math.max(e,0);var n=Math.floor((e?Math.log(e):0)/Math.log(1024));n=Math.min(n,t.length-1),e=e*100/Math.pow(1024,n);var r=t[n],i;return r==="B"||r==="KB"?i=Math.round(Math.round(e)/100)+" "+t[n]:i=Math.round(e)/100+" "+t[n],i};return e})}(this),function(e,t){define("utilities/ConditionalEscape",[],function(){var e=function(e,t){return e.replace(/<\s*([^>]+)>/g,function(e,n){var r=e.indexOf(t);return r===1||r===2?e:("&lt;"+n+"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&rsquo;")})};return e})}(this),function(e,t){define("utilities/FormatDate",[],function(){var e=function(e,t){t=t?new Date(parseInt(t,10)):new Date;var n=e;return n=n.replace(/y{4}|M{2}|d{2}|h{2}|H{2}|m{2}|s{2}/g,function(e){switch(e){case"yyyy":return t.getFullYear();case"MM":var n=t.getMonth()+1;return n<10?"0"+n:n;case"dd":var r=t.getDate();return r<10?"0"+r:r;case"HH":var i=t.getHours();return i<10?"0"+i:i;case"hh":var i=t.getHours();return i>12&&(i-=12),i<10?"0"+i:i;case"mm":var n=t.getMinutes();return n<10?"0"+n:n;case"ss":var s=t.getSeconds();return s<10?"0"+s:s}}),n};return e})}(this),function(){var e=this,t=e.Backbone,n=[],r=n.push,i=n.slice,s=n.splice,o;typeof exports!="undefined"?o=exports:o=e.Backbone={},o.VERSION="1.0.0";var u=e._;!u&&typeof require!="undefined"&&(u=require("underscore")),o.$=e.jQuery||e.Zepto||e.ender||e.$,o.noConflict=function(){return e.Backbone=t,this},o.emulateHTTP=!1,o.emulateJSON=!1;var a=o.Events={on:function(e,t,n){if(!l(this,"on",e,[t,n])||!t)return this;this._events||(this._events={});var r=this._events[e]||(this._events[e]=[]);return r.push({callback:t,context:n,ctx:n||this}),this},once:function(e,t,n){if(!l(this,"once",e,[t,n])||!t)return this;var r=this,i=u.once(function(){r.off(e,i),t.apply(this,arguments)});return i._callback=t,this.on(e,i,n)},off:function(e,t,n){var r,i,s,o,a,f,c,h;if(!this._events||!l(this,"off",e,[t,n]))return this;if(!e&&!t&&!n)return this._events={},this;o=e?[e]:u.keys(this._events);for(a=0,f=o.length;a<f;a++){e=o[a];if(s=this._events[e]){this._events[e]=r=[];if(t||n)for(c=0,h=s.length;c<h;c++)i=s[c],(t&&t!==i.callback&&t!==i.callback._callback||n&&n!==i.context)&&r.push(i);r.length||delete this._events[e]}}return this},trigger:function(e){if(!this._events)return this;var t=i.call(arguments,1);if(!l(this,"trigger",e,t))return this;var n=this._events[e],r=this._events.all;return n&&c(n,t),r&&c(r,arguments),this},stopListening:function(e,t,n){var r=this._listeners;if(!r)return this;var i=!t&&!n;typeof t=="object"&&(n=this),e&&((r={})[e._listenerId]=e);for(var s in r)r[s].off(t,n,this),i&&delete this._listeners[s];return this}},f=/\s+/,l=function(e,t,n,r){if(!n)return!0;if(typeof n=="object"){for(var i in n)e[t].apply(e,[i,n[i]].concat(r));return!1}if(f.test(n)){var s=n.split(f);for(var o=0,u=s.length;o<u;o++)e[t].apply(e,[s[o]].concat(r));return!1}return!0},c=function(e,t){var n,r=-1,i=e.length,s=t[0],o=t[1],u=t[2];switch(t.length){case 0:while(++r<i)(n=e[r]).callback.call(n.ctx);return;case 1:while(++r<i)(n=e[r]).callback.call(n.ctx,s);return;case 2:while(++r<i)(n=e[r]).callback.call(n.ctx,s,o);return;case 3:while(++r<i)(n=e[r]).callback.call(n.ctx,s,o,u);return;default:while(++r<i)(n=e[r]).callback.apply(n.ctx,t)}},h={listenTo:"on",listenToOnce:"once"};u.each(h,function(e,t){a[t]=function(t,n,r){var i=this._listeners||(this._listeners={}),s=t._listenerId||(t._listenerId=u.uniqueId("l"));return i[s]=t,typeof n=="object"&&(r=this),t[e](n,r,this),this}}),a.bind=a.on,a.unbind=a.off,u.extend(o,a);var p=o.Model=function(e,t){var n,r=e||{};t||(t={}),this.cid=u.uniqueId("c"),this.attributes={},u.extend(this,u.pick(t,d)),t.parse&&(r=this.parse(r,t)||{});if(n=u.result(this,"defaults"))r=u.defaults({},r,n);this.set(r,t),this.changed={},this.initialize.apply(this,arguments)},d=["url","urlRoot","collection"];u.extend(p.prototype,a,{changed:null,validationError:null,idAttribute:"id",initialize:function(){},toJSON:function(e){return u.clone(this.attributes)},sync:function(){return o.sync.apply(this,arguments)},get:function(e){return this.attributes[e]},escape:function(e){return u.escape(this.get(e))},has:function(e){return this.get(e)!=null},set:function(e,t,n){var r,i,s,o,a,f,l,c;if(e==null)return this;typeof e=="object"?(i=e,n=t):(i={})[e]=t,n||(n={});if(!this._validate(i,n))return!1;s=n.unset,a=n.silent,o=[],f=this._changing,this._changing=!0,f||(this._previousAttributes=u.clone(this.attributes),this.changed={}),c=this.attributes,l=this._previousAttributes,this.idAttribute in i&&(this.id=i[this.idAttribute]);for(r in i)t=i[r],u.isEqual(c[r],t)||o.push(r),u.isEqual(l[r],t)?delete this.changed[r]:this.changed[r]=t,s?delete c[r]:c[r]=t;if(!a){o.length&&(this._pending=!0);for(var h=0,p=o.length;h<p;h++)this.trigger("change:"+o[h],this,c[o[h]],n)}if(f)return this;if(!a)while(this._pending)this._pending=!1,this.trigger("change",this,n);return this._pending=!1,this._changing=!1,this},unset:function(e,t){return this.set(e,void 0,u.extend({},t,{unset:!0}))},clear:function(e){var t={};for(var n in this.attributes)t[n]=void 0;return this.set(t,u.extend({},e,{unset:!0}))},hasChanged:function(e){return e==null?!u.isEmpty(this.changed):u.has(this.changed,e)},changedAttributes:function(e){if(!e)return this.hasChanged()?u.clone(this.changed):!1;var t,n=!1,r=this._changing?this._previousAttributes:this.attributes;for(var i in e){if(u.isEqual(r[i],t=e[i]))continue;(n||(n={}))[i]=t}return n},previous:function(e){return e==null||!this._previousAttributes?null:this._previousAttributes[e]},previousAttributes:function(){return u.clone(this._previousAttributes)},fetch:function(e){e=e?u.clone(e):{},e.parse===void 0&&(e.parse=!0);var t=this,n=e.success;return e.success=function(r){if(!t.set(t.parse(r,e),e))return!1;n&&n(t,r,e),t.trigger("sync",t,r,e)},j(this,e),this.sync("read",this,e)},save:function(e,t,n){var r,i,s,o=this.attributes;e==null||typeof e=="object"?(r=e,n=t):(r={})[e]=t;if(r&&(!n||!n.wait)&&!this.set(r,n))return!1;n=u.extend({validate:!0},n);if(!this._validate(r,n))return!1;r&&n.wait&&(this.attributes=u.extend({},o,r)),n.parse===void 0&&(n.parse=!0);var a=this,f=n.success;return n.success=function(e){a.attributes=o;var t=a.parse(e,n);n.wait&&(t=u.extend(r||{},t));if(u.isObject(t)&&!a.set(t,n))return!1;f&&f(a,e,n),a.trigger("sync",a,e,n)},j(this,n),i=this.isNew()?"create":n.patch?"patch":"update",i==="patch"&&(n.attrs=r),s=this.sync(i,this,n),r&&n.wait&&(this.attributes=o),s},destroy:function(e){e=e?u.clone(e):{};var t=this,n=e.success,r=function(){t.trigger("destroy",t,t.collection,e)};e.success=function(i){(e.wait||t.isNew())&&r(),n&&n(t,i,e),t.isNew()||t.trigger("sync",t,i,e)};if(this.isNew())return e.success(),!1;j(this,e);var i=this.sync("delete",this,e);return e.wait||r(),i},url:function(){var e=u.result(this,"urlRoot")||u.result(this.collection,"url")||B();return this.isNew()?e:e+(e.charAt(e.length-1)==="/"?"":"/")+encodeURIComponent(this.id)},parse:function(e,t){return e},clone:function(){return new this.constructor(this.attributes)},isNew:function(){return this.id==null},isValid:function(e){return this._validate({},u.extend(e||{},{validate:!0}))},_validate:function(e,t){if(!t.validate||!this.validate)return!0;e=u.extend({},this.attributes,e);var n=this.validationError=this.validate(e,t)||null;return n?(this.trigger("invalid",this,n,u.extend(t||{},{validationError:n})),!1):!0}});var v=["keys","values","pairs","invert","pick","omit"];u.each(v,function(e){p.prototype[e]=function(){var t=i.call(arguments);return t.unshift(this.attributes),u[e].apply(u,t)}});var m=o.Collection=function(e,t){t||(t={}),t.url&&(this.url=t.url),t.model&&(this.model=t.model),t.comparator!==void 0&&(this.comparator=t.comparator),this._reset(),this.initialize.apply(this,arguments),e&&this.reset(e,u.extend({silent:!0},t))},g={add:!0,remove:!0,merge:!0},y={add:!0,merge:!1,remove:!1};u.extend(m.prototype,a,{model:p,initialize:function(){},toJSON:function(e){return this.map(function(t){return t.toJSON(e)})},sync:function(){return o.sync.apply(this,arguments)},add:function(e,t){return this.set(e,u.defaults(t||{},y))},remove:function(e,t){e=u.isArray(e)?e.slice():[e],t||(t={});var n,r,i,s;for(n=0,r=e.length;n<r;n++){s=this.get(e[n]);if(!s)continue;delete this._byId[s.id],delete this._byId[s.cid],i=this.indexOf(s),this.models.splice(i,1),this.length--,t.silent||(t.index=i,s.trigger("remove",s,this,t)),this._removeReference(s)}return this},set:function(e,t){t=u.defaults(t||{},g),t.parse&&(e=this.parse(e,t)),u.isArray(e)||(e=e?[e]:[]);var n,i,o,a,f,l,c=t.at,h=this.comparator&&c==null&&t.sort!==!1,p=u.isString(this.comparator)?this.comparator:null,d=[],v=[],m={};for(n=0,i=e.length;n<i;n++){if(!(o=this._prepareModel(e[n],t)))continue;(f=this.get(o))?(t.remove&&(m[f.cid]=!0),t.merge&&(f.set(o.attributes,t),h&&!l&&f.hasChanged(p)&&(l=!0))):t.add&&(d.push(o),o.on("all",this._onModelEvent,this),this._byId[o.cid]=o,o.id!=null&&(this._byId[o.id]=o))}if(t.remove){for(n=0,i=this.length;n<i;++n)m[(o=this.models[n]).cid]||v.push(o);v.length&&this.remove(v,t)}d.length&&(h&&(l=!0),this.length+=d.length,c!=null?s.apply(this.models,[c,0].concat(d)):r.apply(this.models,d)),l&&this.sort({silent:!0});if(t.silent)return this;for(n=0,i=d.length;n<i;n++)(o=d[n]).trigger("add",o,this,t);return l&&this.trigger("sort",this,t),this},reset:function(e,t){t||(t={});for(var n=0,r=this.models.length;n<r;n++)this._removeReference(this.models[n]);return t.previousModels=this.models,this._reset(),this.add(e,u.extend({silent:!0},t)),t.silent||this.trigger("reset",this,t),this},push:function(e,t){return e=this._prepareModel(e,t),this.add(e,u.extend({at:this.length},t)),e},pop:function(e){var t=this.at(this.length-1);return this.remove(t,e),t},unshift:function(e,t){return e=this._prepareModel(e,t),this.add(e,u.extend({at:0},t)),e},shift:function(e){var t=this.at(0);return this.remove(t,e),t},slice:function(e,t){return this.models.slice(e,t)},get:function(e){return e==null?void 0:this._byId[e.id!=null?e.id:e.cid||e]},at:function(e){return this.models[e]},where:function(e,t){return u.isEmpty(e)?t?void 0:[]:this[t?"find":"filter"](function(t){for(var n in e)if(e[n]!==t.get(n))return!1;return!0})},findWhere:function(e){return this.where(e,!0)},sort:function(e){if(!this.comparator)throw new Error("Cannot sort a set without a comparator");return e||(e={}),u.isString(this.comparator)||this.comparator.length===1?this.models=this.sortBy(this.comparator,this):this.models.sort(u.bind(this.comparator,this)),e.silent||this.trigger("sort",this,e),this},sortedIndex:function(e,t,n){t||(t=this.comparator);var r=u.isFunction(t)?t:function(e){return e.get(t)};return u.sortedIndex(this.models,e,r,n)},pluck:function(e){return u.invoke(this.models,"get",e)},fetch:function(e){e=e?u.clone(e):{},e.parse===void 0&&(e.parse=!0);var t=e.success,n=this;return e.success=function(r){var i=e.reset?"reset":"set";n[i](r,e),t&&t(n,r,e),n.trigger("sync",n,r,e)},j(this,e),this.sync("read",this,e)},create:function(e,t){t=t?u.clone(t):{};if(!(e=this._prepareModel(e,t)))return!1;t.wait||this.add(e,t);var n=this,r=t.success;return t.success=function(i){t.wait&&n.add(e,t),r&&r(e,i,t)},e.save(null,t),e},parse:function(e,t){return e},clone:function(){return new this.constructor(this.models)},_reset:function(){this.length=0,this.models=[],this._byId={}},_prepareModel:function(e,t){if(e instanceof p)return e.collection||(e.collection=this),e;t||(t={}),t.collection=this;var n=new this.model(e,t);return n._validate(e,t)?n:(this.trigger("invalid",this,e,t),!1)},_removeReference:function(e){this===e.collection&&delete e.collection,e.off("all",this._onModelEvent,this)},_onModelEvent:function(e,t,n,r){if((e==="add"||e==="remove")&&n!==this)return;e==="destroy"&&this.remove(t,r),t&&e==="change:"+t.idAttribute&&(delete this._byId[t.previous(t.idAttribute)],t.id!=null&&(this._byId[t.id]=t)),this.trigger.apply(this,arguments)}});var b=["forEach","each","map","collect","reduce","foldl","inject","reduceRight","foldr","find","detect","filter","select","reject","every","all","some","any","include","contains","invoke","max","min","toArray","size","first","head","take","initial","rest","tail","drop","last","without","indexOf","shuffle","lastIndexOf","isEmpty","chain"];u.each(b,function(e){m.prototype[e]=function(){var t=i.call(arguments);return t.unshift(this.models),u[e].apply(u,t)}});var w=["groupBy","countBy","sortBy"];u.each(w,function(e){m.prototype[e]=function(t,n){var r=u.isFunction(t)?t:function(e){return e.get(t)};return u[e](this.models,r,n)}});var E=o.View=function(e){this.cid=u.uniqueId("view"),this._configure(e||{}),this._ensureElement(),this.initialize.apply(this,arguments),this.delegateEvents()},S=/^(\S+)\s*(.*)$/,x=["model","collection","el","id","attributes","className","tagName","events"];u.extend(E.prototype,a,{tagName:"div",$:function(e){return this.$el.find(e)},initialize:function(){},render:function(){return this},remove:function(){return this.$el.remove(),this.stopListening(),this},setElement:function(e,t){return this.$el&&this.undelegateEvents(),this.$el=e instanceof o.$?e:o.$(e),this.el=this.$el[0],t!==!1&&this.delegateEvents(),this},delegateEvents:function(e){if(!e&&!(e=u.result(this,"events")))return this;this.undelegateEvents();for(var t in e){var n=e[t];u.isFunction(n)||(n=this[e[t]]);if(!n)continue;var r=t.match(S),i=r[1],s=r[2];n=u.bind(n,this),i+=".delegateEvents"+this.cid,s===""?this.$el.on(i,n):this.$el.on(i,s,n)}return this},undelegateEvents:function(){return this.$el.off(".delegateEvents"+this.cid),this},_configure:function(e){this.options&&(e=u.extend({},u.result(this,"options"),e)),u.extend(this,u.pick(e,x)),this.options=e},_ensureElement:function(){if(!this.el){var e=u.extend({},u.result(this,"attributes"));this.id&&(e.id=u.result(this,"id")),this.className&&(e["class"]=u.result(this,"className"));var t=o.$("<"+u.result(this,"tagName")+">").attr(e);this.setElement(t,!1)}else this.setElement(u.result(this,"el"),!1)}}),o.sync=function(e,t,n){var r=T[e];u.defaults(n||(n={}),{emulateHTTP:o.emulateHTTP,emulateJSON:o.emulateJSON});var i={type:r,dataType:"json"};n.url||(i.url=u.result(t,"url")||B()),n.data==null&&t&&(e==="create"||e==="update"||e==="patch")&&(i.contentType="application/json",i.data=JSON.stringify(n.attrs||t.toJSON(n))),n.emulateJSON&&(i.contentType="application/x-www-form-urlencoded",i.data=i.data?{model:i.data}:{});if(n.emulateHTTP&&(r==="PUT"||r==="DELETE"||r==="PATCH")){i.type="POST",n.emulateJSON&&(i.data._method=r);var s=n.beforeSend;n.beforeSend=function(e){e.setRequestHeader("X-HTTP-Method-Override",r);if(s)return s.apply(this,arguments)}}i.type!=="GET"&&!n.emulateJSON&&(i.processData=!1),i.type==="PATCH"&&window.ActiveXObject&&(!window.external||!window.external.msActiveXFilteringEnabled)&&(i.xhr=function(){return new ActiveXObject("Microsoft.XMLHTTP")});var a=n.xhr=o.ajax(u.extend(i,n));return t.trigger("request",t,a,n),a};var T={create:"POST",update:"PUT",patch:"PATCH","delete":"DELETE",read:"GET"};o.ajax=function(){return o.$.ajax.apply(o.$,arguments)};var N=o.Router=function(e){e||(e={}),e.routes&&(this.routes=e.routes),this._bindRoutes(),this.initialize.apply(this,arguments)},C=/\((.*?)\)/g,k=/(\(\?)?:\w+/g,L=/\*\w+/g,A=/[\-{}\[\]+?.,\\\^$|#\s]/g;u.extend(N.prototype,a,{initialize:function(){},route:function(e,t,n){u.isRegExp(e)||(e=this._routeToRegExp(e)),u.isFunction(t)&&(n=t,t=""),n||(n=this[t]);var r=this;return o.history.route(e,function(i){var s=r._extractParameters(e,i);n&&n.apply(r,s),r.trigger.apply(r,["route:"+t].concat(s)),r.trigger("route",t,s),o.history.trigger("route",r,t,s)}),this},navigate:function(e,t){return o.history.navigate(e,t),this},_bindRoutes:function(){if(!this.routes)return;this.routes=u.result(this,"routes");var e,t=u.keys(this.routes);while((e=t.pop())!=null)this.route(e,this.routes[e])},_routeToRegExp:function(e){return e=e.replace(A,"\\$&").replace(C,"(?:$1)?").replace(k,function(e,t){return t?e:"([^/]+)"}).replace(L,"(.*?)"),new RegExp("^"+e+"$")},_extractParameters:function(e,t){var n=e.exec(t).slice(1);return u.map(n,function(e){return e?decodeURIComponent(e):null})}});var O=o.History=function(){this.handlers=[],u.bindAll(this,"checkUrl"),typeof window!="undefined"&&(this.location=window.location,this.history=window.history)},M=/^[#\/]|\s+$/g,_=/^\/+|\/+$/g,D=/msie [\w.]+/,P=/\/$/;O.started=!1,u.extend(O.prototype,a,{interval:50,getHash:function(e){var t=(e||this).location.href.match(/#(.*)$/);return t?t[1]:""},getFragment:function(e,t){if(e==null)if(this._hasPushState||!this._wantsHashChange||t){e=this.location.pathname;var n=this.root.replace(P,"");e.indexOf(n)||(e=e.substr(n.length))}else e=this.getHash();return e.replace(M,"")},start:function(e){if(O.started)throw new Error("Backbone.history has already been started");O.started=!0,this.options=u.extend({},{root:"/"},this.options,e),this.root=this.options.root,this._wantsHashChange=this.options.hashChange!==!1,this._wantsPushState=!!this.options.pushState,this._hasPushState=!!(this.options.pushState&&this.history&&this.history.pushState);var t=this.getFragment(),n=document.documentMode,r=D.exec(navigator.userAgent.toLowerCase())&&(!n||n<=7);this.root=("/"+this.root+"/").replace(_,"/"),r&&this._wantsHashChange&&(this.iframe=o.$('<iframe src="javascript:0" tabindex="-1" />').hide().appendTo("body")[0].contentWindow,this.navigate(t)),this._hasPushState?o.$(window).on("popstate",this.checkUrl):this._wantsHashChange&&"onhashchange"in window&&!r?o.$(window).on("hashchange",this.checkUrl):this._wantsHashChange&&(this._checkUrlInterval=setInterval(this.checkUrl,this.interval)),this.fragment=t;var i=this.location,s=i.pathname.replace(/[^\/]$/,"$&/")===this.root;if(this._wantsHashChange&&this._wantsPushState&&!this._hasPushState&&!s)return this.fragment=this.getFragment(null,!0),this.location.replace(this.root+this.location.search+"#"+this.fragment),!0;this._wantsPushState&&this._hasPushState&&s&&i.hash&&(this.fragment=this.getHash().replace(M,""),this.history.replaceState({},document.title,this.root+this.fragment+i.search));if(!this.options.silent)return this.loadUrl()},stop:function(){o.$(window).off("popstate",this.checkUrl).off("hashchange",this.checkUrl),clearInterval(this._checkUrlInterval),O.started=!1},route:function(e,t){this.handlers.unshift({route:e,callback:t})},checkUrl:function(e){var t=this.getFragment();t===this.fragment&&this.iframe&&(t=this.getFragment(this.getHash(this.iframe)));if(t===this.fragment)return!1;this.iframe&&this.navigate(t),this.loadUrl()||this.loadUrl(this.getHash())},loadUrl:function(e){var t=this.fragment=this.getFragment(e),n=u.any(this.handlers,function(e){if(e.route.test(t))return e.callback(t),!0});return n},navigate:function(e,t){if(!O.started)return!1;if(!t||t===!0)t={trigger:t};e=this.getFragment(e||"");if(this.fragment===e)return;this.fragment=e;var n=this.root+e;if(this._hasPushState)this.history[t.replace?"replaceState":"pushState"]({},document.title,n);else{if(!this._wantsHashChange)return this.location.assign(n);this._updateHash(this.location,e,t.replace),this.iframe&&e!==this.getFragment(this.getHash(this.iframe))&&(t.replace||this.iframe.document.open().close(),this._updateHash(this.iframe.location,e,t.replace))}t.trigger&&this.loadUrl(e)},_updateHash:function(e,t,n){if(n){var r=e.href.replace(/(javascript:|#).*$/,"");e.replace(r+"#"+t)}else e.hash="#"+t}}),o.history=new O;var H=function(e,t){var n=this,r;e&&u.has(e,"constructor")?r=e.constructor:r=function(){return n.apply(this,arguments)},u.extend(r,n,t);var i=function(){this.constructor=r};return i.prototype=n.prototype,r.prototype=new i,e&&u.extend(r.prototype,e),r.__super__=n.prototype,r};p.extend=m.extend=N.extend=E.extend=O.extend=H;var B=function(){throw new Error('A "url" property or function must be specified')},j=function(e,t){var n=t.error;t.error=function(r){n&&n(e,r,t),e.trigger("error",e,r,t)}}}.call(this),define("backbone",["underscore","jquery"],function(e){return function(){var t,n;return t||e.Backbone}}(this)),function(e,t){define("utilities/QueryString",[],function(){var t="[?&#]",n="=([^&]*)",r={};return r.get=function(r,i){i=i||e.location.search;var s=i.match(new RegExp(t+r+n,"i")),o=s&&s[1],u=o&&decodeURIComponent(o);return u},r})}(this),function(e,t){define("Configuration",[],function(){var t={BASE_PATH:"javascripts/",actions:{BLOCK_WINDOW:"wdj://window/blocking.json",SEND_LOG:"wdj://window/log.json",SCREEN_SHOT:"wdj://window/screenshot_device.json",FULL_SCREEN:"wdj://window/full_screenshot.json",WEIBO:"wdj://window/weibo.json",SAVE_SCREENSHOT:"wdj://window/save_screenshot_dir.json",SET_LAST_USED_DIR:"wdj://window/set_last_used_dir.json",EDIT_IMAGE:"wdj://window/edit_image.json",CHECK_FILE_PATH:"wdj://window/check_file_path.json",SHOW_FILE:"wdj://window/show_file.json",SELECT_CONTACT_PHOTO:"wdj://window/select_contact_photo_file.json",OPEN_FILE:"wdj://window/open_file.json",PUBLISH_EVENT:"wdj://window/publish.json",UPDATE_NOTIFICATION_TITLE:"wdj://window/update_notification.json",CLOSE_ALL_NOTIFICATION:"wdj://window/close_all_notification.json",MAILTO:"wdj://window/mailto.json",OPEN_WANDUJIA:"wdj://helper/startup_wandoujia.json",ZIP_PACKAGE:"wdj://window/zip.json",SAVE_APP_SETTING:"wdj://window/save_app_setting.json",OPEN_URL:"wdj://window/open_url.json",OPEN_URL_HELPER:"wdj://helper/open_url.json",SELECT_FOLDER:"wdj://window/select_folder.json",CONNET_PHONE:"wdj://window/open_phone_selector.json",WINDOW_DEVICE_BIND:"wdj://window/bind_device.json",WINDOW_DEVICE_UNBIND:"wdj://window/unbind_device.json",WINDOW_DEVICE_NEED_BIND:"wdj://window/need_bind.json",RECORD_CURRENT_BACKUP_TIME:"wdj://window/record_backup_time.json",WINDOW_OPEN_PRIVACY_SETTING:"wdj://window/open_privacy_setting.json",DEVICE_USB_REDETECT:"wdj://window/usb_redetect.json",DEVICE_GET_USB_DETECT_STATE:"wdj://window/usb_detect_state.json",WINDOW_OPEN_SETTING:"wdj://window/open_setting.json",WINDOW_DISK_FREE_SPACE:"wdj://window/disk_free_space.json",DEVICE_GET_WALLPAPER:"wdj://device/wallpaper.json",DEVICE_GET_DEVICE_STATE:"wdj://device/state.json",DEVICE_GET_SCREENSHOT_INFO:"wdj://device/screenshot.json",DEVICE_GET_INTERNAL_ROOM:"wdj://device/internal.json",DEVICE_GET_EXTERNAL_ROOM:"wdj://device/external.json",DEVICE_OPEN_SD_CARD:"wdj://device/open_sdcard.json",DEVICE_TITLE:"wdj://device/title.json",DEVICE_GET_BATTERY:"wdj://device/battery.json",DEVICE_IS_AUTOBACKUP:"wdj://device/is_autobakup.json",DEVICE_CHECK_FTP_REG:"wdj://device/check_ftp_reg.json",DEVICE_FIX_FTP:"wdj://device/fix_ftp_reg.json",DEVICE_CAN_SCREENSHOT_WIFI:"wdj://device/enable_wifi_srceen_shot.json",DEVICE_GET_UDID:"wdj://device/get_udid.json",DEVICE_GET_SHELL:"wdj://device/shell.json",GET_WELCOM_PAGE_IMG:"wdj://social/save_welcome_page.json",AUTH:"wdj://social/auth.json",STATUS_UPLOAD:"wdj://social/statuses_upload.json",USER_SHOW:"wdj://social/users_show.json",USER_LOGOUT:"wdj://social/users_logout.json",AUTH_INFO:"wdj://social/auth_info.json",GET_TOKEN:"wdj://social/get_token.json",CONTACT_GET_SHOW:"wdj://contacts/show.json",CONTACT_GET_CONTACT:"wdj://contacts/get.json",CONTACT_SEARCH:"wdj://contacts/search.json",CONTACT_ADD:"wdj://contacts/add.json",CONTACT_UPDATE:"wdj://contacts/update.json",CONTACT_SYNC:"wdj://contacts/sync.json",CONTACT_GROUPS_SHOW:"wdj://groups/show.json",CONTACT_GROUPS_DELETE:"wdj://groups/delete.json",CONTACT_GROUPS_UPDATE:"wdj://groups/update.json",CONTACT_GROUPS_ADD:"wdj://groups/add.json",CONTACT_SET_GROUPS:"wdj://contacts/set_groups.json",CONTACT_CANCEL:"wdj://contacts/cancel.json",CONTACT_BATCH_DELETE:"wdj://contacts/batch_delete.json",CONTACT_EXPORT:"wdj://contacts/export.json",CONTACT_IMPORT:"wdj://contacts/import.json",CONTACT_START:"wdj://contacts/star.json",CONTACT_UNSTART:"wdj://contacts/unstar.json",CONTACT_SELECT_CONTACT_FILE:"wdj://window/select_contact_file.json",CONTACT_SYNCED_ACCOUNTS:"wdj://contacts/syncd_accounts.json",CONTACT_BATCH_GROUP:"wdj://contacts/batch_group.json",CONTACT_HAS_BACKUP:"wdj://contacts/has_backup.json",CONTACT_LOAD_BACKUP:"wdj://contacts/load_backup.json",APP_SHOW:"wdj://apps/show.json",APP_SYNC:"wdj://apps/sync.json",APP_DUMP_LOCAL:"wdj://apps/dump.json",APP_DOWNLOAD:"wdj://apps/download.json",APP_BATCH_DOWNLOAD:"wdj://apps/batch_download.json",APP_INSTALL:"wdj://apps/install.json",APP_UNINSTALL:"wdj://apps/batch_uninstall.json",APP_IGNORE_UPDATE:"wdj://apps/ignore.json",APP_UNIGNORE_UPDATE:"wdj://apps/unignore.json",APP_GET_RECOMMEND:"wdj://apps/recommend.json",APP_BATCH_UNINSTALL:"wdj://apps/batch_uninstall.json",APP_UNLIKE:"wdj://apps/unlike.json",APP_GET_SELECTED_APK:"wdj://window/select_apps.json",APP_MOVE:"wdj://apps/move.json",APP_EXPORT:"wdj://apps/export.json",APP_UPDATE_NOTIFI_FREQUENCE:"wdj://helper/check_frequence.json",APP_CLOSE_UPDAYE_NOTIFI:"wdj://helper/close_app_checker.json",APP_COMMENTARY:"wdj://apps/comment.json",APP_GET_COMMENT:"wdj://apps/app_comment.json",APP_ENJOY:"wdj://apps/enjoy.json",APP_SNAP_SHOT:"wdj://helper/app_snapshot.json",APP_CANCEL:"wdj://apps/cancel.json",APP_SYNC_SHOW:"wdj://apps/sync_show.json",APP_BATCH_INSTALL:"wdj://apps/batch_install.json",APP_APK_DETAIL:"wdj://apps/apk_detail.json",APP_DOWNLOAD_DATA:"wdj://apps_data/download.json",APP_HAS_BACKUP:"wdj://apps/has_backup.json",APP_LOAD_BACKUP:"wdj://apps/load_backup.json",APP_SHOW_WEB_APPS:"wdj://apps/my_apps.json",APP_SYNC_WEB_APPS:"wdj://apps/refresh_my_apps.json",APP_HIDE_WEB_APPS:"wdj://apps/hide_my_app.json",APP_SHOW_SUGGESTION_INSTALLATION:"wdj://apps/show_new_device_apps.json",APP_GET_MD5:"wdj://apps/get_md5.json",APP_EXPORT_APP_DATA:"wdj://apps/export_app_data.json",APP_IGNORE_WASH:"wdj://apps/ignore_wash.json",APP_GET_APP_DATA_COUNT:"wdj://apps/app_data_count.json",APP_GET_APP_DETAIL:"wdj://apps/apk_detail.json",SMS_GET_CONVERSATION:"wdj://sms/conversations.json",SMS_GET_THREADS:"wdj://sms/threads.json",SMS_MARK_AS_READ:"wdj://sms/mark_read.json",SMS_MARK_AS_UNREAD:"wdj://sms/mark_unread.json",SMS_DELETE:"wdj://sms/remove.json",SMS_SEND:"wdj://sms/send.json",SMS_BATCH_SEND:"wdj://sms/batch_send.json",SMS_DELETE_CONVERSATION:"wdj://sms/remove_conversation.json",SMS_SYNC:"wdj://sms/sync.json",SMS_RESEND:"wdj://sms/resend.json",SMS_CONVERSATION_MARK_AS_READ:"wdj://sms/mark_conversation_read.json",SMS_GET_SERVICE_CENTER:"wdj://sms/services.json",SMS_IMPORT:"wdj://sms/import.json",SMS_EXPORT:"wdj://sms/export.json",SMS_BATCH_RESEND:"wdj://sms/batch_resend.json",SMS_OPEN_ON_DEVICE:"wdj://sms/show_in_device.json",SMS_CANCEL:"wdj://sms/cancel.json",SMS_SELECT_SMS_FILE:"wdj://window/select_sms_file.json",SMS_HAS_BACKUP:"wdj://sms/has_backup.json",SMS_LOAD_BACKUP:"wdj://sms/load_backup.json",SMS_COPY:"wdj://window/copy_clipboard.json",TASK_SHOW_PROGRESS:"wdj://jobs/show.json",TASK_DELETE_TASK:"wdj://jobs/clear.json",TASK_PAUSE_TASK:"wdj://jobs/pause.json",TASK_RESUME_TASK:"wdj://jobs/resume.json",TASK_STOP_TASK:"wdj://jobs/stop.json",TASK_START_TASK:"wdj://jobs/start.json",TASK_REMOVE_FINISHI:"wdj://jobs/clean_finished.json",TASK_OPEN_DOWNLOAD_DIRECTORY:"wdj://window/apps_folder.json",TASK_START_ALL:"wdj://jobs/start_all.json",TASK_FORCE_RESTART:"wdj://jobs/force_restart.json",TASK_OPEN_FOLDER:"wdj://window/apps_folder.json",TASK_CACHE_SIZE:"wdj://jobs/cache_size.json",MUSID_SHOW:"wdj://music/show.json",MUSIC_DOWNLOAD:"wdj://music/download.json",MUSIC_IMPORT:"wdj://music/import.json",MUSIC_EXPORT:"wdj://music/export.json",MUSIC_SELECT:"wdj://window/select_music.json",MUSIC_SYNC:"wdj://music/sync.json",MUSIC_DELETE:"wdj://music/delete.json",MUSIC_RESET_RINGTONE:"wdj://music/reset_ringtone.json",MUSIC_SET_RINGTONE:"wdj://music/set_ringtone.json",MUSIC_GET_RINGTONE:"wdj://music/get_ringtone.json",MUSIC_LOAD:"wdj://music/load.json",MUSIC_CANCEL:"wdj://music/cancel.json",MUSIC_PLAY:"wdj://music/play.json",MUSIC_STOP:"wdj://music/stop.json",PHOTO_DOWNLOAD:"wdj://photo/download.json",PHOTO_SET_WALLPAPER:"wdj://photo/wallpaper.json",PHOTO_IGNORE_FOLDER:"wdj://photo/ignore_folder.json",PHOTO_UNIGNORE_FOLDER:"wdj://photo/unignore_folder.json",PHOTO_GET:"wdj://photo/get.json",PHOTO_DELETE:"wdj://photo/delete.json",PHOTO_THUMBNAIL:"wdj://photo/thumbnail.json",PHOTO_THUMBNAILS:"wdj://photo/thumbnails.json",PHOTO_ROTATE:"wdj://photo/rotate.json",PHOTO_SELECT_PHOTO:"wdj://window/select_photo.json",PHOTO_CANCEL:"wdj://photo/cancel.json",PHOTO_IMPORT:"wdj://photo/import.json",PHOTO_EXPORT:"wdj://photo/export.json",PHOTO_SHOW:"wdj://photo/show.json",PHOTO_SYNC:"wdj://photo/sync.json",PHOTO_CLOUD_THUMBNAIL:"wdj://photo/cloud_thumbnail.json",PHOTO_CLOUD_THUMBNAILS:"wdj://photo/cloud_thumbnails.json",PHOTO_CLOUD_GET:"wdj://photo/cloud_get.json",VIDEO_DOWNLOAD:"wdj://video/download.json",VIDEO_CANCEL:"wdj://video/cancel.json",VIDEO_THUMBNAIL:"wdj://video/thumbnail.json",VIDEO_SHOW:"wdj://video/show.json",VIDEO_SYNC:"wdj://video/sync.json",VIDEO_DELETE:"wdj://video/delete.json",VIDEO_EXPORT:"wdj://video/export.json",VIDEO_LOAD:"wdj://video/load.json",VIDEO_IMPORT:"wdj://video/import.json",VIDEO_PLAY:"wdj://video/play.json",VIDEO_SELECT_VIDEO:"wdj://window/select_video.json",BOOK_DOWNLOAD:"wdj://book/download.json",MARKET_SEARCH_APP:"wdj://market/search_app.json",MARKET_LIST:"wdj://market/list.json",ACCOUNT_LOGIN:"wdj://account/login.json",ACCOUNT_LOGOUT:"wdj://account/logout.json",ACCOUNT_BIND:"wdj://account/bind.json",ACCOUNT_REGIST:"wdj://account/register.json",ACCOUNT_INFO:"wdj://account/account_info.json",ACCOUNT_SHARE:"wdj://account/share.json",BACKUP_PREPARE:"wdj://backup/prepare.json",BACKUP_CHECK_FILE:"wdj://backup/check_file.json",BACKUP_GET_SETTING:"wdj://backup/get_setting.json",BACKUP_SET_SETTING:"wdj://backup/set_setting.json",BACKUP_START:"wdj://backup/start.json",BACKUP_CANCEL:"wdj://backup/cancel.json",BACKUP_FINISH:"wdj://backup/finish.json",RESTORE_BACKUP_FILE:"wdj://restore/backup_file.json",RESTORE_READ_FILE:"wdj://restore/read_file.json",RESTORE_FILE_SELECT:"wdj://restore/file_select.json",RESTORE_CLEAR:"wdj://restore/clear.json",RESTORE_RESUME:"wdj://restore/resume.json",RESTORE_CANCEL:"wdj://restore/cancel.json",RESTORE_FINISH:"wdj://restore/finish.json",RESTORE_RETRY:"wdj://restore/retry.json",RESTORE_START:"wdj://restore/start.json",RESTORE_APPS:"wdj://restore/restore_apps.json",ITUNES_IMPORT_CHECK:"wdj://itunes/check.json",ITUNES_IMPORT_BEGIN:"wdj://itunes/begin.json",ITUNES_IMPORT_FINISH:"wdj://itunes/finish.json",ITUNES_IMPORT_PARSE:"wdj://itunes/parser.json",ITUNES_IMPORT_QUERY:"wdj://itunes/query.json",ITUNES_IMPORT_AUDIO:"wdj://itunes/import_audio.json",ITUNES_CREATE_PLAYLIST:"wdj://itunes/create_playlist.json",PLUGIN_LIST:"wdj://sidebar/list.json",PLUGIN_LOAD:"wdj://sidebar/load_extension.json",PLUGIN_PREVIEW:"wdj://sidebar/preview.json",PLUGIN_REMOVE:"wdj://sidebar/delete_item.json",PLUGIN_ADD:"wdj://sidebar/add_item.json",PLUGIN_UPDATE:"wdj://sidebar/update.json",PLUGIN_LOAD_LOCAL:"wdj://sidebar/load_local_extension.json",FLASH_ROM_FLASHABLE:"wdj://flash/is_flashable.json",IS_PHOTO_SYNC_ON:"wdj://sync/is_sync_on.json",SET_PHOTO_SYNC:"wdj://sync/set_sync_switch.json",UPLOAD_PHOTO:"wdj://sync/start_sync.json",GET_LATEST_AUTO_BACKUP:"wdj://sync/latest_bacukup_file.json",OPEN_AUTO_BACKUP_FILE:"wdj://window/open_auto_backup_folder.json",OPEN_PHOTO_AUTO_BACKUP_FILE:"wdj://window/open_photo_backup_folder.json",OPEN_PHOTO_AUTO_BACKUP_FILE_HELPER:"wdj://helper/open_photo_backup_folder.json",IS_USER_FLASHED:"wdj://sync/is_flashed.json",GET_SYSTEM_SETTING:"wdj://window/get_system_setting.json",OPEN_NOTIFY_SETTING:"wdj://window/save_desktop_notification.json",OPEN_SYNC_AND_START:"wdj://window/open_sync_and_start.json",OPEN_SYNC_AND_START_HELPER:"wdj://helper/open_sync_and_start.json",OPEN_SYNC_DISABLE_NOTFIY:"wdj://helper/disable_download_photo_notify.json",CLOSE_ALL_NOTIFICATION_HELPER:"wdj://helper/close_all_notification.json",OPEN_NOTIFY_SETTING_HELPER:"wdj://helper/open_notify_setting.json",OPTIMIZE_SCAN:"wdj://optimize/scan_all.json",OPTIMIZE_CHECK:"wdj://optimize/check.json",OPTIMIZE_INSTALL:"wdj://optimize/install.json",OPTIMIZE_RAM:"wdj://optimize/optimize_tasks.json",OPTIMIZE_CACHE:"wdj://optimize/optimize_cache.json",OPTIMIZE_CANCEL:"wdj://optimize/cancel.json",SYNC_MANUAL_BACKUP:"wdj://sync/manual_sync.json",SYNC_SNAPSHOT_LIST:"wdj://sync/snapshot_list.json",SYNC_SNAPSHOT_INFO:"wdj://sync/snapshot_info.json",SYNC_SNAPSHOT_FILE:"wdj://sync/snapshot_file.json",SYNC_SET_SWITCH:"wdj://window/sync_set_cloud_switch.json",SYNC_IS_SWITCH_ON:"wdj://window/sync_is_cloud_switch_on.json",SYNC_STOP_REMOTE_SYNC:"wdj://sync/stop_sync.json",APP_QUERY_INFO:"http://apps.wandoujia.com/api/v1/apps",APP_WASH_FEEDBACK:"http://apps.wandoujia.com/api/v1/xibaibai/feedback",APP_WASH_GET_TEXT:"http://apps.wandoujia.com/api/v1/xibaibai/feedback",APP_WASH_SCAN:"http://apps.wandoujia.com/api/v1/xibaibai/scanner"},events:{DEVICE_STATE_CHANGE:"device.state_changed",DEVICE_OFFLINE_CHANGE:"device.offline_changed",DEVICE_USB_DETECT:"usb.detect",DEVICE_ID_CHANGE:"device.change_to",WEB_NAVIGATE:"web.navigate",WEB_FORCE_NAVIGATE:"web.force.navigate",SETTING_PRIVACY:"setting.privacy",THEME_CHANGED:"themes.folder_changed",SETTING_APP_CHANGE:"app.setting.changed",TASK_START:"jobs.start",TASK_ADD:"jobs.add",TASK_STOP:"jobs.stop",TASK_OPEN_MONITOR:"jobs.autoopen",TASK_CHANGE:"jobs.changed",TASK_NEED_CONFIRM:"jobs.need_force",TASK_DUPLICATED:"jobs.duplicated",TASK_STATUS_CHANGE:"jobs.status_changed",CONTACT_UPDATED:"contacts.updated",CONTACT_SYNCED:"contacts.synced",APP_LIST_UPDATED:"apps.updated",APP_INSTALL_STARTED:"apps.install.started",APP_INSTALL_FAILED:"apps.install.failed",APP_INSTALL_SUCCESS:"apps.install.success",APP_INSTALLED:"apps.install.success",APP_INSTALL_1_X:"web.download",APP_INSTALL_LOCAL:"web.install",WEB_APP_LIST_UPDATED:"apps.my_apps.updated",SMS_CALLLOG_SMS_RECEIVE:"sms.received",SMS_CALLLOG_SMS_UPDATED:"sms.updated",MUSIC_DOWNLOAD_SUCCESS:"music_download",MUSIC_UPDATED:"music.updated",PHOTO_DOWNLOAD_SUCCESS:"photo_download",PHOTO_UPDATED:"photo.updated",PHOTO_SHOW_IMPORTOR:"photo.show.importor",ACCOUNT_STATE_CHANGE:"account.state_changed",VIDEO_UPDATED:"video.updated",VIDEO_DOWNLOAD_SUCCESS:"video.download",MESSAGE_CLOSE_MESSAGE_NOTIFICATION:"close_message_notification",MESSAGE_MARK_AS_READ:"mark_as_read",HISTORY_CHANGED:"history.changed",FLASH_ERROR:"flash.error",AUDIOS_IMPORT_MESSAGE:"iTunes_audios_import",PLAYLIST_IMPORT_MESSAGE:"iTunes_playlist_import",SIDEBAR_UPDATED:"sidebar.list",SIDEBAR_PREVIEW:"sidebar.preview",SIDEBAR_STAR:"sidebar.star",SIDEBAR_ITEM_UPDATED:"sidebar.updated",BACKUP_FINISH:"backup.finish.success",SYNC_PHOTO_COMPLETE:"sync.complete",SYNC_CLOUD_SETTING_CHANGE:"sync.cloud_setting_changed",SYNC_PHOTO_NOTIFY_UPDATE:"sync.photo.num",AUTO_BACKUP_START:"autobackup.progress.start",AUTO_BACKUP_CHANGE:"autobackup.progress.changing",AUTO_BACKUP_COMPLETE:"autobackup.progress.completed",DOWNLOAD_PHOTO_COMPLETE:"sync.photo.updated",CUSTOM_WELCOME_BILLBOARD_NAVIGATE:"billborad.navigate",CUSTOM_GALLERY_STAR:"gallery.star",CUSTOM_GALLERY_UNSTAR:"gallery.unstar",CUSTOM_IFRAME_ALERT:"iframe.alert",CUSTOM_IFRAME_CONFIRM:"iframe.confirm",CUSTOM_IFRAME_DISPOSABLE:"iframe.disposable",CUSTOM_IFRAME_PHOTO_SHARE:"iframe.photo.share",CUSTOM_IFRAME_PHOTO_DELETE:"iframe.photo.delete",CUSTOM_IFRAME_PHOTO_DELETED:"iframe.photo.deleted",CUSTOM_IFRAME_PHOTO_EXPORT:"iframe.photo.export",CUSTOM_IFRAME_PHOTO_SYNC_ALERT:"iframe.photo.sync.alert",CUSTOM_IFRAME_PHOTO_RENDERED:"iframe.photo.rendered",CUSTOM_IFRAME_PHOTO_SELECT_TAB:"iframe.photo.select.tab"},enums:{LOCALE_DEFAULT:0,LOCALE_ZH_CN:1,LOCALE_EN_US:2,VIRTUAL_DEVICE:0,OFFLINE_DEVICE:1,USB_DEVICE:2,WIFI_DEVICE:3,INTERNET_DEVICE:4,ADB_DEVICE:6,NAVIGATE_TYPE_MARKET:"market",NAVIGATE_TYPE_APP:"app",NAVIGATE_TYPE_CONTACT:"contact",NAVIGATE_TYPE_CONTACT_CREATE:"contact_create",NAVIGATE_TYPE_SMS:"sms",NAVIGATE_TYPE_SEND_SMS:"send_sms",NAVIGATE_TYPE_PAGE:"page",NAVIGATE_TYPE_WEBAPP:"web_app",NAVIGATE_TYPE_PHOTO_CLOUD:"photo_cloud",NAVIGATE_TYPE_BACKUP_CLOUD:"backup_cloud",NAVIGATE_TYPE_ILLEGAL_LOGOUT:"illegal_logout",NAVIGATE_TYPE_GALLERY:"gallery",NAVIGATE_TYPE_IMPORT_MUSIC:"import_music",NAVIGATE_TYPE_IMPORT_IMAGE:"import_image",NAVIGATE_TYPE_IMPORT_VIDEO:"import_video",NAVIGATE_TYPE_THEME:"themes",NAVIGATE_TYPE_APP_WASH:"wash",NAVIGATE_TYPE_TASK_MANAGER:"tast_manager",UPDATE_IGNORE_NONE:"none",UPDATE_IGNORE_THIS_VERSION:"version",UPDATE_IGNORE_FOREVER:"forever",INSTALL_LOCATION_EXTENTION:2,INSTALL_LOCATION_DEVICE:1,CONTACT_DEFAULT_ICON:"images/contact-default-small.png",CONTACT_DEFAULT_BATCH_ICON:"images/contact-default-batch.png",CONTACT_DEFAULT_ICON_LARGE:"images/contact-default-large.png",CONTACT_DESCRIPTION_ITEM_TYPE_PHONE_NUMBER:0,ITUNES_IMPORT_ALL:0,ITUNES_IMPORT_PLAYLIST:1,ITUNES_IMPORT_AUDIOS:2,SMS_CONVERSATION_TYPE_ALL:0,SMS_CONVERSATION_TYPE_UNREAD:1,SMS_CONVERSATION_TYPE_SPECIFY_ID:2,SMS_CONVERSATION_TYPE_SPECIFY_SMS_ID:3,SMS_CONVERSATION_SORTBY_DATE_DESC:0,SMS_CONVERSATION_SORTBY_DATE_ASC:1,SMS_CONVERSATION_SORTBY_NAME_DESC:2,SMS_CONVERSATION_SORTBY_NAME_ASC:3,SMS_CONVERSATION_SORTBY_UNREAD_AMOUNT_DESC:4,SMS_CONVERSATION_SORTBY_UNREAD_AMOUNT_ASC:5,SMS_CONVERSATION_SORTBY_TOTAL_AMOUNT_DESC:6,SMS_CONVERSATION_SORTBY_TOTAL_AMOUNT_ASC:7,SMS_THREADS_TYPE_SPECIFY_ID:0,SMS_THREADS_TYPE_SPECIFY_CONTACT:1,SMS_THREADS_TYPE_SPECIFY_NUMBER:2,SMS_THREADS_TYPE_ALL:3,SMS_TYPE_RECEIVE:1,SMS_TYPE_SENT:2,SMS_TYPE_SENDING:4,SMS_TYPE_SENT_FAILD:5,SMS_TYPE_QUEUE:6,TASK_TYPE_PUSH:4,TASK_TYPE_LOCAL_INSTALL:3,TASK_TYPE_DOWNLOAD:2,TASK_TYPE_INSTALL:1,TASK_TYPE_PARSING_VIDEO_URL:5,TASK_TYPE_MERGE_VIDEO:6,TASK_TYPE_UNZIP:7,TASK_TYPE_RESTORE_APP_DATA:8,TASK_STATE_ADDED:0,TASK_STATE_WAITING:1,TASK_STATE_PAUSE:2,TASK_STATE_PROCESSING:3,TASK_STATE_SUCCESS:4,TASK_STATE_FAILD:5,TASK_STATE_STOPPED:6,TASK_DEFAULT_ICON_PATH_APP:"images/icon_default_app_36X36.png",TASK_DEFAULT_ICON_PATH_MUSIC:"images/icon_default_music_36X36.png",TASK_DEFAULT_ICON_PATH_PHOTO:"images/icon_default_pic_36X36.png",TASK_DEFAULT_ICON_PATH_VIDEO:"images/icon_default_video_36X36.png",TASK_DEFAULT_ICON_PATH_BOOK:"images/icon_default_ebook_36X36.png",TASK_DEFAULT_ICON_PATH_FILE:"images/icon_default_file_36X36.png",IMAGE_SPACER:"images/spacer-20X20.png",MODEL_TYPE_APPLICATION:"app",MODEL_TYPE_APPLICATION_DATA:"app_data",MODEL_TYPE_MUSIC:"music",MODEL_TYPE_VIDEO:"video",MODEL_TYPE_PHOTO:"photo",MODEL_TYPE_BOOK:"ebook",SCREEN_SHOT_DESTINATION_FILE:0,SCREEN_SHOT_DESTINATION_CLIPBOARD:1,SINA_SHARE_PIC_LIMIT_SIZE:5,PHOTO_ALL_TYPE:0,PHOTO_PHONE_TYPE:1,PHOTO_LIBRARY_TYPE:2,PHOTO_CLOUD_TYPE:3,URL_TAPAS_HELP:"http://bbs.dianxinos.com/",URL_MULTI_SIM_HELP:"http://help.wandoujia.com/entries/21550442",URL_EXTENSION_PUBLISH:"http://www.wandoujia.com/webstore/dev",URL_WELCOME_BILLBOARD:"http://www.wandoujia.com/webstore/billboard",URL_WELCOME_BILLBOARD_EN:"https://s3.amazonaws.com/snappea_welcome/startpage.html",URL_WANDOUJIA_APP_DETAIL_PAGE:"http://apps.wandoujia.com/apps/{1}?{2}",FACEBOOK_LOGOUT_URI:"https://www.facebook.com/logout.php",FACEBOOK_REDIRECT_URI:"http://www.snappea.com/facebook/proxy.html",FACEBOOK_OAUTH_API:"https://graph.facebook.com/oauth/authorize?client_id=265004820250785&scope=publish_stream&display=popup&response_type=token&redirect_uri=",GALLERY_URL:"http://www.wandoujia.com/webstore/sidebar/gallery",PHOTO_SYNC_TEXT_LINK:"www.wandoujia.com/photos",PHOTO_SYNC_LINK:"https://account.wandoujia.com/?auth={1}&callback=http%3A%2F%2Fwww.wandoujia.com%2Fphotos%3Fsource%3Dwindows",REPORT_URL:"http://www.wandoujia.com/webstore/sidebar/report",IFRAME_PREFIX:"wdj-extension-frame-",TEMP_EXTENTION_ID:"wdj-extention-temp",EXTENTION_ERROR_PAGE_URL:"javascripts/modules/browser/extention-error.html",SYNC_DATA_TYPE_CONTACTS:30101,SYNC_DATA_TYPE_SMS:30201,SYNC_DATA_TYPE_PHOTO:40101,SYNC_DATA_TYPE_APP:50101,SYNC_PROGRESS_START:1,SYNC_PROGRESS_SUCCESS:2,SYNC_PROGRESS_FAILED:3,SYNC_PROGRESS_COMPLETED:4,FLASH_DOWNLOAD_URL:"http://dl.wandoujia.com/files/flash/latest/flashplayer",SOCIAL_APP_BIO_URL:"http://app-bio.wandoujia.com/apps/{1}",SOCIAL_TEXT_PREVIEW_POST_URL:"http://social-services.wandoujia.com/preview/text?content_type={1}",SOCIAL_TEXT_PREVIEW_URL:"http://social-services.wandoujia.com/preview/text?content_type={1}&content={2}",SOCIAL_IMAGE_PREVIEW_URL:"http://social-services.wandoujia.com/preview/image?content_type={1}&content={2}",SOCIAL_SCREENSHOT:"screenshot",SOCIAL_PHOTO:"photo",SOCIAL_APP:"app",SOCIAL_DORAEMON_EXTENSION:"doraemon_extension",SOCIAL_WELCOME:"welcome",SOCIAL_ONE_KEY_UPDATE:"one_key_update",SOCIAL_DORAEMON_CONTENT:"doraemon_content",SOCIAL_WANDOUJIA_THEME:"wandoujia_theme",SOCIAL_SET_WALLPAPER:"set_wallpaper",SOCIAL_SET_RINGTONE:"set_ringtone",SOCIAL_SET_MUSIC_AS_RINGTONE:"set_music_as_ringtone",SOCIAL_UNINSTALL_APP:"uninstall_app",SOCIAL_WASH:"wandoujia_wash",SOCIAL_SHARE_FAILED:"10",SOCIAL_SHARE_COOKIE_EXPIRED:"101",BR_TYPE_CONTACT:1,BR_TYPE_CONTACT_GROUP:2,BR_TYPE_SMS:3,BR_TYPE_MMS:4,BR_TYPE_CALLLOG:5,BR_TYPE_BOOKMARK:6,BR_TYPE_SETTING:7,BR_TYPE_APP:8,BR_TYPE_WDAPK:9,BR_TYPE_APP_DATA:10,BACKUP_APP_DATA_MESSAGE_NEED_USER:"NEED_USER_BACKUP",BACKUP_APP_DATA_MESSAGE_START:"BACKUP_START",BACKUP_APP_DATA_MESSAGE_SPLIT:"SPLIT_BACKUP_FILE",BACKUP_APP_DATA_MESSAGE_NEED_USER_RESTORE:"NEED_USER_RESTORE",SETTING_AUTO_BACKUP_COMPLETE:"auto_backup_complete",DOWNLOAD_PHOTO_COMPLETE:"download_photo_complete",APP_WASH_AUTH_KEY:"gpo3uybFexlfH0NJWaZPjFtLFkEPkCHl",SINFGLE_MESSAGE_CHAR_NUMBER:140}},n=function(e){return Object.keys(e).forEach(function(t){typeof e[t]=="object"&&n(e[t])}),Object.freeze(e),e};return n(t),Object.defineProperty(e,"CONFIG",{value:t,writable:!1,enumerable:!0,configurable:!1}),t})}(this),function(e,t){define("BackendSocket",[],function(){console.log("BackendSocket - File loaded.");var t=e.setTimeout,n=e.clearTimeout,r=0,i=1,s=2,o=3,u=/^wdjs\:\/\//i,a=function(e){return t(e,0)},f=n,l=function(t){var n=this,f=r,l,c,h,p;if(!u.test(t))throw new Error('URL should be started with "wdjs://"');Object.defineProperty(this,"readyState",{get:function(){return f}}),Object.defineProperty(this,"extensions",{value:""}),Object.defineProperty(this,"protocol",{value:""}),Object.defineProperty(this,"onopen",{get:function(){return l},set:function(e){return l=e,n}}),Object.defineProperty(this,"onerror",{get:function(){return c},set:function(e){return c=e,n}}),Object.defineProperty(this,"onclose",{get:function(){return h},set:function(e){return h=e,n}}),Object.defineProperty(this,"onmessage",{get:function(){return p},set:function(e){return p=e,n}}),this.close=function(){if(f===s||f===o)return;f=s,a(function(){f=o,typeof h=="function"&&h()})},this.send=function(){throw new Error("send is disabled and not implemented in BackendSocket")};var d=!1;a(function(){if(f!==r)return;e.OneRingStreaming("*",function(e,t,n){if(typeof p=="function"&&!!t&&!!n){var r={deviceId:e,channel:t,data:n};p({data:r}),d&&console.log(r)}}),f=i,typeof l=="function"&&l()}),e.blackSheepWall=function(){d=!0}};return l})}(this),function(e,t){define("utilities/FilterFunction",[],function(){console.log("FilterFunction - File loaded.");var e={},t="data",n=function(e){return JSON.stringify(e)},r=function(e){var t=e.split("."),r=t.map(n);return"["+r.join("][")+"]"},i=e.operators={};return i[""]=i.eq=function(e,t){var i,s=arguments.callee;if(e.constructor===String||e.constructor===Number||e.constructor===Boolean)i=t+"==="+n(e);else if(e instanceof Array){i=t+".length==="+e.length;var o,u;for(o=0,u=e.length;o<u;o++)i+="&&"+s(e[o],t+"["+o+"]")}else i="Object.keys("+t+").length==="+Object.keys(e).length,Object.keys(e).forEach(function(n){i+="&&"+s(e[n],t+r(n))});return i},i.ne=function(e,t){var n=i.eq(e,t);return"!("+n+")"},i.lt=function(e,t){return t+"<"+n(e)},i.lte=function(e,t){return t+"<="+n(e)},i.gt=function(e,t){return t+">"+n(e)},i.gte=function(e,t){return t+">="+n(e)},e.generate=function(e){var n="return true";return Object.keys(e).forEach(function(s){var o=e[s];if(o.constructor===String||o.constructor===Number||o.constructor===Boolean)""in i&&(n+="&&"+i[""](o,t+r(s)));else{var u=!1;Object.keys(o).forEach(function(e){if(e.indexOf("$")===0){u=!0;var a=e.substr(1);a in i&&(n+="&&"+i[a](o[e],t+r(s)))}}),u||(n+="&&"+i[""](o,t+r(s)))}}),n+=";",new Function(t,n)},e})}(this),function(e,t){define("WorkerPoll",["underscore","backbone"],function(t,n){console.log("WorkerPoll - File loaded.");var r=e.setInterval,i=e.clearInterval,s=function(e){var t,n=this.runningTasks.length;for(t=0;t<n;t++)if(this.runningTasks[t]<e)return!0;return!1},o=function(t){this.waitingResponse.sort(function(e,t){return e.timestamp>t.timestamp});var n,r=this.waitingResponse.length,i;for(n=0;n<r;n++){i=this.waitingResponse[n];if(!!s.call(this,i.timestamp))break;i.callback.call(i.context||e,i.evt)}this.waitingResponse.splice(0,n+1)},u=function(t,n){this.size=n||this.size,this.url=t;var s=r(function(){this.workerQueue.length<10?this.workerQueue.push(new e.Worker(this.url)):i(s)}.bind(this),50)};return u.prototype=t.extend({size:3,taskQueue:[],workerQueue:[],runningTasks:[],waitingResponse:[],addTask:function(e,t,n){var r=(new Date).getTime();this.workerQueue.length>0?this.runTask(e,t,n,r):this.taskQueue.push({message:e,callback:t,context:n,timestamp:r})},runTask:function(t,n,r,i){var u=this.workerQueue.shift(),a=function(t){s.call(this,i)?this.waitingResponse.push({evt:t,callback:n,context:r,timestamp:i}):(n.call(r||e,t),o.call(this,i)),this.runningTasks.splice(this.runningTasks.indexOf(i),1),u.removeEventListener("message",a),this.workerQueue.push(u);if(this.taskQueue.length>0){var f=this.taskQueue.shift();this.runTask(f.message,f.callback,f.context,f.timestamp)}}.bind(this);this.runningTasks.push(i),u.addEventListener("message",a),u.postMessage(t)}},n.Events),u})}(this),function(e,t){define("ParserFactory",["underscore","WorkerPoll"],function(e,t){console.log("ParserFactory - File loaded.");var n=10,r=require.s.contexts._.config.baseUrl+"/workers/jsonparser.js"})}(this),function(e){define("MessageRouterMixin",["underscore","utilities/FilterFunction","ParserFactory"],function(t,n,r){console.log("MessageRouterMixin - File loaded.");var i=1,s=function(t,r,s){return i++,this.callbackList.push({id:i,route:t,filter:n.generate(t),callback:r,context:s||e}),i},o=function(e){var t=this.callbackList,r=n.generate({id:e}),i,s=t.length;for(i=0;i<s;i++)if(r(t[i])){var o=t.splice(i,1);delete o.id,delete o.router,delete o.callback,delete o.context;break}},u=function(e){t.each(this.callbackList,function(t){t.filter(e)&&t.callback.call(t.context,JSON.parse(e.data.data))})};return{mixin:function(e){e.onmessage=s.bind(e),e.offmessage=o.bind(e),e.on("message",u,e),e.callbackList=[]}}})}(this),function(e,t){define("IO",["jquery","underscore","backbone","Configuration","BackendSocket","MessageRouterMixin","ParserFactory"],function(t,n,r,i,s,o,u){console.log("IO - File loaded.");var a=n.extend(function(){},r.Events);o.mixin(a),a.Backend=n.extend(function(){},r.Events),o.mixin(a.Backend),a.Backend.socket=new s("wdjs://window/events"),a.Backend.socket.onmessage=function(e){a.Backend.trigger("message",e)},a.Backend.requestAsync=function(n,r){var i=t.Deferred();typeof n!="string"&&(r=n,n=r.url);var s=n;r=r||{},r.type=r.type||"get",r.data=r.data||{};var o=function(t){t=JSON.parse(t),t.state_line=t.state_code,console.log("IO - Callback message for '"+s+"'",t),typeof r.success=="function"&&r.success.call(e,t),i.resolve(t)};switch(r.type.toLowerCase()){case"get":var u=[],a;for(a in r.data)r.data.hasOwnProperty(a)&&u.push(a+"="+e.encodeURIComponent(r.data[a]));u.length>0&&(n=n+"?"+u.join("&")),e.OneRingRequest(r.type,n,null,o);break;case"post":e.OneRingRequest(r.type,n,e.encodeURIComponent(JSON.stringify(r.data)),o)}return console.log("IO - AJAX call: "+s,r),i.promise()},a.sendCustomEventsAsync=function(e,n){var r=t.Deferred();return a.requestAsync({url:i.actions.PUBLISH_EVENT,data:{channel:e,value:JSON.stringify(n||{})},success:function(e){e.state_code===200?r.resolve(e):r.reject(e)}}),r.promise()},a.Cloud=n.extend(function(){},r.Events),o.mixin(a.Cloud),a.Cloud.requestAsync=t.ajax,a.requestAsync=function(e){var t=typeof e=="string"?e:e.url;return/^wdj:/.test(t)?a.Backend.requestAsync.apply(a.Backend,arguments):a.Cloud.requestAsync.apply(a.Cloud,arguments)},a.Backend.on("message",function(e){a.trigger("message",n.extend(e,{source:"backend"}))}),a.Cloud.on("message",function(e){a.trigger("message",n.extend(e,{source:"cloud"}))});if(r&&r.sync){var f={create:"POST",update:"PUT",patch:"PATCH","delete":"DELETE",read:"GET"};r.sync=function(e,t,n){var r=t.url,i={url:t.url,type:f[e],contentType:"application/json",data:t.data||{},dataType:"json",processData:!1,success:n.success,error:n.error};a.requestAsync(r,i)}}return a})}(this),function(e,t){define("Environment",["backbone","jquery","utilities/QueryString","IO","Configuration"],function(t,n,r,i,s){var o=t.Model.extend({defaults:{deviceId:r.get("device_id")||"Default",pcId:r.get("pcid")||"00",backendVersion:r.get("version")||"2.0",locale:parseInt(r.get("config"),10)||s.enums.LOCALE_DEFAULT,source:r.get("source")||"",search:e.location.search,internetBar:Boolean(parseInt(r.get("internet_bar"),10))},initialize:function(){this.get("deviceId")==="Default"&&i.requestAsync(s.actions.DEVICE_GET_UDID).done(function(e){this.set({deviceId:e.body.value,search:this.get("search").replace("device_id=Default","device_id="+e.body.value)});if(e.body.value==="Default")var t=i.Backend.onmessage({"data.channel":s.events.DEVICE_ID_CHANGE},function(e){i.Backend.offmessage(t),this.set({deviceId:e.value,search:this.get("search").replace("device_id=Default","device_id="+e.value)})},this)}.bind(this))}}),u=new o;switch(u.get("locale")){case s.enums.LOCALE_DEFAULT:n("body").addClass("locale-defualt");break;case s.enums.LOCALE_ZH_CN:n("body").addClass("locale-zh-cn");break;case s.enums.LOCALE_EN_US:n("body").addClass("locale-en-us")}return e.Environment=u,u})}(this),function(e,t){define("utilities/ShortenQuantity",["Environment","Configuration"],function(e,t){var n=function(n){var r=n.toString(),i="";return e.get("locale")===t.enums.LOCALE_DEFAULT||e.get("locale")===t.enums.LOCALE_ZH_CN?r.length>5?(i+=r.slice(0,r.length-4),i+=" 万"):i+=r.toString()+" ":r.length>6?(i+=r.slice(0,r.length-5),i+="m"):i+=r.toString()+" ",i};return n})}(this),function(e,t){define("utilities/ValidateEmail",[],function(){var e=/^[A-Za-z0-9](([_\.\-]?[a-zA-Z0-9]+)*)@([A-Za-z0-9]+)(([\.\-]?[a-zA-Z0-9]+)*)\.([A-Za-z]{2,})$/,t=function(t){return e.test(t)};return t})}(this),function(e,t){define("utilities/FormatDuration",[],function(){var e=function(e){var t=6e4,n=parseInt(e/t,10),r=(e%t/1e3).toString();return r<10&&(r="0"+r),n+":"+r.substring(0,2)};return e})}(this),function(){define("utilities/CompressHTML",[],function(){var e=function(e){return e.replace(/\n/gi,"").replace(/>\s+</gi,"><").replace(/>\s+\{\{/gi,">{{").replace(/\}\}\s+</gi,"}}<").replace(/\}\}\s+\{\{/gi,"}}{{")};return e})}(this),function(e){define("utilities/SmartDate",["utilities/FormatDate","Environment","Configuration"],function(e,t,n){var r=function(r){var i=parseInt(r,10),s=new Date(i),o=new Date,u=new Date(o.getDate())-new Date(s.getDate()),a="";if(s.getFullYear()===o.getFullYear()&&s.getMonth()===o.getMonth())switch(u){case 0:t.get("locale")===n.enums.LOCALE_EN_US?a=e("Today MM / dd",i):a=e("今天 MM 月 dd 日",i);break;case 1:t.get("locale")===n.enums.LOCALE_EN_US?a=e("Yesterday MM / dd",i):a=e("昨天 MM 月 dd 日",i);break;case 2:t.get("locale")===n.enums.LOCALE_EN_US?a=e("MM / dd",i):a=e("前天 MM 月 dd 日",i);break;default:t.get("locale")===n.enums.LOCALE_EN_US?a=e("MM / dd",i):a=e("MM 月 dd 日",i)}else{var f=o.getFullYear()-s.getFullYear();f!==0?t.get("locale")===n.enums.LOCALE_EN_US?a=e("MM / dd / yyyy",i):a=e("yyyy 年 MM 月 dd 日",i):t.get("locale")===n.enums.LOCALE_EN_US?a=e("MM / dd",i):a=e("yyyy 年 MM 月 dd 日",i)}return a};return r})}(this),function(e,t){define("utilities/StringUtil",["utilities/MD5","utilities/ValidateURL","utilities/FormatString","utilities/ReadableSize","utilities/ConditionalEscape","utilities/FormatDate","utilities/ShortenQuantity","utilities/ValidateEmail","utilities/FormatDuration","utilities/CompressHTML","utilities/SmartDate"],function(t,n,r,i,s,o,u,a,f,l,c){var h={MD5:t,isURL:n,format:r,readableSize:i,conditionalEscape:s,formatDate:o,shortenQuantity:u,isEmail:a,formatDuration:f,compressHTML:l,smartDate:c};return e.StringUtil=h,h})}(this),define("text",["module"],function(e){var t,n,r,i,s=["Msxml2.XMLHTTP","Microsoft.XMLHTTP","Msxml2.XMLHTTP.4.0"],o=/^\s*<\?xml(\s)+version=[\'\"](\d)*.(\d)*[\'\"](\s)*\?>/im,u=/<body[^>]*>\s*([\s\S]+)\s*<\/body>/im,a=typeof location!="undefined"&&location.href,f=a&&location.protocol&&location.protocol.replace(/\:/,""),l=a&&location.hostname,c=a&&(location.port||undefined),h={},p=e.config&&e.config()||{};t={version:"2.0.7",strip:function(e){if(e){e=e.replace(o,"");var t=e.match(u);t&&(e=t[1])}else e="";return e},jsEscape:function(e){return e.replace(/(['\\])/g,"\\$1").replace(/[\f]/g,"\\f").replace(/[\b]/g,"\\b").replace(/[\n]/g,"\\n").replace(/[\t]/g,"\\t").replace(/[\r]/g,"\\r").replace(/[\u2028]/g,"\\u2028").replace(/[\u2029]/g,"\\u2029")},createXhr:p.createXhr||function(){var e,t,n;if(typeof XMLHttpRequest!="undefined")return new XMLHttpRequest;if(typeof ActiveXObject!="undefined")for(t=0;t<3;t+=1){n=s[t];try{e=new ActiveXObject(n)}catch(r){}if(e){s=[n];break}}return e},parseName:function(e){var t,n,r,i=!1,s=e.indexOf("."),o=e.indexOf("./")===0||e.indexOf("../")===0;return s!==-1&&(!o||s>1)?(t=e.substring(0,s),n=e.substring(s+1,e.length)):t=e,r=n||t,s=r.indexOf("!"),s!==-1&&(i=r.substring(s+1)==="strip",r=r.substring(0,s),n?n=r:t=r),{moduleName:t,ext:n,strip:i}},xdRegExp:/^((\w+)\:)?\/\/([^\/\\]+)/,useXhr:function(e,n,r,i){var s,o,u,a=t.xdRegExp.exec(e);return a?(s=a[2],o=a[3],o=o.split(":"),u=o[1],o=o[0],(!s||s===n)&&(!o||o.toLowerCase()===r.toLowerCase())&&(!u&&!o||u===i)):!0},finishLoad:function(e,n,r,i){r=n?t.strip(r):r,p.isBuild&&(h[e]=r),i(r)},load:function(e,n,r,i){if(i.isBuild&&!i.inlineText){r();return}p.isBuild=i.isBuild;var s=t.parseName(e),o=s.moduleName+(s.ext?"."+s.ext:""),u=n.toUrl(o),h=p.useXhr||t.useXhr;!a||h(u,f,l,c)?t.get(u,function(n){t.finishLoad(e,s.strip,n,r)},function(e){r.error&&r.error(e)}):n([o],function(e){t.finishLoad(s.moduleName+"."+s.ext,s.strip,e,r)})},write:function(e,n,r,i){if(h.hasOwnProperty(n)){var s=t.jsEscape(h[n]);r.asModule(e+"!"+n,"define(function () { return '"+s+"';});\n")}},writeFile:function(e,n,r,i,s){var o=t.parseName(n),u=o.ext?"."+o.ext:"",a=o.moduleName+u,f=r.toUrl(o.moduleName+u)+".js";t.load(a,r,function(n){var r=function(e){return i(f,e)};r.asModule=function(e,t){return i.asModule(e,f,t)},t.write(e,a,r,s)},s)}};if(p.env==="node"||!p.env&&typeof process!="undefined"&&process.versions&&!!process.versions.node)n=require.nodeRequire("fs"),t.get=function(e,t,r){try{var i=n.readFileSync(e,"utf8");i.indexOf("﻿")===0&&(i=i.substring(1)),t(i)}catch(s){r(s)}};else if(p.env==="xhr"||!p.env&&t.createXhr())t.get=function(e,n,r,i){var s=t.createXhr(),o;s.open("GET",e,!0);if(i)for(o in i)i.hasOwnProperty(o)&&s.setRequestHeader(o.toLowerCase(),i[o]);p.onXhr&&p.onXhr(s,e),s.onreadystatechange=function(t){var i,o;s.readyState===4&&(i=s.status,i>399&&i<600?(o=new Error(e+" HTTP status: "+i),o.xhr=s,r(o)):n(s.responseText),p.onXhrComplete&&p.onXhrComplete(s,e))},s.send(null)};else if(p.env==="rhino"||!p.env&&typeof Packages!="undefined"&&typeof java!="undefined")t.get=function(e,t){var n,r,i="utf-8",s=new java.io.File(e),o=java.lang.System.getProperty("line.separator"),u=new java.io.BufferedReader(new java.io.InputStreamReader(new java.io.FileInputStream(s),i)),a="";try{n=new java.lang.StringBuffer,r=u.readLine(),r&&r.length()&&r.charAt(0)===65279&&(r=r.substring(1)),r!==null&&n.append(r);while((r=u.readLine())!==null)n.append(o),n.append(r);a=String(n.toString())}finally{u.close()}t(a)};else if(p.env==="xpconnect"||!p.env&&typeof Components!="undefined"&&Components.classes&&Components.interfaces)r=Components.classes,i=Components.interfaces,Components.utils["import"]("resource://gre/modules/FileUtils.jsm"),t.get=function(e,t){var n,s,o={},u=new FileUtils.File(e);try{n=r["@mozilla.org/network/file-input-stream;1"].createInstance(i.nsIFileInputStream),n.init(u,1,0,!1),s=r["@mozilla.org/intl/converter-input-stream;1"].createInstance(i.nsIConverterInputStream),s.init(n,"utf-8",n.available(),i.nsIConverterInputStream.DEFAULT_REPLACEMENT_CHARACTER),s.readString(n.available(),o),s.close(),n.close(),t(o.value)}catch(a){throw new Error((u&&u.path||"")+": "+a)}};return t}),define("text!ui/ui.tpl",[],function(){return'<templates>\n<script type="text/x-ui-template" id="window">\n    <header class="w-ui-window-header hbox drag-handel">\n        <div class="w-ui-window-header-title"></div>\n        <div class="w-ui-window-header-x"></div>\n    </header>\n    <div class="w-ui-window-body vbox"></div>\n    <footer class="w-ui-window-footer hbox">\n        <div class="w-ui-window-footer-monitor"></div>\n        <div class="w-ui-window-footer-button-ctn"></div>\n    </footer>\n</script>\n\n<script type="text/x-ui-template" id="modal-mask">\n    <div class="w-ui-helper"></div>\n</script>\n\n<script type="text/x-ui-template" id="button-set-yes">\n    <button class="button-yes primary">{{= i18n.ui.CONFIRM }}</button>\n</script>\n\n<script type="text/x-ui-template" id="button-set-cancel">\n    <button class="button-cancel">{{= i18n.ui.CANCEL }}</button>\n</script>\n\n<script type="text/x-ui-template" id="button-set-retry">\n    <button class="button-retry">{{= i18n.ui.RETRY }}</button>\n</script>\n\n<script type="text/x-ui-template" id="button-set-yes-no">\n    <button class="button-yes primary">{{= i18n.ui.CONFIRM }}</button>\n    <button class="button-no">{{= i18n.ui.CANCEL }}</button>\n</script>\n\n<script type="text/x-ui-template" id="button-set-yes-cancel">\n    <button class="button-yes primary">{{= i18n.ui.CONFIRM }}</button>\n    <button class="button-cancel">{{= i18n.ui.CANCEL }}</button>\n</script>\n\n<script type="text/x-ui-template" id="button-set-retry-cancel">\n    <button class="button-retry primary">{{= i18n.ui.RETRY }}</button>\n    <button class="button-cancel">{{= i18n.ui.CANCEL }}</button>\n</script>\n\n<script type="text/x-ui-template" id="button-set-yes-no-cancel">\n    <button class="button-yes primary">{{= i18n.ui.YES }}</button>\n    <button class="button-no">{{= i18n.ui.NO }}</button>\n    <button class="button-cancel">{{= i18n.ui.CANCEL }}</button>\n</script>\n\n<script type="text/x-ui-template" id="disposable-tip">\n    <label>\n        <input type="checkbox" class="check-disposable" />\n        {{= i18n.ui.DISPOSABLE_TIP }}\n    </label>\n</script>\n\n<script type="text/x-ui-template" id="smart-list">\n    <ul class="w-ui-smartlist-body-ctn"></ul>\n    <div class="w-ui-smartlist-scroll-ctn">\n        <div class="w-ui-smartlist-scroll-substitution"></div>\n    </div>\n    <div class="empty-tip w-layout-hide text-secondary"></div>\n    {{= TemplateFactory.get(\'ui\', \'loading\') }}\n</script>\n\n<script type="text/x-ui-template" id="smart-list-new">\n    <ul class="w-ui-smartlist-body-ctn"></ul>\n    <div class="empty-tip w-layout-hide text-secondary"></div>\n    {{= TemplateFactory.get(\'ui\', \'loading\') }}\n</script>\n\n<script type="text/x-ui-template" id="button">\n    <div class="label"></div>\n</script>\n\n<script type="text/x-ui-template" id="icon-button">\n    <div class="hbox">\n        <div class="icon"></div>\n        <div class="label"></div>\n    </div>\n</script>\n\n<script type="text/x-ui-template" id="menu-button">\n    <div class="hbox">\n        <div class="label wc"></div>\n        <div class="arrow-ctn hbox">\n            <div class="arrow"></div>\n        </div>\n    </div>\n</script>\n\n<script type="text/x-ui-template" id="menu-item-radio">\n    <label class="wc">\n        <input type="radio" name="{{= it.name }}" value="{{= it.value }}" />\n        <span>{{= it.label }}</span>\n    </label>\n</script>\n\n<script type="text/x-ui-template" id="menu-item-normal">\n    <div class="normal">\n        <span>{{= it.label }}</span>\n    </div>\n</script>\n\n<script type="text/x-ui-template" id="menu-item-group">\n    <div class="group text-thirdly">\n        <span>{{= it.label }}</span>\n    </div>\n</script>\n\n<script type="text/x-ui-template" id="menu-item-link">\n    <div class="link">\n        <span>{{= it.label }}</span>\n    </div>\n</script>\n\n<script type="text/x-ui-template" id="menu-item-checkbox">\n    <label class="wc">\n        <input type="checkbox" name="{{= it.name }}" value="{{= it.value }}" />\n        <span>{{= it.label }}</span>\n    </label>\n</script>\n\n<script type="text/x-ui-template" id="batch-action-body">\n    <div class="w-batch-action-body">\n        <div class="hbox">\n            <div class="tip"></div>\n            <div class="progress-ctn">\n                <span class="progress">0</span> / <span class="total">0</span>\n            </div>\n        </div>\n        <div class="progress-ctn hbox">\n            <progress class="tiny running" max="100" value="0"></progress>\n        </div>\n    </div>\n</script>\n\n<script type="text/x-ui-template" id="tip">\n    <div class="arrow"></div>\n</script>\n\n<script type="x-ui-template" id="loading">\n    <div class="w-ui-loading">\n        <div class="anima">\n            <div class="rotor rotor1"></div>\n            <div class="rotor rotor2"></div>\n            <div class="rotor rotor3"></div>\n            <div class="rotor rotor4"></div>\n            <div class="rotor rotor5"></div>\n            <div class="rotor rotor6"></div>\n            <div class="rotor rotor7"></div>\n            <div class="rotor rotor8"></div>\n        </div>\n    </div>\n</script>\n\n<script type="x-ui-template" id="loading-white">\n    <div class="w-ui-loading white">\n        <div class="anima">\n            <div class="rotor rotor1"></div>\n            <div class="rotor rotor2"></div>\n            <div class="rotor rotor3"></div>\n            <div class="rotor rotor4"></div>\n            <div class="rotor rotor5"></div>\n            <div class="rotor rotor6"></div>\n            <div class="rotor rotor7"></div>\n            <div class="rotor rotor8"></div>\n        </div>\n    </div>\n</script>\n\n<script type="text/x-ui-template" id="loading-horizental">\n    <div class="w-ui-loading-horizental-ctn">\n        <div class="w-ui-loading-horizental">\n            <div class="ball ball1"></div>\n            <div class="ball ball2"></div>\n            <div class="ball ball3"></div>\n            <div class="ball ball4"></div>\n        </div>\n    </div>\n</script>\n\n<script type="text/x-ui-template" id="loading-horizental-transparent">\n    <div class="w-ui-loading-horizental-ctn transparent">\n        <div class="w-ui-loading-horizental">\n            <div class="ball ball1"></div>\n            <div class="ball ball2"></div>\n            <div class="ball ball3"></div>\n            <div class="ball ball4"></div>\n        </div>\n    </div>\n</script>\n</templates>\n'}),define("text!modules/misc.tpl",[],function(){return'<templates>\n<script type="text/x-ui-template" id="sd-mount">\n    <div class="w-misc-sd-mount-ctn">\n        <h1>{{= i18n.misc.PLEASE_UNMOUNT_SD_CARD }}</h1>\n        <p>{{= i18n.misc.PLEASE_UNMOUNT_SD_CARD_DES }}</p>\n        <div class="mount-sd-tip"></div>\n    </div>\n</script>\n\n<script type="text/x-ui-template" id="main">\n    <div class="sidebar vbox"></div>\n    <div class="module-ctn"></div>\n</script>\n\n<script type="text/x-ui-template" id="pim-menu">\n    <div class="menu-title hbox">\n        <span class="text-thirdly">{{= i18n.misc.TITLE_PIM }}</span>\n        <hr />\n    </div>\n    <menu class="w-sidebar-menu"></menu>\n</script>\n\n<script type="text/x-ui-template" id="menu-item">\n    <div class="title hbox">\n        <div class="icon {{= it.icon }}"></div>\n        <div class="label">{{= it.label }}</div>\n        {{? it.count !== -1 }}\n            {{? it.id === 3 }}\n                <div class="count" data-title="{{= StringUtil.format(i18n.app.UPDATE_DES, it.count) }}">{{= it.count }}</div>\n            {{??}}\n                <div class="count">{{= it.count }}</div>\n            {{?}}\n        {{?}}\n    </div>\n</script>\n\n<script type="text/x-ui-template" id="menu-child-item">\n    <div class="sub-title">{{= it.label }}</div>\n    <div class="count">{{= it.count }}</div>\n</script>\n\n<script type="text/x-ui-template" id="binding-devie">\n    <div class="w-misc-device-binding">\n        <h1>{{= i18n.misc.BINDING_TITLE }}</h1>\n        <p class="text-secondary">{{= i18n.misc.BINDING_DES }}</p>\n        <ul>\n            <li class="hbox">\n                <div class="icon backup"></div>\n                <div class="des">\n                    <h2>{{= i18n.misc.BINDING_AUTOBACKUP }}</h2>\n                    <div class="text-thirdly">{{= i18n.misc.BINDING_AUTOBACKUP_DES }}</div>\n                </div>\n            </li>\n            <li class="hbox">\n                <div class="icon account"></div>\n                <div class="des">\n                    <h2>{{= i18n.misc.BINDING_ACCOUNT }}</h2>\n                    <div class="text-thirdly">{{= i18n.misc.BINDING_ACCOUNT_DES }}</div>\n                </div>\n            </li>\n            <li class="hbox">\n                <div class="icon connect"></div>\n                <div class="des">\n                    <h2>{{= i18n.misc.BINDING_CONNECT }}</h2>\n                    <div class="text-thirdly">{{= i18n.misc.BINDING_CONNECT_DES }}</div>\n                </div>\n            </li>\n            <li class="hbox">\n                <div class="icon update"></div>\n                <div class="des">\n                    <h2>{{= i18n.misc.BINDING_UPDATE }}</h2>\n                    <div class="text-thirdly">{{= i18n.misc.BINDING_UPDATE_DES }}</div>\n                </div>\n            </li>\n        </ul>\n    </div>\n</script>\n\n<script type="text/x-ui-template" id="binding-devie-i18n">\n    <div class="w-misc-device-binding">\n        <h1>{{= i18n.misc.BINDING_TITLE }}</h1>\n        <p class="text-secondary">{{= i18n.misc.BINDING_DES }}</p>\n        <ul>\n            <li class="hbox">\n                <div class="des">\n                    <h2>{{= i18n.misc.BINDING_AUTOBACKUP }}</h2>\n                    <div class="text-thirdly">{{= i18n.misc.BINDING_AUTOBACKUP_DES }}</div>\n                </div>\n            </li>\n            <li class="hbox">\n                <div class="des">\n                    <h2>{{= i18n.misc.BINDING_CONNECT }}</h2>\n                    <div class="text-thirdly">{{= i18n.misc.BINDING_CONNECT_DES }}</div>\n                </div>\n            </li>\n        </ul>\n    </div>\n</script>\n\n<script type="text/x-ui-template" id="notify-setting">\n    <div class="w-notify-setting hbox">\n        <div class="setting-icon"></div>\n        <span class="button-setting text-thirdly link">{{= i18n.misc.NOTIFY_SETTING }}</span>\n    </div>\n</script>\n\n<script type="text/x-ui-template" id="notify-disable">\n    <div class="w-notify-setting hbox">\n        <span class="button-disable text-thirdly link">{{= i18n.misc.DONT_SHOW_AGAIN }}</span>\n    </div>\n</script>\n\n<script type="text/x-ui-template" id="adb-notif">\n    <div class="hbox ctn">\n        <div class="icon"></div>\n        <div class="text-secondary tip">{{= i18n.misc.USB_LOADING_INFO }}</div>\n        <div class="loading">\n            {{= TemplateFactory.get(\'ui\', \'loading-horizental-transparent\') }}\n        </div>\n        <button class="min button-retry">{{= i18n.ui.RETRY }}</button>\n    </div>\n</script>\n\n<script type="text/x-ui-template" id="shadow">\n    <div class="w-menu-shadow">\n        <div class="shadow"></div>\n    </div>\n</script>\n\n<script type="text/x-ui-template" id="font-style-xp">\n    <style type="text/css">\n        body,\n        button,\n        input,\n        textarea {\n            font: 12px/1.5em Arial, Helvetica, SimSun, sans-serif;\n        }\n    </style>\n</script>\n\n<script type="text/x-ui-template" id="batch-error-window">\n    <div>{{= it.tip }}</div>\n    {{? it.errorInfo }}\n    <div>{{= i18n.misc.POSIBLE_REASON }}{{= i18n.taskManager[it.errorInfo] || i18n.taskManager.UNKNOWN_ERROR }}</div>\n    {{?}}\n    <ul class="list-ctn">\n        {{~ it.items : item }}\n        <li class="item wc">- {{= item }}</li>\n        {{~}}\n    </ul>\n</script>\n\n<script type="text/x-ui-template" id="close-auto-start">\n    <div class="tip">{{= i18n.welcome.CLOSE_AUTO_START }}</div>\n    <div class="button-close"></div>\n</script>\n</templates>\n'}),define("text!app/app.tpl",[],function(){return'<templates>\n<script type="text/x-ui-template" id="default-panel">\n    <div class="notifier-ctn">\n        <div class="update-all">\n            <button class="w-icon-btn button-update-all">\n                <span class="icon update"></span>\n                <span class="label"></span>\n            </button>\n            <div class="des text-thirdly"></div>\n        </div>\n        <div class="transfer-all">\n            <button class="button-transfer-all"></button>\n            <div class="des text-thirdly">\n                {{= i18n.app.ONE_KEY_TRANSFER_DES }}\n            </div>\n        </div>\n        <div class="wash">\n            <button class="button-wash">{{= i18n.app.APP_WASH }}<div class="beta"></div></button>\n            <div class="des text-thirdly">\n                {{= i18n.app.APP_WASH_DES }}\n            </div>\n        </div>\n    </div>\n</script>\n\n<script type="text/x-ui-template" id="app-recommend-list">\n    <h3 class="text-secondary"></h3>\n    <ul class="list"></ul>\n    <div class="tip text-thirdly"></div>\n</script>\n\n<script type="text/x-ui-template" id="app-recommend-item">\n    <div class="icon button-navigate-to-detail">\n        <img src="{{= CONFIG.enums.TASK_DEFAULT_ICON_PATH_APP }}" alt="{{= it.app.title }}" />\n    </div>\n    <div class="body vbox">\n        <div class="title button-navigate-to-detail wc">{{= it.app.title }}</div>\n        <div class="text-thirdly wc">\n            {{? it.isDefaultPanel && it.recReason.reasonContent }}\n            {{= StringUtil.format(i18n.app.SUGGESTION_REF, it.recReason.reasonContent) }}\n            {{??}}\n            {{= i18n.app.DOWNLOAD_COUNT }}\n            {{= StringUtil.format(i18n.app.DOWNLOAD_COUNT_TIP, StringUtil.shortenQuantity(it.app.downloadCount)) }}\n            {{?}}\n        </div>\n    </div>\n    <button class="button-install primary min">{{= i18n.app.INSTALL }}</button>\n    <div class="button-dislike" data-title="{{= i18n.app.DISLIKE }}"></div>\n</script>\n\n<script type="text/x-ui-template" id="application-commentary">\n    {{\n        var enjoyInfo = it.web_info || {};\n    }}\n    <div class="count-ctn hbox">\n        <div class="rate vbox">\n            <div class="title text-thirdly">{{= i18n.app.LIKE }}</div>\n            <div class="like-count percent text-secondary button-navigate-to-detail">{{= enjoyInfo.likesCount || 0 }}</div>\n        </div>\n        <div class="split"></div>\n        <div class="rate vbox">\n            <div class="title text-thirdly">{{= i18n.app.COL_RATE_LABEL }}</div>\n            <div class="percent text-secondary button-navigate-to-detail">{{= enjoyInfo.likesRate || 0 }}%</div>\n        </div>\n    </div>\n    <div class="btn-ctn">\n        <span class="w-ui-buttongroup">\n            <button class="w-icon-btn button-like min" data-title="{{= i18n.app.LIKE }}"><span class="icon like"></span></button>\n            <button class="w-icon-btn button-dislike min" data-title="{{= i18n.app.UNLIKE }}"><span class="icon dislike"></span></button>\n        </span>\n        <button class="w-icon-btn button-comment min"><span class="icon comment"></span>{{= i18n.app.COMMENTARY }}</button>\n        <button class="w-icon-btn button-share min"><span class="icon share"></span>{{= i18n.common.SHARE}}</button>\n    </div>\n    <div class="input-ctn">\n        <textarea placeholder="{{= StringUtil.format(i18n.app.COMMENTARY_PLACEHOLDER, it.base_info.name) }}" class="input-content"></textarea>\n        <div class="code-ctn">\n            <div class="ctn hbox">\n                <div class="text-secondary">验证码：</div>\n                <input class="input-code" type="text" />\n                <img class="code" title="点击更换" />\n            </div>\n        </div>\n        <div class="hbox comment-actions">\n            <div class="monitor text-secondary"></div>\n            <button class="button-send primary min">{{= i18n.app.COMMENTARY }}</button>\n        </div>\n    </div>\n</script>\n\n<script type="text/x-ui-template" id="update-notification">\n    <ul class="list-ctn"></ul>\n    <div class="manage-ctn hbox">\n        <div class="mid-ctn">\n            <span class="button-manage-app link">{{= i18n.app.MANAGE_MY_APPS }}</span>\n        </div>\n        <button class="primary button-update-all">{{= i18n.app.UPDATE_ALL }}</button>\n    </div>\n</script>\n\n<script type="text/x-ui-template" id="update-notification-list-item">\n    <div class="icon"><img src="{{= it.base_info.icon }}" alt="{{= it.base_info.name }}" /></div>\n    <div class="base-info vbox">\n        <div>{{= it.base_info.name }}</div>\n        <div class="hbox" title="{{= i18n.app.COULD_UPDATE_TO }}v{{= it.upgrade_info.versionName }}(v{{= it.upgrade_info.versionCode }})">\n            <span class="text-secondary version-name">\n                v{{= it.base_info.version_name }}\n                {{? it.upgrade_info.versionName !== it.base_info.version_name }}\n                (v{{= it.base_info.version_code }})\n                {{?}}\n            </span>\n            <span class="update-info text-primary wc">\n                {{= i18n.app.COULD_UPDATE_TO }}v{{= it.upgrade_info.versionName }}\n                {{? it.upgrade_info.versionName !== it.base_info.version_name }}\n                (v{{= it.upgrade_info.versionCode }})\n                {{?}}\n            </span>\n        </div>\n    </div>\n    <button class="primary button-update min">{{= i18n.app.UPDATE }}</button>\n</script>\n\n<script type="text/x-ui-template" id="detail-panel">\n    <div class="app-info hbox">\n        {{? FunctionSwitch.ENABLE_APP_UPGRADE }}\n        <div class="icon" title="{{= it.detail_page_info ? i18n.app.LOOK_FOR_DETAIL : i18n.app.APP_NOT_INDEXED }}">\n            <img src="{{= it.base_info.icon }}" alt="{{! it.base_info.name }}" class="{{? it.detail_page_info }}button-navigate-to-detail{{?}}" />\n        </div>\n        {{??}}\n        <div class="icon">\n            <img src="{{= it.base_info.icon }}" alt="{{! it.base_info.name }}" />\n        </div>\n        {{?}}\n        <div class="title vbox">\n            {{? FunctionSwitch.ENABLE_APP_UPGRADE }}\n            <div class="name wc{{? it.detail_page_info }} link button-navigate-to-detail{{?}}" title="{{= it.detail_page_info ? i18n.app.LOOK_FOR_DETAIL : i18n.app.APP_NOT_INDEXED }}">\n                {{! it.base_info.name }}\n            </div>\n            {{??}}\n            <div class="name wc">\n                {{! it.base_info.name }}\n            </div>\n            {{?}}\n            <div class="actions">\n                {{? !it.isWeb }}\n                {{? StringUtil.isURL(it.upgrade_info.downloadUrl) }}\n                <button class="button-update min">{{= i18n.app.UPDATE }}</button>\n                {{?}}\n                {{? !it.base_info.is_system || (it.base_info.is_system && Device.get(\'isRoot\')) }}\n                <button class="button-uninstall min">{{= i18n.app.UNINSTALL }}</button>\n                {{?}}\n                {{??}}\n                <button class="button-install min">{{= i18n.app.INSTALL }}</button>\n                {{?}}\n            </div>\n        </div>\n    </div>\n    <dl class="cf">\n        <dt class="text-thirdly">{{= i18n.app.VERSION }}</dt>\n        {{\n            var originVersion = it.base_info.version_name.replace(/^version|v|V/, \'\');\n        }}\n        {{? StringUtil.isURL(it.upgrade_info.downloadUrl) }}\n        <dd class="hbox">\n            <div class="version wc">\n                v{{= originVersion }}\n                {{\n\n                    var targetVersion = it.upgrade_info.versionName.replace(/^version|v|V/, \'\');\n                    var flag = (originVersion === targetVersion)\n                                || (targetVersion.localeCompare(originVersion) === (-1));\n                    if (flag) {\n                        targetVersion += \'(v\' + it.upgrade_info.versionCode + \')\';\n                    }\n                }}\n                {{? flag }}\n                    (v{{= it.base_info.version_code }})\n                {{?}}\n            </div>\n            {{? it.detail_page_info }}\n            <div class="link button-navigate-to-version">{{= i18n.app.VERSION_HISTORY }}</div>\n            {{?}}\n        </dd>\n        <dt class="text-thirdly latest-version">{{= i18n.app.LATEST_VERSION }}</dt>\n        <dd title="v{{= targetVersion }}" class="wc">v{{= targetVersion }}</dd>\n        {{??}}\n        <dd class="hbox">\n            <div class="versin wc">v{{= originVersion }}</div>\n            {{? it.detail_page_info }}\n            <div class="link button-navigate-to-version">{{= i18n.app.VERSION_HISTORY }}</div>\n            {{?}}\n        </dd>\n        {{?}}\n        {{? !it.isWeb }}\n        <dt class="text-thirdly">{{= i18n.app.INSTALL_POSITION_LABEL }}</dt>\n        <dd>\n            {{? it.base_info.installed_location === CONFIG.enums.INSTALL_LOCATION_EXTENTION }}\n            {{= i18n.app.SD_CARD }}\n            <span class="link button-move-to-device">{{= i18n.app.MOVE }}</span>\n            {{??}}\n            {{= i18n.app.PHONE }}\n            <span class="link button-move-to-sd-card">{{= i18n.app.MOVE }}</span>\n            {{?}}\n        </dd>\n        {{?}}\n        <dt class="text-thirdly">{{= i18n.app.SIZE }}</dt>\n        <dd>{{= StringUtil.readableSize(it.base_info.apk_size) }}</dd>\n        {{? FunctionSwitch.ENABLE_APP_UPGRADE }}\n        {{? it.web_info && it.web_info.categories && it.web_info.categories.length > 0}}\n        <dt class="text-thirdly">{{= i18n.app.CATEGORY }}</dt>\n        <dd>\n            {{~ it.web_info.categories : cate }}\n            <span class="link button-navigate-to-category" data-cate="{{= cate.alias }}">{{= cate.name }}</span>\n            {{~}}\n        </dd>\n        {{?}}\n        {{?}}\n        {{? FunctionSwitch.ENABLE_APP_PERMISSION }}\n        <dt class="text-thirdly permission">{{= i18n.app.PERMISSON }}</dt>\n        <dd class="permission">\n            {{\n                var important = [];\n                var unimportant = [];\n                _.map(it.base_info.permission_info, function(permission) {\n                    if (permission.protection_level >= 1) {\n                        important.push(permission);\n                    } else {\n                        unimportant.push(permission);\n                    }\n                });\n            }}\n            <ul class="permission-list">\n                {{? important.length === 0 }}\n                <li>{{= i18n.app.NO_SPECIAL_PERMISSION }}</li>\n                {{?}}\n                {{~ important : permission }}\n                <li class="wc" title="{{= permission.name }}">{{= permission.name }}</li>\n                {{~}}\n            </ul>\n            <ul class="permission-list unimportant">\n                {{~ unimportant : permission }}\n                <li class="wc" title="{{= permission.name }}">{{= permission.name }}</li>\n                {{~}}\n            </ul>\n            {{? unimportant.length > 0 }}\n            <span class="button-toggle-permission">\n                <span class="link">{{= i18n.app.MORE }}</span>\n                <span class="arrow">&raquo;</span>\n            </span>\n            {{?}}\n        </dd>\n        {{?}}\n    </dl>\n</script>\n\n<script type="text/x-ui-template" id="batch-apps">\n    <div class="title">\n        <span class="count"></span>\n        <span class="button-deselect link">{{= i18n.misc.DESELECT }}</span>\n    </div>\n    <div class="w-app-batch-list-ctn vbox"></div>\n</script>\n\n<script type="text/x-ui-template" id="app-list-item">\n    <label class="input item-checker-wrap hbox"><input class="item-checker" type="checkbox" value="{{= it.id }}"></label>\n    <div class="info hbox">\n        <div class="icon">\n            <img src="{{= it.base_info.icon }}" alt="{{! it.base_info.name }}" />\n        </div>\n        <div class="name wc">\n            {{= it.base_info.name }}\n            {{? StringUtil.isURL(it.upgrade_info.downloadUrl) }}\n            <span class="version-tip text-secondary">\n            {{\n                var originVersion = it.base_info.version_name.replace(/^version|v|V/, \'\');\n                var targetVersion = it.upgrade_info.versionName.replace(/^version|v|V/, \'\');\n                var flag = (originVersion === targetVersion)\n                            || (targetVersion.localeCompare(originVersion) === (-1));\n                if (flag) {\n                    originVersion += \'(v\' + it.base_info.version_code + \')\';\n                    targetVersion += \'(v\' + it.upgrade_info.versionCode + \')\';\n                }\n            }}\n            v{{= originVersion }}\n            </span>\n            {{?}}\n        </div>\n    </div>\n    {{? StringUtil.isURL(it.upgrade_info.downloadUrl) }}\n    <div class="current-version text-secondary wc" title="v{{= originVersion }}">v{{= originVersion }}</div>\n    <div class="target-version text-secondary wc" title="v{{= targetVersion }}">\n        <span class="latest-tip">{{= i18n.app.LATEST_LABEL }}</span>v{{= targetVersion }}\n    </div>\n    {{??}}\n    <div class="current-version text-secondary wc" title="v{{= it.base_info.version_name.replace(/^version|v|V/, \'\') }}">\n        v{{= it.base_info.version_name.replace(/^version|v|V/, \'\') }}\n    </div>\n    <div class="target-version wc"></div>\n    {{?}}\n    <div class="size text-secondary">\n        {{= StringUtil.readableSize(it.base_info.apk_size) }}\n    </div>\n    {{? !it.isWeb }}\n    <div class="location text-secondary">\n        {{? it.base_info.installed_location === CONFIG.enums.INSTALL_LOCATION_EXTENTION }}\n        {{= i18n.app.SD_CARD }}\n        {{??}}\n        {{= i18n.app.PHONE }}\n        {{?}}\n    </div>\n    {{?}}\n    <div class="update hbox">\n        {{? StringUtil.isURL(it.upgrade_info.downloadUrl) && !it.is_blocked }}\n            {{? it.isUpdating }}\n                <progress class="tiny" max="100" value="{{= it.progress }}"></progress>\n                <span class="button-cancel link">{{= i18n.ui.CANCEL }}</span>\n            {{??}}\n                <button class="button-update min">{{= i18n.app.UPDATE }}</button>\n                {{? !it.is_blocked }}\n                    <span class="button-ignore link">{{= i18n.app.APPS_IGNORE_UPGRADE_TEXT }}</span>\n                {{?}}\n            {{?}}\n        {{?}}\n    </div>\n    <div class="web-update hbox">\n        {{? it.installed }}\n            <span class="text-secondary" >{{= i18n.app.ALREAD_INSTALLED }}</span>\n        {{??}}\n            {{? it.isUpdating }}\n                <progress class="tiny" max="100" value="{{= it.progress }}"></progress>\n                <span class="button-cancel link">{{= i18n.ui.CANCEL }}</span>\n            {{??}}\n                <button class="button-install min">{{= i18n.app.INSTALL }}</button>\n            {{?}}\n        {{?}}\n        <span class="button-hide link">{{= i18n.common.DELETE_TEXT }}</span>\n    </div>\n    <div class="button-close" data-id="{{= it.id }}" title="{{= i18n.misc.DESELECT }}"></div>\n</script>\n\n<script type="text/x-ui-template" id="one-key-update-body">\n<header class="w-smart-list-header w-app-list-header text-secondary hbox">\n    <label class="check-select-all-wrap"><input class="check-select-all" type="checkbox" /></label>\n    <div class="info smart-list-sortable desc" data-smart-list-sortby="base_info.name" data-smart-list-sort-type="string">{{= i18n.app.COL_NAME_LABEL }}</div>\n    <div class="current-version">{{= i18n.app.APP_INSTALL_VERSION_LABEL }}</div>\n    <div class="target-version">{{= i18n.app.APP_LATEST_VERSION_LABEL }}</div>\n    <div class="size smart-list-sortable" data-smart-list-sortby="base_info.apk_size" data-smart-list-sort-type="number">{{= i18n.app.COL_SIZE_LABEL }}</div>\n</header>\n<footer class="w-smart-list-footer text-secondary"></footer>\n</script>\n\n<script type="text/x-ui-template" id="web-app-empty-tip">\n    {{= i18n.app.WEB_APPS_EMPTY_TIP_PRE }}\n    <span class="button-find-app link">{{= i18n.app.WEB_APPS_EMPTY_TIP_LINK }}</span>\n    {{= i18n.app.WEB_APPS_EMPTY_TIP_POST }}\n</script>\n\n<script type="text/x-ui-template" id="one-key-move-body">\n<header class="w-smart-list-header w-app-list-header text-secondary hbox">\n    <label class="check-select-all-wrap"><input class="check-select-all" type="checkbox" /></label>\n    <div class="info smart-list-sortable desc" data-smart-list-sortby="base_info.name" data-smart-list-sort-type="string">{{= i18n.app.COL_NAME_LABEL }}</div>\n    <div class="current-version">{{= i18n.app.APP_INSTALL_VERSION_LABEL }}</div>\n    <div class="size smart-list-sortable" data-smart-list-sortby="base_info.apk_size" data-smart-list-sort-type="number">{{= i18n.app.COL_SIZE_LABEL }}</div>\n</header>\n<footer class="w-smart-list-footer text-secondary"></footer>\n</script>\n\n<script type="text/x-ui-template" id="retry-window">\n    <p class="tip">{{= it.tip }}</p>\n    <ul class="list">\n        {{~ it.failedApps : app }}\n        <li class="wc">- {{= app }}</li>\n        {{~}}\n    </ul>\n</script>\n\n<script type="text/x-ui-template" id="local-install-body">\n    <div class="btn-ctn hbox">\n        <button class="button-add-file">{{= i18n.misc.ADD_FILE }}</button>\n        <button class="button-add-folder">{{= i18n.misc.ADD_FOLDER }}</button>\n        <div class="tip">{{= i18n.app.APK_SELECTOR_DISCRIPTION_TEXT }}</div>\n    </div>\n    <div class="w-app-local-install-list vbox">\n        <header class="w-smart-list-header w-app-list-header text-secondary hbox">\n            <label class="check-select-all-wrap"><input class="check-select-all" type="checkbox" /></label>\n            <div class="info smart-list-sortable desc" data-smart-list-sortby="base_info.name" data-smart-list-sort-type="string">{{= i18n.app.COL_NAME_LABEL }}</div>\n            <div class="current-version">{{= i18n.app.COL_VERSION_LABEL }}</div>\n            <div class="size smart-list-sortable" data-smart-list-sortby="base_info.apk_size" data-smart-list-sort-type="number">{{= i18n.app.COL_SIZE_LABEL }}</div>\n        </header>\n        <footer class="w-smart-list-footer text-secondary"></footer>\n    </div>\n</script>\n\n<script type="text/x-ui-template" id="local-install-monitor">\n    <input type="checkbox" class="check-delete-when-finish" />\n    {{= i18n.app.DELETE_APK_WHEN_FINISH }}\n</script>\n\n<script type="text/x-ui-template" id="toolbar">\n    <input type="checkbox" class="check-select-all" />\n    <button class="w-icon-btn primary button-install min">\n        <span class="icon add"></span>{{= i18n.app.BUTTON_ADD_APP_LABEL }}\n    </button>\n    <button class="w-icon-btn button-update min">\n        <span class="icon update"></span>{{= i18n.app.BUTTON_UPGRADE_LABEL }}\n    </button>\n    <button class="w-icon-btn button-uninstall min">\n        <span class="icon delete"></span>{{= i18n.app.BUTTON_UNINSTALL_LABEL }}\n    </button>\n    <button class="w-icon-btn button-export min">\n        <span class="icon export"></span>{{= i18n.app.BUTTON_EXPORT_LABEL }}\n    </button>\n    <div class="split"></div>\n    <button class="w-icon-btn button-move-to-sd-card min">\n        <span class="icon sd"></span>{{= i18n.app.BUTTON_TRANSFER_LABEL }}\n    </button>\n    <button class="w-icon-btn button-move-to-device min">\n        <span class="icon device"></span>{{= i18n.app.BUTTON_MOVE_TO_DEVICE_LABEL }}\n    </button>\n    <div class="split"></div>\n    <button class="w-icon-btn button-refresh min">\n        <span class="icon refresh"></span>{{= i18n.common.REFRESH_TEXT }}\n    </button>\n</script>\n\n<script type="text/x-ui-template" id="app-list">\n    <header class="w-list-tab-header">\n        <menu class="tab hbox">\n            <li class="hbox" data-tab="normal">\n                <div>{{= i18n.misc.NAV_APP_INSTALLED }}</div>\n                <div class="count">{{= it.normal }}</div>\n            </li>\n            <li class="hbox" data-tab="sys">\n                <div>{{= i18n.misc.NAV_APP_SYS }}</div>\n                <div class="count">{{= it.sys }}</div>\n            </li>\n            <li class="hbox" data-tab="update">\n                <div>{{= i18n.misc.NAV_APP_UPDATABLE }}</div>\n                <div class="count">{{= it.update }}</div>\n            </li>\n            <li class="hbox" data-tab="web">\n                <div>{{= i18n.app.WEB_APPS_EMPTY }}</div>\n                <div class="count">{{= it.web }}</div>\n            </li>\n        </menu>\n        <div class="pointer"></div>\n        <div class="sort"></div>\n    </header>\n    <div class="sd-mount header-tip">\n        <div class="hbox content-ctn">\n            <div class="tip text-secondary">{{= i18n.app.SD_MOUNT_TIP2 }}</div>\n            <div class="button-close-sd button-close"></div>\n        </div>\n    </div>\n    <div class="flash header-tip">\n        <div class="hbox content-ctn">\n            <div class="tip text-secondary">{{= i18n.app.FLASH_TIP_TIP }}</div>\n            <div class="button-close-flash button-close"></div>\n        </div>\n    </div>\n    <div class="ignore-tip">\n        <div class="content hbox">\n            <div class="count text-secondary"></div>\n            <button class="button-open-ignore min">查看</button>\n        </div>\n    </div>\n</script>\n\n<script type="text/x-ui-template" id="app-main">\n    <div class="w-app-ctn hbox"></div>\n</script>\n\n<script type="text/x-ui-template" id="mount-sd">\n    <div class="w-misc-sd-mount-ctn">\n        <h1>{{= i18n.misc.PLEASE_UNMOUNT_SD_CARD }}</h1>\n        <p>{{= i18n.misc.APPS_USB_TEXT }}</p>\n        <div class="mount-sd-tip"></div>\n    </div>\n</script>\n\n<script type="text/x-ui-template" id="changelog">\n    {{\n        var originVersion = it.base_info.version_name.replace(/^version|v|V/, \'\');\n        var targetVersion = it.upgrade_info.versionName.replace(/^version|v|V/, \'\');\n        var flag = (originVersion === targetVersion)\n                    || (targetVersion.localeCompare(originVersion) === (-1));\n        if (flag) {\n            originVersion += \'(v\' + it.base_info.version_code + \')\';\n            targetVersion += \'(v\' + it.upgrade_info.versionCode + \')\';\n        }\n    }}\n    <div class="version text-secondary">\n        <div>{{= i18n.app.VERSION }}v{{= originVersion }}</div>\n        <div>{{= i18n.app.LATEST_VERSION }}v{{= targetVersion }}</div>\n    </div>\n    {{? !it.upgrade_info.changeLog.trim() }}\n    <div class="title text-secondary">{{= i18n.app.CHANGE_LOG_EMPRY }}</div>\n    {{??}}\n    <div class="content text-secondary">{{= it.upgrade_info.changeLog }}</div>\n    {{?}}\n</script>\n\n<script type="text/x-ui-template" id="sd-mount">\n    <div class="w-app-mount-sd-tip">\n        <div class="tip">{{= i18n.app.SD_MOUNT_TIP }}</div>\n        <hr />\n        <div class="tip-ctn">\n            <div class="tip">\n                <span></span>\n            </div>\n        </div>\n        <div class="mount-sd"></div>\n    </div>\n</script>\n</templates>\n'}),define("text!message/message.tpl",[],function(){return'<templates>\n<script type="text/x-ui-template" id="message-main">\n    <div class="w-message-ctn"></div>\n</script>\n<script type="text/x-ui-template" id="message-panel">\n    <div class="empty-info vbox">\n        <div class="bg"></div>\n        <div class="text-thirdly tip">{{= i18n.message.SEND_A_SMS }}</div>\n    </div>\n</script>\n\n<script type="text/x-ui-template" id="conversation-list-ctn">\n    <header class="count-tip text-secondary"></header>\n</script>\n\n<script type="text/x-ui-template" id="conversation-list-item">\n    <label class="input item-checker-wrap">\n        <input class="item-checker" type="checkbox" value="{{= it.id }}">\n    </label>\n    <div class="avatar">\n        <img src="{{= it.contactIcon }}" alt="{{! it.contactName }}" />\n    </div>\n    <div class="content">\n        <div class="hbox">\n            <div class="nameplate">\n                {{? it.address.length > 1 }}\n                    <span class="name wc">\n                    {{!\n                        _.map(it.address.slice(0, 2), function(add) {\n                            return (add.contact_id === \'-1\' ? add.phone_number : add.contact_name)\n                                    || i18n.contact.UNNAMED_CONTACT;\n                        }).join(i18n.misc.CAESURA_SIGN)\n                    }}\n                    {{? it.address.length > 2 }}\n                        {{= StringUtil.format(i18n.message.BATCH_SEND_TIP, it.address.length) }}\n                    {{?}}\n                    </span>\n                {{??}}\n                    <span class="name wc">\n                    {{! it.contactName }}\n                    </span>\n                    <div class="count total">{{= it.total_number }}</div>\n                {{?}}\n            </div>\n            <div class="notifier">\n                {{? it.unread_number > 0 }}\n                <div class="count unread">\n                    {{= it.unread_number }}\n                </div>\n                {{?}}\n                {{? it.sending_sms > 0 }}\n                <div class="icon sending" title="{{= i18n.message.SENDING }}"></div>\n                {{?}}\n                {{? it.failed_sms > 0 }}\n                <div class="icon faild" title="{{= StringUtil.format(i18n.message.SEND_FAILED_TIP, it.failed_sms) }}"></div>\n                {{?}}\n            </div>\n        </div>\n        <div class="text-thirdly hbox">\n            <div class="summary wc">\n                {{? it.is_summary_mms }}\n                [{{= i18n.message.MMS }}] {{! it.summary || i18n.message.NONE_SUBJECT }}({{= StringUtil.format(i18n.message.CONTAIN_MULTIMEDIA, it.summary_media_count) }})\n                {{??}}\n                {{! it.summary }}\n                {{?}}\n            </div>\n            <date class="date">\n                {{= StringUtil.smartDate(it.last_date) }}\n            </date>\n        </div>\n    </div>\n    <div class="button-close" data-id="{{= it.id }}" title="{{= i18n.misc.DESELECT }}"></div>\n</script>\n\n<script type="text/x-ui-template" id="threads-header">\n    {{? it.isBatch }}\n    <div class="contact-info wc batch">\n        [{{= i18n.message.BATCH_SEND }}]\n        {{=\n            _.map(it.contactName.reverse().slice(0, 2), function(contact) {\n                return (contact.contact_id === \'-1\' ? contact.phone_number : contact.contact_name)\n                        || i18n.contact.UNNAMED_CONTACT;\n            }).join(i18n.misc.CAESURA_SIGN)\n        }}\n        {{? it.contactName.length > 2 }}\n            {{= StringUtil.format(i18n.message.NAMEPLATE_BATCH_SEND_TIP, it.contactName.length) }}\n        {{?}}\n    </div>\n    {{? it.failedCount > 0 }}\n    <div class="text-warning failed-count">{{= StringUtil.format(i18n.message.SEND_FAILED_TIP, it.failedCount) }}</div>\n    <button class="button-resend-all">{{= i18n.message.RESEND_ALL }}</button>\n    {{?}}\n    {{??}}\n    <img src="{{= it.contactIcon }}" alt="{{! it.contactName }}" />\n    <div class="contact-info enable-select hbox">\n        {{? it.contactId !== \'-1\' }}\n        <span class="name wc">{{! it.contactName }}</span>\n        <span class="number text-thirdly wc">&nbsp;{{= it.phoneNumber }}</span>\n        {{??}}\n        <span class="name wc">{{! it.contactName }}</span>\n        {{?}}\n    </div>\n    {{? it.contactId === \'-1\' }}\n    <button class="button-addToContact">{{= i18n.message.ADD_TO_CONTACT }}</button>\n    {{??}}\n    <button class="button-navigateToContact">{{= i18n.message.LOOK_UP_CONTACT }}</button>\n    {{?}}\n    {{?}}\n</script>\n\n<script type="text/x-ui-template" id="message-sender-threads-panel">\n    <div class="selector-ctn hbox">\n        <span class="text-secondary">{{= i18n.message.SEND_MESSAGE_TO }}</span>\n        <div class="number-selector"></div>\n    </div>\n    <div class="sender-ctn hbox">\n        <textarea class="input-content" autofocus="true"></textarea>\n        <div class="count-ctn">\n            <div class="count-down text-thirdly"></div>\n            <button class="button-send primary">{{= i18n.message.SEND_SMS }}</button>\n        </div>\n    </div>\n</script>\n\n<script type="text/x-ui-template" id="threads-panel">\n    <ul class="w-message-threads-list-ctn"></ul>\n    <div class="empty-tip text-secondary"></div>\n</script>\n\n<script type="text/x-ui-template" id="message-sender">\n    <div class="header hbox">\n        <label class="cf" for="address">{{= i18n.message.RECEIVER }}</label>\n        <div class="address">\n            <input id="address" type="text" class="input-contact searchbox" autofocus="true" />\n        </div>\n        <button class="w-icon-btn button-add-contact">\n            <span class="icon add-grey"></span>{{= i18n.message.ADD_CONTACT }}\n        </button>\n    </div>\n    <div class="body hbox">\n        <label class="cf" for="content">{{= i18n.message.CONTENT }}</label>\n        <textarea id="content" class="input-content"></textarea>\n    </div>\n    <div class="monitor text-secondary">\n        <span class="content-count"></span><span class="contacts-count"></span>\n    </div>\n    <div class="help hbox">\n        <div class="batch-send-tip hbox">\n            <span class="link button-add-placeholder">{{= i18n.message.ADD_BATCH_RECEIVER }}</span>\n            <div class="tip"></div>\n        </div>\n        <div class="multi-sim-tip hbox">\n            <span class="link button-feedback">{{= i18n.message.PROBLEM_WITH_DUAL_SIM_PHONE }}</span>\n            <div class="tip"></div>\n        </div>\n    </div>\n</script>\n\n<script type="text/x-ui-template" id="threads-item">\n    {{? it.last_in_day }}\n    <div class="date-ctn text-thirdly hbox">\n        <hr />\n        <date>\n            {{=\n                (Environment.get(\'locale\') === CONFIG.enums.LOCALE_DEFAULT\n                    || Environment.get(\'locale\') === CONFIG.enums.LOCALE_ZH_CN) ?\n                        this.smartDate(it.day) : StringUtil.formatDate(\'MM / dd / yyyy\', it.day * 24 * 60 * 60 * 1000)\n            }}\n        </date>\n        <hr />\n    </div>\n    {{?}}\n    <ul class="w-message-item-ctn"></ul>\n</script>\n\n<script type="text/x-ui-template" id="threads-item-message">\n    <div class="content-wrap text-secondary">\n        <span class="content enable-select">\n        <div class="receiver">{{! StringUtil.format(i18n.message.SEND_TO, it.contact_name) }}</div>\n        {{? it.id < 0 }}\n        [{{= i18n.message.MMS }}] {{! it.subject || i18n.message.NONE_SUBJECT }}（{{= StringUtil.format(i18n.message.CONTAIN_MULTIMEDIA, it.mms_media_count) }}，<span class="link button-open-on-device">{{= i18n.message.OPEN_ON_DEIVE }}</span>）<br />\n            <span class="mms-content{{ if(it.body.length > 140) { }} wc{{ } }}">{{! it.body }}</span>\n            {{? it.body.length > 140 }}\n            <span class="button-toggle link">{{= i18n.message.EXPEND }}</span>\n            {{?}}\n        {{??}}\n        {{! it.body }}\n        {{?}}\n        </span>\n        <div class="arrow">\n            <div class="side"></div>\n        </div>\n        <div class="actions">\n            {{? it.type === CONFIG.enums.SMS_TYPE_RECEIVE }}\n            <button class="button-reply" title="{{= i18n.message.FORWARD }}"></button>\n            <button class="button-copy" title="{{= i18n.message.COPY }}"></button>\n            <button class="button-delete" title="{{= i18n.message.DELETE }}"></button>\n            {{??}}\n            <button class="button-delete" title="{{= i18n.message.DELETE }}"></button>\n            <button class="button-copy" title="{{= i18n.message.COPY }}"></button>\n            <button class="button-reply" title="{{= i18n.message.FORWARD }}"></button>\n            {{?}}\n        </div>\n    </div>\n    <div class="info text-thirdly">\n        {{\n            switch(it.type) {\n            case CONFIG.enums.SMS_TYPE_SENT_FAILD :\n                if(it.id >= 0) {\n        }}\n        <div class="icon faild"></div>{{= i18n.message.SEND_FAILED }}<span class="button-resend link">{{= i18n.message.RESEND }}</span>\n        {{\n                    }\n                break;\n            case CONFIG.enums.SMS_TYPE_SENDING :\n        }}\n        <div class="icon sending" title="{{= i18n.message.SENDING }}">\n        {{\n                break;\n            case CONFIG.enums.SMS_TYPE_QUEUE:\n        }}\n        <div class="icon sending" title="{{= i18n.message.SENDING }}">\n        {{\n                break;\n            default:\n        }}\n        <date>{{= StringUtil.formatDate(\'HH:mm\' , it.date) }}</date>\n        {{\n            }\n        }}\n    </div>\n</script>\n\n<script type="text/x-ui-template" id="message-notification">\n    <div class="w-sms-notification-container hbox">\n        <div class="w-sms-notification-avatar">\n            <img src="{{= it.contact_icon }}" alt="{{! it.contact_name }}" />\n        </div>\n        <div class="w-sms-notification-content">\n            <span class="w-sms-notification-body enable-select">\n                <span class="body">{{! it.body }}</span>\n                <date class="date text-secondary">{{= StringUtil.formatDate(\' - HH:mm\' , it.date) }}</date>\n            </span>\n        </div>\n    </div>\n</script>\n\n<script type="text/x-ui-template" id="search-result-item">\n    <img class="avatar" src="{{= it.avatar }}" alt="{{= it.displayTitle }}" />\n    <div class="title wc">{{= it.displayTitle }}</div>\n    <div class="text-secondary number wc">{{= it.displayNumber }}</div>\n</script>\n\n<script type="text/x-ui-template" id="message-notification-sender">\n    <textarea class="input-content" placeholder="{{= i18n.message.SENDER_PLACEHOLDER }}"></textarea>\n    <div class="hbox notification-sender">\n        <button class="button-send primary">{{= i18n.message.REPLY_MESSAGE }}</button>\n        <div class="navigate">\n            <span class="button-delete link">{{= i18n.message.DELETE }}</span>\n            <span class="button-prev link">{{= i18n.message.PREV_MESSAGE }}</span>\n            <span class="button-next link">{{= i18n.message.NEXT_MESSAGE }}</span>\n        </div>\n    </div>\n</script>\n\n<script type="text/x-ui-template" id="contact-seletor-body">\n    <input class="searchbox" type="text" placeholder="{{= i18n.message.SEARCH_CONTACT }}" />\n    <div class="selector-ctrl hbox">\n        <div class="selector-ctn"></div>\n        <div class="link button-select-all">{{= i18n.ui.SELECT_ALL }}</div>\n    </div>\n    <div class="list-ctn hbox"></div>\n    <div class="selector-monitor"></div>\n</script>\n\n<script type="text/x-ui-template" id="contact-selector-footer">\n    <span class="text-secondary count">{{= StringUtil.format(i18n.message.CONTACT_SELECT, 0) }}</span>\n    <span class="link button-clear-all">{{= i18n.message.CLEAR_ALL }}</span>\n</script>\n\n<script type="text/x-ui-template" id="contact-list-item">\n    <label class="input item-checker-wrap hbox"><input class="item-checker" type="checkbox" value="{{= it.id }}"></label>\n    <img class="avatar" src="{{= it.avatarSmall }}" alt="{{= it.title }}"/>\n    <div class="title wc">{{= it.title }}</div>\n    <div class="phone-number text-secondary wc">{{= it.phoneNumber }}</div>\n    <div class="state hbox">\n        <div class="tip text-primary">{{= i18n.misc.SELECT }}</div>\n        <div class="check"></div>\n    </div>\n</script>\n\n<script type="text/x-ui-template" id="monitor-item-sender">\n    <span title="{{! it.phoneNumber }}">{{! it.title || it.phoneNumber }}</span>\n    <div class="button-delete"></div>\n</script>\n\n<script type="text/x-ui-template" id="batch-conversations">\n    <div class="title">\n        <span class="count"></span>\n        <span class="button-deselect link">{{= i18n.misc.DESELECT }}</span>\n    </div>\n    <div class="w-message-batch-conversations-list-ctn vbox"></div>\n</script>\n\n<script type="text/x-ui-template" id="toolbar">\n    <input type="checkbox" class="check-select-all" />\n    <button class="w-icon-btn primary button-send min">\n        <span class="icon add"></span>{{= i18n.message.SEND_SMS }}\n    </button>\n    <button class="w-icon-btn button-delete min">\n        <span class="icon delete"></span>{{= i18n.misc.DELETE }}\n    </button>\n    <button class="w-icon-btn button-mark-as-read min">\n        <span class="icon mark-as-read"></span>{{= i18n.message.MARK_AS_READ }}\n    </button>\n    <div class="split"></div>\n    <button class="w-icon-btn button-import min">\n        <span class="icon import"></span>{{= i18n.misc.IMPORT }}\n    </button>\n    <button class="w-icon-btn button-export min">\n        <span class="icon export"></span>{{= i18n.misc.EXPORT }}\n    </button>\n    <div class="split"></div>\n    <button class="w-icon-btn button-refresh min">\n        <span class="icon refresh"></span>{{= i18n.misc.REFRESH }}\n    </button>\n</script>\n\n<script type="text/x-ui-template" id="import-backup">\n    <div class="tip">\n        <label class="select-file" >{{= i18n.message.SELECT_BACKUP_FILE }}</label>\n    </div>\n    <div class="header hbox">\n        <div class="backup-record" >{{= i18n.message.BACKUP_RECORD }}</div>\n        <div class="message-number" >{{= i18n.message.BACKUP_MESSAGE_NUMBER }}</div>\n    </div>\n    <div class="list-ctn">\n        <div class="loading">{{= i18n.common.LOADING }}</div>\n        <ul class="list">\n            {{~ it.list : item }}\n            <li>\n                <label class="item-wrap hbox">\n                    <input class="file-radio" type="radio" name="backup" value="{{= item.file_path }}" />\n                    <div class="date">{{= StringUtil.formatDate("yyyy-MM-dd", item.date) }}</div>\n                    <div class="title" title="{{= item.file_path }}">{{= item.device_title }}</div>\n                    <div class="count">{{= item.number }}</div>\n                </label>\n            </li>\n            {{~}}\n        </ul>\n    </div>\n</script>\n\n<script type="text/template" id="import-file-select">\n    <p class="title">{{= i18n.message.IMPORT_SELECT_FILE }}</p>\n    <div>\n        <input name="file" type="text" class="file"></input>\n        <span class="browser"></span>\n    </div>\n    <p class="invalid" style="display:none">{{= i18n.message.INVALID_FILE }}</p>\n</script>\n\n<script type="text/template" id="import-progress">\n    <div class="hbox">\n        <div class="progress-desc">{{= i18n.message.IMPORTING_SMS }}</div>\n        <div class="progress-num">0 / 0</div>\n    </div>\n    <div class="progress-ctn hbox">\n        <progress class="tiny running" max="100" value="0"></progress>\n    </div>\n    <div class="duplicate-ctn">\n        <span class="duplicate text-thirdly"></span>\n    </div>\n</script>\n\n<script type="text/template" id="export-select">\n    <div class="w-contact-export">\n        <p class="title">{{= i18n.message.SELECT_MESSAGE }}</p>\n        <ul class="type">\n            <li>\n                <label>\n                    <input class="w-ui-radio" type="radio" name="sms_export" value="1" checked/>\n                        {{= i18n.message.COUNT_TIP }}\n                </label>\n            </li>\n            <li>\n                <label>\n                    <input class="w-ui-radio" type="radio" name="sms_export" value="2"/>\n                    {{= i18n.message.ALL_MESSAGE }}<span class="count"></span>\n                </label>\n            </li>\n        </ul>\n    </div>\n</script>\n\n<script type="text/template" id="export-progress">\n    <div class="hbox">\n        <div class="progress-desc">{{= i18n.message.EXPORTING_SMS }}</div>\n        <div class="progress-num">0 / 0</div>\n    </div>\n    <div class="progress-ctn hbox">\n        <progress class="tiny running" max="100" value="0"></progress>\n    </div>\n</script>\n</templates>\n'}),define("text!task/taskmanager.tpl",[],function(){return'<templates>\n<script type="text/x-ui-template" id="main">\n    <div class="ctn vbox">\n        <div class="w-task-mask"></div>\n    </div>\n</script>\n\n<script type="text/x-ui-template" id="task-list">\n    <header class="w-smart-list-header text-secondary hbox">\n        <div class="name">{{= i18n.taskManager.TASK_NAME }}</div>\n        <div class="size">{{= i18n.taskManager.SIZE }}</div>\n        <div class="progress">{{= i18n.taskManager.PROGRESS }}</div>\n        <div class="action"></div>\n    </header>\n</script>\n\n<script type="text/x-ui-template" id="toolbar">\n    <input type="checkbox" class="check-select-all" />\n    <button class="w-icon-btn button-pause min">\n        <span class="icon pause"></span>{{= i18n.misc.PAUSE }}\n    </button>\n    <button class="w-icon-btn button-continue min">\n        <span class="icon start"></span>{{= i18n.misc.RESUME }}\n    </button>\n    <button class="w-icon-btn button-delete min">\n        <span class="icon delete"></span>{{= i18n.misc.DELETE }}\n    </button>\n    <div class="split"></div>\n    <button class="w-icon-btn button-open-folder min">\n        <span class="icon open-folder"></span>{{= i18n.taskManager.OPEN_DOWNLOAD_FOLDER }}\n    </button>\n    <div class="button-close"></div>\n</script>\n\n<script type="text/x-ui-template" id="list-item">\n    <label class="input item-checker-wrap">\n        <input class="item-checker" type="checkbox" value="{{= it.id }}">\n    </label>\n    <div class="icon" title="{{! it.more_info || \'\' }}">\n        <img src="{{= it.icon }}" alt="{{! it.title }}" />\n    </div>\n    <div class="title" title="{{! it.more_info || \'\' }}">{{= it.title }}</div>\n    <div class="size text-secondary">{{= (it.size && Number(it.size) !== 0) ? StringUtil.readableSize(it.size) : i18n.taskManager.UNKNOWN }}</div>\n    <div class="status vbox text-thirdly">\n        {{\n            switch (it.type) {\n                case CONFIG.enums.TASK_TYPE_DOWNLOAD :\n                    switch (it.state) {\n                        case CONFIG.enums.TASK_STATE_ADDED :\n        }}\n        <div class="progress hbox">\n            <progress class="tiny disabled" max="100" value="{{= it.processing }}" />\n        </div>\n        <div>\n            {{= StringUtil.format(i18n.taskManager.PAUSE_STATUS, StringUtil.readableSize(it.size * (it.processing / 100))) }}\n        </div>\n        {{\n                            break;\n                        case CONFIG.enums.TASK_STATE_WAITING :\n        }}\n        <div class="progress hbox">\n            <progress class="tiny disabled" max="100" value="{{= it.processing }}" />\n        </div>\n        <div>{{= i18n.taskManager.WAITING_DOWNLOAD }}</div>\n        {{\n                            break;\n                        case CONFIG.enums.TASK_STATE_PROCESSING :\n        }}\n        <div class="progress hbox">\n            <progress class="tiny" max="100" value="{{= it.processing }}" />\n        </div>\n        <div>\n            {{= StringUtil.format(i18n.taskManager.RUNNING_STATUS, StringUtil.readableSize(it.received_size), StringUtil.readableSize(it.speed)) }}\n        </div>\n        {{\n                            break;\n                        case CONFIG.enums.TASK_STATE_FAILD :\n                            if (it.message === \'NO_SPACE\' ) {\n        }}\n        <div class="text-warning">{{= i18n.taskManager.NO_SPACE }}</div>\n        {{\n                            } else {\n        }}\n        <div class="text-warning">{{= i18n.taskManager.DOWNLOAD_FAILED }}</div>\n        {{\n                            }\n                            break;\n                    }\n                    break;\n                case CONFIG.enums.TASK_TYPE_INSTALL :\n                    switch (it.state) {\n                        case CONFIG.enums.TASK_STATE_ADDED :\n        }}\n        <div>{{= i18n.taskManager.STOPPED }}</div>\n        {{\n                            break;\n                        case CONFIG.enums.TASK_STATE_WAITING :\n        }}\n        <div class="progress hbox"><progress class="tiny" max="100" value="100" /></div>\n        <div>{{= i18n.taskManager.WAITING_INSTALL }}</div>\n        {{\n                            break;\n                        case CONFIG.enums.TASK_STATE_PROCESSING :\n                            if(it.message === \'SCAN_VIRUS\') {\n        }}\n        <div class="progress hbox"><progress class="tiny running" max="100" value="100" /></div>\n        <div>{{= i18n.taskManager.SCANNING }}</div>\n        {{\n                            } else {\n        }}\n        <div class="progress hbox"><progress class="tiny running" max="100" value="100" /></div>\n        <div>\n            {{= i18n.taskManager.INSTALLING }}\n            {{? it.message === \'INSTALLING_PASS_VIRUS_SCAN\' }}\n            &nbsp;-&nbsp;<span class="text-primary">{{= i18n.taskManager.SCAN_PASS }}</span>\n            {{?? it.message === \'INSTALLING_VIRUS_SCAN_FAILED\' }}\n            &nbsp;-&nbsp;<span class="text-warning">{{= i18n.taskManager.SCAN_FAILED }}</span>\n            {{?}}\n        </div>\n        {{\n                            }\n                            break;\n                        case CONFIG.enums.TASK_STATE_SUCCESS :\n        }}\n        <div>\n            {{? it.message === \'NEED_CONFIRM\' }}\n            {{= i18n.taskManager.CONFIRM_ON_DEVICE }}\n            {{??}}\n            {{= i18n.misc.FINISH }}\n            {{?}}\n        </div>\n        {{\n                            break;\n                        case CONFIG.enums.TASK_STATE_FAILD :\n        }}\n        <div class="text-warning">{{= i18n.taskManager[it.message] || i18n.taskManager.UNKNOWN_ERROR }}</div>\n        {{              break;\n                    }\n                    break;\n                case CONFIG.enums.TASK_TYPE_PARSING_VIDEO_URL:\n                    switch (it.state) {\n                        case CONFIG.enums.TASK_STATE_PROCESSING :\n        }}\n        <div class="progress hbox"><progress class="tiny running" max="100" value="100" /></div>\n        <div>{{= i18n.taskManager.PARSING_VIDEO_URL }}</div>\n        {{\n                            break;\n                        case CONFIG.enums.TASK_STATE_SUCCESS :\n        }}\n        <div>{{= i18n.taskManager.PARSING_VIDEO_URL_SUCCESS }}</div>\n        {{\n                            break;\n                        case CONFIG.enums.TASK_STATE_FAILD :\n        }}\n        <div class="text-warning">{{= i18n.taskManager[it.message] || i18n.taskManager.UNKNOWN_ERROR }}</div>\n        {{\n                            break;\n                        default:\n        }}\n        <div>{{= i18n.taskManager.WAITING_DOWNLOAD }}</div>\n        {{\n                    }\n                    break;\n                case CONFIG.enums.TASK_TYPE_MERGE_VIDEO:\n                    switch (it.state) {\n                        case CONFIG.enums.TASK_STATE_PROCESSING :\n        }}\n        <div class="progress hbox"><progress class="tiny running" max="100" value="100" /></div>\n        <div>{{= i18n.taskManager.MERGE_VIDEO }}</div>\n        {{\n                            break;\n                        case CONFIG.enums.TASK_STATE_SUCCESS :\n        }}\n        <div>{{= i18n.taskManager.MERGE_VIDEO_SUCCESS }}</div>\n        {{\n                            break;\n                        case CONFIG.enums.TASK_STATE_FAILD :\n        }}\n        <div class="text-warning">{{= i18n.taskManager[it.message] || i18n.taskManager.UNKNOWN_ERROR }}</div>\n        {{\n                            break;\n                    }\n                    break;\n                case CONFIG.enums.TASK_TYPE_PUSH :\n                    switch (it.state) {\n                        case CONFIG.enums.TASK_STATE_ADDED :\n        }}\n        <div class="progress hbox">\n            <progress class="tiny disabled" max="100" value="{{= it.processing }}" />\n        </div>\n        <div>\n            {{= StringUtil.format(i18n.taskManager.PUSH_PAUSE_STATUS, StringUtil.readableSize(it.size * (it.processing / 100))) }}\n        </div>\n        {{\n                            break;\n                        case CONFIG.enums.TASK_STATE_WAITING :\n        }}\n        <div>{{= i18n.taskManager.WAITING_PUSHING }}</div>\n        {{\n                            break;\n                        case CONFIG.enums.TASK_STATE_PROCESSING :\n                            if(it.message === \'START_UNZIPPING\') {\n        }}\n        <div class="progress hbox"><progress class="tiny running" max="100" value="100" /></div>\n        <div>\n            {{= i18n.taskManager.START_UNZIPPING }}\n        </div>\n        {{\n                            } else if(it.message === \'UNZIP_COMPLETE\') {\n        }}\n        <div class="progress hbox"><progress class="tiny running" max="100" value="100" /></div>\n        <div>\n            {{= i18n.taskManager.UNZIP_COMPLETE }}\n        </div>\n        {{\n                            } else {\n        }}\n        <div class="progress hbox">\n            <progress class="tiny running" max="100" value="{{= it.processing }}" />\n        </div>\n        <div>\n            {{= i18n.taskManager.PUSHING }}\n            {{? it.received_size }}\n            {{= StringUtil.format(i18n.taskManager.PUSHING_STATUS, StringUtil.readableSize(it.received_size), StringUtil.readableSize(it.speed)) }}\n            {{?}}\n        </div>\n        {{\n                            }\n                            break;\n                        case CONFIG.enums.TASK_STATE_SUCCESS :\n        }}\n        <div>{{= i18n.misc.FINISH }}</div>\n        {{\n                            break;\n                        case CONFIG.enums.TASK_STATE_FAILD :\n        }}\n        <div class="text-warning">{{= i18n.taskManager[it.message] || i18n.taskManager.UNKNOWN_ERROR }}</div>\n        {{\n                            break;\n                            break;\n                        case CONFIG.enums.TASK_STATE_STOPPED :\n        }}\n        <div>{{= i18n.taskManager.WAITING_PUSHING }}</div>\n        {{\n                            break;\n                    }\n                    break;\n                case CONFIG.enums.TASK_TYPE_RESTORE_APP_DATA :\n                    switch (it.state) {\n                        case CONFIG.enums.TASK_STATE_ADDED :\n        }}\n        <div>{{= i18n.taskManager.STOPPED }}</div>\n        {{\n                            break;\n                        case CONFIG.enums.TASK_STATE_WAITING :\n        }}\n        <div>{{= i18n.taskManager.WAITING_RESTORE_APP_DATA }}</div>\n        {{\n                            break;\n                        case CONFIG.enums.TASK_STATE_PROCESSING :\n                            if (it.message === CONFIG.enums.BACKUP_APP_DATA_MESSAGE_NEED_USER_RESTORE) {\n        }}\n        <div class="text-warning">{{= i18n.backup_restore.RESTORE_APP_DATA_WAITING }}</div>\n        {{\n                            } else {\n        }}\n        <div class="progress hbox"><progress class="tiny running" max="100" value="100" /></div>\n        <div>{{= i18n.taskManager.PROCESSING_RESTORE_APP_DATA }}</div>\n        {{\n                            }\n                            break;\n                        case CONFIG.enums.TASK_STATE_SUCCESS :\n        }}\n        <div>\n            {{= i18n.misc.FINISH }}\n        </div>\n        {{\n                            break;\n                        case CONFIG.enums.TASK_STATE_FAILD :\n        }}\n        <div>\n            {{= i18n.backup_restore.RESTORE_APP_DATA_ERROR }}\n        </div>\n        {{\n                        break;\n                    }\n                    break;\n            case CONFIG.enums.TASK_TYPE_UNZIP :\n                switch (it.state) {\n                        case CONFIG.enums.TASK_STATE_PROCESSING :\n        }}\n        <div>{{= i18n.taskManager.UNZIPING }}</div>\n        {{\n                            break;\n                        case CONFIG.enums.TASK_STATE_FAILD :\n        }}\n        <div class="text-warning">{{= i18n.taskManager.UNZIP_FAILED }}</div>\n        {{\n                            break;\n                }\n                break;\n            }\n        }}\n    </div>\n</script>\n\n<script type="text/x-ui-template" id="task-action">\n    {{\n        switch (it.type) {\n            case CONFIG.enums.TASK_TYPE_DOWNLOAD :\n                switch (it.state) {\n                    case CONFIG.enums.TASK_STATE_ADDED :\n    }}\n    <button class="button-start">{{= i18n.misc.CONTINUE }}</button>\n    {{\n                        break;\n                    case CONFIG.enums.TASK_STATE_PROCESSING :\n    }}\n    <button class="button-pause">{{= i18n.misc.PAUSE }}</button>\n    {{\n                        break;\n                    case CONFIG.enums.TASK_STATE_FAILD :\n                        if (it.message === \'NO_SPACE\') {\n    }}\n    <button class="button-change-path">{{= i18n.ui.CHANGE_DOWN_PATH }}</button>\n    {{\n                        } else {\n    }}\n    <button class="button-retry">{{= i18n.ui.RETRY }}</button>\n    {{\n                        }\n                        break;\n                }\n                break;\n            case CONFIG.enums.TASK_TYPE_INSTALL :\n                switch (it.state) {\n                    case CONFIG.enums.TASK_STATE_ADDED :\n    }}\n    <button class="button-start">{{= i18n.misc.CONTINUE }}</button>\n    {{\n                        break;\n                    case CONFIG.enums.TASK_STATE_FAILD :\n                        if(it.forceRestart) {\n    }}\n    <button class="button-force-restart secondary">{{= i18n.taskManager.UNINSTALL_THEN_INSTALL }}</button>\n    <span class="button-delete link">{{= i18n.misc.DELETE }}</span>\n    {{\n                        } else if (it.message === \'NO_MORE_MEMORY\') {\n                            if (it.category === CONFIG.enums.MODEL_TYPE_APPLICATION) {\n    }}\n    <button class="button-change-location primary">{{= i18n.taskManager.CHANGE_INSTALL_LOCATION }}</button>\n    <span class="button-manage-app link">{{= i18n.taskManager.MANAGE_APP }}</span>\n    {{\n                            }\n    }}\n    <span class="button-delete link">{{= i18n.misc.DELETE }}</span>\n    {{\n                        } else if (it.message === \'NO_MORE_SDCARD\') {\n                            if (it.category === CONFIG.enums.MODEL_TYPE_APPLICATION) {\n    }}\n    <button class="button-install-to-device secondary">{{= i18n.taskManager.INSTALL_TO_DEVICE }}</button>\n    {{\n                            }\n    }}\n    <span class="button-manage-sd link">{{= i18n.taskManager.MANAGE_SD }}</span>\n    <span class="button-delete link">{{= i18n.misc.DELETE }}</span>\n    {{\n                        } else if (it.message === \'INSTALL_FAILED_MALICIOUS_APK\') {\n    }}\n    <button class="button-delete secondary">{{= i18n.taskManager.DELETE_TASK }}</button>\n    <span class="button-continue-install link">{{= i18n.taskManager.CONTINUE_INSTALL }}</span>\n    {{\n                        } else if (it.message === \'INSTALL_FAILED_DEVICE_NOT_FOUND\' ||\n                                it.message === \'CONNECTION_LOST\' ||\n                                it.message === \'DEVICE_NOT_FOUND\') {\n    }}\n    <button class="button-connect primary">{{= i18n.welcome.CONNECT_PHONE }}</button>\n    {{\n                        } else {\n                            if(!it.blockAction) {\n    }}\n    <button class="button-retry">{{= i18n.ui.RETRY }}</button>\n    {{\n                            }\n                        }\n                        break;\n                }\n                break;\n            case CONFIG.enums.TASK_TYPE_PUSH :\n                switch (it.state) {\n                    case CONFIG.enums.TASK_STATE_ADDED :\n    }}\n    <button class="button-start">{{= i18n.misc.CONTINUE }}</button>\n    {{\n                        break;\n                    case CONFIG.enums.TASK_STATE_SUCCESS :\n                        switch(it.category) {\n                            case CONFIG.enums.MODEL_TYPE_BOOK :\n    }}\n    <button class="button-open-on-device primary">{{= i18n.taskManager.LOOK_OVER }}</button>\n    {{\n\n                                break;\n                            case CONFIG.enums.MODEL_TYPE_PHOTO :\n    }}\n    <!--<button class="button-set-as-wallpaper primary">{{= i18n.taskManager.SET_AS_WALL_PAPER }}</button>-->\n    {{\n                                break;\n                        }\n                        break;\n                    case CONFIG.enums.TASK_STATE_FAILD :\n    }}\n    <button class="button-retry">{{= i18n.ui.RETRY }}</button>\n    {{\n                        break;\n                }\n                break;\n            case CONFIG.enums.TASK_TYPE_PARSING_VIDEO_URL:\n                switch (it.state) {\n                    case CONFIG.enums.TASK_STATE_FAILD :\n    }}\n    <button class="button-retry">{{= i18n.ui.RETRY }}</button>\n    {{\n                        break;\n                }\n                break;\n            case CONFIG.enums.TASK_TYPE_MERGE_VIDEO:\n                switch (it.state) {\n                    case CONFIG.enums.TASK_STATE_FAILD :\n    }}\n    <button class="button-retry">{{= i18n.ui.RETRY }}</button>\n    {{\n                        break;\n                }\n                break;\n        }\n    }}\n</script>\n\n<script type="text/x-ui-template" id="monitor-item">\n    <div class="content hbox">\n        <div class="icon {{= it.icon }}"></div>\n        <div class="desc text-secondary">{{= it.desc }}</div>\n    </div>\n</script>\n\n<script type="text/x-ui-template" id="task-ctn">\n    <div class="active item">\n        <div class="content hbox">\n            <div class="active-wrap">\n                <div class="icon"></div>\n            </div>\n            <div class="desc text-secondary"></div>\n        </div>\n    </div>\n    <div class="push item">\n        <div class="content hbox">\n            <div class="icon"></div>\n            <div class="desc text-secondary"></div>\n        </div>\n    </div>\n    <div class="error item">\n        <div class="content hbox">\n            <div class="icon"></div>\n            <div class="desc text-warning"></div>\n        </div>\n    </div>\n    <div class="cache item">\n        <div class="content hbox">\n            <div class="icon"></div>\n            <div class="desc text-secondary">{{= i18n.taskManager.NO_TASK_RUNNING }}</div>\n        </div>\n    </div>\n</script>\n\n<script type="text/x-ui-template" id="disconnect-tip">\n    <div class="w-task-popup-tip">\n        <h2>{{= i18n.taskManager.DEVICE_NOT_CONNECT }}</h2>\n        <p>{{= i18n.taskManager.DEVICE_NOT_CONNECT_TIP }}</p>\n        <div class="cf">\n            <button class="button-connect primary">{{= i18n.welcome.CONNECT_PHONE }}</button>\n        </div>\n        <div class="button-close"></div>\n    </div>\n</script>\n\n<script type="text/x-ui-template" id="confirm-tip">\n    <div class="w-task-popup-tip">\n        <h2>{{= i18n.taskManager.CONFIRM_ON_DEVICE }}</h2>\n        <p>{{= i18n.taskManager.CONFIRM_ON_DEVICE_TIP }}</p>\n        <div class="button-close"></div>\n    </div>\n</script>\n\n<script type="text/x-ui-template" id="confirm-miui-v5-tip">\n    <div class="w-task-popup-tip">\n        <h2>{{= i18n.taskManager.CONFIRM_ON_DEVICE }}</h2>\n        <p>{{= i18n.taskManager.CONFIRM_ON_DEVICE_MIUI_V5_TIP }}</p>\n        <div class="button-close"></div>\n    </div>\n</script>\n\n<script type="text/x-ui-template" id="disconnect-running-tip">\n    <div class="w-task-popup-tip">\n        <h2>{{= i18n.taskManager.DEVICE_DISCONNECT }}</h2>\n        <p>{{= i18n.taskManager.DEVICE_DISCONNECT_TIP }}</p>\n        <div class="button-close"></div>\n    </div>\n</script>\n\n<script type="text/x-ui-template" id="offline-task-added">\n    <div class="w-task-popup-tip">\n        <p>{{= StringUtil.format(i18n.taskManager.OFFLINE_TASK_TIP, it.count) }}</p>\n    </div>\n</script>\n\n<script type="text/x-ui-template" id="delete-monitor">\n    <input type="checkbox" class="check-delete-apk" checked />\n    {{= i18n.taskManager.DELET_APK_ALSO }}\n</script>\n\n<script type="x-ui-template" id="task-dashboard">\n    <li class="hbox">\n        <div class="icon speed"></div>\n        <div class="desc">{{= StringUtil.readableSize(it.speed) }}/s</div>\n    </li>\n    {{? it.active !== 0 }}\n    <li class="hbox">\n        <div class="icon active"></div>\n        <div class="desc">{{= StringUtil.format(i18n.taskManager.RUNNING_COUNT_TIP, it.active) }}</div>\n    </li>\n    {{?}}\n    {{? it.complete !== 0 }}\n    <li class="hbox">\n        <div class="icon complete"></div>\n        <div class="desc">{{= StringUtil.format(i18n.taskManager.COMPLETE_COUNT_TIP, it.complete) }}</div>\n    </li>\n    {{?}}\n    {{? it.error !== 0 }}\n    <li class="hbox">\n        <div class="icon error"></div>\n        <div class="desc">{{= StringUtil.format(i18n.taskManager.ERROR_COUNT_TIP, it.error) }}</div>\n    </li>\n    {{?}}\n</script>\n\n<script type="text/x-ui-template" id="out-of-space">\n    <div class="w-task-popup-tip">\n        <h2>{{= i18n.taskManager.OUT_OF_SPACE_WARN }}</h2>\n        <p>{{= i18n.taskManager.OUT_OF_SPACE_TIP }}</p>\n        <div class="cf">\n            <button class="button-change-disk primary">{{= i18n.taskManager.MODIFY_STORAGE_DISK }}</button>\n        </div>\n        <div class="button-close"></div>\n    </div>\n</script>\n\n<script type="text/x-ui-template" id="not-enough-space">\n    <div class="w-task-popup-tip">\n        <h2>{{= i18n.taskManager.NOT_ENOUGH_SPACE_WARN }}</h2>\n        <p>{{= i18n.taskManager.NOT_ENOUGH_SPACE_TIP }}</p>\n        <div class="cf">\n            <button class="button-change-disk primary">{{= i18n.taskManager.MODIFY_STORAGE_DISK }}</button>\n        </div>\n        <div class="button-close"></div>\n    </div>\n</script>\n</templates>\n'}),define("text!social/social.tpl",[],function(){return'<templates>\n<script type="text/x-ui-template" id="share">\n<div class="w-social-share-share">\n    <div class="header">\n        <span class="text-secondary">{{= i18n.common.SHARE_WIDGET_SHARE_TIP }}</span>\n        <span class="share-tip text-thirdly"></span>\n        <div class="w-ui-loading-small info_loading send-loading" >\n            <div class="anima">\n                <div class="rotor rotor1"></div>\n                <div class="rotor rotor2"></div>\n                <div class="rotor rotor3"></div>\n                <div class="rotor rotor4"></div>\n                <div class="rotor rotor5"></div>\n                <div class="rotor rotor6"></div>\n                <div class="rotor rotor7"></div>\n                <div class="rotor rotor8"></div>\n            </div>\n        </div>\n    </div>\n    <textarea class="input-content" placeholder="{{= i18n.common.SHARE_WIDGET_CONTENT_TIP_TEXT }}"></textarea>\n    <p class="pic-size-tip"></p>\n</div>\n</script>\n\n<script type="text/x-ui-template" id="facebook-share">\n<div class="w-social-share-share">\n    <p class="header">\n        <span>{{= i18n.common.SHARE_WIDGET_SHARE_TIP }}</span>\n        <a href="###" class="exit-oauth">{{= i18n.common.SHARE_WIDGET_EXIT_TEXT }}</a>\n        <span class="nickname"></span>\n    </p>\n\n    <textarea placeholder="{{= i18n.common.SHARE_WIDGET_CONTENT_TIP_TEXT }}"></textarea>\n    <p class="share-tip"></p>\n    <div class="w-ui-loading-small info_loading send-loading" >\n        <div class="anima">\n            <div class="rotor rotor1"></div>\n            <div class="rotor rotor2"></div>\n            <div class="rotor rotor3"></div>\n            <div class="rotor rotor4"></div>\n            <div class="rotor rotor5"></div>\n            <div class="rotor rotor6"></div>\n            <div class="rotor rotor7"></div>\n            <div class="rotor rotor8"></div>\n        </div>\n    </div>\n    <p class="pic-size-tip"></p>\n</div>\n</script>\n\n<script type="text/x-ui-template" id="social-platform-selector">\n    <span class="text-thirdly"{{= i18n.common.SHARE_TO }}</span>\n    <input type="checkbox" class="social-platform" data-type="sina" />\n    <input type="checkbox" class="social-platform" data-type="qzone" />\n    <input type="checkbox" class="social-platform" data-type="tqq" />\n    <input type="checkbox" class="social-platform" data-type="renren" />\n</script>\n\n<script type="text/x-ui-template" id="social-platform-selector-big">\n    <div class="big-ctn hbox">\n        <input type="checkbox" class="social-platform-big" data-type="sina" />\n        <span data-type="sina">{{= i18n.common.SHARE_TO_SINA }}</span>\n\n        <input type="checkbox" class="social-platform-big" data-type="qzone" />\n        <span data-type="qzone">{{= i18n.common.SHARE_TO_QQ }}</span>\n    </div>\n\n    <div class="big-ctn hbox">\n        <input type="checkbox" class="social-platform-big" data-type="tqq" />\n        <span data-type="tqq">{{= i18n.common.SHARE_TO_QZONE }}</span>\n\n        <input type="checkbox" class="social-platform-big" data-type="renren" />\n        <span data-type="renren">{{= i18n.common.SHARE_TO_RENREN }}</span>\n    </div>\n</script>\n\n<script type="text/x-ui-template" id="preview">\n    <div class="share-preview">\n        <h3 class="share-preview-header">{{= i18n.common.SHARE_WIDGET_PREVIEW_PIC }}</h3>\n        <a href="###" class="view-from-pc">{{= i18n.common.VIEW_PIC }}</a>\n        <div class="share-preview-content"></div>\n        <div class="w-ui-loading info_loading" >\n            <div class="anima">\n                <div class="rotor rotor1"></div>\n                <div class="rotor rotor2"></div>\n                <div class="rotor rotor3"></div>\n                <div class="rotor rotor4"></div>\n                <div class="rotor rotor5"></div>\n                <div class="rotor rotor6"></div>\n                <div class="rotor rotor7"></div>\n                <div class="rotor rotor8"></div>\n            </div>\n        </div>\n    </div>\n</script>\n\n<script type="text/x-ui-template" id="uninstall-share">\n    <div class="icon"></div>\n    <div>{{= i18n.misc.REVIEW_FOR_UNINSTALL_TIPS }}</div>\n    <ul class="item-ctn cf">\n        {{~ it.items : item }}\n        <li class="hbox" data-id="{{= item.id }}" data-name="{{= item.name }}">{{= item.name }}\n        </li>\n        {{~}}\n    </ul>\n</script>\n</templates>\n'}),define("text!music/iTunes/iTunes.tpl",[],function(){return'<templates>\n<script type="text/x-ui-tempate" id="select-library-content">\n    <h3>{{= i18n.music.SELECT_LIBRARY_TITLE }}</h3>\n    <ul class="select-library-list">\n        {{\n            _.each(it, function(item, index) {\n        }}\n                <li class="library-item">\n                    <label>\n                        <input type="radio" name="libraryItem" value="{{= index }}" class="w-ui-radio" {{? index === 0 }}checked="true"{{?}}>\n                        <span class="library-name">{{! item.name }}</span>\n                        <span class="library-time">({{= i18n.music.CREATE_TIME }}{{= item.time }})</span>\n                    </label>\n                </li>\n        {{\n            });\n        }}\n    </ul>\n</script>\n\n<script type="text/x-ui-tempate" id="select-source-content">\n    <h3>{{= i18n.music.SELECT_SOURCE_TITLE }}</h3>\n    <ul>\n        {{\n            _.each(it, function(item, index){\n        }}\n                <li>\n                    <label>\n                        <input type="radio" name="sourceType" value = "{{= index }}" class="w-ui-radio" {{? index === 0 }}checked="true"{{?}}>\n                        <span>{{= item.label }}</span>\n                    </label>\n                    {{? index === 0 }}\n                        <p class="source-tip">{{= i18n.music.SCANNING_TIP }}</p>\n                        <p class="less-capacity">{{= i18n.music.LESS_CAPACITY }}</p>\n                    {{?}}\n                </li>\n        {{\n            });\n        }}\n    </ul>\n</script>\n\n<script type="text/x-ui-tempate" id="iTunes-source-info">\n    {{? it.isSelected }}\n    {{= i18n.musci.ALREADY_SELECT }}\n    {{?}}\n    {{= StringUtil.format(i18n.music.SELECT_TIP, it.playlistCount, it.audiosCount, it.capacitySize) }}\n</script>\n\n<script type="text/x-ui-tempate" id="iTunes-import">\n    <h3>{{= it.title }}</h3>\n    <div class="progress-wrap"></div>\n</script>\n\n<script type="text/x-ui-tempate" id="import-progress">\n    <p class="{{= it.className }}{{? it.isFaild }} w-iTunes-error-tip{{?}}">\n        <span class="progress-tip">{{= it.tip }} </span>\n        <span class="progress-value">\n            <span class="current">{{= it.current }}</span>&nbsp;/&nbsp;<span class="total">{{= it.total }}</span>\n        </span>\n    </p>\n</script>\n\n<script type="text/x-ui-tempate" id="playlist">\n    <h3>{{= i18n.music.SELECT_PLAYLIST_FOR_IMPORT }}</h3>\n    <div class="playlist-content"></div>\n    <!--\n    <table class="playlist-content">\n        <thead>\n            <tr>\n                <th class="name"><input type="checkbox" class="total-checkbox">{{= i18n.music.PLAYLIST_NAME }}</th>\n                <th class="count">{{= i18n.music.AUDIOS_COUNT }}</th>\n            </tr>\n        </thead>\n        <tbody class="playlists">\n\n        </tbody>\n    </table>\n    -->\n</script>\n\n<script type="text/x-ui-tempate" id="playlist-item">\n    <tr>\n        <td class="name"><label><input type="checkbox" value="{{= it.id }}">{{= it.name }}</label></td>\n        <td class="count">{{= it.count }}</td>\n    </tr>\n</script>\n\n<script type="text/x-ui-tempate" id="audio-list">\n    <h3>{{= i18n.music.SELECT_FILES }}</h3>\n    <div class="audio-list-content"></div>\n</script>\n\n<script type="text/x-ui-tempate" id="audio-list-item">\n    <tr>\n        <td class="name"><label><input type="checkbox" value="{{= it.id }}">{{= it.title }}</label></td>\n        <td class="artist">{{= it.artist }}</td>\n        <td class="album">{{= it.album }}</td>\n        <td class="size">{{= it.size }}</td>\n    </tr>\n</script>\n</templates>\n'}),define("text!modules/photo/photo.tpl",[],function(){return'<templates>\n<script type="text/x-ui-template" id="photo-item">\n    <img class="thumb" src="">\n    <div class="control hbox">\n        <input type="checkbox" class="check-item dark">\n        <div class="placeholder"></div>\n        <div class="button-share"></div>\n        <div class="button-info"></div>\n    </div>\n    <div class="error text-thirdly">\n        {{= i18n.photo.GET_PHOTOS_ERROR }}\n        <div class="button-retry" title="{{= i18n.ui.RETRY }}"></div>\n    </div>\n</script>\n\n<script type="text/x-ui-template" id="photo-thread">\n    <header class="header">\n        <label class="label">\n            <input type="checkbox" class="checker" />\n            <span class="text-secondary" title="{{! it.key }}">{{! it.key }}</span>\n            <div class="count">{{= it.count }}</div>\n        </label>\n    </header>\n    <ul class="photo-ctn"></ul>\n</script>\n\n<script type="text/x-ui-template" id="photo-list">\n    <div class="spy"></div>\n    {{= TemplateFactory.get(\'ui\', \'loading\') }}\n    <div class="empty-tip text-secondary"></div>\n    <div class="mask"></div>\n</script>\n\n<script type="text/x-ui-template" id="slide-show">\n    <div class="top-control">\n    </div>\n    <div class="photo-ctn vbox">\n        <img class="photo hide" src="" alt="" />\n        <div class="button-previous hbox">\n            <div class="button"></div>\n        </div>\n        <div class="button-next hbox">\n            <div class="button"></div>\n        </div>\n        <div class="error">\n            {{= i18n.photo.GET_PHOTOS_ERROR }}\n            <div class="button-retry" title="{{= i18n.ui.RETRY }}"></div>\n        </div>\n    </div>\n    <div class="control">\n        <div class="tip"></div>\n        <div class="buttons hbox">\n            <div class="btn-ctn">\n                <div class="button button-rotate-left" title="{{= i18n.photo.ROTATE_LEFT }}"></div>\n                <div class="button button-rotate-right" title="{{= i18n.photo.ROTATE_RIGHT }}"></div>\n                <div class="button button-play" title="{{= i18n.photo.SLIDE_SHOW }}"></div>\n                <div class="split"></div>\n                <div class="button button-delete" title="{{= i18n.misc.DELETE }}"></div>\n                <div class="button button-export" title="{{= i18n.misc.EXPORT }}"></div>\n                <div class="button button-wallpaper" title="{{= i18n.photo.SET_AS_WALLPAPER }}" data-title="{{= i18n.photo.WALLPAPER_SETTING_SUCCESS_TEXT }}"></div>\n                <div class="button button-share" title="{{= i18n.common.SHARE }}"></div>\n            </div>\n        </div>\n    </div>\n    {{= TemplateFactory.get(\'ui\', \'loading-white\') }}\n    <div class="button-close"></div>\n</script>\n\n<script type="text/x-ui-template" id="local-import-body">\n    <div class="btn-ctn hbox">\n        <button class="button-add-file">{{= i18n.misc.ADD_FILE }}</button>\n        <button class="button-add-folder">{{= i18n.misc.ADD_FOLDER }}</button>\n        <div class="tip">{{= i18n.photo.FILE_SELECTOR_DESCRIPTION }}</div>\n    </div>\n    <div class="w-photo-local-import-list vbox">\n        <header class="w-smart-list-header w-photo-list-header text-secondary hbox">\n            <label class="check-select-all-wrap"><input class="check-select-all" type="checkbox" /></label>\n            <div class="preview">{{= i18n.photo.PREVIEW_TEXT }}</div>\n            <div class="title smart-list-sortable" data-smart-list-sortby="name" data-smart-list-sort-type="string">{{= i18n.photo.PICTURE_NAME }}</div>\n            <div class="format smart-list-sortable" data-smart-list-sortby="type" data-smart-list-sort-type="string">{{= i18n.photo.PICTURE_FORMAT }}</div>\n            <div class="size smart-list-sortable" data-smart-list-sortby="size" data-smart-list-sort-type="number">{{= i18n.photo.PICTURE_SIZE }}</div>\n        </header>\n    </div>\n</script>\n\n<script type="text/x-ui-template" id="photo-list-item">\n    <label class="input item-checker-wrap hbox"><input class="item-checker" type="checkbox" value="{{= it.id }}"></label>\n    <div class="preview">\n        <img src="file:///{{= it.thumbnail }}" alt="{{! it.name }}" />\n    </div>\n    <div class="title wc" title="{{! it.name }}">{{! it.name }}</div>\n    <div class="format">{{= it.type }}</div>\n    <div class="size">{{= StringUtil.readableSize(it.size) }}</div>\n</script>\n\n<script type="text/x-ui-template" id="toolbar">\n    <input type="checkbox" class="check-select-all" />\n    <button class="w-icon-btn primary button-import min">\n        <span class="icon add"></span>{{= i18n.photo.ADD_LAOCEL_PHOTO_LABEL }}\n    </button>\n    <button class="w-icon-btn button-delete min">\n        <span class="icon delete"></span>{{= i18n.misc.DELETE }}\n    </button>\n    <button class="w-icon-btn button-export min">\n        <span class="icon export"></span>{{= i18n.misc.EXPORT }}\n    </button>\n    <div class="split"></div>\n    <button class="w-icon-btn button-refresh min">\n        <span class="icon refresh"></span>{{= i18n.misc.REFRESH }}\n    </button>\n    <div class="split"></div>\n    <button class="w-icon-btn button-fullscreen min">\n        <span class="icon fullscreen"></span>{{= i18n.photo.SLIDE_PLAY_TEXT }}\n    </button>\n</script>\n\n<script type="text/x-ui-template" id="photo-sync-switch">\n    <div class="tip">{{= i18n.sync.CLOUD_PHOTO }}</div>\n    <div class="w-ui-switch-button button-sync">\n        <div class="switcher"></div>\n    </div>\n</script>\n\n<script type="text/x-ui-template" id="info">\n    <div>{{= i18n.misc.NAME }}{{! it.display_name }}</div>\n    <div>{{= i18n.misc.DATE }}{{= StringUtil.formatDate(\'yyyy-MM-dd\', it.date) }}</div>\n    <div>{{= i18n.misc.FILE_SIZE }}{{= StringUtil.readableSize(it.size) }}</div>\n</script>\n\n<script type="text/x-ui-template" id="gallery">\n    <header class="w-list-tab-header">\n        <menu class="tab hbox">\n            <li class="hbox" data-tab="phone">\n                <div>{{= i18n.misc.NAV_PIC_PHONE_LIB }}</div>\n                <div class="count">{{= it.phone }}</div>\n            </li>\n            <li class="hbox" data-tab="lib">\n                <div>{{= i18n.misc.NAV_PIC_GALLERY }}</div>\n                <div class="count">{{= it.lib }}</div>\n            </li>\n            {{? FunctionSwitch.ENABLE_PHOTO_SYNC }}\n            <li class="hbox" data-tab="cloud">\n                <div>{{= i18n.misc.NAV_PIC_CLOUD }}</div>\n                <div class="count">{{= it.cloud }}</div>\n            </li>\n            {{?}}\n        </menu>\n        <div class="pointer"></div>\n    </header>\n</script>\n</templates>\n'}),define("text!contact/contact.tpl",[],function(){return'<templates>\n<script type="tetx/x-ui-template" id="detail-panel">\n\n</script>\n\n<script type="text/x-ui-template" id="detail-panel-edit">\n    <div class="contact-info">\n        <div class="header-ctn hbox">\n            <div class="avatar button-avatar">\n                <img src="{{= it.contact.avatar }}" alt="{{! it.contact.name ? (it.contact.name.display_name || \'\') : \'\' }}" />\n                <div class="mask">\n                    <div class="tip">{{= i18n.contact.CHANGE_AVATAR }}</div>\n                </div>\n            </div>\n            <div class="infos vbox">\n                <div class="name">\n                    <input data-id="{{= it.contact.name ? it.contact.name.id : \'\' }}" class="input-name" type="text" value="{{! it.contact.displayName || \'\' }}" placeholder="{{= i18n.contact.NAME }}" />\n                </div>\n                <div class="nickname">\n                     <input data-id="{{= (it.contact.nickname && it.contact.nickname[0] && it.contact.nickname[0].id) || \'\' }}" class="input-nickname" type="text" value="{{! (it.contact.nickname && it.contact.nickname[0] && it.contact.nickname[0].name) || \'\' }}" placeholder="{{= i18n.contact.NICKNAME }}" />\n\n                </div>\n                <div class="switch text-secondary"></div>\n            </div>\n        </div>\n        <h1 class="text-primary">{{= i18n.contact.CONTACT_INFO }}</h1>\n        <ul class="info-ctn cf">\n            <li class="phone">\n                <dl>\n                    {{? it.contact.phone }}\n                        {{~ it.contact.phone : phone }}\n                        <dt class="type text-secondary" data-cate="phone" data-type="{{= phone.type }}" data-label="{{= phone.label }}"></dt>\n                        <dd class="wc enable-select">\n                            <input data-id="{{= phone.id }}" data-type="{{= phone.type }}" data-label="{{= phone.label }}" class="input-phone" type="text" value="{{! phone.number || \'\' }}" />\n                            <span class="button-delete" title="{{= i18n.contact.DELETE }}"></span>\n                        </dd>\n                        {{~}}\n                    {{??}}\n                        <dt class="type text-secondary" data-cate="phone"></dt>\n                        <dd class="wc enable-select">\n                            <input data-type="1" class="input-phone" type="text" />\n                        </dd>\n                    {{?}}\n                </dl>\n            </li>\n            <li class="email">\n                <dl>\n                    {{? it.contact.email }}\n                        {{~ it.contact.email : email }}\n                        <dt class="type text-secondary" data-cate="email" data-type="{{= email.type }}" data-label="{{= email.label }}"></dt>\n                        <dd class="wc enable-select">\n                            <input data-id="{{= email.id }}" data-type="{{= email.type }}" data-label="{{= email.label }}" class="input-email" type="email" value="{{! email.address || \'\' }}" pattern="^[a-zA-Z0-9.!#$%&’*+/=?^_`{|}~-]+@[a-zA-Z0-9-]+(?:\\.[a-zA-Z0-9-]+)*$" />\n                            <span class="button-delete" title="{{= i18n.contact.DELETE }}"></span>\n                        </dd>\n                        {{~}}\n                    {{??}}\n                        <dt class="type text-secondary" data-cate="email"></dt>\n                        <dd class="wc enable-select">\n                            <input data-type="1" class="input-email" type="email" pattern="^[a-zA-Z0-9.!#$%&’*+/=?^_`{|}~-]+@[a-zA-Z0-9-]+(?:\\.[a-zA-Z0-9-]+)*$" />\n                        </dd>\n                    {{?}}\n                </dl>\n            </li>\n            <li class="im">\n                <dl>\n                    {{? it.contact.IM }}\n                        {{~ it.contact.IM : im }}\n                        <dt class="type text-secondary" data-cate="im" data-type="{{= im.protocol }}" data-label="{{= im.label }}"></dt>\n                        <dd class="wc enable-select">\n                            <input data-type="{{= im.protocol }}" data-id="{{= im.id }}" data-label="{{= im.label }}" class="input-im" type="text" value="{{! im.data || \'\' }}"/>\n                            <span class="button-delete" title="{{= i18n.contact.DELETE }}"></span>\n                        </dd>\n                        {{~}}\n                    {{?}}\n                </dl>\n            </li>\n            <li class="address">\n                <dl>\n                    {{? it.contact.address }}\n                        {{~ it.contact.address : address }}\n                        <dt class="type text-secondary" data-cate="address" data-type="{{= address.type }}" data-label="{{= address.label }}"></dt>\n                        <dd class="wc enable-select">\n                            <input data-type="{{= address.type }}" data-id="{{= address.id }}" data-label="{{= address.label }}" class="input-address" type="text" value="{{! address.formatted_address || \'\' }}"/>\n                            <span class="button-delete" title="{{= i18n.contact.DELETE }}"></span>\n                        </dd>\n                        {{~}}\n                    {{?}}\n                </dl>\n            </li>\n            <li class="organization">\n                <dl>\n                    {{? it.contact.organization }}\n                        {{~ it.contact.organization : organization }}\n                        <dt class="type text-secondary" data-cate="org" data-type="{{= organization.type }}" data-label="{{= organization.label }}"></dt>\n                        <dd class="wc enable-select">\n                            <input data-type="{{= organization.type }}" data-id="{{= organization.id }}" data-label="{{= organization.label }}" class="input-organization" type="text" value="{{! organization.company || \'\' }}"/>\n                            <span class="button-delete" title="{{= i18n.contact.DELETE }}"></span>\n                        {{~}}\n                    {{?}}\n                </dl>\n            </li>\n            <li>\n                <dl>\n                    {{? it.contact.note }}\n                        {{~ it.contact.note : note }}\n                        <dt class="type text-secondary" data-cate="note">{{= i18n.contact.REMARK }}</dt>\n                        <dd class="wc enable-select">\n                            <textarea data-id="{{= note.id }}" class="input-note">{{! note.note || \'\' }}</textarea>\n                            <span class="button-delete" title="{{= i18n.contact.DELETE }}"></span>\n                        </dd>\n                        {{~}}\n                    {{??}}\n                        <dt class="type text-secondary" data-cate="note">{{= i18n.contact.REMARK }}</dt>\n                        <dd class="wc enable-select">\n                            <textarea data-id="" class="input-note"></textarea>\n                        </dd>\n                    {{?}}\n                </dl>\n            </li>\n            <li class="account-label">\n                <dl>\n                    <dt class="type text-secondary">{{= i18n.contact.ACCOUNT }}<dt>\n                    <dd class="account-ctn"></dd>\n                </dl>\n            </li>\n        </ul>\n        <div class="category-selector"></div>\n    </div>\n    <div class="btn-ctn">\n        <button class="button-save primary">{{= i18n.contact.SAVE }}</button>\n        <button class="button-cancel">{{= i18n.contact.CANCEL }}</button>\n    </div>\n</script>\n\n<script type="text/x-ui-tempalte" id="edit-phone">\n    <dt class="type text-secondary" data-cate="phone"></dt>\n    <dd class="wc enable-select">\n        <input data-type="1" class="input-phone" type="text" />\n        <span class="button-delete" title="{{= i18n.contact.DELETE }}"></span>\n    </dd>\n</script>\n\n<script type="text/x-ui-tempalte" id="edit-email">\n    <dt class="type text-secondary" data-cate="email"></dt>\n    <dd class="wc enable-select">\n        <input data-type="1" class="input-email" type="email" pattern="^[a-zA-Z0-9.!#$%&’*+/=?^_`{|}~-]+@[a-zA-Z0-9-]+(?:\\.[a-zA-Z0-9-]+)*$" />\n        <span class="button-delete" title="{{= i18n.contact.DELETE }}"></span>\n    </dd>\n</script>\n\n<script type="text/x-ui-tempalte" id="edit-im">\n    <dt class="type text-secondary" data-cate="im"></dt>\n    <dd class="wc enable-select">\n        <input data-type="1" class="input-im" type="text" />\n        <span class="button-delete" title="{{= i18n.contact.DELETE }}"></span>\n    </dd>\n</script>\n\n<script type="text/x-ui-tempalte" id="edit-address">\n    <dt class="type text-secondary" data-cate="address"></dt>\n    <dd class="wc enable-select">\n        <input data-type="1" class="input-address" type="text" />\n        <span class="button-delete" title="{{= i18n.contact.DELETE }}"></span>\n    </dd>\n</script>\n\n<script type="text/x-ui-tempalte" id="edit-organization">\n    <dt class="type text-secondary" data-cate="org"></dt>\n    <dd class="wc enable-select">\n        <input data-type="1" class="input-organization" type="text" />\n        <span class="button-delete" title="{{= i18n.contact.DELETE }}"></span>\n    </dd>\n</script>\n\n<script type="text/x-ui-template" id="batch-contacts">\n    <div class="title">\n        <span class="count"></span>\n        <span class="button-deselect link">{{= i18n.misc.DESELECT }}</span>\n    </div>\n    <div class="actions">\n        <button class="button-send">{{= i18n.message.SEND_SMS }}</button>\n    </div>\n    <div class="w-contact-batch-contacts-list-ctn vbox"></div>\n</script>\n\n<script type="text/x-ui-template" id="contact-item">\n    <label class="input item-checker-wrap">\n        <input class="item-checker" type="checkbox" value="{{= it.id }}">\n    </label>\n    <div class="star hbox{{? it.starred }} starred{{?}}">\n        <div class="star-img button-star"></div>\n    </div>\n    <div class="avatar">\n        <img src="{{= it.avatarSmall }}" alt="{{! it.displayName || i18n.contact.UNNAMED_CONTACT }}" />\n    </div>\n    <div class="body">\n        <div class="name wc">{{! it.displayName || i18n.contact.UNNAMED_CONTACT }}</div>\n        <div class="wc text-thirdly">\n            {{? it.phone && it.phone.length > 0 }}\n            {{=\n                _.map(it.phone, function(phone) {\n                    return phone.number;\n                }).join(\', \')\n            }}\n            {{??}}\n            {{=\n                _.map(it.email, function(email) {\n                    return email.address;\n                }).join(\', \')\n            }}\n            {{?}}\n        </div>\n    </div>\n    <ul class="group-menu hbox">\n        {{\n            var TAG_COLORS = [\'#f95159\', \'#f7ef20\', \'#49a7ee\', \'#95ab2f\', \'#f98729\', \'#5886f4\', \'#ab74ff\'];\n            var tagColor;\n            var group;\n        }}\n        {{~ it.group : item }}\n        {{\n            group = this.getGroup(item.group_row_id);\n        }}\n        {{? group }}\n            {{ tagColor = TAG_COLORS[Math.floor(parseInt(group.id) % TAG_COLORS.length)]; }}\n            <li style="background-color: {{= tagColor }}"></li>\n        {{?}}\n        {{~}}\n    </ul>\n    <div class="button-close" data-id="{{= it.id }}" title="{{= i18n.misc.DESELECT }}"></div>\n</script>\n\n<script type="text/x-ui-template" id="group-list">\n    {{\n        var TAG_COLORS = [\'#f95159\', \'#f7ef20\', \'#49a7ee\', \'#95ab2f\', \'#f98729\', \'#5886f4\', \'#ab74ff\'];\n        var tagColor;\n        var group;\n    }}\n    <ul class="group-menu hbox">\n        {{~ it.group : item }}\n        {{\n            group = this.getGroup(item.group_row_id);\n        }}\n        {{? group }}\n            {{ tagColor = TAG_COLORS[Math.floor(parseInt(group.id) % TAG_COLORS.length)]; }}\n            <li style="background-color: {{= tagColor }}"></li>\n        {{?}}\n        {{~}}\n    </ul>\n    <ul class="group-list">\n        {{~ it.group : item }}\n        {{\n            group = this.getGroup(item.group_row_id);\n        }}\n        {{? group }}\n            {{ tagColor = TAG_COLORS[Math.floor(parseInt(group.id) % TAG_COLORS.length)]; }}\n            <li class="cf hbox"><div class="squar" style="background-color: {{= tagColor }}"></div>{{= group.get(\'title\') }}</li>\n        {{?}}\n        {{~}}\n    </ul>\n</script>\n\n<script type="text/x-ui-template" id="add-group-body">\n    <label>{{= i18n.contact.GROUP_NAME }}<input class="input-group-name" type="text" autofocus="true" placeholder="{{= i18n.contact.GROUP_NAME_PLACEHOLDER }}" /></label>\n</script>\n\n<script type="text/x-ui-template" id="import-backup">\n    <div class="tip">\n        <label class="select-file" >{{= i18n.contact.SELECT_BACKUP_FILE }}</label>\n    </div>\n    <div class="header hbox">\n        <div class="backup-record" >{{= i18n.contact.BACKUP_RECORD }}</div>\n        <div class="contact-number" >{{= i18n.contact.BACKUP_MESSAGE_NUMBER }}</div>\n    </div>\n    <div class="list-ctn">\n        <div class="loading">{{= i18n.common.LOADING }}</div>\n        <ul class="list">\n            {{~ it.list : item }}\n            <li>\n                <label class="item-wrap hbox">\n                    <input class="file-radio" type="radio" name="backup" value="{{= item.file_path }}" />\n                    <div class="date">{{= StringUtil.formatDate("yyyy-MM-dd", item.date) }}</div>\n                    <div class="title" title="{{= item.file_path }}">{{= item.device_title }}</div>\n                    <div class="count">{{= item.number }}</div>\n                </label>\n            </li>\n            {{~}}\n        </ul>\n    </div>\n</script>\n\n<script type="text/x-ui-template" id="quick-add">\n    <header>\n        {{= i18n.contact.CONTACT_INTRO }}\n    </header>\n    <h3 class="legend">\n        <span class="icon" />{{= i18n.contact.QUICK_ADD_CONTACT }}\n    </h3>\n    <form class="new-contact" onsubmit="javascript: return false;">\n        <dl class="cf">\n            <dt><label for="w-contact-quick-add-name">{{= i18n.contact.NAME }}</label></dt>\n            <dd><input id="w-contact-quick-add-name" name="name" type="text" class="input-name" /></dd>\n            <dt><label for="w-contact-quick-add-phone">{{= i18n.contact.CELL_PHONE }}</label></dt>\n            <dd><input id="w-contact-quick-add-phone" name="phone" type="text" class="input-phone" /></dd>\n            <dt><label for="w-contact-quick-add-email">{{= i18n.contact.EMAIL }}</label></dt>\n            <dd><input id="w-contact-quick-add-email" name="email" type="email" class="input-email" pattern="^[a-zA-Z0-9.!#$%&’*+/=?^_`{|}~-]+@[a-zA-Z0-9-]+(?:\\.[a-zA-Z0-9-]+)*$" /></dd>\n            <dt><label for="w-contact-quick-add-account">{{= i18n.contact.ACCOUNT }}</label></dt>\n            <dd class="account-ctn"></dd>\n        </dl>\n    </form>\n    <div class="btn-ctn hbox">\n        <button type="button" class="button-save primary">{{= i18n.contact.SAVE }}</button>\n        <div class="running">\n        <div class="w-ui-loading-small" style="display: block; ">\n            <div class="anima">\n                <div class="rotor rotor1"></div>\n                <div class="rotor rotor2"></div>\n                <div class="rotor rotor3"></div>\n                <div class="rotor rotor4"></div>\n                <div class="rotor rotor5"></div>\n                <div class="rotor rotor6"></div>\n                <div class="rotor rotor7"></div>\n                <div class="rotor rotor8"></div>\n            </div>\n        </div>\n        </div>\n        <span class="hint text-secondary"></span>\n    </div>\n</script>\n\n<script type="text/x-ui-template" id="contact-main">\n    <div class="w-contact-ctn hbox"></div>\n</script>\n\n<script type="text/x-ui-template" id="toolbar">\n    <input type="checkbox" class="check-select-all" />\n    <button class="w-icon-btn primary button-new min">\n        <span class="icon add"></span>{{= i18n.contact.BUTTON_ADD_CONTACT_LABEL }}\n    </button>\n    <button class="w-icon-btn button-delete min">\n        <span class="icon delete"></span>{{= i18n.misc.DELETE }}\n    </button>\n    <button class="w-icon-btn button-merge min">\n        <span class="icon merge"></span>{{= i18n.contact.MERGE }}\n    </button>\n    <div class="split"></div>\n    <button class="w-icon-btn button-import min">\n        <span class="icon import"></span>{{= i18n.misc.IMPORT }}\n    </button>\n    <button class="w-icon-btn button-export min">\n        <span class="icon export"></span>{{= i18n.misc.EXPORT }}\n    </button>\n    <div class="split"></div>\n    <button class="w-icon-btn button-refresh min">\n        <span class="icon refresh"></span>{{= i18n.misc.REFRESH }}\n    </button>\n    <div class="selector-wrap hbox">\n        {{? Environment.get(\'locale\') === CONFIG.enums.LOCALE_DEFAULT ||\n                Environment.get(\'locale\') === CONFIG.enums.LOCALE_ZH_CN }}\n        <div>{{= i18n.misc.DISPLAY }}</div>\n        {{?}}\n    </div>\n</script>\n\n<script type="text/x-ui-template" id="list-ctn">\n    <header class="count-tip text-secondary"></header>\n</script>\n\n<script type="x-ui-template" id="custom-info">\n<label>{{= i18n.contact.LABEL }}<input type="text" class="input-label" /></label>\n</script>\n\n<script type="text/x-ui-template" id="contact-sim-tip">\n    <div class="w-contact-sim-tip">\n        <h1>{{= i18n.contact.CONTACT_SIM_SELECT_TEXT_1 }}</h1>\n        <p>{{= i18n.contact.CONTACT_SIM_SELECT_TEXT_2 }}</p>\n        <div class="sim-tip"></div>\n    </div>\n</script>\n\n<script type="text/template" id="export-select-type">\n    <p class="title">{{= i18n.contact.SELECT_EXPORT_FORMAT }}</p>\n    <ul>\n        <li>\n            <label>\n                <input type="radio" name="contact-export-type" value="0" checked />\n                {{= i18n.contact.V_CARD }}<span class="text-secondary">{{= i18n.contact.GROUP_TIP }}</span>\n            </label>\n        </li>\n        <li>\n            <label>\n                <input type="radio" name="contact-export-type" value="1" />\n                {{= i18n.contact.OUTLOOK }}\n            </label>\n        </li>\n        <li>\n            <label>\n                <input type="radio" name="contact-export-type" value="2" />\n                {{= i18n.contact.WINDOW_MAIN }}\n            </label>\n        </li>\n        <li>\n            <label>\n                <input type="radio" name="contact-export-type" value="3" />\n                {{= i18n.contact.NOKIA }}\n            </label>\n        </li>\n    </ul>\n</div></script>\n\n<script type="text/template" id="export-tip">\n    <p class="tip">{{= it.tip }}</p>\n    <p>{{= i18n.contact.ALERT_TIP_EXOPRT_VCARD }}</p>\n</script>\n\n<script type="text/template" id="export-select-number">\n    <p>{{= i18n.contact.SELECT_COUNTACTS_TO_EXPORT }}</p>\n    <ul>\n        <li>\n            <label>\n                <input type="radio" name="contact-export" value="1" checked />\n                {{= i18n.contact.CURRENT_SELECT }}\n                <span class="count">({{= it.selectNumber }})</span>\n            </label>\n        </li>\n        <li>\n            <label>\n                <input type="radio" name="contact-export" value="2" />\n                {{= i18n.contact.ALL_CONTACT }}\n                <span class="count">({{= it.allNumber }})</span>\n            </label>\n        </li>\n        <li>\n            <label>\n                <input type="radio" name="contact-export" value="3" />\n                {{= i18n.contact.CONTACT_HAS_NUMBER }}\n                <span class="count">({{= it.hasPhoneNumber }})</span>\n            </label>\n        </li>\n        <li class="hbox">\n            <label>\n                <input type="radio" name="contact-export" value="4" />\n                {{= i18n.contact.GROUP }}\n            </label>\n            <span class="account"></span>\n        </li>\n    </ul>\n</script>\n\n<script type="text/template" id="export-progress">\n    <div class="hbox">\n        <div class="progress-desc">{{= i18n.contact.EXPORT_PROGRESS_DESC2 }}</div>\n        <div class="progress-num">0 / 0</div>\n    </div>\n    <div class="progress-ctn hbox">\n        <progress class="tiny running" max="100" value="0"></progress>\n    </div>\n</script>\n\n<script type="text/x-ui-template" id="avatar-editor">\n    <div class="ctrl-ctn hbox">\n        <div>{{= i18n.contact.EDIT_CONTACT_HEAD_SELECT_SOURCE }}</div>\n        <div class="btn-ctn">\n            <button class="button-select-from-pc">{{= i18n.contact.EDIT_CONTACT_HEAD_PC_SOURCE }}</button>\n        </div>\n        <div class="link button-delete">{{= i18n.contact.EDIT_CONTACT_HEAD_DEL_TEXT }}</div>\n    </div>\n</script>\n\n<script type="text/x-ui-template" id="avatar-list">\n    <div class="spy"></div>\n    {{= TemplateFactory.get(\'ui\', \'loading\') }}\n    <div class="empty-tip text-secondary"></div>\n</script>\n\n<script type="text/x-ui-template" id="avatar-list-item">\n    <img class="thumb" src="">\n    <div class="error text-thirdly">\n        {{= i18n.photo.GET_PHOTOS_ERROR }}\n        <div class="button-retry" title="{{= i18n.ui.RETRY }}"></div>\n    </div>\n    <!--<div class="w-ui-loading"></div>-->\n</script>\n\n<script type="text/x-ui-template" id="avatar-list-thread">\n    <header class="header">\n        <span class="text-secondary" title="{{! it.key }}">{{! it.key }}</span>\n        <div class="count">{{= it.count }}</div>\n    </header>\n    <ul class="photo-ctn"></ul>\n</script>\n\n<script type="text/template" id="import-file-select">\n    <p class="title">{{= i18n.contact.SELECT_CONATCTS_BAKCUP_FILE }}</p>\n    <div>\n          <input name="file" type="text" class="file" readonly></input>\n          <span class="browser"></span>\n    </div>\n    <p class="invalid" style="display:none">{{= i18n.contact.INVALID_BAKCUP_FILE }}</p>\n</script>\n\n<script type="text/template" id="import-account-select">\n   <p class="title">{{= i18n.contact.SELECT_ACCOUNT_TO_IMPORT }}</p>\n</script>\n\n<script type="text/template" id="import-progress">\n    <div class="hbox">\n        <div class="progress-desc">{{= i18n.contact.IMPORTING_CONTACT }}</div>\n        <div class="progress-num">0 / 0</div>\n    </div>\n    <div class="progress-ctn hbox">\n        <progress class="tiny running" max="100" value="0"></progress>\n    </div>\n    <div class="duplicate-ctn">\n        <span class="duplicate text-thirdly"></span>\n    </div>\n</script>\n\n</templates>\n'}),define("text!welcome/welcome.tpl",[],function(){return'<templates>\n<script type="text/x-ui-template" id="welcome">\n    <div class="content hbox"></div>\n    <footer class="hbox"></footer>\n</script>\n\n<script type="text/x-ui-template" id="device">\n    <div class="stage-ctn">\n        <div class="screen-wrap">\n            <div class="screen-ctn vbox">\n                <div class="screen">\n                    <img alt="" />\n                </div>\n            </div>\n        </div>\n        <div class="tip">\n            <div class="ctn hbox">\n                <div class="icon"></div>\n                <div class="des"></div>\n            </div>\n        </div>\n        {{= TemplateFactory.get(\'ui\', \'loading-white\') }}\n        <button class="w-icon-btn button-set-ring">\n            <span class="icon ring"></span>{{= i18n.welcome.EDIT_RING }}\n        </button>\n    </div>\n</script>\n\n<script type="x-ui-template" id="billboard">\n    <div class="ctn">\n        <iframe id="wdj-iframe-billboard" class="w-layout-hidden" src="{{= it.url }}"></iframe>\n        {{= TemplateFactory.get(\'ui\', \'loading\') }}\n    </div>\n</script>\n\n<script type="x-ui-template" id="device-tools">\n    <div class="btns">\n        <span class="w-ui-buttongroup screen-shot-setting">\n            <button class="w-icon-btn min button-screen-shot" data-title="{{= i18n.welcome.SCREEN_SHOT_TEXT }}">\n                {{= i18n.welcome.SCREEN_SHOT_TEXT }}\n            </button>\n        </span>\n        <span class="w-ui-buttongroup">\n            <button class="w-icon-btn min img button-play" data-title="{{= i18n.welcome.PLAY_BTN_TEXT }}">\n                <span class="icon play-black"></span>\n            </button>\n            <button class="w-icon-btn min img button-refresh" data-title="{{= i18n.welcome.REFRESH_BTN_TEXT }}">\n                <span class="icon refresh-black"></span>\n            </button>\n            <button class="w-icon-btn min img button-fullscreen" data-title="{{= i18n.welcome.FULLSCREEN_BTN_TEXT }}">\n                <span class="icon fullscreen-black"></span>\n            </button>\n        </span>\n        <button class="w-icon-btn min img button-share" data-title="{{= i18n.common.SHARE }}">\n            <span class="icon share-black"></span>\n        </button>\n    </div>\n    <div class="usb-tip text-secondary">\n        <div class="icon info"></div>\n        {{= i18n.misc.SCREEN_SHOT_UNDER_USB }}\n    </div>\n</script>\n\n<script type="text/x-ui-template" id="capacity">\n    {{ var percent = parseInt((it.internalCapacity - it.internalFreeCapacity) / it.internalCapacity * 100, 10); }}\n    <div class="phone-capacity hbox{{? percent >= 90 }} outofspace{{?}}">\n        <div class="icon" data-title="{{= i18n.app.PHONE }}"></div>\n        <progress class="progress tiny{{? percent >= 90 }} highlight{{?}}" max="100" value="{{= percent }}" />\n        <div class="ratio text-secondary">\n            <span class="{{? percent >= 90 }}text-warning{{?}}">{{= StringUtil.readableSize(it.internalCapacity - it.internalFreeCapacity) }}</span> / {{= StringUtil.readableSize(it.internalCapacity) }}\n        </div>\n    </div>\n    {{ var percent =  parseInt((it.externalCapacity - it.externalFreeCapacity) / it.externalCapacity * 100, 10); }}\n    <div class="external-capacity hbox{{? percent >= 90 }} outofspace{{?}}">\n        <div class="icon" data-title="{{= i18n.app.SD_CARD }}"></div>\n        <progress class="progress tiny{{? percent >= 90 }} highlight{{?}}" max="100" value="{{= percent }}" />\n        <div class="ratio text-secondary">\n            <span class="{{? percent >= 90 }}text-warning{{?}}">{{= StringUtil.readableSize(it.externalCapacity - it.externalFreeCapacity) }}</span> / {{= StringUtil.readableSize(it.externalCapacity) }}\n        </div>\n    </div>\n</script>\n\n<script type="text/x-ui-template" id="file-tools">\n    <button class="button-open-sd min">{{= i18n.welcome.TOOL_SD }}</button>\n    <button class="button-backup min">{{= i18n.welcome.TOOL_BACKUP }}</button>\n    <span class="w-ui-buttongroup auto-backup-ctn">\n        <button class="button-group-backup min">{{= i18n.welcome.TOOL_BACKUP }}</button>\n        <button class="w-icon-btn img min button-auto-backup">\n            <span class="icon open-folder-black"></span>\n        </button>\n    </span>\n    <button class="button-restore min">{{= i18n.welcome.TOOL_RECOVERY }}</button>\n</script>\n\n<script type="text/x-ui-template" id="connection-guide">\n    <div class="content-ctn">\n        <div class="tips-ctn">\n            <h1>{{= i18n.welcome.CONNECT_UR_PHONE }}</h1>\n            <div class="tips text-secondary">{{= i18n.welcome.CONNECTION_TIP }}</div>\n            <button class="primary button-connect max">{{= i18n.welcome.CONNECT_PHONE }}</button>\n        </div>\n    </div>\n</script>\n\n<script type="text/x-ui-template" id="one-key-move-tip">\n    <div>\n        <span class="des">{{= i18n.common.PHONE_CAPACITY_TIP }}</span>\n        <span class="link button-one-key-move">{{= i18n.common.PHONE_CAPACITY_ACTION }}</span>\n    </div>\n</script>\n\n<script type="text/x-ui-template" id="open-sd-tip">\n    <div>\n        <span class="des">{{= i18n.common.SD_CAPACITY_TIP }}</span>\n        <span class="link button-open-sd-card">{{= i18n.common.SD_CAPACITY_ACTION }}</span>\n    </div>\n</script>\n\n<script type="text/x-ui-template" id="flash-tip">\n    <div class="w-welcome-flash-tip hbox">\n        <div class="pic-ctn"></div>\n        <div class="content-ctn">\n            <h2 class="title">{{= i18n.welcome.FLASH_TIP_TITLE }}</h2>\n            <div class="desc">{{= i18n.welcome.FLASH_TIP_DESC }}</div>\n        </div>\n        <div class="button-close"></div>\n    </div>\n</script>\n</templates>\n'}),define("text!sync/sync.tpl",[],function(){return'<templates>\n<script type="text/x-ui-template" id="photo-sync">\n    <span class="text-tip"></span>\n    <div class="split"></div>\n    <span class="link button-open-url">{{= i18n.common.VIEW }}</span>\n    <span class="link button-open-photosync">{{= i18n.common.OPEN }}</span>\n    <span class="link button-close-photosync">{{= i18n.photo.CLOSE_PHOTO_SYNC }}</span>\n</script>\n\n<script type="text/x-ui-template" id="tip">\n    <p class="tip1"></p>\n</script>\n\n<script type="text/x-ui-template" id="auto-backup-complete-notify">\n    <div class="hbox wrap cf">\n        <div class="pic-ctn"></div>\n        <div class="content-ctn">\n            <h2 class="header-text">{{= i18n.backup_restore.AUTO_BACKUP_COMPLETE_FINISH }}</h2>\n            <p class="content text-secondary">{{= it.content }}</p>\n            <p class="text-secondary">{{= i18n.backup_restore.AUTO_BACKUP_COMPLETE_FINISH_TIP }}</p>\n        </div>\n    </div>\n    <div class="hbox footer-ctn">\n        <button class="primary button-open">{{= i18n.welcome.SHOW_FILE }}</button>\n    </div>\n</script>\n\n<script type="text/x-ui-template" id="download-photo-notify">\n    <div class="hbox wrap cf">\n        <div class="pic-ctn"></div>\n        <div class="content-ctn">\n            <h2 class="header-text">{{= StringUtil.format(i18n.backup_restore.PHOTO_DOWNLOAD_NOTIFY_TITLE, it.num) }}</h2>\n            <p class="content text-secondary">{{= i18n.backup_restore.PHOTO_DOWNLOAD_NOTIFY_CONTENT }}</p>\n        </div>\n    </div>\n    <div class="hbox footer-ctn">\n        <button class="primary button-open">{{= i18n.welcome.SHOW_FILE }}</button>\n    </div>\n</script>\n\n<script type="text/x-ui-template" id="open-sync">\n    <div class="hbox wrap cf">\n        <div class="pic-ctn"></div>\n        <div class="content-ctn">\n            <h2 class="header-text">{{= i18n.backup_restore.SYNC_PHOTO_PUSH_NOTIFY_TITLE }}</h2>\n            <p class="content text-secondary">{{= StringUtil.format(i18n.backup_restore.SYNC_PHOTO_PUSH_NOTIFY_CONTENT, it.num) }}</p>\n        </div>\n    </div>\n    <div class="hbox footer-ctn">\n        <button class="primary button-open">{{= i18n.backup_restore.SYNC_PHOTO_OPEN }}</button>\n    </div>\n</script>\n\n<script type="text/x-ui-template" id="backup-guide">\n    <div class="hbox wrap cf">\n        <div class="pic-ctn"></div>\n        <div class="content-ctn">\n            <h2 class="header-text">{{= it.content }}</h2>\n            <p class="text-secondary">{{= i18n.backup_restore.BACKUP_GUIDE_CONTENT }}</p>\n        </div>\n    </div>\n    <div class="hbox footer-ctn">\n        <button class="primary button-open">{{= i18n.backup_restore.BACKUP_GUIDE_NOW }}</button>\n    </div>\n</script>\n\n<script type="text/x-ui-template" id="account-guide-body">\n    <div class="guide-header hbox"></div>\n    <div class="guide-split"><div class="icon"></div></div>\n    <div class="guide-content hbox"></div>\n</script>\n\n<script type="text/x-ui-template" id="account-guide-header">\n    <div class="item hbox cloud-backup">\n        <div class="icon icon-cloud-backup"></div>\n        <div class="title">{{= i18n.sync.CLOUD_BACKUP }}</div>\n    </div>\n    <div class="item hbox cloud-photo">\n        <div class="icon icon-cloud-photo"></div>\n        <div class="title">{{= i18n.sync.CLOUD_PHOTO }}</div>\n    </div>\n    <div class="item hbox social-platform">\n        <div class="icon icon-social-platform"></div>\n        <div class="title">{{= i18n.sync.SOCIAL_PLATFORM }}</div>\n    </div>\n</script>\n\n<script type="text/template" id="account-guide-content-backup">\n    <div class="pic-ctn pic-content-backup"></div>\n    <div class="content-ctn">\n        <p class="title">{{= i18n.sync.CLOUD_BACKUP_TITLE }}</p>\n        <p class="desc text-secondary">{{= i18n.sync.CLOUD_BACKUP_DESC }}</p>\n        <label class="guide-option"><input type="checkbox" checked="true" />{{= i18n.sync.CLOUD_BACKUP_OPTION }}</label>\n    </div>\n</script>\n\n<script type="text/template" id="account-guide-content-photo">\n    <div class="pic-ctn pic-content-photo"></div>\n    <div class="content-ctn">\n        <p class="title">{{= i18n.sync.CLOUD_PHOTO_TITLE }}</p>\n        <p class="desc text-secondary">{{= i18n.sync.CLOUD_PHOTO_DESC }}</p>\n        <label class="guide-option"><input type="checkbox" checked="true" />{{= i18n.sync.CLOUD_PHOTO_OPTION }}</label>\n    </div>\n</script>\n\n<script type="text/template" id="account-guide-content-social">\n    <div class="pic-ctn pic-content-social"></div>\n    <div class="content-ctn">\n        <p class="title">{{= i18n.sync.SOCIAL_PLATFORM_TITLE }}</p>\n        <p class="desc text-secondary">{{= i18n.sync.SOCIAL_PLATFORM_DESC }}</p>\n        <div class="social-ctn"></div>\n        <label class="guide-option"><input type="checkbox" checked="true" disabled />{{= i18n.sync.SOCIAL_PLATFORM_OPTION }}</label>\n    </div>\n</script>\n</templates>'}),define("text!optimize/optimize.tpl",[],function(){return'<templates>\n<script type="text/x-ui-template" id="scan">\n    <div class="progress hbox">\n        <div class="pre-scan"></div>\n        <div class="title-ctn vbox">\n            <div class="title">{{= i18n.optimize.WELCOME }}</div>\n            <div class="tip text-secondary"></div>\n        </div>\n    </div>\n    <div class="monitor-ctn vbox">\n        <div class="monitor vbox">\n            <div class="button-ctn vbox">\n                <button class="button-scan"></button>\n                <div class="wifi-tip text-secondary">{{= i18n.optimize.WIFI_TIP }}</div>\n            </div>\n        </div>\n        <div class="vendor hbox">\n            <div class="logo"></div>\n            <span class="text-secondary">{{= i18n.optimize.VENDOR }}</span>\n        </div>\n    </div>\n</script>\n\n<script type="text/x-ui-template" id="install">\n    <div class="scanning"></div>\n    <div class="title-ctn vbox">\n        <div class="title">{{= i18n.optimize.INSTALLING }}</div>\n        <progress class="min" max="100" value="{{= it.progress }}"></progress>\n    </div>\n    <button class="button-cancel">{{= i18n.ui.CANCEL }}</button>\n</script>\n\n<script type="text/x-ui-template" id="scan-progress">\n    <div class="scanning"></div>\n    <div class="title-ctn vbox">\n        <div class="title">{{= i18n.optimize.SCANNING }}</div>\n        <div class="progress-ctn vbox">\n            <div class="progress-inside"></div>\n        </div>\n        <div class="tip text-secondary wc"></div>\n    </div>\n    <button class="button-cancel">{{= i18n.ui.CANCEL }}</button>\n</script>\n\n<script type="text/x-ui-template" id="scan-monitor">\n    <h3 class="finish-title">{{= StringUtil.format(i18n.optimize.FINISH_TITLE, 0) }}</h3>\n    <ul class="finish">\n        <li class="virus hbox">\n            <div class="icon icon-done"></div>\n            <div class="tip text-secondary"></div>\n        </li>\n        <li class="cache hbox">\n            <div class="icon icon-done"></div>\n            <div class="tip text-secondary"></div>\n        </li>\n        <li class="ram hbox">\n            <div class="icon icon-done"></div>\n            <div class="tip text-secondary"></div>\n        </li>\n    </ul>\n    <h3 class="optimize-title">{{= StringUtil.format(i18n.optimize.OPTIMIZE_TITLE, 0) }}</h3>\n    <ul class="optimize">\n        <li class="virus hbox">\n            <div class="icon icon-warn"></div>\n            <div class="tip text-secondary"></div>\n            <div class="button-optimize-virus link">{{= i18n.optimize.OPTIMIZE }}</div>\n        </li>\n        <li class="cache hbox">\n            <div class="icon icon-warn"></div>\n            <div class="tip text-secondary"></div>\n            <div class="button-optimize-cache link">{{= i18n.optimize.OPTIMIZE }}</div>\n        </li>\n        <li class="ram hbox">\n            <div class="icon icon-warn"></div>\n            <div class="tip text-secondary"></div>\n            <div class="button-optimize-ram link">{{= i18n.optimize.OPTIMIZE }}</div>\n        </li>\n    </ul>\n    <h3 class="suggestion-title">{{= StringUtil.format(i18n.optimize.SUGGESTION_TITLE, 0) }}</h3>\n    <ul class="suggestion">\n        <li class="update hbox">\n            <div class="icon icon-info"></div>\n            <div class="tip text-secondary"></div>\n            <div class="button-update-all link">{{= i18n.optimize.UPDATE }}</div>\n        </li>\n        <li class="backup hbox">\n            <div class="icon icon-info"></div>\n            <div class="tip text-secondary"></div>\n            <div class="button-backup link">{{= i18n.optimize.BACKUP }}</div>\n        </li>\n    </ul>\n</script>\n</templates>'}),define("text!doraemon/doraemon.tpl",[],function(){return'<templates>\n<script type="text/x-ui-template" id="nav-title">\n    <span class="text-thirdly">{{= i18n.misc.TITLE_DOWNLOAD }}</span>\n    <hr />\n    <div class="button-ctn">\n        <div class="button-management" data-title="{{= i18n.misc.MANGEMENT }}"></div>\n        <div class="button-management white" data-title="{{= i18n.misc.MANGEMENT }}"></div>\n    </div>\n</script>\n\n<script type="text/x-ui-template" id="menu">\n    <menu class="w-sidebar-menu"></menu>\n</script>\n\n<script type="text/x-ui-template" id="menu-item">\n    <div class="title hbox">\n        <div class="icon category {{= it.cateid || \'dev\' }}" data-title="{{= it.displayCategory || it.catetitle }}"></div>\n        {{= it.name }}\n        {{? it.star }}\n        <div class="star-extension" data-title="豌豆荚优质内容"></div>\n        {{?}}\n    </div>\n</script>\n\n<script type="text/x-ui-template" id="extension-item">\n    <label class="input item-checker-wrap">\n        <input class="item-checker" type="checkbox" value="{{= it.id }}">\n    </label>\n    <div class="icon"><img src="images/icon_default_extention.png" alt="{{! it.name }}" /></div>\n    <div class="name">{{! it.name }}</div>\n    {{? it.dev_mode }}\n    <div class="dev-mode">\n        <span>{{= i18n.misc.LOCALE_EXTENTION }}</span>\n        <span class="link button-zip">{{= i18n.misc.ZIP_EXTENTION }}</span>\n        <span class="link button-reload">{{= i18n.misc.RELOAD_EXTENTION }}</span>\n        <span class="link button-publish">{{= i18n.misc.PUBLISH }}</span>\n    </div>\n    {{??}}\n    <div class="developer wc">{{! it.developer }}</div>\n    <div class="category" wc>{{! it.catetitle }}</div>\n    <div class="fav">{{= it.fav }}</div>\n    {{?}}\n</script>\n\n<script type="text/x-ui-template" id="toolbar">\n    <input type="checkbox" class="check-select-all" />\n    <button class="w-icon-btn button-gallery primary min">\n        <span class="icon add"></span>{{= i18n.misc.ADD_COLLECT }}\n    </button>\n    <button class="w-icon-btn button-up min">\n        <span class="icon up"></span>{{= i18n.misc.MOVE_UP }}\n    </button>\n    <button class="w-icon-btn button-down min">\n        <span class="icon move-down"></span>{{= i18n.misc.MOVE_DOWN }}\n    </button>\n    <div class="split"></div>\n    <button class="w-icon-btn button-unstar min">\n        <span class="icon delete"></span>{{= i18n.misc.REMOVE_COLLECT }}\n    </button>\n    <div class="debug-wrap hbox">\n        <div class="text-secondary">{{= i18n.misc.DEVELOPER_LABEL }}</div>\n        <button class="button-load-extention min">{{= i18n.misc.LOAD_EXTENTION }}</button>\n    </div>\n</script>\n\n<script type="text/x-ui-template" id="extension-list">\n    <header class="w-smart-list-header text-secondary hbox">\n        <div class="name">{{= i18n.misc.SITE_NAME }}</div>\n        <div class="developer">{{= i18n.misc.DEVELOPER }}</div>\n        <div class="category">{{= i18n.misc.CATEGORY }}</div>\n        <div class="fav">{{= i18n.misc.POPULARITY }}</div>\n    </header>\n</script>\n\n<script type="text/x-ui-template" id="report">\n    <p class="text-secondary">{{= i18n.misc.REPORT_TIP }}</p>\n    <form method="post" name="report" class="form-report" action="{{= CONFIG.enums.REPORT_URL }}" onsubmit="return false;">\n        <p class="hbox">\n            <span class="label text-secondary">{{= i18n.misc.REPORT_SITE_NAME }}</span>\n            {{= it.name }}\n        </p>\n        <p>\n            <label class="email-label hbox">\n                <span class="label text-secondary">{{= i18n.misc.EMAIL_LABEL }}</span>\n                <input type="text" name="email" class="input-email" pattern="^[A-Za-z0-9](([_\\.\\-]?[a-zA-Z0-9]+)*)@([A-Za-z0-9]+)(([\\.\\-]?[a-zA-Z0-9]+)*)\\.([A-Za-z]{2,})$" />\n            </label>\n        </p>\n        <label class="content-label hbox text-secondary" >\n            <div class="label">{{= i18n.misc.PROBLEM_DES }}</div>\n            <textarea name="content" class="input-content"></textarea>\n        </label>\n        <input type="hidden" name="id" class="input-id" value="{{= it.id }}" />\n    </form>\n</script>\n\n<script type="text/x-ui-template" id="info-panel">\n    <div class="icon">\n        <img src="{{= it.icon }}" alt="{{= it.name }}" />\n    </div>\n    <div class="content vbox">\n        <div class="title">{{= it.name }}</div>\n        <div class="des wc text-secondary">{{= it.desc }}</div>\n        <div>\n            <button class="button-star primary">{{= i18n.misc.ADD_TO_COLLECT }}</button>\n            <span class="tip text-thirdly">{{= StringUtil.format(i18n.misc.STARRED_COUNT, it.fav) }}</span>\n        </div>\n    </div>\n    <div class="button-close"></div>\n    <div class="arrow"></div>\n</script>\n\n<script type="text/x-ui-template" id="browser">\n    <div class="browser-ctn">\n        <iframe class="browser" id="{{= _.uniqueId(\'wdj_extention_window_\') }}" branch="{{= _.uniqueId(\'wdj_extention_window_branch_\') }}"></iframe>\n        <div class="flash-notifier hbox">\n            <div class="des">{{= i18n.misc.FLASH_NOTIFIER }}</div>\n            <button class="button-install-flash">{{= i18n.misc.DOWNLOAD_FLASH }}</button>\n            <div class="button-close-flash-notifier"></div>\n        </div>\n        <div class="progress">\n            <div class="value">\n                <div class="shinning"></div>\n            </div>\n        </div>\n    </div>\n</script>\n\n<script type="text/c-ui-template" id="app-dependency">\n    <div class="ctn hbox">\n        <span class="text-secondary">{{= StringUtil.format(i18n.misc.APP_DEPENDENCY_TIP, it.title) }}</span>\n        <div class="icon">\n            <img src="{{= CONFIG.enums.TASK_DEFAULT_ICON_PATH_APP }}" alt="{{= it.title }}" />\n        </div>\n        <div class="info">\n            <span>{{= it.title }}</span>\n            <span class="tip text-secondary">{{= StringUtil.readableSize(it.apks[0].bytes) }}</span>\n            <span class="tip text-secondary">{{= StringUtil.format(i18n.app.DOWNLOAD_COUNT_TIP, StringUtil.shortenQuantity(it.downloadCount)) }}</span>\n            <button class="primary button-install">{{= i18n.app.INSTALL }}</button>\n        </div>\n        <div class="button-close"></div>\n    </div>\n</script>\n\n<script type="text/x-ui-template" id="browser-toolbar">\n    {{? it.id.toString() !== \'305\' }}\n    <button class="w-icon-btn browser-nav button-back min" title="{{= i18n.misc.BACK }}">\n        <span class="icon back"></span>\n    </button>\n    <button class="w-icon-btn browser-nav button-forward min" title="{{= i18n.misc.FORWARD }}">\n        <span class="icon forward"></span>\n    </button>\n    <button class="w-icon-btn browser-nav button-refresh min" title="{{= i18n.misc.REFRESH }}">\n        <span class="icon nav-refresh"></span>\n    </button>\n    <div class="split"></div>\n    <button class="w-icon-btn browser-nav button-star min">\n        <span class="icon star"></span>\n    </button>\n    <button class="w-icon-btn browser-nav button-share min" title="{{= i18n.common.SHARE }}">\n        <span class="icon share"></span>\n    </button>\n    <button class="w-icon-btn browser-nav button-report min" title="{{= i18n.misc.REPORT_PROBLEM }}">\n        <span class="icon report"></span>\n    </button>\n    <span class="developer-wrap hbox">\n        <div class="split"></div>\n        <div class="label text-secondary">{{= i18n.misc.DEVELOPER_LABEL }}</div>\n        <button class="w-icon-btn browser-nav button-reload" title="{{= i18n.misc.RELOAD_EXTENTION }}">\n            <span class="icon reload"></span>\n        </button>\n    </span>\n    {{?}}\n</script>\n\n<script type="text/x-ui-template" id="browser-menu">\n    {{? it.extension }}\n        <li class="root-item selected" data="{{= it.extension.app.launch.web_url }}">\n            <div class="title">\n                {{= it.extension.app.label ? it.extension.app.label : i18n.misc.HOME_PAGE }}\n            </div>\n        </li>\n        {{~ it.extension.app.navigation : item }}\n            <li class="root-item" data="{{= item.web_url }}">\n                <div class="title">{{= item.label }}</div>\n            </li>\n        {{~}}\n    {{?}}\n</script>\n</templates>\n'}),define("text!music/music.tpl",[],function(){return'<templates>\n<script type="text/x-ui-template" id="toolbar">\n    <input type="checkbox" class="check-select-all" />\n    <button class="w-icon-btn primary button-add-music min">\n        <span class="icon add"></span>{{= i18n.music.ADD_LOCAL_MUSIC_TEXT }}\n    </button>\n    <button class="w-icon-btn button-delete min">\n        <span class="icon delete"></span>{{= i18n.misc.DELETE }}\n    </button>\n    <button class="w-icon-btn button-export min">\n        <span class="icon export"></span>{{= i18n.misc.EXPORT }}\n    </button>\n    <div class="split"></div>\n    <button class="w-icon-btn button-refresh min">\n        <span class="icon refresh"></span>{{= i18n.misc.REFRESH }}\n    </button>\n    <div class="itunes-wrap">\n        <button class="w-icon-btn button-itunes min">\n            <span class="icon itunes"></span>{{= i18n.music.ITUNES_IMPORT }}\n        </button>\n    </div>\n</script>\n\n<script type="text/x-ui-template" id="local-import-body">\n    <div class="btn-ctn hbox">\n        <button class="button-add-file">{{= i18n.misc.ADD_FILE }}</button>\n        <button class="button-add-folder">{{= i18n.misc.ADD_FOLDER }}</button>\n        <div class="tip">{{= i18n.music.FILE_SELECTOR_DESCRIPTION }}</div>\n    </div>\n    <div class="w-music-local-import-list vbox">\n        <header class="w-smart-list-header w-music-list-header text-secondary hbox">\n            <label class="check-select-all-wrap"><input class="check-select-all" type="checkbox" /></label>\n            <div class="title smart-list-sortable" data-smart-list-sortby="title" data-smart-list-sort-type="string">{{= i18n.music.SING_NAME_TEXT }}</div>\n            <div class="artist smart-list-sortable" data-smart-list-sortby="artist" data-smart-list-sort-type="string">{{= i18n.music.ARTIST_TEXT }}</div>\n            <div class="duration smart-list-sortable" data-smart-list-sortby="duration" data-smart-list-sort-type="number">{{= i18n.music.SING_TIME_TEXT }}</div>\n            <div class="format smart-list-sortable" data-smart-list-sortby="format" data-smart-list-sort-type="string">{{= i18n.music.SING_FORMAT }}</div>\n            <div class="size smart-list-sortable" data-smart-list-sortby="size" data-smart-list-sort-type="number">{{= i18n.music.SING_SIZE_TEXT }}</div>\n        </header>\n        <footer class="w-smart-list-footer text-secondary"></footer>\n    </div>\n</script>\n\n<script type="text/x-ui-template" id="music-item">\n    <label class="input item-checker-wrap hbox"><input class="item-checker" type="checkbox" value="{{= it.id }}"></label>\n    <div class="title wc" title="{{! it.title }}">{{! it.title }}</div>\n    <div class="play">\n        {{? it.playing }}\n        <div class="button-stop" title="{{= i18n.music.STOP_TEXT }}"></div>\n        <div class="playing"></div>\n        {{?? it.loading }}\n        <div class="loading"></div>\n        {{?? it.error }}\n        <div class="error" title="{{= i18n.music.MUSIC_CANNOT_PLAY_TEXT }}"></div>\n        {{??}}\n        <div class="button-play" title="{{= i18n.music.PLAY_TEXT }}"></div>\n        {{?}}\n    </div>\n    <div class="artist text-secondary wc" title="{{! it.artist }}">{{! it.artist }}</div>\n    <div class="album text-secondary wc" title="{{! it.album }}">{{! it.album }}</div>\n    <div class="duration text-secondary">{{= StringUtil.formatDuration(it.duration) }}</div>\n    <div class="format text-secondary wc" title="{{= it.format }}">{{= it.format }}</div>\n    <div class="size text-secondary">{{= StringUtil.readableSize(it.size) }}</div>\n    <div class="type">\n        {{? it.collection !== undefined && it.collection.settings !== undefined }}\n            {{? it.collection.settings.ringtone === it.id }}\n            <div class="ring-icon ringtone"></div>\n            {{?}}\n            {{? it.collection.settings.notification === it.id }}\n            <div class="ring-icon notification"></div>\n            {{?}}\n            {{? it.collection.settings.alarm === it.id }}\n            <div class="ring-icon alarm"></div>\n            {{?}}\n        {{?}}\n    </div>\n</script>\n\n<script type="text/x-ui-template" id="music-list">\n<header class="w-smart-list-header w-music-list-header text-secondary hbox">\n    <label class="check-select-all-wrap"><input class="check-select-all" type="checkbox" /></label>\n    <div class="title smart-list-sortable" data-smart-list-sortby="title" data-smart-list-sort-type="string">{{= i18n.music.SING_NAME_TEXT }}</div>\n    <div class="play"></div>\n    <div class="artist smart-list-sortable" data-smart-list-sortby="artist" data-smart-list-sort-type="string">{{= i18n.music.ARTIST_TEXT }}</div>\n    <div class="album smart-list-sortable" data-smart-list-sortby="album" data-smart-list-sort-type="string">{{= i18n.music.ALBUM_TEXT }}</div>\n    <div class="duration smart-list-sortable" data-smart-list-sortby="duration" data-smart-list-sort-type="number">{{= i18n.music.SING_TIME_TEXT }}</div>\n    <div class="format smart-list-sortable" data-smart-list-sortby="format" data-smart-list-sort-type="string">{{= i18n.music.SING_FORMAT }}</div>\n    <div class="size smart-list-sortable" data-smart-list-sortby="size" data-smart-list-sort-type="number">{{= i18n.music.SING_SIZE_TEXT }}</div>\n    <div class="type"></div>\n</header>\n</script>\n\n<script type="text/x-ui-template" id="set-ring-list">\n<header class="w-smart-list-header w-music-list-header text-secondary hbox">\n    <div class="title smart-list-sortable" data-smart-list-sortby="title" data-smart-list-sort-type="string">{{= i18n.music.SING_NAME_TEXT }}</div>\n    <div class="type"></div>\n</header>\n</script>\n</templates>'}),define("text!video/video.tpl",[],function(){return'<templates>\n<script type="text/x-ui-template" id="local-import-body">\n    <div class="btn-ctn hbox">\n        <button class="button-add-file">{{= i18n.misc.ADD_FILE }}</button>\n        <button class="button-add-folder">{{= i18n.misc.ADD_FOLDER }}</button>\n        <div class="tip">{{= i18n.video.FILE_SELECTOR_DESCRIPTION }}</div>\n    </div>\n    <div class="support-tip">{{= i18n.video.VIDEO_SUPPORT_TIP }}</div>\n    <div class="w-video-local-import-list vbox">\n        <header class="w-smart-list-header w-video-list-header text-secondary hbox">\n            <label class="check-select-all-wrap"><input class="check-select-all" type="checkbox" /></label>\n            <div class="title smart-list-sortable" data-smart-list-sortby="name" data-smart-list-sort-type="string">{{= i18n.video.VIDEO_NAME }}</div>\n            <div class="format smart-list-sortable" data-smart-list-sortby="type" data-smart-list-sort-type="string">{{= i18n.video.VIDEO_FORMAT }}</div>\n            <div class="size smart-list-sortable" data-smart-list-sortby="size" data-smart-list-sort-type="number">{{= i18n.video.VIDEO_SIZE }}</div>\n        </header>\n    </div>\n</script>\n\n<script type="text/x-ui-template" id="video-item">\n    <label class="input item-checker-wrap hbox"><input class="item-checker" type="checkbox" value="{{= it.id }}"></label>\n    <div class="title wc" title="{{! it.name }}">{{! it.name }}</div>\n    <div class="format">{{= it.type }}</div>\n    <div class="size">{{= StringUtil.readableSize(it.size) }}</div>\n</script>\n</templates>'}),define("text!backuprestore/backup.tpl",[],function(){return'<templates>\n\n<script type="text/template" id="choose-backup-type">\n    <div class="content">\n        <div class="button hbox button-local">\n            <div class="icon local-icon"></div>\n            <h2 class="title">{{= i18n.backup_restore.BACKUP_TITLE_LOCAL }}</h2>\n        </div>\n        <div class="text-secondary desc">{{= i18n.backup_restore.BACKUP_TYPE_LOCAL_CONTENT }}</div>\n    </div>\n    <div class="content">\n        <div class="button hbox button-remote">\n            <div class="icon remote-icon"></div>\n            <h2 class="title">{{= i18n.backup_restore.BACKUP_TITLE_REMOTE }}</h2>\n        </div>\n        <div class="text-secondary desc">{{= i18n.backup_restore.BACKUP_TYPE_REMOTE_CONTENT }}</div>\n    </div>\n</script>\n\n<script type="text/x-ui-template" id="choose-backup-restore-data">\n    <p class="title">{{= it.isBackup ? i18n.backup_restore.CHOOSE_BACKUP_DATA_TIP : i18n.backup_restore.CHOOSE_RESTORE_DATA_TIP }}</p>\n    <div class="header hbox">\n        <div class="backup-type" >{{= i18n.backup_restore.TYPE }}</div>\n        <div class="backup-number" >{{= i18n.backup_restore.QUANTITY }}</div>\n    </div>\n    <div class="list-ctn">\n        {{? it.loading }}\n            <div class="loading">{{= i18n.common.LOADING }}</div>\n        {{?}}\n        <ul class="list">\n            {{~ it.list : item }}\n            {{? item.type !== 10 || FunctionSwitch.ENABLE_CLOUD_BACKUP_RESTORE }}\n            <li>\n                <label class="item-wrap hbox">\n                    <input class="file-radio" type="checkbox" name="type" value="{{= item.type }}" \n                        {{= (!it.isBackup && item.count === 0) ? \'disabled\' : \'\' }} />\n                    <div class="type hbox">\n                        {{= i18n.backup_restore.BR_TYPE_WORD_ENUM[item.type] }}\n                        {{? item.type === CONFIG.enums.BR_TYPE_APP_DATA}}\n                            <div class="beta"></div>\n                            <div class="app-data-tip-ctn"></div>\n                        {{?}}\n                    </div>\n                    <div class="count" data-value="{{= item.type }}">{{= item.count }}</div>\n                </label>\n            </li>\n            {{?}}\n            {{~}}\n        </ul>\n    </div>\n</script>\n\n<script type="text/template" id="choose-app-type">\n    <p class="title">{{= i18n.backup_restore.CHOOSE_APP_TYPE_TITLE }}</p>\n    <div class="content">\n        <label class="hbox">\n            <input class="radio-item wdapk" type="radio" value="2" name="app_type" checked="true">\n            <h3>{{= i18n.backup_restore.APP_TYPE_WDAPK_TITLE }}</h3>\n        </label>\n        <p class="desc desc-middle text-secondary">{{= i18n.backup_restore.APP_TYPE_WDAPK_CONTENT }}</p>\n        <label class="hbox">\n            <input class="radio-item apk" type="radio" value="0" name="app_type">\n            <h3>{{= i18n.backup_restore.APP_TYPE_APK_TITLE }}</h3>\n        </label>\n        <p class="desc text-secondary apk-desc">{{= i18n.backup_restore.APP_TYPE_APK_CONTENT }}</p>\n    </div>\n</script>\n\n<script type="text/template" id="choose-backup-location">\n    <p class="title">{{= i18n.backup_restore.SET_FILE_NAME }}</p>\n    <div class="content">\n        <input class="file-name" type="text"></input>\n        <div class="file-path-ctn">\n            {{= i18n.backup_restore.SAVE_LOCATION_LABEL }}\n            <span class="file-path"></span>\n            <span class="link button-set-location">{{= i18n.backup_restore.SET_FILE_PATH_LINK_BUTTON }}</span>\n        </div>\n    </div>\n</script>\n\n<script type="text/template" id="backup-progress">\n    <p class="title">{{= i18n.backup_restore.BACKUPING }}</p>\n    <div class="progress-ctn">\n    </div>\n\n    <div class="privacy-tip">\n        <p>{{= i18n.backup_restore.PRIVACY_TIP }}</p>\n    </div>\n</script>\n\n<script type="text/template" id="backup-progress-item">\n    <div class="icon-ctn"></div>\n    <div class="status">\n        <div class="progress-desc"></div>\n        <div class="progress hbox">\n            <progress class="tiny" max="" value="" />\n        </div>\n    </div>\n    <span class="progress-num"></span>\n</script>\n\n<script type="text/template" id="error-item-list">\n    <p class="title"></p>\n    <div class="app-list-ctn">\n        <div class="loading">{{= i18n.common.LOADING }}</div>\n        <ul class="list">\n            {{~ it.list : item }}\n            <li class="hbox item-ctn">\n                <div class="icon">\n                    <img src="{{= item.base_info.icon ? (\'file:///\' + item.base_info.icon) : CONFIG.enums.TASK_DEFAULT_ICON_PATH_APP }}" alt="{{! item.base_info.name }}" />\n                </div>\n                <div class="name wc">\n                    {{= item.base_info.name }}\n                </div>\n                <div class="size text-secondary">\n                    <div>{{= StringUtil.readableSize(item.base_info.apk_size) }}</div>\n                </div>\n            </li>\n            {{~}}\n        </ul>\n    </div>\n</script>\n\n<script type="text/template" id="error-item-tip">\n    <div class="all-non-app-failed">\n        <p>{{= StringUtil.format(i18n.backup_restore.RESTORE_PERMISSSION_TIP1, it.type_name) }}</p>\n        <p>{{= StringUtil.format(i18n.backup_restore.RESTORE_PERMISSSION_TIP2, it.type_name) }}</p>\n        <p>{{= i18n.backup_restore.RESTORE_PERMISSSION_TIP3 }}</p>\n    </div>\n    <div class="part-non-app-failed">\n        <p>{{= StringUtil.format(i18n.backup_restore.RESTORE_PERMISSSION_PART_TIP1, it.error_number, it.type_name) }}</p>\n        <p>{{= i18n.backup_restore.RESTORE_PERMISSSION_TIP3 }}</p>\n    </div>\n</script>\n\n<script type="text/template" id="error-retry">\n    <div class="content"></div>\n</script>\n\n<script type="text/template" id="backup-remote-progress">\n    <p class="title">{{= i18n.backup_restore.BACKUPING }}</p>\n    <div class="progress-ctn"></div>\n\n    <div class="mobile-tip">\n        <p>{{= i18n.backup_restore.MOBILE_TIP }}</p>\n    </div>\n</script>\n\n<script type="text/template" id="backup-local-auto-tip">\n    <div class="pic-local-ctn pic-ctn"></div>\n    <div class="content-ctn">\n        <p class="title">{{= i18n.backup_restore.AUTO_BACKUP_TIP_TITLE }}</p>\n        <p class="desc text-secondary">{{= i18n.backup_restore.AUTO_BACKUP_TIP_DESC }}</p>\n    </div>\n</script>\n\n<script type="text/template" id="backup-remote-auto-tip">\n    <div class="pic-remote-ctn pic-ctn"></div>\n    <div class="content-ctn">\n        <p class="title">{{= i18n.backup_restore.AUTO_BACKUP_REMOTE_TIP_TITLE }}</p>\n        <p class="desc text-secondary">{{= i18n.backup_restore.AUTO_BACKUP_REMOTE_TIP_DESC }}</p>\n    </div>\n</script>\n\n<script type="text/template" id="backup-remote-error-view">\n    <p class="content"></p>\n</script>\n\n<script type="text/template" id="backup-app-data-tip-view">\n    <div class="hbox wrap cf">\n        <div class="backup-pic-ctn"></div>\n        <div class="content-ctn">\n            <h2>{{= i18n.backup_restore.BACKUP_APP_DATA_TIP_TITLE }}</h2>\n            <div class="text-secondary">{{= i18n.backup_restore.BACKUP_APP_DATA_TIP_CONTENT }}</div>\n        </div>\n    </div>\n</script>\n</templates>\n'}),define("text!backuprestore/restore.tpl",[],function(){return'<templates>\n\n<script type="text/template" id="choose-restore-type">\n    <div class="content">\n        <div class="button hbox button-local">\n            <div class="icon local-icon"></div>\n            <h2 class="title">{{= i18n.backup_restore.RESTORE_TYPE_LOCAL_TITLE }}</h2>\n        </div>\n        <div class="text-secondary desc">{{= i18n.backup_restore.RESTORE_TYPE_LOCAL_CONTENT }}</div>\n    </div>\n    <div class="content">\n        <div class="button hbox button-remote">\n            <div class="icon remote-icon"></div>\n            <h2 class="title">{{= i18n.backup_restore.RESTORE_TYPE_REMOTE_TITLE }}</h2>\n        </div>\n        <div class="text-secondary desc">{{= i18n.backup_restore.RESTORE_TYPE_REMOTE_CONTENT }}</div>\n    </div>\n</script>\n\n<script type="text/template" id="select-file-folder">\n    <p>{{= i18n.backup_restore.SELECT_FILE_FOLDER_TIP }}</p>\n</script>\n\n<script type="text/template" id="choose-restore-file">\n    <p class="title">{{= i18n.backup_restore.CHOOSE_RESTORE_FILE_TITLE }}</p>\n    <div class="header hbox">\n        <div class="file-name" >{{= i18n.backup_restore.BACKUP_FILE }}</div>\n        <div class="count-wrap">\n            <div class="contact-number"></div>\n        </div>\n        <div class="count-wrap">\n            <div class="sms-number"></div>\n        </div>\n        <div class="count-wrap">\n            <div class="app-number"></div>\n        </div>\n    </div>\n    <div class="list-ctn">\n        <ul class="list">\n            {{~ it.list : item }}\n            <li>\n                <label class="item-wrap hbox">\n                    <input class="file-radio" type="radio" name="file" value="{{= item.file_name }}" />\n                    <div class="file-name wc" title="{{= item.file_name }}">{{= item.short_file_name }}</div>\n                    <div class="contact-number" title="{{= i18n.backup_restore.CONTACT }}"></div>\n                    <div class="sms-number" title="{{= i18n.backup_restore.SMS }}"><div class="loading"></div></div>\n                    <div class="app-number" title="{{= i18n.backup_restore.APP }}"></div>\n                </label>\n            </li>\n            {{~}}\n        </ul>\n    </div>\n    <div class="tip-link">\n        {{= i18n.backup_restore.CHOOSE_RESTORE_FILE_TIP_BEFORE }}\n        <span class="link button-select-file">{{= i18n.backup_restore.CHOOSE_RESTORE_FILE_TIP_LINK }}</span>\n        {{= i18n.backup_restore.CHOOSE_RESTORE_FILE_TIP_AFTER }}\n        {{? FunctionSwitch.ENABLE_CLOUD_BACKUP_RESTORE }}\n        <div class="old-version-tip" title=""></div>\n        {{??}}\n        <div class="old-version-tip locale-patch" title=""></div>\n        {{?}}\n    </div>\n</script>\n\n<script type="text/x-ui-template" id="old-version-tip">\n    <div class="old-version-tip">\n        {{= i18n.backup_restore.RESOTRE_OLD_VERSION_TIP_BEFORE }}\n        <a href="{{= i18n.backup_restore.RESTORE_OLD_VERSION_DL_LINK }}" target="_default">\n            {{= i18n.backup_restore.RESOTRE_OLD_VERSION_TIP_LINK }}\n        </a>\n        {{= i18n.backup_restore.RESOTRE_OLD_VERSION_TIP_AFTER }}\n    </div>\n</script>\n\n<script type="text/x-ui-template" id="choose-account">\n    <p>{{= i18n.backup_restore.RESTORE_CHOOSE_ACCOUNT_TIP }}</p>\n    <div class="account-ctn"></div>\n</script>\n\n<script type="text/template" id="resotre-progress">\n    <p class="title">{{= i18n.backup_restore.RESTORING_TIP }}</p>\n\n    <div class="progress-ctn"></div>\n</script>\n\n<script type="text/template" id="restore-app-tip">\n    <div class="image-ctn"></div>\n    <div class="content-ctn">\n        <p>{{= i18n.backup_restore.RESTORE_APP_TIP }}</p>\n    </div>\n</script>\n\n<script type="text/template" id="restore-delete-data">\n    <p>{{= i18n.backup_restore.RESTORE_DELETE_DATA_TIP }}</p>\n    <ul class="list">\n        <li>\n            <label>\n                <input class="radio-item yes" type="radio" value="1" name="delete_data" checked="true">\n                <span class="desc">{{= i18n.backup_restore.RESTORE_DELETE_DATA_TIP_YES }}</span>\n            </label>\n        </li>\n        <li>\n            <label>\n                <input class="radio-item no" type="radio" value="0" name="delete_data">\n                <span class="desc">{{= i18n.backup_restore.RESTORE_DELETE_DATA_TIP_NO }}</span>\n            </label>\n        </li>\n    </ul>\n</script>\n\n<script type="text/template" id="choose-restore-date-item">\n    <label class="item-wrap hbox" data-version="{{= it.item.version }}">\n        <input class="date-radio" type="radio" name="date" value="{{= it.item.version }}" data-udid="{{= it.item.udid }}" />\n        <div class="date">{{= it.item.timestamp }}</div>\n        <div class="device wc" title="{{= it.item.deviceName }}">{{= it.item.deviceName }}</div>\n        <div class="contact-number" title="{{= i18n.backup_restore.CONTACT }}"></div>\n        <div class="sms-number" title="{{= i18n.backup_restore.SMS }}">\n            <div class="w-ui-loading-small info_loading" style="display: block; ">\n                <div class="anima">\n                    <div class="rotor rotor1"></div>\n                    <div class="rotor rotor2"></div>\n                    <div class="rotor rotor3"></div>\n                    <div class="rotor rotor4"></div>\n                    <div class="rotor rotor5"></div>\n                    <div class="rotor rotor6"></div>\n                    <div class="rotor rotor7"></div>\n                    <div class="rotor rotor8"></div>\n                </div>\n            </div>\n        </div>\n        <div class="app-number" title="{{= i18n.backup_restore.APP }}"></div>\n    </label>\n</script>\n\n<script type="text/template" id="choose-restore-date">\n    <p class="title">{{= i18n.backup_restore.CHOOSE_RESTORE_DATE_TITLE }}</p>\n    <div class="header hbox">\n        <div class="date" >{{= i18n.backup_restore.RESTORE_DATE }}</div>\n        <div class="device" >{{= i18n.backup_restore.RESTORE_DEVICE }}</div>\n        <div class="count-wrap">\n            <div class="contact-number"></div>\n        </div>\n        <div class="count-wrap">\n            <div class="sms-number"></div>\n        </div>\n        <div class="count-wrap">\n            <div class="app-number"></div>\n        </div>\n    </div>\n    <div class="list-ctn">\n        <div class="loading">{{= i18n.common.LOADING }}</div>\n        <ul class="list">\n            <li class="load-more-ctn">\n                <span class="button-load-more link">{{= i18n.common.LOAD_MORE }}</span>\n            </li>\n        </ul>\n    </div>\n</script>\n\n</templates>\n'}),define("text!app/wash/wash.tpl",[],function(){return'<templates>\n<script type="text/x-ui-template" id="wash-intro">\n    <h1 class="text-primary title">{{= i18n.app.APP_WASH }}</h1>\n    <p class="text-secondary">{{= i18n.app.SCAN_TIP1 }}</p>\n    <p class="text-secondary">{{= i18n.app.SCAN_TIP2 }}</p>\n    <p class="text-secondary">{{= i18n.app.SCAN_TIP3 }}</p>\n    <button class="grand button-start primary">{{= i18n.app.START_SCAN }}</button>\n    <p class="text-thirdly connect-tip">{{= i18n.app.WASH_CONNECT_TIP }}</p>\n    <div class="w-app-wash-report-ctn text-secondary">之前洗错了？请<span class="link button-feedback">反馈给豌豆们</span></div>\n</script>\n\n<script type="text/x-ui-template" id="wash-scanning">\n    <h1 class="text-primary title">{{= i18n.app.SCANNING }}</h1>\n    <p class="text-thirdly desc">{{= i18n.app.SCANNING_TIP }}</p>\n    <progress class="min" max="100" value=""></progress>\n</script>\n\n<script type="text/x-ui-template" id="wash-scan-result">\n    <ul class="result"></ul>\n    <div class="summary">\n        <ul>\n            <li class="pirate">\n                <div class="count"></div>\n                <div class="des text-secondary">{{= i18n.app.PIRATE_TIP }}</div>\n            </li>\n            <li class="ads">\n                <div class="count"></div>\n                <div class="des text-secondary">{{= i18n.app.ADS_TIP }}</div>\n            </li>\n            <li class="ads-uninstall">\n                <div class="count"></div>\n                <div class="des text-secondary">广告应用暂无替换方案</div>\n            </li>\n        </ul>\n    </div>\n    <div class="w-app-wash-report-ctn text-secondary">洗错了？<span class="link button-restart">再洗一次</span>试试，或<span class="link button-feedback">反馈给豌豆们</span></div>\n</script>\n\n<script type="text/x-ui-template" id="summary-pop-ads">\n    <div class="summary">\n        <h1 class="text-primary title">{{= i18n.app.RESULT_SUMMARY_POP_ADS }}</h1>\n        <p class="text-thirdly desc"></p>\n        <div class="btn-ctn">\n            <button class="button-uninstall-all grand">{{= i18n.app.UNINSTALL_ALL }}</button>\n        </div>\n    </div>\n</script>\n\n<script type="text/x-ui-template" id="result-empty">\n    <h1 class="text-primary title">{{= i18n.app.RESULT_EMPTY }}</h1>\n    <p class="text-secondary desc">{{= i18n.app.RESULT_EMPTY_TIP }}</p>\n    <div class="btn-ctn">\n        <button class="grand button-share primary">{{= i18n.app.WASH_SHARE }}</button>\n        <button class="grand button-restart">再洗一次</button>\n    </div>\n    <p class="text-thirdly survey">\n        {{= i18n.app.WASH_SURVEY }}<span class="link button-feedback">{{= i18n.app.TELL_US }}</span>\n    </p>\n</script>\n\n<script type="text/x-ui-template" id="result-replace-finish">\n    <h1 class="text-primary title">{{= i18n.app.RESULT_FINISH }}</h1>\n    <p class="text-secondary desc">{{= i18n.app.RESULT_FINISH_TIP }}</p>\n    <div class="btn-ctn">\n        <button class="grand button-share primary">{{= i18n.app.WASH_SHARE }}</button>\n        <button class="grand button-restart">再洗一次</button>\n    </div>\n    <p class="text-thirdly survey">\n        {{= i18n.app.WASH_SURVEY }}<span class="link button-feedback">{{= i18n.app.TELL_US }}</span>\n    </p>\n</script>\n\n<script type="text/x-ui-template" id="feedback-card">\n    <h2 class="text-primary title">能告诉豌豆们为什么暂不处理吗？</h2>\n    <ul>\n        {{\n            var id = _.uniqueId(\'ignore-report-\');\n            var reasons;\n        }}\n        {{? it.type === \'ADS\' }}\n        {{\n            reasons = _.find(it.text, function (item) {\n                return item.type === \'UNINSTALL\';\n            }).content;\n        }}\n        {{~ reasons : reason }}\n        <li>\n            <label>\n                <input type="radio" name="{{= id }}" value="{{= reason }}" />{{= reason }}\n            </label>\n        </li>\n        {{~}}\n        {{??}}\n        {{\n            reasons = _.find(it.text, function (item) {\n                return item.type === \'REPLACE\';\n            }).content;\n        }}\n        {{~ reasons : reason }}\n        <li>\n            <label>\n                <input type="radio" name="{{= id }}" value="{{= reason }}" />{{= reason }}\n            </label>\n        </li>\n        {{~}}\n        {{?}}\n        <li>\n            <label>\n                <input type="radio" name="{{= id }}" value="" />其他<input disabled="true" type="text" class="input-reason" />\n            </label>\n        </li>\n    </ul>\n    <div class="button-ctn">\n        <button class="button-send primary">{{= i18n.misc.SEND }}</button>\n        <button class="button-cancel">{{= i18n.ui.CANCEL }}</button>\n    </div>\n</script>\n\n<script type="text/x-ui-template" id="result-item">\n    {{? it.result.suggestion.action === \'REPLACE\' }}\n    <div class="back replace-confirm vbox">\n        <div class="wording-ctn">\n            <p>注意：替换后，当前山寨应用的数据或游戏积分会随替换而消失。</p>\n            <p>确定替换吗？</p>\n        </div>\n        <div class="button-ctn">\n            <button class="button-replace primary">{{= i18n.ui.CONFIRM }}</button>\n            <button class="button-cancel">{{= i18n.ui.CANCEL }}</button>\n        </div>\n    </div>\n    {{?}}\n    <div class="front vbox">\n        {{? it.result.function.type === \'PIRATE\' }}\n        <div class="tag pirate" data-title="该应用被原开发者以外的人篡改过">{{= i18n.app.PIRATE }}</div>\n        {{??}}\n        <div class="tag ads" data-title="该应用有广告">{{= i18n.app.ADS }}</div>\n        {{?}}\n        <div class="hbox app-info">\n            <div class="icon"><img src="{{= it.origin.base_info.icon }}" alt="{{= it.origin.base_info.name }}" /></div>\n            <div class="title wc">{{= it.origin.base_info.name }}</div>\n        </div>\n        <div class="content">\n        {{! it.result.summary }}{{? it.result.candidateApks }}<div class="info"></div>{{?}}\n        </div>\n        <div class="button-ctn">\n            {{? it.result.suggestion.action === \'CLOSEPOPUP\' }}\n            <button class="button-close-ads">关广告</button>\n            {{?? it.result.suggestion.action === \'UNINSTALL\' }}\n            <button class="button-uninstall">{{= i18n.app.UNINSTALL }}</button>\n            {{??}}\n            <button class="button-confirm">{{= i18n.app.REPLACE }}</button>\n            {{?}}\n            <span class="link button-ignore">暂不处理</span>\n        </div>\n    </div>\n</script>\n\n<script type="text/x-ui-template" id="wash-error">\n    <h1 class="text-primary title">{{= i18n.app.APP_WASH_ERROR }}</h1>\n    <p class="text-secondary">{{= i18n.app.WASH_ERROR_TIP }}</p>\n    <button class="grand button-retry primary">{{= i18n.app.WASH_RETRY }}</button>\n</script>\n\n<script type="text/x-ui-template" id="wash-feedback">\n    <div class="step-1 step">\n        <label>\n            <input type="radio" name="wash-feedback-type" value="1">洗错了\n        </label>\n        <label>\n            <input type="radio" name="wash-feedback-type" value="2">洗漏了\n        </label>\n        <label>\n            <input type="radio" name="wash-feedback-type" value="3">其他<input disabled="true" class="input-reason" type="text" />\n        </label>\n    </div>\n</script>\n\n<script type="text/x-ui-template" id="wash-feedback-item">\n    <input class="item-checker" type="checkbox" value="{{= it.id }}">\n    <label class="wrap hbox">\n        <input type="radio" name="wash-feedback-item" value="{{= it.base_info.package_name }}" />\n        <div class="icon-ctn">\n            <img src="{{= it.base_info.icon }}" alt="{{= it.base_info.name }}" />\n        </div>\n        {{= it.base_info.name }}\n    </lebel>\n</script>\n\n<script type="text/x-ui-template" id="wash-feedback-reason">\n    <div class="step-3 step">\n        {{\n            var reasons;\n        }}\n        {{? it.type === 1 }}\n            {{\n                reasons = _.find(it.text, function (item) {\n                    return item.type === \'WRONG\';\n                }).content;\n            }}\n            {{~ reasons : reason }}\n            <label>\n                <input type="radio" name="wash-feedback-reason" value="{{= reason }}">{{= reason }}\n            </label>\n            {{~}}\n        {{??}}\n            {{\n                reasons = _.find(it.text, function (item) {\n                    return item.type === \'MISSING\';\n                }).content;\n            }}\n            {{~ reasons : reason }}\n            <label>\n                <input type="radio" name="wash-feedback-reason" value="{{= reason }}">{{= reason }}\n            </label>\n            {{~}}\n        {{?}}\n        <label>\n            <input type="radio" name="wash-feedback-reason" value="">其他坏行为<input disabled="true" class="input-reason" type="text" />\n        </label>\n    </div>\n</script>\n\n<script type="text/x-ui-template" id="wash-notification">\n    <div class="icon-ctn">\n        <div class="icon"></div>\n    </div>\n    <div class="info">\n        <h2 class="text-primary">跟山寨应用和广告应用说白白</h2>\n        <p class="text-secondary">豌豆洗白白可以找出您手机中的山寨应用和广告应用，并协助您把它们替换为官方版或无广告版。</p>\n        <button class="primary button-wash">洗一下</button>\n    </div>\n</script>\n\n<script type="text/x-ui-template" id="result-info">\n    <ul class="w-app-wash-info">\n        <li class="hbox info">\n            <div>替换前：<div></div></div>\n            <ul class="item-ctn">\n                {{~ it.candidateApks[0].detailChange : change }}\n                {{\n                    var warn = change.level === \'BETTER\';\n                }}\n                <li class="item {{? warn }}text-warning{{??}}text-primary{{?}}">\n                    <div class="icon {{? warn }}warn{{??}}check{{?}}"></div>\n                    {{= change.source }}\n                </li>\n                {{~}}\n            </ul>\n        </li>\n        <li class="hbox info">\n            <div>替换后：<div></div></div>\n            <ul class="item-ctn">\n                {{~ it.candidateApks[0].detailChange : change }}\n                {{\n                    var warn = change.level === \'WORTH\';\n                }}\n                <li class="item {{? warn }}text-warning{{??}}text-primary{{?}}">\n                    <div class="icon {{? warn }}warn{{??}}check{{?}}"></div>\n                    {{= change.candidate }}\n                </li>\n                {{~}}\n            </ul>\n        </li>\n    </ul>\n</script>\n\n<script type="text/x-ui-template" id="close-notification">\n    <div class="w-app-wash-close-popup-ctn">\n        <h1 class="text-primary">请在手机上关闭{{= it.title }}的通知栏消息</h1>\n        <div class="close-popup-tip hbox">\n            <div class="tip1"></div>\n            <div class="tip2"></div>\n        </div>\n    </div>\n</script>\n</templates>\n'}),function(e,t){define("ui/TemplateFactory",["jquery","utilities/StringUtil","text!ui/ui.tpl","text!modules/misc.tpl","text!app/app.tpl","text!message/message.tpl","text!task/taskmanager.tpl","text!social/social.tpl","text!music/iTunes/iTunes.tpl","text!modules/photo/photo.tpl","text!contact/contact.tpl","text!welcome/welcome.tpl","text!sync/sync.tpl","text!optimize/optimize.tpl","text!doraemon/doraemon.tpl","text!music/music.tpl","text!video/video.tpl","text!backuprestore/backup.tpl","text!backuprestore/restore.tpl","text!app/wash/wash.tpl"],function(t,n,r,i,s,o,u,a,f,l,c,h,p,d,v,m,g,y,b,w){var E={ui:t(n.compressHTML(r)),misc:t(n.compressHTML(i)),contact:t(n.compressHTML(c)),app:t(n.compressHTML(s)),message:t(n.compressHTML(o)),taskManager:t(n.compressHTML(u)),social:t(n.compressHTML(a)),iTunes:t(n.compressHTML(f)),photo:t(n.compressHTML(l)),welcome:t(n.compressHTML(h)),sync:t(n.compressHTML(p)),optimize:t(n.compressHTML(d)),doraemon:t(n.compressHTML(v)),music:t(n.compressHTML(m)),video:t(n.compressHTML(g)),backup:t(n.compressHTML(y)),restore:t(n.compressHTML(b)),wash:t(n.compressHTML(w))},S={};return S.get=function(e,t){var n;E[e]?n=E[e]:console.error("TemplateFactory - Load template with module name '"+e+"' failed.");var r=n.find("#"+t);if(!(r.length<=0))return r.html();console.error("TemplateFactory - Load template with ID '"+t+"' failed.")},e.TemplateFactory=S,S})}(this),function(e,t){define("utilities/BrowserSniffer",[],function(){var t={wandoujia:!1};typeof e.OneRingRequest=="function"&&typeof e.OneRingStreaming=="function"&&(t.wandoujia=!0);var n={WindowsXP:!1},r=e.navigator.userAgent;if(r.indexOf("Windows NT 5.1")>=0||r.indexOf("Windows NT 5.2")>=0)n.WindowsXP=!0;var i={};return i.is=function(e){return t[e]},i.sysIs=function(e){return n[e]},i})}(this),function(){function t(e,t,n,r,i,s){t[e]&&(n.push(e),(t[e]===!0||t[e]===1)&&r.push(i+e+"/"+s))}function n(e,t,n,r,i){var s=r+t+"/"+i;require._fileExists(e.toUrl(s+".js"))&&n.push(s)}function r(e,t,n){var i;for(i in t)t.hasOwnProperty(i)&&(!e.hasOwnProperty(i)||n)?e[i]=t[i]:typeof t[i]=="object"&&r(e[i],t[i],n)}var e=/(^.*(^|\/)nls(\/|$))([^\/]*)\/?([^\/]*)/;define("i18n",["module"],function(i){var s=i.config?i.config():{};return{version:"2.0.1+",load:function(i,o,u,a){a=a||{},a.locale&&(s.locale=a.locale);var f,l=e.exec(i),c=l[1],h=l[4],p=l[5],d=h.split("-"),v=[],m={},g,y,b="";l[5]?(c=l[1],f=c+p):(f=i,p=l[4],h=s.locale,h||(h=s.locale=typeof navigator=="undefined"?"root":(navigator.language||navigator.userLanguage||"root").toLowerCase()),d=h.split("-"));if(a.isBuild){v.push(f),n(o,"root",v,c,p);for(g=0;g<d.length;g++)y=d[g],b+=(b?"-":"")+y,n(o,b,v,c,p);o(v,function(){u()})}else o([f],function(e){var n=[],i;t("root",e,n,v,c,p);for(g=0;g<d.length;g++)i=d[g],b+=(b?"-":"")+i,t(b,e,n,v,c,p);o(v,function(){var t,i,s;for(t=n.length-1;t>-1&&n[t];t--){s=n[t],i=e[s];if(i===!0||i===1)i=o(c+s+"/"+p);r(m,i)}u(m)})})}}})}(),define("nls/ui",{root:!0,en:!0}),define("nls/root/ui",{YES:"是",NO:"否",CONFIRM:"确定",CANCEL:"取消",RETRY:"重试",IGNORE:"忽略",NEXT:"下一步",PREV:"上一步",FINISH:"完成",CONTINUE:"继续",SKIP:"跳过",TIP:"提示",SORT:"排序",CHANGE_DOWN_PATH:"修改默认存储路径",DISPOSABLE_TIP:"下次不再提示",SELECT_ALL:"全部选择",AUTO_CLOSE:"{1} 秒后自动关闭"}),define("nls/misc",{root:!0,en:!0}),define("nls/root/misc",{NAME:"名称：",DATE:"日期：",FILE_SIZE:"文件大小：",USB_LOADING_INFO:"正在读取手机信息，请稍候...",USB_LOADING_INFO_FAILED:"读取手机信息失败，建议您重试",USB_ROM_TOO_OLD:"您的手机 ROM 版本低于 2.0，豌豆荚无法提供支持",USB_INSTALL_FAILED:"手机安装豌豆荚失败，建议您重试",USB_UPDATE_FAILED:"手机上的豌豆荚升级失败，建议您重试",USB_INSTALL_APK_INVALID:"手机上的豌豆荚安装包损坏，建议您重试",USB_APK_INSTALLING:"正在为您的手机安装豌豆荚，安装完成后即可管理手机...",USB_APK_UPDATING:"正在为您升级手机上的豌豆荚，完成后即可管理手机...",USB_INSTALL_FAILED_NO_MORE_SPACE:"手机安装豌豆荚失败，空间不足",USB_INSTALL_FAILED_INTERNAL_ERROR:"手机安装豌豆荚失败，手机内部错误",POSIBLE_REASON:"可能的原因：",MTP_BLOCK_BY_SCREEN_LOCK:'您的手机可能正处于锁屏状态，「SD卡管理」功能需要您解锁手机，请解锁后继续。如果您的手机没有锁屏，请尝试重启手机后再试。或<span class="link button-ftp">使用 FTP 方式管理 SD 卡。</span>',SELECT:"选择",CAESURA_SIGN:"、",DESELECT:"取消选择",DISPLAY:"显示：",PAUSE:"暂停",CONTINUE:"继续",DELETE:"删除",IMPORT:"导入",EXPORT:"导出",FORWARD:"前进",BACK:"后退",RESUME:"继续",REFRESH:"刷新",HOME_PAGE:"首页",REPORT_PROBLEM:"提交错误报告",REPORT_TIP:"如果您发现下载内容站出现显示错乱或内容无法下载等问题，请将错误报告提交给我们，这将帮助我们尽快解决问题，让该内容站恢复到可用状态。",REPORT_SITE_NAME:"内容站名称：",REPORT_SUCCESS:"错误报告提交成功。",REPORT_FAILED:"错误报告提交失败，请稍后再试。",PROBLEM_DES:"错误描述：",EMAIL_LABEL:"您的 Email 地址：",LOCALE_EXTENTION:"本地扩展",ZIP_EXTENTION:"打包扩展",RELOAD_EXTENTION:"重新载入",RELOAD_SUCCESS:"更新成功",MANGEMENT:"管理",ADD_TO_COLLECT:"收藏到左侧栏",BATCH_UNSTAR_PLUGINS:"<p>确定取消收藏选中的 {1} 个内容站吗？</p>",PUBLISH:"发布",LOGIN_TO_MANAGE:"请登录后管理收藏",LOGIN_TO_STAR:"请登录后添加收藏",LOGIN_TO_SHARE:"请登录后分享",DEVICE_CAPACITY_REMAIN:"，手机剩余空间为：{1}",SD_CAPACITY_REMAIN:"，存储卡剩余空间为：{1}",SUGGESTION_INSTALL:"装机必备",STAR:"收藏",STARRED_COUNT:"共 {1} 人收藏",DOWNLOAD_COUNT:"下载次数：{1}",GALLERY_LOADING:"正在加载丰富的下载内容...",FLASH_NOTIFIER:"您需要安装 Adobe Flash Player 才可以试听铃声和观看视频。",DOWNLOAD_FLASH:"下载 Adobe Flash Player",GALLERY_TITLE:"下载内容",SUGGESTION_TIP:"没有找到感兴趣的内容吗？要不要看看这些：",APP_DEPENDENCY_TIP:"「{1}」提供的内容需要下载以下应用才能使用",SEND:"提交",PLEASE_UNMOUNT_SD_CARD:"请关闭 USB 存储设备",PLEASE_UNMOUNT_SD_CARD_DES:"您的手机连接时打开了「USB 存储设备」。豌豆荚无法读取 SD 卡上的内容，请按照图示关闭「USB 存储设备」后重试。",ALERT_TIP_NO_SD_CARD:"非常抱歉，SD 卡不可用。请确认您的手机正确的插入了 SD 卡。",DEFAULT_DEVICE_NAME:"Android 设备",CONNECTION_LOSE:"连接中断。",NOT_ENOUGH_ROOM_FOR_IMPORT:"手机 SD 卡和内存存储空间不足，导入失败。请删掉一些文件后重试。",EXPLORE:"浏览",FINISH:"完成",IMPORTING:"正在导入，请勿断开手机",IMPORT_FINISH:"导入完成",OPEN_EXPORT_FILE:"查看导出文件",SHORE_TO_WEIBO:"分享到新浪微博",SET_RINGTONE:"铃声更换",SCREEN_SHOT_UNDER_USB:"屏幕截图功能需要 USB 连接模式下才能使用",SELECTOR_DESCRIPTION_TEXT:"已选 {1} 个，共 {2} 个",ADD_FILE:"添加文件",ADD_FOLDER:"添加文件夹",TITLE_PIM:"管理",TITLE_DOWNLOAD:"下载",NAV_WELCOME_TO_WDJ:"欢迎使用豌豆荚",NAV_OPTIMIZE:"手机体检",NAV_CONTACT:"通讯录",NAV_CONTACT_ALL:"全部联系人",NAV_CONTACT_HAS_PHONE:"有电话的联系人",NAV_CONTACT_STARRED:"收藏夹",NAV_APP:"应用和游戏",NAV_APP_INSTALLED:"已安装",NAV_APP_SYS:"系统",NAV_APP_UPDATABLE:"可升级",NAV_APP_IGNORED:"忽略升级",NAV_SMS:"短信",NAV_SMS_ALL:"全部短信",NAV_SMS_UNREAD:"未读短信",NAV_MUSIC:"音乐",NAV_PIC:"图片",NAV_PIC_PHONE_LIB:"手机相册",NAV_PIC_GALLERY:"图片库",NAV_PIC_CLOUD:"云相册",NAV_VIDEO:"视频",NAV_SHOW_GALLERY:"更多内容",ADD_COLLECT:"添加收藏",MOVE_UP:"上移",MOVE_DOWN:"下移",REMOVE_COLLECT:"取消收藏",SITE_NAME:"内容站",DEVELOPER:"开发者",DEVELOPER_LABEL:"开发者：",LOAD_EXTENTION:"载入扩展",CATEGORY:"类别",POPULARITY:"收藏人气",GALLERY_EMPTY_LIST:"什么也没有收藏",ILLEGAL_LOGOUT:"很抱歉，对于绑定的手机，只有在手机连接的时候才可以注销账号。",BIND:"绑定",UNBIND:"不绑定",BINDING_DEVICE:"绑定手机",BINDING_TITLE:"是否需要绑定当前连接的手机？",BINDING_DES:"绑定手机会让您使用豌豆荚更便捷。绑定包含下列操作：",BINDING_AUTOBACKUP:"自动备份手机数据",BINDING_AUTOBACKUP_DES:'将手机中的 <span class="text-warning">联系人、短信、照片、应用</span> 自动备份到电脑。',BINDING_ACCOUNT:"记住豌豆荚账号",BINDING_ACCOUNT_DES:"手机上的登录状态在连接电脑后被记住，不需要再次手动登录豌豆荚。",BINDING_CONNECT:"自动连接手机",BINDING_CONNECT_DES:"启动豌豆荚时，自动尝试通过 USB 或者 Wi-Fi 连接您的手机，无需您再手动连接。",BINDING_UPDATE:"应用升级提醒",BINDING_UPDATE_DES:"当您手机上的应用可以升级时，弹出提示框提示升级。",BINDING_WARNING:"如果您使用的不是自己的电脑和手机，请不要绑定！",FTP_FIX:"豌豆荚检测到您的系统默认 FTP 关联程序异常，可能无法正常使用 SD 卡管理功能。是否需要修复后再打开？",FIX:"修复",FIX_FAILED:"修复失败",OPEN_DERICTLY:"直接打开",REVIEW_FOR_UNINSTALL_TIPS:"卸载成功，来吐个槽？",REVIEW_FOR_UNINSTALL_TRAFFIC:"跑流量",REVIEW_FOR_UNINSTALL_ADS:"有广告",REVIEW_FOR_UNINSTALL_MEMORY:"占内存",REVIEW_FOR_UNINSTALL_OTHER:"不给力",NOTIFY_SETTING:"桌面提醒设置",DONT_SHOW_AGAIN:"不再提示",EXT_CATE_APP:"应用",EXT_CATE_GAME:"游戏",EXT_CATE_MUSIC:"音乐",EXT_CATE_VIDEO:"视频",EXT_CATE_EBOOK:"电子书",EXT_CATE_WALLPAPER:"壁纸",EXT_CATE_FUN:"有趣儿",EXT_CATE_DEV:"本地插件"}),define("nls/app",{root:!0,en:!0}),define("nls/root/app",{LOADING_UPDATE:"正在加载升级信息...",LATEST_LABEL:"最新：",DISLIKE:"猜错了",UPDATE_ALL:"一键升级",UPDATE:"升级",UPDATING:"升级中",COULD_UPDATE_TO:"升至：",COULD_UPDATE:"可升级至",MANAGE_MY_APPS:"管理我的应用",CONFIG:"设置",UPDATE_NOTIFI_FREQUENCE_WEEKLY:"每周提醒一次",UPDATE_NOTIFI_FREQUENCE_DAYLY:"每天提醒一次",UPDATE_NOTIFI_FREQUENCE_NEVER:"不再提醒",CONFIRM_UNINSTALL_ON_DEVICE:"请在手机上确认卸载。",MOVE:"移动",CATEGORY:"类别：",VERSION_HISTORY:"历史版本",IGNORED_APPS:"已有 {1} 个应用忽略升级",IGNORED_TITLE:"忽略升级的应用",ENABLE_APP_UPGRADE_TIP:'您已经禁用了「自动检测可升级应用」功能，<span class="link button-open-update">点击重新开启</span>',CHANGE_LOG_EMPRY:"暂时没有此应用的升级信息",SUGGESTION_REF:'根据 <span class="button-navigate-to-ref-page">{1}</span> 推荐',START_SCAN:"开洗",SCAN_TIP1:"山寨应用有风险，广告应用很烦人！",SCAN_TIP2:"豌豆洗白白会帮您找出这些应用，并协助您把它们更换成官方版或没有广告的版本。",SCAN_TIP3:"尽情享受放心应用的乐趣吧！",SCANNING:"正在准备洗澡水...",SCANNING_TIP:"分析已安装应用",QUERYING:"正在准备沐浴液...",QUERYING_TIP:"查找可替换应用",PIRATE_TIP:"山寨应用可替换为官方版",ADS_TIP:"广告应用可替换为无广告版",REPLACE_ALL:"一键洗白",PIRATE:"山寨",ADS:"广告",REPLACE:"替换为正版",REPLACE_ADS:"替换为无广告版",BEFORE_REPLACE:"替换前：",AFTER_REPLACE:"替换后：",UNKNOWN_VIRUS:"安全未知",NONE_VIRUS:"无病毒木马",HAS_VIRUS:"有病毒木马",MAY_VIRUS:"有可疑代码",NONE_ADS:"无广告",EMBEDED_ADS:"内嵌广告",POP_ADS:"通知栏广告",NON_POP_ADS:"无通知栏广告",BOTH_ADS:"多种广告",UNKNOWN_ADS:"广告状态未知",NONE_PRAVICE_VERIFIED:"无隐私风险",PRAVICE_VERIFIED:"隐私风险",UNKNOWN_VERIFIED:"隐私风险未知",NONE_OFFICIAL_VERIFIED:"非官方发布",OFFICIAL_VERIFIED:"官方发布",RESULT_EMPTY:"本来就好白！",RESULT_EMPTY_TIP:"太棒了！没有发现山寨应用和广告应用！",RESULT_FINISH:"洗后变好白",RESULT_FINISH_TIP:"没有山寨和广告应用的困扰，世界清静多了。",POP_ADS_TIP:"通知栏广告应用",RESULT_SUMMARY_POP_ADS:"洗好了！",RESULT_SUMMARY_POP_ADS_TIP:"还有 {1} 个有通知栏广告的应用暂时没有替换方案，您可以看看是否需要卸载。",UNINSTALL_ALL:"全部卸载",DIRECT_ADS_TITLE:"本来就挺白！",DIRECT_ADS_DESC:"没有发现山寨应用！</br>有 {1} 个有通知栏广告的应用暂时没有替换方案，您可以看看是否需要卸载。",WASH_CONNECT_TIP:"需要 USB 连接模式才可以洗白白哦！",WASH_SHARE:"去臭美一下",APP_WASH_ERROR:"糟糕！停水了！",WASH_ERROR_TIP:"洗白白的时候停水了，请检查您的网络连接后重试一下。",WASH_RETRY:"再放一缸水",WASH_SURVEY:"有豌豆没发现的脏应用？",TELL_US:"告诉豌豆们吧！",EMPTY_TIP_WEB_APP_NOT_LOGIN:'您想找到曾经安装过的应用吗？立即 <span class="button-login link">登录豌豆荚</span> 就能把它们都找回来！',ALERT_TIP_CRITICAL_APP:"非常抱歉，「{1}」无法删除。此应用是 Android 手机系统的核心应用，删除后会导致手机损坏或「变砖」。",ALERT_TIP_UNINSTALL_WIFI_CONFIRM:"您当前使用的是 Wi-Fi 连接，需要您到手机上完成卸载。",ALERT_TIP_DEL_SYS_APP_CONFIRM:"<p>确定要卸载选中的 {1} 个系统应用吗？</p><p>卸载系统应用可能会导致您的手机无法正常工作。</p>",ALERT_TIP_IGNORED_UPDATE_CONFIRM:"确定要忽略此应用的升级吗？忽略成功后，您可以在「忽略升级的应用」中更改此设置。",ALERT_TIP_MOVE_NEED_CONFIRM:"请到手机上确认移动应用。",SD_MOUNT_TIP:"由于您在手机上打开了「USB 存储设备」，豌豆荚无法显示您安装的应用程序。请根据提示管理「USB 存储」选项功能再试。",SD_MOUNT_TIP2:'您在手机上打开了「USB 存储设备」，如果您有安装在 SD 卡上的应用，将不能被读取。<a href="http://help.wandoujia.com/entries/22332803-sd" target="_default">查看帮助</a>',FLASH_TIP_TIP:'又刷机了？豌豆荚可以快速帮您恢复数据到手机上哦。<span class="button-flash link">马上去试试！</span>',ONE_KEY_UPDATE:"一键升级 ({1})",ONE_KEY_UPDATE_DES:"您有 {1} 个应用可升级。",UPDATE_DES:"{1} 个应用可升级",ONE_KEY_TRANSFER:"一键移动 ({1})",ONE_KEY_TRANSFER_DES:"帮您把手机内存的应用移动到 SD 卡上，彻底释放手机内存空间。",ONE_KEY_UPDATE_TITLE:"一键升级",INSTALL_ALL:"全部安装",WEB_APPS:"下载过的应用 ({1})",WEB_APPS_DES:"查看您下载过的 {1} 个应用。",WEB_APPS_DES_EMPTY:"查看您下载过的应用。",WEB_APPS_EMPTY:"下载过的",WEB_APPS_DES_LOGIN:"登录豌豆荚查看下载过的应用。",WEB_APPS_TITLE:"下载过的应用",WEB_APPS_NUMBER:"您共下载过 {1} 个应用，",WEB_APPS_PERCENT:"超过了 {1}% 的豌豆荚用户。",WEB_APPS_EMPTY_TIP_PRE:"您还没有下载过任何应用哦，现在马上去 ",WEB_APPS_EMPTY_TIP_LINK:"寻找有趣的应用",WEB_APPS_EMPTY_TIP_POST:" 来下载吧！",APP_SEARCH:"应用搜索",WEB_APPS_HIDE_TEXT:"隐藏",UNINSTALL_AFTER_HIDE:"已从下载历史中删除「{1}」，要在手机上卸载这个应用吗？",WEB_APPS_HIDING_TEXT:"正在隐藏",WEB_APPS_HIDE_FAILED_TEXT:"隐藏失败",APP_WASH:"豌豆洗白白",APP_WASH_DES:"洗白白一下，跟山寨应用，有广告的应用说白白！",DO_U_LIKE_THIS_APP:"喜欢这款应用么",DO_U_LIKE_THIS_APP2:"您喜欢这款应用吗",LIKE:"喜欢",UNLIKE:"不喜欢",COMMENTARY_PLACEHOLDER:"点评一下「{1}」...",SHARE:"分享",COMMENTARY:"评论",COMMENTARY_APP:"评论应用",COMMENTARY_APP_SUCCESS:"评论成功！",COMMENTARY_APP_FAILED:"评论失败！",LOGIN:"登录",SYNC:"同步：",MODIFY:"发表",SEND_SUCCESS:"成功",SEND_FAILED:"失败",DOWNLOAD_COUNT:"下载次数：",DOWNLOAD_COUNT_TIP:"{1}次",NO_SPECIAL_PERMISSION:"无特殊权限",BATCH_APP_TITLE:"选择了 {1} 个应用",ADDING_LOCAL_APK:"正在添加本地应用，请稍候...",UPDATEING_ALL:"正在升级...",APP_NOT_INDEXED:"很遗憾，豌豆荚还没有收录这个应用呢",LOOK_FOR_DETAIL:"查看应用详情",COL_NAME_LABEL:"应用名称",COL_SIZE_LABEL:"大小",COL_RATE_LABEL:"好评率",COL_VERSION_LABEL:"版本",COL_INSTALL_TIME:"安装时间",COL_PERMISSION_LABEL:"权限",COL_INSTALL_POSITION:"安装位置",INSTALL_POSITION_LABEL:"安装位置：",RATE_COUNT:"{1}人评价",LIKE_COUNT:"{1}人",BUTTON_ADD_APP_LABEL:"安装新应用",BUTTON_UNINSTALL_LABEL:"卸载",BUTTON_UPGRADE_LABEL:"升级",UPGRADEING_TEXT:"升级中",BUTTON_EXPORT_LABEL:"导出",BUTTON_REFRESH_LABEL:"刷新",BUTTON_REFRESH_LIST_LABEL:"刷新列表",BUTTON_INSTALL_LABEL:"安装",BUTTON_CANCEL_LABEL:"取消",ALREAD_INSTALLED:"已安装",INSTALL_STATUS:"安装状态",BUTTON_MOVE_TO_DEVICE_LABEL:"移动到手机内存",APK_SELECTOR_DISCRIPTION_TEXT:"选择 APK 文件或包含 APK 的文件夹，支持多选",DIALOG_TIP:"提示",UNINSTALL_TIP:"确定要卸载选中的 {1} 个应用？",MOVE_TO_SD_CARD:"您选择了 {1} 个可移动到 SD 卡的应用，确定转移吗？",MOVE_TO_DEVICE:"您选择了 {1} 个可移动到手机内存的应用，确定转移吗？",UPGRADE_TIP_TEXT:"确定要升级选中的 {1} 个应用？",NON_CHECKED_TEXT:"您还未选择任何应用呢。",NON_USER_APPS_TEXT:"您还未安装过应用呢",NON_SYSTEM_APPS_TEXT:"您的手机没有系统应用",NON_UPGRADE_APPS_TEXT:"太赞了，所有的应用都是最新的了",NON_IGNORE_APPS_TEXT:"您是升级控，不会放过任何一个升级",UPGRADE_TIP:"亲，目前不能为您的手机升级应用，我们正在努力中...",UNKNOWN_PERMISSION:"未知权限",IGNORED:"已忽略",DELETE_APK_WHEN_FINISH:"完成后删除本地 APK 文件",ONE_KEY_TRANSFER_LABEL:"一键移动({1})",ONE_KEY_TRANSFER_TITLE:"一键移动",ONE_KEY_UNINSTALL:"一键清理",ONE_KEY_UNINSTALL_DES:"检测到您有 {1} 个应用可以清理",INSTALL:"安装",INSTALLING:"安装中",UNINSTALL:"卸载",APP_DETAIL:"应用详情",VERSION:"当前版本：",LATEST_VERSION:"最新版本：",SIZE:"大小：",PERMISSON:"权限：",MORE:"更多",COLLAPSE:"收起",RECOMMENDATION_DEFAULT:"豌豆猜您也喜欢",RECOMMENDATION:"安装了这个应用的人也喜欢",PHONE:"手机内存",SD_CARD:"SD 卡",APP_INSTALL_VERSION_LABEL:"已安装的版本",APP_LATEST_VERSION_LABEL:"最新的版本",APP_SELECT_GRID_TIP:"您还未添加应用",APP_SELECT_GRID_TIP_BACKUP:'，您可以 <span class="button-import-backup link">从自动备份中导入</span>',BUTTON_TRANSFER_LABEL:"移动到 SD 卡",CONFIRM_UNINSTALL:"您确定卸载该应用吗？",CONFIRM_UNINSTALL_SYSTEM_APP:"确定要卸载该应用吗？<br />您选择的应用是系统应用。卸载错误的系统应用可能导致您的系统损坏，手机无法使用。",APP_DELETE_PROGRESS:"正在卸载，请稍候...",APP_DELETE_FAILED:"{1} 个应用卸载失败。",APP_DELETE_SUCCESS:"成功卸载 {1} 个应用。",APP_EXPORT_PROGRESS:"正在导出，请稍候...",APP_EXPORT_SUCCESS:"成功导出 {1} 个应用。",APPS_INSTALL_FAILED:"非常抱歉，以下应用文件损坏无法安装：",APPS_NONE_TRANSFER_TEXT:"没有可转移的应用。",APPS_NONE_UPGRADABLE_TEXT:"您还没有可升级的应用",APPS_TRANSFER_TIP_TEXT:"您选择的应用移动到 SD 卡后可能导致应用无法正常使用，您确定要移动吗？ ",APPS_TRANSFER_PROCESSING_TEXT:"正在移动...",APPS_TRANSFER_SUCCESS_TEXT:"转移成功",APPS_BATCH_UNINSTALL_FAILED:"非常抱歉，以下应用卸载失败：",UNINSTALL_FAILED:"非常抱歉，应用卸载失败。",UNINSTALL_FAILED_SYSTEM_APP:"请在豌豆荚上允许豌豆荚获取 root 权限后重试。",APPS_IGNORE_UPGRADE_TEXT:"忽略",APPS_CANCEL_IGNORE_TEXT:"取消忽略",APPS_TRANSFER_FAILED_TEXT:"非常抱歉，以下应用转移失败：",APPS_EXPORT_ERROR_TEXT:"非常抱歉，以下应用导出失败：",APPS_USB_TEXT:"您的手机连接时打开了「USB 存储设备」，豌豆荚无法移动应用到 SD 卡，请按照图示关闭「USB 存储设备」后重试。",XIAOMI_SD_DISABLE:"非常抱歉，无法安装应用到 SD 卡。<br />小米手机默认 ROM 的设置禁止了安装应用到 SD 卡，豌豆荚无法为您安装或移动应用到 SD 卡。",GET_PERMISSION_TEXT:"请在手机上完成授权",UNKNOWN_APP:"未知应用",MOVE_FAILED:"转移失败了。",EXPORT_ERROR:"应用导出失败。",UNINSTALL_ERROR:"应用卸载失败。",GETTING_RECOMMEND:"正在猜呀猜...",RECOMMEND_LIST_EMPTY:"好累啊，明天再玩吧！",GET_RECOMMEND_ERROR:"抱歉，猜不着啦","android.permission-group.ACCOUNTS":"访问您的账号","android.permission-group.COST_MONEY":"需要您付费的服务","android.permission-group.DEVELOPMENT_TOOLS":"开发工具","android.permission-group.LOCATION":"您的位置","android.permission-group.HARDWARE_CONTROLS":"硬件控制","android.permission-group.MESSAGES":"读写您的短信和邮件","android.permission-group.NETWORK":"访问网络","android.permission-group.PERSONAL_INFO":"您的个人信息","android.permission-group.PHONE_CALLS":"手机通话","android.permission-group.STORAGE":"读写 SD 卡","android.permission-group.SYSTEM_TOOLS":"系统工具","android.permission.ACCESS_CHECKIN_PROPERTIES":"访问检入属性","android.permission.ACCESS_COARSE_LOCATION":"读取基于网络的粗略位置","android.permission.ACCESS_FINE_LOCATION":"读取精准的 GPS 位置","android.permission.ACCESS_LOCATION_EXTRA_COMMANDS":"访问额外的位置信息提供程序命令","android.permission.ACCESS_MOCK_LOCATION":"使用模拟地点进行测试","android.permission.ACCESS_NETWORK_STATE":"查看网络状态","android.permission.ACCESS_SURFACE_FLINGER":"访问 SurfaceFlinger","android.permission.ACCESS_WIFI_STATE":"查看 Wi-Fi 状态","android.permission.BATTERY_STATS":"修改电池统计信息","android.permission.BLUETOOTH":"创建蓝牙连接","android.permission.BLUETOOTH_ADMIN":"蓝牙管理","android.permission.BRICK":"变砖","android.permission.BROADCAST_PACKAGE_REMOVED":"发送包删除的广播","android.permission.BROADCAST_STICKY":"发送置顶广播","android.permission.CALL_PHONE":"拨打电话","android.permission.CALL_PRIVILEGED":"拨打任何电话","android.permission.CAMERA":"拍照","android.permission.CHANGE_COMPONENT_ENABLED_STATE":"启用或停用应用程序组件","android.permission.CHANGE_CONFIGURATION":"更改用户界面设置","android.permission.CHANGE_NETWORK_STATE":"更改网络连接性","android.permission.CHANGE_WIFI_STATE":"更改 Wi-Fi 状态","android.permission.CLEAR_APP_CACHE":"删除所有应用程序缓存数据","android.permission.CLEAR_APP_USER_DATA":"删除应用程序的数据","android.permission.CONTROL_LOCATION_UPDATES":"控制位置更新通知","android.permission.DELETE_CACHE_FILES":"删除其他应用程序的缓存","android.permission.DELETE_PACKAGES":"删除应用程序","android.permission.DEVICE_POWER":"开机或关机","android.permission.DIAGNOSTIC":"读取/写入诊断所拥有的资源","android.permission.DISABLE_KEYGUARD":"停用键盘锁","android.permission.DUMP":"检索系统内部状态","android.permission.EXPAND_STATUS_BAR":"展开/收拢状态栏","android.permission.FACTORY_TEST":"在出厂测试模式下运行","android.permission.FLASHLIGHT":"控制闪光灯","android.permission.FORCE_BACK":"强制应用程序关闭","android.permission.GET_ACCOUNTS":"发现已知账号","android.permission.GET_PACKAGE_SIZE":"计算应用程序存储空间","android.permission.GET_TASKS":"检索当前运行的应用程序","android.permission.HARDWARE_TEST":"测试硬件","android.permission.INJECT_EVENTS":"按键和控制按钮","android.permission.INSTALL_PACKAGES":"直接安装应用程序","android.permission.public_SYSTEM_WINDOW":"显示未授权的窗口","android.permission.INTERNET":"网络通信","android.permission.MANAGE_APP_TOKENS":"管理应用程序令牌","android.permission.MASTER_CLEAR":"将系统恢复为出厂设置","android.permission.MODIFY_AUDIO_SETTINGS":"更改您的音频设置","android.permission.MODIFY_PHONE_STATE":"修改手机状态","android.permission.READ_PHONE_STATE":"读取手机状态和身份","android.permission.MOUNT_UNMOUNT_FILESYSTEMS":"装载和卸载文件系统","android.permission.PERSISTENT_ACTIVITY":"让应用程序始终运行","android.permission.PROCESS_OUTGOING_CALLS":"拦截外拨电话","android.permission.READ_CALENDAR":"访问日历","android.permission.READ_CONTACTS":"访问联系人数据","android.permission.READ_FRAME_BUFFER":"读取帧缓冲区","android.permission.READ_INPUT_STATE":"记录您键入的内容和执行的操作","android.permission.READ_LOGS":"读取系统日志文件","android.permission.READ_OWNER_DATA":"读取所有者数据","android.permission.READ_SMS":"读取短信或彩信","android.permission.READ_SYNC_SETTINGS":"读取同步设置","android.permission.READ_SYNC_STATS":"读取同步统计信息","android.permission.REBOOT":"强行重新启动手机","android.permission.RECEIVE_BOOT_COMPLETED":"开机时自动启动","android.permission.RECEIVE_MMS":"接收彩信","android.permission.RECEIVE_SMS":"接收短信","android.permission.RECEIVE_WAP_PUSH":"接收 WAP","android.permission.RECORD_AUDIO":"录音","android.permission.REORDER_TASKS":"对正在运行的应用程序重新排序","android.permission.RESTART_PACKAGES":"重新启动应用程序","android.permission.SEND_SMS":"发送短信","android.permission.SET_ACTIVITY_WATCHER":"监控所有应用程序的启动","android.permission.SET_ALWAYS_FINISH":"关闭所有后台应用程序","android.permission.SET_ANIMATION_SCALE":"修改全局动画速度","android.permission.SET_DEBUG_APP":"启用应用程序调试","android.permission.SET_ORIENTATION":"更改屏幕显示方向","android.permission.SET_PREFERRED_APPLICATIONS":"设置首选应用程序","android.permission.SET_PROCESS_FOREGROUND":"允许应用程序强行运行到前端","android.permission.SET_PROCESS_LIMIT":"限制运行的进程个数","android.permission.SET_TIME_ZONE":"设置时区","android.permission.SET_WALLPAPER":"设置壁纸","android.permission.SET_WALLPAPER_HINTS":"设置有关壁纸大小的提示","android.permission.SIGNAL_PERSISTENT_PROCESSES":"向应用程序发送 Linux 信号","android.permission.STATUS_BAR":"停用或修改状态栏","android.permission.SUBSCRIBED_FEEDS_READ":"读取订阅的供稿","android.permission.SYSTEM_ALERT_WINDOW":"显示系统级警报","android.permission.VIBRATE":"控制振动器","android.permission.WAKE_LOCK":"防止手机休眠","android.permission.WRITE_APN_SETTINGS":"写入「接入点名称」设置","android.permission.WRITE_CALENDAR":"添加或修改日历活动以及向邀请对象发送电子邮件","android.permission.WRITE_CONTACTS":"编辑或写入联系人","android.permission.WRITE_GSERVICES":"修改 Google 服务地图","android.permission.WRITE_OWNER_DATA":"写入所有者数据","android.permission.WRITE_SETTINGS":"修改全局系统设置","android.permission.WRITE_SMS":"编辑短信或彩信","android.permission.WRITE_SYNC_SETTINGS":"写入同步设置"}),define("nls/backup_restore",{root:!0,en:!0}),define("nls/root/backup_restore",{CONTACT:"联系人",CONTACT_GROUP:"分组",SMS:"短信",MMS:"彩信",CALLLOG:"通话记录",BOOKMARK:"书签",SETTING:"设置",APP:"应用程序",APP_DATA:"应用数据",BR_TYPE_WORD_ENUM:["","联系人","分组","短信","彩信","通话记录","书签","设置","应用程序","应用程序","应用数据"],CONFIRM_TITLE:"提示",BACKUP_TITLE:"备份数据",BACKUP_TITLE_LOCAL:"备份到电脑",BACKUP_TITLE_REMOTE:"备份到云端",RESTORE_TITLE_LOCAL:"从本地恢复",RESTORE_TITLE_REMOTE:"从云端恢复",RESTORE_TITLE:"恢复数据",START_BACKUP:"开始备份",START_RESTORE:"开始恢复",BACKUP_WAITING:"稍后备份{1}",BACKUP_PROCESS:"正在备份{1}",BACKUP_PROCESS_APP_DATA:"正在备份应用数据，详细备份进度请在手机上查看",BACKUP_FINISH:"{1}备份完成。",BACKUP_FAILED:"{1}备份失败。",RESTORE_PROCESS:"正在恢复{1}，请稍候...",RESTORE_WAITING:"稍后恢复{1}",RESTORE_FINISH:"{1}恢复完成。",RESTORE_FAILED:"{1}恢复失败。",TIP_IN_WIFI:"很抱歉，为了确保您的数据不会丢失，豌豆荚暂时不支持在 Wi-Fi 连接手机时备份和恢复数据。<br />请连接 USB 数据线后重试。",ERROR_WHEN_WRITE_ROM:"好像找不到您的 SD 卡了……<br />请您确认一下：<br />- 连接电脑时一定要在手机上关闭「USB 大容量存储模式」哦<br />- SD 卡是否正确地插入手机了呢？<br />- 或者……您的SD 卡是不是坏掉啦？换一张卡试试呢？",RESTORE_CONFIRM_1_TITLE:"恢复数据期间，为了确保数据的完整性，请确认",RESTORE_CONFIRM_1_TIP1:"您的手机电量已不足 20%，继续恢复有可能导致手机电量耗尽造成数据丢失，建议充电后再进行恢复。您确认要继续恢复数据吗？",RESTORE_CONFIRM_1_TIP2:"- 不要对联系人、短信、应用进行导入、安装、删除等操作",RESTORE_CONFIRM_1_TIP3:"- 手机剩余电量大于 20%",RESTORE_CONFIRM_2_TITLE:"您指定的备份文件无效，请重新指定。",RESTORE_CONFIRM_3_TITLE:"您要把联系人恢复到哪个账号？请选择",RESTORE_CONFIRM_4_TITLE:"是否要删除手机上原有数据？已安装的应用程序和SIM卡上的联系人不会被删除。",RESTORE_CONFIRM_4_TIP1:"不删除，同时保留两份数据",RESTORE_CONFIRM_4_TIP2:"删除，只需要刚刚恢复的数据",DELETING:"正在删除，请稍候...",DELETE_SUCCESS:"成功删除手机原有的数据。",DELETE_FAILED:"很抱歉，删除手机原有数据失败。",RESTORE_CONFIRM_6_TIP1:"您的电脑和手机的连接中断。",RESTORE_CONFIRM_6_TIP2:"豌豆荚会在手机上继续恢复，请到手机上查看恢复进度。",RESTORE_CONFIRM_7_TITLE:"您的电脑和手机的连接中断。无法完成恢复。",RESTORE_CONFIRM_8_TITLE:"以下 {1} 个联系人恢复失败。是否忽略并继续恢复其他数据？",RESTORE_CONFIRM_9_TITLE:"很抱歉，有 {1} 条{2}恢复失败。是否忽略并继续恢复其他数据？",RESTORE_CONFIRM_10_TITLE:"以下 {1} 个应用恢复失败，可能原因有：",RESTORE_CONFIRM_10_TIP1:"是否忽略并继续恢复其他数据？",RESTORE_RUNING:"设备上已有恢复任务在进行中。",BACKUP_RESTORE_RUNING:"设备上已有备份或恢复任务在进行中。",BACKUP_TO_CLOUD_FAILED:"很抱歉，备份到云端失败。",BACKUP_TO_CLOUD_FAILED_DETAIL:"{1} 条{2}备份失败。",NETWORK_ERROR:"很抱歉，网络连接失败。",RESTORE_INVLID_FILE:"您指定的备份文件无效，请重新指定。",RESTORE_INVLID_CONTACTS_FILE:"您指定的备份文件无效。如果您想单独恢复联系人，请使用联系人管理中的导入功能。",RESTORE_SUCCESS:"豌豆荚成功恢复了您的数据。",RESTART:"某些数据可能要重启手机才能看到, 建议您立即重启手机。",RESTORE_STEP_2_TITLE:"请选择您要恢复的数据",RESTORE_FINISH_TIP:"恢复完成",RESTORING_TIP:"正在恢复，请勿断开手机连接",RESTORING_ON_DEVICE_TIP:"正在恢复，请到手机上查看恢复进度。",SELECT_BACKUP_FILE:"指定备份文件",SELECT_BACKUP_FILE_FOLDER:"指定备份文件夹",BACKUP_FILE:"备份文件",SELECT_FILE:"请选择备份文件",BAK_TIP_PREFIX:"（后缀为 .bak 的备份文件请使用 ",OLD_VERSION:"旧版豌豆荚",BAK_TIP_SUFFIX:"进行恢复）",BACKUP_CONFIRM_1_TITLE:"备份数据期间，为了确保数据的完整性，请确认",BACKUP_CONFIRM_2_TIP1:"由于应用程序「{1}」的权限设置，豌豆荚无法备份此应用程序。",BACKUP_CONFIRM_2_TIP2:"建议您忽略此应用程序并继续备份其他数据。",BACKUP_CONFIRM_3_TIP1:"是否覆盖已有的备份文件？",BACKUP_CONFIRM_4_TITLE:"很抱歉，您设置的备份文件名或者目录不可用，请重新设置。",BACKUP_CONFIRM_5_TITLE:"以下 {1} 个应用备份失败。是否忽略并继续备份其他数据？",CHOOSE_APP_TYPE_TITLE:"请选择备份应用数据的方式",RETRYING:"正在重试，请稍候...",BACKUP_CONNECTION_LOST:"您的电脑和手机的连接中断。无法完成备份。",RESTORE_CONNECTION_LOST:"您的电脑和手机的连接中断。无法完成恢复。",SD_CARD_ERROR:"SD 卡无法写入。请检查您的 SD 卡是否有足够的存储空间, 或者是否处于写保护状态。",FILE_DOWNLOAD_ERROR:"数据传输失败",PC_ZIP_ERROR:"压缩临时文件时出错。",CANCELED:"已取消操作。",FILE_PATH_ERROR:"文件路径设置不正确。",FILE_CANT_READ:"很抱歉，您选择的文件 {1} 不可用，请检查后重试。",BACKUP_RUNING:"设备上已有备份任务在进行中。",UNKNOW_ERROR:"很抱歉，出现未知错误：",BACKUP_STEP_1_TITLE:"请选择您要备份的数据",BACKUP_STEP_2_TITLE:"请命名备份文件",TYPE:"数据类型",QUANTITY:"数量",FILE_TYPE:"备份方式",SAVE_LOCATION:"设置保存位置",SAVE_LOCATION_LABEL:"备份保存位置：",OPEN_BACKUP_FILE:"查看备份文件",FINISH_ALL:"全部完成。",PRIVACY_TIP:"豌豆荚未对备份数据进行加密，备份的数据是您的私人数据，请妥善保管。",MOBILE_TIP:"您可以在电脑或手机上恢复这些数据。",BACKUPING:"正在备份，请勿断开手机连接",BACKUP_FINISH_LABEL:"备份完成",RESTORE_FINISH_LABEL:"恢复完成",BACKUP_COMPRESSING:"正在为您压缩备份文件，请稍候...",FILE_TYPE_APK:"普通备份",FILE_TYPE_WDAPK:"快速备份 (beta)",WDAPK_INTRO_TIP:"• 快速备份：（推荐）<br />豌豆荚会备份您应用的名称，恢复时豌豆荚会根据应用名称即时下载最新版本恢复到您的手机上。备份速度飞快，但恢复时需要联网。<br />• 普通备份：<br />豌豆荚会将您的应用完整复制到电脑上保存。备份速度一般，但恢复时不需联网。",INSTALL_APK_TIP1:"豌豆荚会下载和安装备份的应用的最新版本，请点击继续。",INSTALL_APK_TIP2:"",RESTORE_APP_TIP:"豌豆荚已将要恢复的应用添加到任务管理器，您可以在下载管理界面中查看应用安装的情况。",RESTORE_PERMISSSION_TIP1:"很抱歉，{1}恢复失败。",RESTORE_PERMISSSION_TIP2:'您可能使用了控制手机数据读写权限的系统或者程序。例如MIUI系统、Flyme系统、LBE、腾讯手机管家等。请您授予豌豆荚读写{1}的权限后再继续恢复数据。<a target="_default" href="http://help.wandoujia.com/entries/22017678?utm_campaign=tips&utm_medium=client&utm_source=backup">帮助</a>',RESTORE_PERMISSSION_TIP3:"是否忽略并继续恢复其他数据？",RESTORE_PERMISSSION_PART_TIP1:"很抱歉，{1} 个{2}恢复失败。",SELECT_FILE_FOLDER_TIP:"抱歉，豌豆荚没有找到您备份的文件，您是否把备份文件移动到了其他位置？",APP_TYPE_WDAPK_TITLE:"备份应用列表（推荐）",APP_TYPE_WDAPK_CONTENT:"备份应用的名称。恢复时会根据应用名称即时下载最新版本恢复到您的手机上。备份速度飞快，但<em>恢复时需要联网</em>。",APP_TYPE_APK_TITLE:"备份完整应用文件",APP_TYPE_APK_CONTENT:"豌豆荚会将您的应用完整复制到电脑上保存。备份速度一般，但恢复时不需联网。",APP_TYPE_APK_CONTENT_WIFI:"您处于Wi-Fi连接状态，备份完整应用功能不可用。请使用 USB 数据线连接。",BACKUP_WIFI_TIP:"您已经可以使用 Wi-Fi 连接豌豆荚进行数据备份！<br />在 Wi-Fi 连接状态下您的备份过程需要的时间会稍长，请勿断开 Wi-Fi 连接。",RESTORE_WIFI_TIP:"您已经可以使用 Wi-Fi 连接豌豆荚进行数据恢复！<br />在 Wi-Fi 连接状态下您的恢复过程需要的时间会稍长，请勿断开 Wi-Fi 连接。",CHOOSE_BACKUP_TYPE_TITLE:"请选择备份方式",BACKUP_TYPE_LOCAL_TITLE:"备份到电脑",BACKUP_TYPE_LOCAL_CONTENT:"将您手机上的数据备份到电脑上，方便恢复",BACKUP_TYPE_REMOTE_TITLE:"备份到云端",BACKUP_TYPE_REMOTE_CONTENT:"将您的数据备份到云端的私人豌豆荚账号中，数据不会丢失。可以恢复到任意历史时间点，还可以直接从手机恢复",CHOOSE_BACKUP_DATA_TIP:"请选择要备份的数据",CHOOSE_RESTORE_DATA_TIP:"请选择要恢复的数据",LOGIN_FAILED_TIP:"很抱歉，登陆失败。请检查您的网络后重试登陆，或选择本地备份",PERMISSION_TIP:'读取手机数据失败。<br />可能是手机上的安全软件阻止了豌豆荚读取联系人或信息的权限，请在手机上「权限管理」中授权。<a target="_default" href="http://help.wandoujia.com/entries/22017678?utm_campaign=tips&utm_medium=client&utm_source=sms">帮助</a>',SET_FILE_NAME:"请命名备份文件",DEFAULT_FILE_NAME:"豌豆荚的备份文件",FILE_NAME_UNLEGAL:"您指定的文件名无效，可能其中包含非法字符，请重新指定",GET_FILE_PATH_FAILED:"很抱歉，获取备份路径名失败，请手工指定",GET_FILE_NAME_FAILED:"很抱歉，获取备份文件失败，请手工指定",SET_FILE_PATH_FAILED:"很抱歉，设置备份路径失败",SET_FILE_PATH_LINK_BUTTON:"修改保存位置",SET_RESTORE_FILE_FAILED:"很抱歉，选择备份文件失败",CONNECT_LOST:"您的电脑和手机的连接中断。",FILE_PATH_INVALID:"很抱歉，您设置的备份文件名或者目录不可用，请重新设置。",OVERWIRTE_EXISTS_FILE_TIP:"是否覆盖已有的备份文件？",BACKUP_FAILED_TIP:"很抱歉，备份失败：",RESTORE_FAILED_TIP:"很抱歉，恢复失败：",RESTORE_DOWNLOAD_FAILED_TIP:"很抱歉，恢复失败：",BACKUP_ABORT_TIP:"很抱歉，备份终止",RESTORE_ABORT_TIP:"您的电脑和手机的连接中断。<br />豌豆荚会在手机上继续恢复，请到手机上查看恢复进度。",APP_ERROR_LIST_TITLE:"以下 {1} 个应用备份失败。是否忽略并继续备份其他数据？",APP_DATA_ERROR_LIST_TITLE:"以下 {1} 个应用的应用数据备份失败。是否忽略？",LOGIN_LINK_BUTTON:"请登录豌豆荚账号",CHOOSE_RESTORE_TYPE_TITLE:"请选择恢复方式",RESTORE_TYPE_LOCAL_TITLE:"从电脑恢复",RESTORE_TYPE_LOCAL_CONTENT:"从您电脑上的本地备份文件中进行恢复",RESTORE_TYPE_REMOTE_TITLE:"从云端恢复",RESTORE_TYPE_REMOTE_CONTENT:"从云端的备份数据进行恢复，可以恢复到任意历史时间点",RESTORE_LIST_SNAPHOST_FAILED:"很抱歉，加载数据列表失败。",CHOOSE_RESTORE_FILE_TITLE:"请选择您要恢复的备份文件",CHOOSE_RESTORE_DATE_TITLE:"请选择您要恢复到的日期",RESTORE_DATE:"日期",RESTORE_DEVICE:"设备",CHOOSE_RESTORE_FILE_TIP_BEFORE:"您也可以 ",CHOOSE_RESTORE_FILE_TIP_LINK:"指定备份文件",CHOOSE_RESTORE_FILE_TIP_AFTER:" 进行恢复",RESOTRE_OLD_VERSION_TIP_BEFORE:"您可以自己指定备份文件进行恢复，如果您要恢复后缀为 .bak 的备份文件请使用 ",RESOTRE_OLD_VERSION_TIP_LINK:"旧版豌豆荚",RESOTRE_OLD_VERSION_TIP_AFTER:" 恢复",RESTORE_OLD_VERSION_DL_LINK:"http://dl.wandoujia.com/files/release/wdj_installer.exe",RESTORE_REMOTE_EMPTY_LIST:"云端还没有您的备份数据。<br />您必须先使用备份到云端功能备份数据，才能从云端进行恢复。",RESTORE_BATTERY_TIP:"您的手机电量已不足 20%，继续恢复有可能导致手机电量耗尽造成数据丢失，建议充电后再进行恢复。您确认要继续恢复数据吗？",RESTORE_CHOOSE_ACCOUNT_TIP:"您要把联系人恢复到哪个账号？请选择",RESTORE_DELETE_DATA_TIP:"是否要删除手机上原有数据？已安装的应用程序和SIM卡上的联系人不会被删除。",RESTORE_DELETE_DATA_TIP_YES:"删除，只需要刚刚恢复的数据",RESTORE_DELETE_DATA_TIP_NO:"不删除，同时保留两份数据",RESTORE_UNKNOW_DEVICE:"未知设备",RESTORE_DOWNLOAD_PROGRESSING:"正在从云端下载备份数据，请稍后...",RESTORE_DOWNLOAD_FINISH:"下载备份数据完成。",AUTO_BACKUP_TIP_TITLE:"还在手动备份？试试自动备份吧！",AUTO_BACKUP_TIP_DESC:"绑定手机后，备份手机再也不需要您亲自动手了！您是否要绑定手机并开启自动备份？",AUTO_BACKUP_YES:"开启自动备份",AUTO_BACKUP_NO:"暂不开启",AUTO_BACKUP_REMOTE_TIP_TITLE:"电脑数据容易丢，试试自动云备份吧！",AUTO_BACKUP_REMOTE_TIP_DESC:"自动将您的 <em>联系人/短信/应用</em> 备份到云端，不需要再手动备份。开启后同时也会在手机上生效。您是否要开启云备份？",AUTO_BACKUP_REMOTE_YES:"开启云备份",BACKUP_APP_DATA_TIP:"豌豆荚可以帮助您备份应用的数据。<br />例如游戏进度、聊天记录、离线地图等。在恢复应用时就能恢复之前应用的使用状态。<br />此功能仅在 USB 连接下提供。",BACKUP_APP_DATA_TIP_TITLE:"请确认备份应用数据",BACKUP_APP_DATA_TIP_CONTENT:"备份应用数据时，您手机会弹出提示让您确认是否要备份数据。请点击「备份我的数据」进行备份。<br /><em>为方便数据恢复，请勿设置备份密码。</em>",RESTORE_APP_DATA_TIP_TITLE:"恢复应用数据时需要手动确认",BACKUP_APP_DATA_WAITING:"正在等待您在手机上确认备份应用数据",RESTORE_APP_DATA_WAITING:"正在等待您在手机上确认恢复应用数据",RESTORE_APP_DATA_TIP_CONTENT:"恢复应用数据时，您的手机会弹出提示让您确认是否要恢复数据。请点击「恢复我的数据」进行恢复。",BACKUP_APP_DATA_ERROR:"很抱歉，备份应用数据失败。",BACKUP_APP_DATA_ERROR_DEVICE_INCOMPATIBLE:"设备未 root，或系统版本过低。",BACKUP_APP_DATA_ERROR_DEVICE_WIFI:"豌豆荚暂不支持 Wi-Fi 连接下备份应用数据。",BACKUP_APP_DATA_ERROR_ENCRYPT:"豌豆荚暂不支持对备份加密，请不要输入密码。",BACKUP_APP_DATA_ERROR_CONNECT_ERROR:"文件传输失败。",USER_CANCELED:"备份应用数据操作被取消。",CUSTOM_AUTH_FAILED_ERROR:"登录信息过期，请退出后重新登录。",CUSTOM_SERVER_UNAVALABEL_ERROR:'很抱歉，辛勤的豌豆荚服务器太累了，请稍后再试。 <a target="_default" href="http://wandoujia.zendesk.com/entries/22986628-cai">帮助</a>',RESTORE_APP_DATA_ERROR:"应用数据恢复失败。",CUSTOM_UNZIP_BACKUP_FILE_ERROR:"很抱歉，解压缩失败，部分应用未能恢复。",AUTO_BACKUP_COMPLETE_FINISH:"自动备份完成！",AUTO_BACKUP_COMPLETE_FINISH_TIP:"备份数据未加密，请确保您使用的是自己的手机和电脑。",AUTO_BACKUP_COMPLETE_FINISH_CONTENT:"本次为您备份了 <em>{1}</em>",PHOTO_DOWNLOAD_NOTIFY_TITLE:"已从云同步 {1} 张照片到电脑",PHOTO_DOWNLOAD_NOTIFY_CONTENT:"云相册刚刚帮您从云端同步了新照片到电脑。您可以查看同步的照片。",BACKUP_GUIDE_TIP:"您还没有备份数据！",BACKUP_GUIDE_TIP_DAY:"您已经 {1} 天没有备份啦！",BACKUP_GUIDE_CONTENT:"豌豆荚提醒您，定期备份手机防止重要数据丢失。您可以使用豌豆荚备份联系人、短信、应用和照片。",BACKUP_GUIDE_NOW:"马上备份",BACKUP_APP_DATA_UNSUPPORT:"暂不支持您的设备",BACKUP_APP_DATA_NON_USB:"请使用 USB 连接",SYNC_PHOTO_PUSH_NOTIFY_TITLE:"您需要自动下载云相册图片到电脑吗？",SYNC_PHOTO_PUSH_NOTIFY_CONTENT:"您手机上的照片已同步到云端。在电脑上开启云相册同步后，豌豆荚将自动将您云相册的图片下载到电脑，查看图片更方便。",SYNC_PHOTO_OPEN:"开启云相册同步"}),define("nls/common",{root:!0,en:!0}),define("nls/root/common",{INSTALL_TEXT:"安装",UNLIKE_TEXT:"换一个",SD_CARD_TEXT:"SD 卡",PHONE_TEXT:"手机",NON_DESCRIPTION_TEXT:"没有描述",DELETE_TEXT:"删除",EXPORT_TEXT:"导出",REFRESH_TEXT:"刷新",OK:"确定",CANCEL:"取消",DIALOG_TIP:"提示",COMPLETE_TEXT:"完成",SHARE:"分享",LOGIN:"登录",RETRY_TEXT:"重试",SAVE_TEXT:"保存",RESELECT_FILE_TEXT:"重新选择文件",VIEW_PIC:"查看大图",YES:"是",NO:"否",IGNORE:"忽略",NEXT_STEP:"下一步",PRE_STEP:"上一步",AD:"推广",REFRESH_ERROR:"刷新失败。",CONFIRM:"确认无误，继续",CONTINUE:"继续",SKIP:"跳过",BACKUP:"备份",VIEW:"查看",RECOMMEND_YES:"是（推荐）",OPEN:"打开",CLOSE:"关闭",WANDOUJIA_TOPIC:" #豌豆荚#",SHARE_TO:"分享到：",SHARE_TO_FACEBOOK_FAILD:"分享到 Facebook 失败",SHARE_TO_FACEBOOK:"分享到 Facebook",SHARE_WIDGET_TITLE:"分享 {1}",SHARE_WIDGET_TITLE_2:"吐槽 {1}",SHARE_WIDGET_TITLE_ONE_KEY_UPDATE:"升级了全部应用，世界清静了",SHARE_WIDGET_INPUT_COUNT_TEXT:"还可以输入 {1} 字",SHARE_WIDGET_INPUT_OVER_COUNT_TEXT:"字数超过 {1} 个",SHARE_WIDGET_CONTENT_TIP_TEXT:"豌豆荚会自动附上截图和来源",SHARE_WIDGET_SENT_TEXT:"分享成功",SHARE_WIDGET_FAILED_TEXT:"分享失败",SHARE_WIDGET_COOKIE_EXPIRED_TEXT:"分享失败，请重新登录",SHARE_WIDGET_PREVIEW_PIC:"图片预览",SHARE_WIDGET_VIEW_FROM_PC_ERROR:"很抱歉，查看大图失败",SHARE_WIDGET_PIC_LIMIT_SIZE_TIP:"抱歉，您分享的图片大于 {1}MB",SHARE_WIDGET_ERROR_NEED_SELECT_PLATFORM:"抱歉，您需要选择要分享到的社交网络",SHARE_WIDGET_SHARE_TIP:"说点什么吧？",SHARE_WIDGET_EXIT_TEXT:"退出登录",LOGIN_FAILED:"登录失败",SHARE_CONTENT_TYPE_SCREENSHOT:"截屏",SHARE_CONTENT_TYPE_PHOTO:"照片",SHARE_CONTENT_TYPE_WELCOME:"豌豆荚",SHARE_CONTENT_TYPE_APP:"应用",SHARE_CONTENT_TYPE_DORAEMON_EXTENSION:"百宝袋扩展",FACEBOOK_MESSAGE_FROM:" 来自我的{1}。",SHARE_DORAEMON_CATEGORY_OTHER:"其他",SHARE_DORAEMON_CATEGORY_INTEREST:"有趣儿",SHARE_DORAEMON_CATEGORY_DEFAULT:"有趣儿的内容",SHARE_ONE_KEY_UPDATE_SYNC:"告诉大家我是不升级会死星人",SHARE_BINDED:"已绑定",SHARE_TO_SINA:"绑定新浪微博",SHARE_TO_QQ:"绑定腾讯微博",SHARE_TO_QZONE:"绑定Qzone",SHARE_TO_RENREN:"绑定人人网",SELECTOR_DESCRIPTION_TEXT:"已选 {1} 个，共 {2} 个",TODAY:"今天",YESTODAY:"昨天",THE_DAY_BEFORE_YESTODAY:"前天",MONTH:"月",DAY:"日",YEAR:"年",HOUR:"{1} 小时",MINUTE:"{1} 分钟",SECOND:"{1} 秒",SD_MOUNT_TIP_TEXT:"豌豆荚检测不到 SD 卡，请在手机上取消挂载 SD 卡。",NO_SD_CARD_TIP_TEXT:"豌豆荚检测到您的手机上没有 SD 卡",NO_SD_CARD_SIZE_TEXT:"暂时无法读取 SD 卡数据",IMPORT_LABEL:"导入",EXPORT_LABEL:"导出",CANCEL_IMPORT_TEXT:"导入操作已被取消",CANCEL_EXPORT_TEXT:"导出操作已被取消",CANCEL_IN_PROGRESS:"正在取消操作，请稍侯...",SD_CAPACITY_TIP:"您的 SD 卡快满了！",PHONE_CAPACITY_TIP:"手机空间不够了！",SD_CAPACITY_ACTION:"打开 SD 卡管理",PHONE_CAPACITY_ACTION:"一键移动应用到 SD 卡",SEND_MAIL_FAILD:"非常抱歉，发送邮件失败",ZIP_PACKAGE_ERROR:"抱歉，打包出错",ZIP_PACKAGE_SUCCESS:"打包成功，打包文件在您刚上传文件的同级目录",LOAD_MORE:"加载更多",LOADING:"加载中...",LOAD_FAILD:"加载失败"}),define("nls/contact",{root:!0,en:!0}),define("nls/root/contact",{ACCOUNT_TYPE_GOOGLE:"Google 账号：",ACCOUNT_TYPE_PHONE:"手机账号",ACCOUNT_TYPE_SIM:"SIM 卡账号",ACCOUNT_TYPE_OTHER:"其他账号",ACCOUNT_LOADING:"读取账号信息...",ACCOUNT_ALL:"全部账号",UNNAMED_CONTACT:"未命名联系人",GROUP_ALL:"全部分组",GROUP_LOADING:"读取分组信息...",ALERT_TIP_EXOPRT_OUTLOOK:"由于 Outlook 格式只能存储 3 个电话或邮箱，不能存储头像、聊天软件账号，豌豆荚不会导出此部分数据。",ALERT_TIP_EXOPRT_WINDOWS_MAIL:"由于 Windows Mail 格式只能存储 2 个电话、1 个传真、1 个邮箱，不能存储群组、聊天软件账号、头像，豌豆荚不会导出此部分数据。",ALERT_TIP_EXOPRT_NOKIA:"由于 Nokia 格式只能存储 3 个电话、2 个传真、2 个邮箱，不能存储群组、聊天软件账号、头像，豌豆荚不会导出此部分数据。",ALERT_TIP_EXOPRT_VCARD:"由于 csv 文件在恢复时容易出现不可控的意外情况，豌豆荚建议您使用vCard格式导出联系人。",ALERT_TIP_MERGE_MANY_CONTACTS:"一次性合并过多联系人需要花费很长时间，确定继续吗？",ALERT_TIP_MERGE_CONTACTS:"<p>确定要合并选中的 {1} 个联系人吗？</p><p>合并成功后，原来的 {2} 个联系人都会被删除。</p>",ALERT_TIP_DEL_SINGLE_CONTACT:"确定要删除选定的 1 个联系人吗？",IMPORT:"导入",EXPORT:"导出",GROUP_ALREADY_EXSIST:"已存在这个分组",PLEASE_INPUT_GROUP_NAME:"请填写分组名称",CONTACT_INTRO:"<p>您可以通过豌豆荚快速查找和搜索联系人、管理分组、批量发送短信。</p><p>左侧列表默认显示的是您的全部联系人。如果您需要查看其他账号和分组下的联系人，请点击右上角菜单切换。</p>",QUICK_ADD_CONTACT:"快速新建联系人",NAME:"姓名",CELL_PHONE:"移动电话",CELL_PHONE_VALIDATE:"您输入的好像不是一个电话号码",EMAIL:"电子邮箱",EMAIL_VALIDATE:"您输入的好像不是一个电子邮箱",ACCOUNT:"账号",SAVE:"保存",DONTSAVE:"不保存",CANCEL:"取消",FINISH:"完成",SAVE_SUCCESS:"保存成功",SAVE_FAILED:"保存失败",CANNOT_EDIT_CONTACTS_UNDER_READONLY_ACCOUNT:"此联系人属于只读账号，无法编辑",EDIT:"编辑",SETIING_RINGTONE:"设置铃声",ADD_CONTACT_METHOD:"添加其他联系方式",CONTACT_INFO:"联系信息",CHANGE_AVATAR:"更换头像",NICKNAME:"昵称",DELETE:"删除",SEND_MAIL:"发邮件",REMARK:"备注",MERGE:"合并",DIAL:"拨打电话",DIAL_SUCCESS:"豌豆荚已经帮您在手机上完成拨号了，拿起手机按下呼叫键吧！",SELECT_CONATCTS_BAKCUP_FILE:"选择包含联系人的 .vcf 或者 .csv 文件",INVALID_BAKCUP_FILE:"无效的 .vcf 或者 .csv 文件",SELECT_ACCOUNT_TO_IMPORT:"您要把联系人导入到哪个账号？请选择：",SELECT_EXPORT_FORMAT:"请选择要导出联系人的格式",V_CARD:"vCard 格式（推荐）",OUTLOOK:"Outlook 2003/2007/2010 的 csv 格式",NOKIA:"Nokia 的 csv 格式",WINDOW_MAIN:"Windows Mail 的 csv 格式",SELECT_COUNTACTS_TO_EXPORT:"请选择要导出的联系人",CURRENT_SELECT:"当前选中的联系人",ALL_CONTACT:"全部联系人",CONTACT_HAS_NUMBER:"有电话号码的联系人",GROUP:"分组",CONFIRM_EDIT_GROUP:"请确认修改分组！",MANAGE_GROUP:"管理分组...",CONTACT_RECORD:"联系记录",CUSTOME_CONTACT_INFO:"自定义联系信息",LABEL:"名称：",PLEASE_CONFIRM:"请确认",PLEASE_CONFIRM_AGAIN:"亲！您真的确认么亲！！！",HOME_NUMBER:"家庭电话",CELL_PHONE_NUMBER:"移动电话",WORK_NUMBER:"工作电话",WORK_FAX:"工作传真",HOME_FAX:"家庭传真",BP_CALL:"传呼机",OTHER_NUMBER:"其他电话",CALLBACK:"回拨号码",CAR:"车载电话",COMPANY_MAIN:"工作总机",ISDN:"ISDN",MAIN:"总机",OTHER_FAX:"其他传真",RADIO:"无线装置",TELEX:"电报",TTY_TDD:"TTY TDD",WORK_MOBILE:"工作移动电话",WORK_PAGER:"工作传呼机",ASSISTANT:"助理",MMS:"彩信",CUSTOME:"自定义...",HOME_MAIL:"家庭邮箱",WORK_MAIL:"工作邮箱",OTHER_MAIL:"其他邮箱",HOME_ADDRESS:"家庭地址",WORK_ADDRESS:"工作地址",OTHER_ADDRESS:"其他地址",WORK:"公司",OTHER:"其他",PHONE:"电话",IM:"聊天工具",ADDRESS:"地址",ORG:"组织",IMPORT_PARTIAL_FAILED:" 个联系人导入失败",IMPORTING_CONTACT:"正在导入联系人, 请稍候...",IMPORT_CONTACT_FINISH:"联系人导入完成",EXPORT_CONTACT_FAILED:"导出联系人失败。",ADD_GROUP:"添加分组...",ACCOUNT_LABEL:"账号：",BUTTON_ADD_CONTACT_LABEL:"新建联系人",BUTTON_DELETE_LABEL:"删除",BUTTON_MERGE_LABEL:"合并",BUTTON_REFRESH_LABEL:"刷新",BUTTON_IMPORT_LABEL:"导入",BUTTON_EXPORT_LABEL:"导出",WINDOW_IMPORT_TITLE:"导入联系人",WINDOW_EXPORT_TITLE:"导出联系人",ALERT_TEXT:"提示",DELETE_TIP_TEXT:"确定要删除选中的 {1} 个联系人？",NON_CHECKED_TEXT:"您还未选择要删除的联系人。",NON_CONTACT_TEXT_PERMISSION:'豌豆荚无法显示您的联系人，可能是手机上的安全软件阻止了豌豆荚读取联系人的权限，请在手机上「权限管理」中授权。<a target="_default" href="http://help.wandoujia.com/entries/22017678?utm_campaign=tips&utm_medium=client&utm_source=contacts">帮助</a>',NON_CONTACT_TEXT:"您还没有添加过联系人。",NON_PHONE_CONTACT_TEXT:"您没有有电话号码的联系人。",NON_STAR_CONTACT_TEXT:"您收藏夹中还没有任何联系人，您可以点击联系人旁边的五角星把他（她）添加到收藏夹。",SAVE_TIP_TEXT:"是否保存所做的修改？",ALL_ACCOUNT_LABEL:"全部账号",ALL_GROUP_LABEL:"全部分组",GROUP_MANAGER_LABEL:"管理分组",GROUP_UNKNOW_LABEL:"未命名",VIEW_LABEL:"显示: ",ACCOUNT_PHONE:"手机账号",ACCOUNT_SIM:"SIM 卡账号",ACCOUNT_TEXT:"账号",ACCOUNT_UNKNOWN:"其他账号",NO_EMAIL_CLIENT_TIP:"<p>非常抱歉, 不能向联系人发送邮件。</p><p>没有找到邮件客户端, 请先安装并绑定邮件服务软件。</p>",GROUP_MANAGER_TITLE:"管理账号与分组",CURRENT_ACCOUNT_LABEL:"当前账号: ",GROUP_NAME_LABEL:"分组名称",GROUP_GRID_TIP_TEXT:"该账号还没有分组。",GROUP_CD_LABEL:"操作",GROUP_SAVE_LABEL:"保存",GROUP_CANCEL_LABEL:"取消",GROUP_DELETE_LABEL:"删除",GROUP_UPDATE_LABEL:"重命名",UNEDITABLE_GROUP_TEXT:"系统分组无法编辑",READ_ONLY_ACCOUNT_GROUP_TEXT:"只读账号无法编辑",GROUP_DELETED_TEXT:"已删除",GROUP_ADD_LABEL:"添加分组",GROUP_CONTACT_LABEL:"修改分组",UNGROUP_CONTACT_LABEL:"未分组",UNKNOWN_ACCOUNT:"未知账号",LOCAL_ACCOUNT:"本机账号",CONTACT_ALL_TEXT:"共 {1} 个联系人 ",CONTACT_GROUP_TEXT:"当前分组一共有 {1} 个联系人",CONTACT_ACCOUNT_TEXT:"当前账号一共有 {1} 个联系人",CONTACT_DELETE_PROGRESS:"正在删除，请稍候...",CONTACT_DELETE_SUCCESS:"成功删除 {1} 个联系人。",CONTACT_DELETE_FAILED_TEXT:"对不起，以下联系人删除失败。",CONTACT_SIM_SELECT_TEXT_1:"SIM 卡上的联系人需要导入到手机上后才能编辑",CONTACT_SIM_SELECT_TEXT_2:"Android 手机不支持编辑 SIM 卡上的联系人，请按照提示把 SIM 卡上的联系人导入到手机后再编辑。",CONTACT_READ_ONLY_TIP:"<p>您选择了只读账号上的联系人，而您的手机不支持编辑只读账号下的联系人。</p><p>是否自动忽略这些联系人并继续操作？</p>",IMPORT_TITLE_TEXT:"导入联系人",DUPLICATE:"已为您忽略了 {1} 条重复联系人。",EXPORT_TITLE_TEXT:"导出联系人",EXPORT_PROGRESS_DESC1:"正在导出，请勿断开手机",EXPORT_PROGRESS_DESC2:"正在导出联系人，请稍候...",EXPORT_SUCCESS_DESC1:"导出完成",EXPORT_SUCCESS_DESC2:"联系人导出完成",CONTACT_SIM_DELTE_TIP:"您选择了 SIM 卡上的联系人，而您的手机不支持编辑 SIM 卡上的联系人。 <br/><br/>是否自动忽略这些联系人并继续操作 ？",EDIT_CONTACT_HEAD:"编辑联系人头像",EDIT_CONTACT_HEAD_SELECT_SOURCE:"选择文件来源：",EDIT_CONTACT_HEAD_SOURCE_BY_PHONE:"手机相册",EDIT_CONTACT_HEAD_SOURCE_BY_LIBRARY:"图片库",EDIT_CONTACT_HEAD_PC_SOURCE:"从电脑上选择文件",EDIT_CONTACT_HEAD_DEL_TEXT:"删除当前头像",DEL_CONTACT_HEAD:"删除头像",ALERT_DEL_CONTACT_HEAD:"确定删除当前联系人头像？",ALERT_PIC_FORMAT_ERROR:"很抱歉，目前仅支持 JPG 和 PNG 格式的图片作为头像，请重新选择。",ALERT_PIC_FORMAT_TIP:"提示：目前仅支持 JPG 和 PNG 格式的图片作为头像。",ALERT_BATCH_MOVE_GROUP:"<p>{1} 等 {2} 个联系人不在 {3} 账号中。</p><p>分组后，会把联系人从旧账号移动到新账号，确定继续？</p>",ALERT_BATCH_MOVE_GROUP_SINGLE:"<p>{1} 不在 {2} 账号中。</p><p>分组后，会把联系人从旧账号移动到新账号，确定继续？</p>",BATCH_CONTACT_TITLE:"选择了 {1} 个联系人",ALERT_SELECT_MORE_CSV_FILE:"很抱歉，暂时不支持一次导入多个 csv 文件。请重新选择一个 csv 文件。",IMPORT_FAIL_TYPE_FILE:"无效的 .vcf 或者 .csv 文件",IMPORT_CONTACTS_FAIL:"导入联系人失败",CONTACT_BATCH_GROUP_PROGRESS:"正在分组，请稍候...",CONTACT_BATCH_GROUP_SUCCESS:"成功为 {1} 个联系人设置分组",GROUP_NAME:"分组名称：",GROUP_NAME_PLACEHOLDER:"请填写分组名称",ADD_GROUP_FAIL:"添加分组出错",GROUP_TIP:"- 仅此格式会保留群组信息",SELECT_BACKUP_FILE:"请选择自动备份的联系人记录",BACKUP_RECORD:"自动备份记录",BACKUP_MESSAGE_NUMBER:"联系人（个）",IMPORT_FROM_FILE:"从指定文件导入",IMPORT_FROM_BACKUP:"从自动备份导入",EXPORT_USING_VCARD:"使用 vCard 导出"}),define("nls/music",{root:!0,en:!0}),define("nls/root/music",{ADD_LOCAL_MUSIC_TEXT:"添加本地音乐",SING_NAME_TEXT:"歌曲名称",ARTIST_TEXT:"歌手",ALBUM_TEXT:"专辑",SING_TIME_TEXT:"时长",SING_SIZE_TEXT:"大小",SING_FORMAT:"格式",FILE_SELECTOR_DESCRIPTION:"选择音乐文件或包含音乐的文件夹，支持多选",MUSIC_PLAY_TEXT:"播放",MUSIC_STOP_TEXT:"停止",DELETE_TIP:"确定要删除选中的 {1} 首音乐？",IMPORT_PROGRESS_TEXT:"正在导入音乐，请稍候...",IMPORT_SUCCESS_TEXT:"成功导入 {1} 首音乐。",EXPORT_PROGRESS_TEXT:"正在导出音乐，请稍候...",EXPORT_SUCCESS_TEXT:"成功导出 {1} 首音乐。",DELETE_MUSIC_ERROR:"非常抱歉，删除音乐失败。",DELETE_MUSIC_ERROR_TEXT:"对不起，以下音乐删除失败：",DELETE_PROGRESS_TEXT:"正在删除音乐，请稍候...",DELETE_SUCCESS_TEXT:"成功删除 {1} 首音乐。",EXPORT_FAILED_TEXT:"非常抱歉，导出音乐失败。",SETTING_RING_TEXT:"设为铃声",SETTING_ITEM_CALL_RING_TEXT:"来电铃声",SETTING_ITEM_NOTIFY_RING_TEXT:"通知铃声",SETTING_ALARM_RING_TEXT:"闹钟铃声",PHONE_RING_TEXT:"手机铃声",NOTIFY_RING_TEXT:"通知铃声",ALARM_RING_TEXT:"闹钟铃声",MUSIC_ADDOR_COUNT_TEXT:"已选 {1} 个，共 {2} 个，存储卡剩余空间为：{3}",MUSIC_ADDOR_GRID_TIP:"您还未添加音乐",STOP_TEXT:"停止",PLAY_TEXT:"播放",MUSIC_EMPTY_TEXT:"您手机上还没有音乐呢",MUSIC_IMPORT_ERROR_TEXT:"对不起，以下音乐文件导入失败：",MUSIC_EXPORT_ERROR_TEXT:"对不起，以下音乐文件导出失败：",MUSIC_IMPORT_OPERATION_FAILED:"导入操作失败。",SET_RING_FAILED_TEXT:"非常抱歉，设置铃声失败。",SET_RING_SUCCESS_TEXT:"设置铃声成功。",SETTING_RING_NOW_TEXT:"正在设置铃声...",NO_SELECTED_MUSIC_TEXT:"您还没选择一首音乐呢",SELECT_FILES:"请选择要导入的音乐",MUSIC_CANNOT_PLAY_TEXT:"无法播放当前格式音乐",SHARE_SET_RINGTONE:"设置铃声成功。晒一晒我的新铃声？",START_IMPORT_ITUNES_FAIL:"抱歉，执行导入 iTunes 操作失败。",CREATE_TIME:"创建时间",ITUNES_IMPORT:"导入 iTunes 音乐库",SELECT_LIBRARY_TITLE:"豌豆荚检测到您有多个 iTunes 音乐库, 请选择导入",ALL_AUDIOS_AND_PLAYLIST:"全部音乐和播放列表",SCANNING_TIP:"正在扫描歌曲, 可能时间比较长, 请耐心等待...",LESS_CAPACITY:"容量不足",SELECT_SOURCE_TITLE:"确定要向您的手机导入",SELECT_AUDIOS:"选择歌曲",SELECT_PLAYLIST:"选择播放列表",PARSE_ITUNES_SOURCE_FAIL:"解析 iTunes 资源错误",IMPORTING_TITLE:"正在导入, 请勿断开手机连接",IMPORTING_AUDIOS_TIP:"正在导入歌曲, 请耐心等待...",CREATING_PLAYLIST_TIP:"正在生成播放列表, 请耐心等待...",AUDIOS_IMPORT_COMPLETE:"歌曲导入完成。",AUDIOS_IMPORT_FAILD:"歌曲导入失败。",CREATE_PLAYLIST_FAILD:"播放列表生成失败。",CREATE_PLAYLIST_COMPLETE:"播放列表生成完成。",PARSE_EMPTY_LIST:"非常抱歉, 解析不到任何歌曲。",CREATE_PLAYLIST_FAILD_TIP:"抱歉, 有 {1} 个播放列表创建失败, 但相应的歌曲已经导入您的手机。",IMPORT_AUDIOS_FAILD_TIP:"抱歉, 有 {1} 首歌曲导入失败, 是否忽略并继续导入播放列表?",SELECT_PLAYLIST_FOR_IMPORT:"请选择您要导入的播放列表",PLAYLIST_NAME:"列表名称",AUDIOS_COUNT:"歌曲数",IMPORT_COMPLETE:"导入完成",SELECT_PLAYLIST_COUNT_TEXT:"已选 {1} 个列表, 共 {2} 首歌曲, 所占空间 {3}",SELECT_AUDIOS_COUNT_TEXT:"已选 {1} 首歌曲, 所占空间 {2}",ALEADY_EXIT_ITUNES_TASK:"已经存在 iTunes 导入任务",NO_ITUNES_IMPORT_TASK:"没有 iTunes 导入任务",PARSE_ITUNES_SOURCE_FAILD:"iTunes 文件解析失败",NO_ITUNES_FILE:"没有 iTunes 文件",MOUNT_CANNOT_CREATE_PLAYLIST:"成功导入播放列表内的音乐, 但是无法在手机上创建播放列表, 因为您的手机 SD 卡被加载为「大容量存储设备」。",ALREADY_SELECT:"已选",SELECT_TIP:"{1} 个列表, 共 {2} 首歌曲, 所占空间 {3}",CONFIRM_IMPORT:"您选择导入{1} 的音乐到手机, 一次导入大量的音乐可能会导致豌豆荚的运行缓慢, 此操作预计耗时{2}。<br/> 确定要导入吗?"}),define("nls/photo",{root:!0,en:!0}),define("nls/root/photo",{ADD_LAOCEL_PHOTO_LABEL:"添加本地图片",FILE_SELECTOR_DESCRIPTION:"选择图片文件或包含图片文件的文件夹，支持多选",PREVIEW_TEXT:"预览",PICTURE_NAME:"图片名称",PICTURE_FORMAT:"图片格式",PICTURE_SIZE:"图片大小",SLIDE_PLAY_TEXT:"幻灯片播放",DELETE_TIP:"确定要删除选中的 {1} 张图片？",IMPORT_PROGRESS_TEXT:"正在导入图片，请稍候...",IMPORT_SUCCESS_TEXT:"成功导入 {1} 张图片。",EXPORT_PROGRESS_TEXT:"正在导出图片，请稍候...",EXPORT_SUCCESS_TEXT:"成功导出 {1} 张图片。",PHOTO_ADDOR_COUNT_TEXT:"已选 {1} 个，共 {2} 个，存储卡剩余空间为：{3}",PHOTO_ADDOR_GRID_TIP:"您还未添加图片",GET_PHOTOS_ERROR:"获取图片失败",DELETE_PHOTO_ERROR:"删除图片失败",DELETE_PROGRESS_TEXT:"正在删除图片，请稍候...",DELETE_SUCCESS_TEXT:"成功删除 {1} 张图片。",EMPTY_PHONE_LIST:"您的手机相册中还没有图片呢",EMPTY_LIBRARY_LIST:"您的图库中还没有图片呢",EMPTY_CLOUD_LIST:"您的云相册中还没有图片呢",EXPORT_FAILED_TEXT:"导出失败！",LOADING_BIGPICTURE_TEXT:"正在载入原图...",SLIDES_STOP_TEXT:"停止播放",SLIDES_AUTO_TEXT:"自动播放",WALLPAPER_SETTING_SUCCESS_TEXT:"设置壁纸已成功",WALLPAPER_SETTING_TEXT:"正在设置壁纸...",WALLPAPER_SETTING_FAILED_TEXT:"对不起，操作失败。",PHOTO_DELETE_ERROR_TEXT:"对不起，以下图片删除失败：",PHOTO_EXPORT_ERROR_TEXT:"对不起，以下图片导出失败：",PHOTO_IMPORT_ERROR_TEXT:"对不起，以下图片文件导入失败：",THREAD_DISPLAY_SHOW:"展开",THREAD_DISPLAY_HIDDEN:"收起",GET_PHOTO_FROM_PC_ERROR:"对不起，从电脑上获取图片失败。",ROTATE_RIGHT:"向右转",ROTATE_LEFT:"向左转",NEXT:"下一张",PREV:"上一张",SLIDE_SHOW:"自动播放",SET_AS_WALLPAPER:"设置为手机壁纸",BACKUP_MY_PHOTOS:"自动同步我的照片",UPLOADING_PHOTOS:"云相册同步中",PHOTO_BACKUP_AUTO:"云相册同步完成",PHOTO_SYNC:'<p>是否在这台电脑上开启云相册同步？</p><p>开启云相册同步后，您的豌豆荚账号下的手机照片会同步到您的 <a href="{1}" target="_default">私人云相册</a> 中保存，同时也会同步到您的这台电脑上。</p><p>如果您使用的不是自己的电脑，请不要选择开启。</p>',PHOTO_SYNC_CLOSED:"云相册同步",PHOTO_SYNC_OPENED:"云相册同步完成",TIP_CLOSE_PHOTO_SYNC:"确定要关闭云相册同步吗？",CLOSE_PHOTO_SYNC:"关闭同步",SHARE_WALLPAPER:"设置壁纸成功。晒一晒我的新壁纸？",EMPTY_TIP_PHOTO_CLOUD_NOT_LOGIN:'<span class="button-login link">登录豌豆荚</span> 来查看您的私人云相册'}),define("nls/taskManager",{root:!0,en:!0}),define("nls/root/taskManager",{OPEN_DOWNLOAD_FOLDER:"打开下载文件夹",RUNNING_STATUS:"已下载 {1}，{2}/s",PUSHING_STATUS:"已传输 {1}, {2}/s",PAUSE_STATUS:"已下载 {1}，已暂停",PUSH_PAUSE_STATUS:"已传输 {1}，已暂停",WAITING_DOWNLOAD:"等待下载",WAITING_PUSHING:"等待传输",WAITING_INSTALL:"等待安装",UNINSTALL_THEN_INSTALL:"卸载后安装",CHANGE_INSTALL_LOCATION:"修改安装位置",MANAGE_APP:"管理应用",INSTALL_TO_DEVICE:"安装到内存",MANAGE_SD:"管理 SD 卡",SEARCH_PLAYER:"去搜索应用",VIDEO_DOWNLOAD_FINISH_TIP:"下载完成，但可能手机安装视频播放器后才能播放",TASK_NAME:"任务名称",SIZE:"大小",PROGRESS:"进度",RUNNING_COUNT:"{1} 项任务正在进行",FAILED_COUNT:"{1} 项任务失败",WATING_PUSH_COUNT:"{1} 项任务待传输",DOWNLOAD_COUNT:"已下载 {1}",NO_TASK_RUNNING:"没有正在进行的任务",TASK_STOPED:"任务中断",HOW_TO_CONNECT_URL:"http://help.wandoujia.com/entries/401079-2-0",UNKNOWN:"未知",CONFIRM_DELETE:"确定要删除这个任务吗？",CONFIRM_DELETE_BATCH:"确定要删除选中的任务吗？",DELET_APK_ALSO:"同时把下载文件移到回收站",DELETE_TITLE:"删除下载任务",RUNNING_COUNT_TIP:"{1} 项进行中",ERROR_COUNT_TIP:"{1} 项失败",COMPLETE_COUNT_TIP:"{1} 项完成",DEVICE_NOT_CONNECT:"没有连接手机",DEVICE_NOT_CONNECT_TIP:"豌豆荚检测到您没有连接手机，任务在连接后将自动传输到手机上。",CONFIRM_ON_DEVICE_TIP:"您正在使用 Wi-Fi 模式连接手机，需要在手机上确认才能完成安装。",CONFIRM_ON_DEVICE_MIUI_V5_TIP:"您的手机使用的是 MIUI 系统，需要在手机上确认才能完成安装。",DEVICE_DISCONNECT:"连接已断开",DEVICE_DISCONNECT_TIP:"豌豆荚检测到您的手机已经断开连接，任务下载完成后将保存在电脑上，下次连接时将自动传输到手机上。",OFFLINE_TASK_TIP:"从您的手机上获取到 {1} 个零流量下载任务",OUT_OF_SPACE_WARN:"磁盘空间预警",OUT_OF_SPACE_TIP:"豌豆荚检测到您的磁盘空间已不足 500M。<br />建议您重新设置下载位置。",MODIFY_STORAGE_DISK:"修改下载位置",NOT_ENOUGH_SPACE_WARN:"磁盘空间不足",NOT_ENOUGH_SPACE_TIP:"豌豆荚检测到您的磁盘空间已满，请重新设置下载位置。",STOPPED:"已停止",RETRY:"重试",PAUSED:"暂停下载",DOWNLOADING:"下载中",CANCEL:"取消",DOWNLOAD_SUCCESS:"下载成功",DOWNLOAD_FAILED:"下载失败",NO_SPACE:"磁盘已满",INSTALLING:"正在安装",CONFIRM_ON_DEVICE:"请在手机上完成安装",INSTALL_OVERWRITE:"覆盖安装",INSTALL_CANCELED_BY_USER:"未在手机上确认安装应用",UNKNOWN_ERROR:"未知错误",DOWNLOAD_FAILD_COUNT_STRING:"{1} 个任务失败",ALL_FINISHI:"全部完成",DOWNLOADING_COUNT_STRING:"{1} 个任务",TASK_ADDED:"任务已添加",LOADING_TASK_LIST:"读取任务列表",PROCESSING:"任务进行中",PUSHING:"正在传输 ",PARSING_VIDEO_URL:"正在解析 MP4 视频地址",PARSING_VIDEO_URL_SUCCESS:"解析 MP4 视频地址成功",MERGE_VIDEO:"正在合并 MP4 视频",MERGE_VIDEO_SUCCESS:"合并 MP4 视频成功",LOOK_OVER:"查看",UNKNOWN_NAME:"未知名称",INSTALL_SUCCESS:"安装成功",NEED_USER_INSTALL:"请在手机上完成安装",CACHE_SIZE:"节省了 {1} 流量",ADD_TASK_TIP:"添加了 {1} 项任务",FINISH_TASK_TIP:"{1} 项任务已完成",DELETE_TASK:"删除应用",CONTINUE_INSTALL:"继续安装",REMOVE_ALL_FINISHI:"清除已完成任务",INSTALL_FAILED_DEVICE_NOT_FOUND:"设备没有连接，无法安装",INSTALL_FAILED_UNKNOWN:"安装失败，未知错误",INSTALL_FAILED_DISCONNECT:"安装失败，连接已断开",INSTALL_FAILED_APK_MISSED:"安装失败，无法找到安装文件",INSTALL_FAILED_APK_READ_FILE:"安装失败，无法读取安装文件",INSTALL_FAILED_CANNOT_PUSH:"安装失败，无法传输文件",INSTALL_FAILED_WRITE_ERROR:"安装失败，无法传输安装文件",INSTALL_FAILED_ALREADY_EXISTS:"安装失败，目标已经存在",INSTALL_FAILED_CONFLICTING_PROVIDER:"安装失败，软件供应商冲突",INSTALL_FAILED_CONTAINER_ERROR:"安装到 SD 卡失败",INSTALL_FAILED_CPU_ABI_INCOMPATIBLE:"安装失败，CPU 的 ABI 未协调错误",INSTALL_FAILED_DEXOPT:"安装时手机内存剩余空间不足",INSTALL_FAILED_DUPLICATE_PACKAGE:"安装文件包名重复",INSTALL_FAILED_INSUFFICIENT_STORAGE:"安装时手机内存剩余空间不足",INSTALL_FAILED_INVALID_APK:"无效的安装文件",INSTALL_FAILED_INVALID_INSTALL_LOCATION:"该应用不支持您选定的安装位置",INSTALL_FAILED_INVALID_URI:"安装失败，无效的 URI",INSTALL_FAILED_MEDIA_UNAVAILABLE:"传输失败",INSTALL_FAILED_MISSING_FEATURE:"安装失败，该应用不支持您的设备",INSTALL_FAILED_MISSING_SHARED_LIBRARY:"您的设备不支持 Add-on 属性",INSTALL_FAILED_NEWER_SDK:"您的设备系统版本不兼容",INSTALL_FAILED_NO_SHARED_USER:"无共享用户权限",INSTALL_FAILED_OLDER_SDK:"您的设备系统版本低于应用所需版本",INSTALL_FAILED_REPLACE_COULDNT_DELETE:"修复已安装的本程序失败",INSTALL_FAILED_SHARED_USER_INCOMPATIBLE:"共享用户权限不完整",INSTALL_FAILED_TEST_ONLY:"仅用于测试",INSTALL_FAILED_TIME_OUT:"安装超时",INSTALL_FAILED_UNKOWNED_ERROR:"安装遇到错误",INSTALL_FAILED_UPDATE_INCOMPATIBLE:"更新不完整，请卸载后重试",INSTALL_PARSE_FAILED_BAD_MANIFEST:"安装文件的配置文件错误",INSTALL_PARSE_FAILED_BAD_PACKAGE_NAME:"安装文件名错误",INSTALL_PARSE_FAILED_BAD_SHARED_USER_ID:"文件用户权限错误",INSTALL_PARSE_FAILED_CERTIFICATE_ENCODING:"文件认证编码错误",INSTALL_PARSE_FAILED_INCONSISTENT_CERTIFICATES:"与已安装版本签名不一致，要卸载已安装版本才能继续，但会同时删除应用数据",INSTALL_PARSE_FAILED_MANIFEST_EMPTY:"安装文件无配置文件",INSTALL_PARSE_FAILED_MANIFEST_MALFORMED:"安装文件的配置文件异常",INSTALL_PARSE_FAILED_NO_CERTIFICATES:"该应用签名有问题，无法安装",INSTALL_PARSE_FAILED_NOT_APK:"文件分析失败（无 APK 信息）",INSTALL_PARSE_FAILED_UNEXPECTED_EXCEPTION:"文件分析时遇到未知错误",INSTALL_PARSE_FAILED_UNKNOWN_FORMAT:"安装文件格式错误",SDCARD_WAS_FULL:"SD 卡空间已满",PUSH_FAILED_CONTAINER_ERROR:"传输到 SD 卡失败",PUSH_FILE_FAILED:"文件传输失败",PUSH_FAILED_DEVICE_NOT_FOUND:"设备没有连接，无法传输",PUSH_FAILED_NO_SDCARD:"没有插入 SD 卡，无法传输文件",install_command_send_failed:"无法安装应用",install_command_send_error:"无法安装应用",install_command_send_disconnect:"无法连接手机",INVALID_FILE_PATH:"无法创建文件",SDCARD_CAN_NOT_WRITE:"SD 卡暂时无法写入",NO_PERMISSION_TO_WRITE_FILE:"没有权限创建文件",LOCAL_FILE_WAS_MISSED:"本地文件无法找到",CONNECTION_LOST:"无法连接手机",UNKNOWN_EXECPTION_FOR_PUSHING_FILE:"文件传输失败",RESOLVE_URL_FAILED:"无法解析到 MP4 视频地址",MP4_MERGE_FAILED:"MP4 视频合并失败",NO_VEDIO_SEGMENT_FOUND:"此地址没有发现 MP4 视频",UNKNOWN_VEDIO_URL:"不支持的视频网站地址",NO_SUCH_FILE_ERROR:"此文件不存在",NO_MORE_SPACE_ERROR:"SD 卡空间已满",FILE_READ_ONLY:"已存在同名的文件并且无法覆盖",INSTALL_FAILED_NO_SDCARD:"SD 卡不可用",INSTALL_FAILED_SDCARD_MOUNT:"请不要挂载 SD 卡",INSTALL_FAILED_MALICIOUS_APK:"扫描发现是恶意应用，不建议继续安装。",FILE_OPERATION_IO_ERROR:"文件传输失败",FILE_OPERATION_SDCARD_IO_ERROR:"文件传输失败",DOWNLOAD_APK_VERIFY_FAILED:'文件下载错误，<a href="http://wandoujia.zendesk.com/entries/23613118--%E5%AE%98%E6%96%B9%E5%B8%AE%E5%8A%A9-%E6%96%87%E4%BB%B6%E4%B8%8B%E8%BD%BD%E9%94%99%E8%AF%AF%E6%98%AF%E6%80%8E%E4%B9%88%E5%9B%9E%E4%BA%8B-" target="_default">查看帮助</a>',NOT_SUPPORT:"格式不支持",SCANNING:"正在进行安全扫描",SCAN_PASS:"已通过安全扫描",SCAN_FAILED:"未通过安全扫描",NO_MORE_MEMORY:"手机内存剩余空间不足",NO_MORE_SDCARD:"SD 卡剩余空间不足",SDCARD_MOUNT:"请不要挂载 SD 卡",NO_SDCARD:"没有插入 SD 卡，无法传输文件",DEVICE_NOT_FOUND:"设备没有连接，无法传输文件",DEVICE_NOT_FOUND_TIP:"请使用 USB 连接或 Wi-Fi 将手机连接到豌豆荚，未完成的任务将在手机连接后继续。",SET_AS_WALL_PAPER:"设为手机壁纸",START_UNZIPPING:"开始解压",UNZIPING:"正在解压...",UNZIP_COMPLETE:"解压成功",UNZIP_FAILED:"解压失败",START_DOWNLOAD:"正在下载",START_INSTALL:"正在安装",START_PUSH:"正在传输",PUSH_SUCCESS:"传输完成",PUSH_COUNT:"已经传输 {1}",I_KNOW:"我知道了",HOW_TO_CONNECT:"如何连接",EMPTY_LIST:"没有任务",ALERT_TIP_ILLEGAL_UPDATE:"<p>检测到「{1}」新版本和已安装版本签名不一致。<p><p>如果您选择继续升级，豌豆荚会帮您先删除旧版本再安装，这样原来的应用数据和游戏存档将会丢失。</p><p>是否继续？</p>",ALERT_TIP_DOWNLOAD_VIDEO:"<p>视频下载成功。</p><p>下载的视频为 .mp4 格式，您的手机可能无法播放。建议您下载安装视频播放器。",ALERT_TIP_TASK_DUPLICATED:"<p>您已经下载过「{1}」，是否重新下载？</p>",WAITING_RESTORE_APP_DATA:"等待恢复应用数据",PROCESSING_RESTORE_APP_DATA:"正在恢复应用数据",RESTORE_APP_DATA_FAILED:"恢复应用数据失败"}),define("nls/video",{root:!0,en:!0}),define("nls/root/video",{ADD_LOCAL_VIDEO_TEXT:"添加本地视频",NO_VIDEOS_TEXT:"您的手机中还没有视频呢。",DELETE_TIP:"确定要删除选中的 {1} 个视频？",VIDEO_DELETE_ERROR_TEXT:"对不起，以下视频删除失败：",VIDEO_EXPORT_ERROR_TEXT:"对不起，以下视频导出失败：",VIDEO_IMPORT_ERROR_TEXT:"对不起，以下视频文件导入失败：",DELETE_PROGRESS_TEXT:"正在删除视频，请稍候...",DELETE_SUCCESS_TEXT:"成功删除 {1} 个视频。",DELETE_VIDEO_ERROR:"删除视频失败",IMPORT_PROGRESS_TEXT:"正在导入视频，请稍候...",IMPORT_SUCCESS_TEXT:"成功导入 {1} 个视频。",IMPORT_UNCONNECT_TEXT:"很抱歉，您的手机连接已断开，无法导入视频。",IMPORT_FAILED_TEXT:"很抱歉，导入视频失败。",EXPORT_PROGRESS_TEXT:"正在导出视频，请稍候...",EXPORT_SUCCESS_TEXT:"成功导出 {1} 个视频。",VIDEO_ADDOR_COUNT_TEXT:"已选 {1} 个，共 {2} 个，存储卡剩余空间为：{3}",PREVIEW_TEXT:"预览",VIDEO_NAME:"视频名称",VIDEO_FORMAT:"视频格式",VIDEO_SIZE:"视频大小",VIDEO_ADDOR_GRID_TIP:"您还未添加视频",FILE_SELECTOR_DESCRIPTION:"选择视频文件或包含视频文件的文件夹，支持多选",CANNOT_GET_SD_DATA:"暂时无法读取 SD 卡数据",PHONE_VIDEO_THREAD_NAME:"手机录像",OTHER_VIDEO_THREAD_NAME:"其他视频",PLAY_VIDEO_TEXT:"正在读取视频，请稍候...<br>按 Esc 取消",PLAY_DISCONNECT:"您的手机没有连接电脑，请连接后再播放。",PLAY_NO_PLAYER:"您的电脑不支持 {1} 格式，请尝试安装该格式播放器后再打开。",PLAY_CANNOT_READ:"视频读取错误。",ADD_VIDEO_LOADING:"正在添加视频，请稍候...",PLAY_VIDEO_SUCCESS:"视频读取成功。",VIDEO_SUPPORT_TIP:'Android 系统默认仅支持 .avi .3gp .mp4 .m4v 四种格式。如果需要导入其它格式视频，请使用 <span class="link button-manage-sd">SD 卡管理</span>。'}),define("nls/welcome",{root:!0,en:!0}),define("nls/root/welcome",{WELCOME_PAGE_SHOT:"分享您的手机和壁纸到新浪微博",WELCOME_PAGE_SHOT_FOR_FACEBOOK:"分享您的手机和壁纸到 Facebook",SCREEN_SHOT_CLIPBOARD_SUCCESS:"已将截图复制到剪贴板",SCREEN_SHOT_FAILD:"抱歉，截屏操作失败",SCREEN_SHOT_CANCELD:"截屏操作已取消",SCREEN_SHOT_TEXT:"截图",SCREEN_SHOT_SAVE_TO_FILE:"保存为文件",SCREEN_SHOT_SAVE_TO_CLIPBOARD:"复制到剪贴板",SCREEN_SHOT_WITH_WRAP:"适中尺寸（带手机外壳）",SCEEN_SHOT_WITHOUT_WRAP:"高清尺寸（屏幕大小）",SAVE_PATH_FOR_SCREENSHOT:"保存位置设置...",SAVE_PATH_FOR_SCREENSHOT_TIP:"截图成功！是否今后都把截图自动保存到刚才选择的文件夹？",SAVE_SCREEN_SHOT_SUCCESS:"截图成功",PLAY_BTN_TEXT:"播放",PAUSE_BTN_TEXT:"暂停",SEND_WEIBO_BTN_TEXT:"发微博",REFRESH_BTN_TEXT:"刷新",FULLSCREEN_BTN_TEXT:"全屏",TOOL_BACKUP:"备份",TOOL_RECOVERY:"恢复",TOOL_SD:"SD 卡管理",MANAGE_SD_UNCONNECT:"很抱歉，您的手机连接已断开，无法启动文件管理。",MANAGE_SD_ERROR:"很抱歉，无法启动文件管理。",HAS_NO_SD_CARD:"很抱歉，您的手机没有 SD 卡。",MANAGE_SD_INTERNET:"很抱歉，豌豆荚暂时不支持在 Internet 连接下的 SD 卡管理。",EDIT_RING:"更换铃声",AUTO_BACKUP:"最近的自动备份：{1}",SHOW_FILE:"查看文件",TIP_IN_OPEN_FILE1:"对不起，豌豆荚找不到备份文件",TIP_IN_OPEN_FILE2:"造成这个问题的原因可能是：<br /> - 文件被意外删除<br /> - 文件路径发生改变",START_AUTO_BACKUP:"正在自动备份",AUTO_BACKUP_SMS_COMPLETE:"自动备份短信完成",AUTO_BACKUP_CONTACTS_COMPLETE:"自动备份联系人完成",AUTO_BACKUP_APP_COMPLETE:"自动备份应用完成",AUTO_BACKUP_PHOTO_COMPLETE:"自动备份照片完成",AUTO_BACKUP_COMPLETE:"自动备份完成",AUTO_BACKUP_TIP_IN_PROGRESS:"正在为您自动备份手机数据...",AUTO_BACKUP_TIP_COMPLETE:"最近的自动备份：{1}",CONNECT_UR_PHONE:"请连接手机",CONNECTION_TIP:"连接手机后，您可以使用豌豆荚安装和管理应用，收发短信，查看和整理通讯录、相册、音乐和视频，让您的手机更强大而又更井然有序。",CONNECT_PHONE:"连接手机",FLASH_TIP_TITLE:"您刷机了吗？",FLASH_TIP_DESC:"豌豆荚可以快速帮您恢复数据到手机上哦。赶快去试试吧！",CLOSE_AUTO_START:'为方便您管理手机，豌豆荚在您手机连上电脑后会自动启动。如果您不希望自动启动，可以在 <span class="link button-setup">设置</span> 中关闭'}),define("nls/message",{root:!0,en:!0}),define("nls/root/message",{SENDER_PLACEHOLDER:"填写您的新信息...",SEND_A_SMS:"给好友发个短信吧",SEND_TO:"发至 {1}：",LOAD_MORE:"查看更多短信",SEND_MESSAGE:"发送信息",RECEIVER:"收信人：",CONTENT:"发送内容：",CONTENT_COUNT:"已输入 {1} 字，",CONTENT_COUNT2:"{1} 字",MESSAGE_COUNT:"可能被拆分为 {1} 条短信发送，",CONTACTS_COUNT:"发送给 {1} 位联系人。",BIRTHDAY_TIP:"今天是他（她）的生日呦，快送上您的祝福吧",ME:"我",UNNAMED_CONTACT:"未命名的联系人",MMS:"彩信",NONE_SUBJECT:"无主题",CONTAIN_MULTIMEDIA:"包含 {1} 个多媒体附件",OPEN_ON_DEIVE:"在手机上查看",FOLD:"收起",EXPEND:"展开",SENDING:"发送中...",SEND_FAILED:"发送失败，",RESEND:"重发",DELETE:"删除",FORWARD:"转发",COPY:"复制",MARK_AS_UNREAD:"标记为未读",ADD_TO_CONTACT:"添加到通讯录",BATCH_SEND_TITLE:"请在手机上点击发送按钮",BATCH_SEND_TOO_MANY_TIP:"豌豆荚已经把收信人和短信内容填入您手机的短信发送框，请在手机上发送短信。为确保短信可以成功发送，豌豆荚每小时可以为您发送 90 条短信，您现在已经超出了这个限制。",DELETE_FAILD:"短信删除失败",ADD_BATCH_RECEIVER:"插入群发称呼",ADD_BATCH_RECEIVER_TIP:"群发称呼可以自动替换成收信人名字。如，您给「张三」和「李四」群发「$NAME，新年快乐！」，张三和李四会分别收到「张三，新年快乐！」和「李四，新年快乐！」。",MESSAGE_TOO_LONG:"您输入的短信将被拆分成多条发送，可能会产生额外的短信费用，确定发送吗？",REPLY_MESSAGE:"回复",PLEASE_INPUT_CONTENT:"请输入发送内容",PREV_MESSAGE:"上一条",NEXT_MESSAGE:"下一条",MESSAGE_FROM:"来自 {1} 的短信",ADD_CONTACT:"添加联系人",LOOK_UP_CONTACT:"查看联系人",SEARCH_CONTACT:"搜索联系人",CONTACT_SELECT:"已选择 {1} 人 ",CLEAR_ALL:"清除全部",NO_CONTACT_UNDER_THIS_ACCOUNT:"当前账号没有联系人",BATCH_SEND:"群发",BATCH_SEND_TIP:"...等 {1} 人",NAMEPLATE_BATCH_SEND_TIP:'...等 <span class="link list-switch">{1} 人</span>',SEND_FAILED_TIP:"{1} 条发送失败",RESEND_ALL:"全部重发",SEND_SMS:"发短信",MARK_AS_READ:"标记为已读",SEND_MESSAGE_TO:"发送短信给：",EMPTY_TIP_4_CONTACT:"豌豆荚找不到您和他的联系记录哦。",COUNT_TIP:'当前选中的会话(<span class="cover-count"></span> 个会话，<span class="sms-count"></span> 条短信)',BATCH_CONVERSATION:"群发短信",TIP_UNREAD:"共 {1} 条，{2} 条未读",TIP_FAILED:"共 {1} 条，{2} 条发送失败",SMS_SUMMARY:"共 {1} 条，{2} 条未读",SMS_UNREAD_SUMMARY:"共 {2} 条未读短信",CONFIRM_DELETE_CONVERSATION:"确定要删除选中的 {1} 个会话中的 {2} 条短信吗？",CONVERSATION_DELETE_PROGRESS:"正在删除，请稍候...",CONVERSATION_DELETE_SUCCESS:"成功删除 {1} 条短信。",CONFIRM_MARK_AS_READ:"确定要将选中的 {1} 个会话中的短信全部标记为已读吗？",CONVERSATION_MARK_AS_READ_PROGRESS:"正在标记已读中，请稍候...",CONVERSATION_MARK_AS_READ_SUCCESS:"成功将 {1} 条短信标记为已读。",ALERT_TIP_IMPORT_EXPORT_WIFI:"<p>很抱歉，为了确保您的数据不会丢失，豌豆荚暂时不支持在 Wi-Fi 连接手机时导入和导出数据。</p><p>请连接 USB 数据线后重试。</p>",ALERT_TIP_EXPORT_MMS:"您选择的会话中包含彩信，这些彩信不会被导出。",WORD_COUNT:"已输入 {1} 字，",ADDRESS_COUNT:"发送给 {1} 位联系人。",SEND:"发送",EXPORT:"导出",BATCH_CONVERSATION_TITLE:"选择了 {1} 组短信",CANCEL:"取消",SEND_WITH_SIM1:"使用默认 SIM 卡发送",SEND_WITH_SIM2:"使用第二张 SIM 卡发送",WINDOW_IMPORT_TITLE:"导入短信",IMPORT_FAILED:"导入短信失败。",IMPORTING_SMS:"正在导入短信，请稍候...",DUPLICATE:"已为您忽略了 {1} 条重复短信。",IMPORT_SMS_FINISH:"短信导入完成",EXPORT_MESSAGE:"导出短信",EXPORT_FAILED:"导出短信失败。",EXPORTING:"正在导出，请勿断开手机",EXPORTING_SMS:"正在导出短信，请稍候...",EXPORT_FINISH:"导出完成",EXPORT_SMS_FINISH:"短信导出完成",IMPORT_SELECT_FILE:"选择包含短信的 .CSV 文件",INVALID_FILE:"无效的 .csv 文件",SELECT_MESSAGE:"请选择要导出的短信",ALL_MESSAGE:"全部短信",NO_CONVERSATION:'豌豆荚无法显示您的短信，可能是手机上的安全软件阻止了豌豆荚读取信息的权限，请在手机上「权限管理」中授权。<a target="_default" href="http://help.wandoujia.com/entries/22017678?utm_campaign=tips&utm_medium=client&utm_source=sms">帮助</a>',NO_UNREAD_CONVERSATION:"您没有任何短信未读哦",PROBLEM_WITH_DUAL_SIM_PHONE:"双卡手机遇到问题",PROBLEM_WITH_DUAL_SIM_PHONE_TIP:'<p>如果您使用的是双卡手机，您可以指定使用其中某一张 SIM 卡发送短信。</p><p>由于市面上的双卡手机型号众多，豌豆荚可能不支持全部型号的双卡手机。如果您的双卡手机不能被识别或者是发送短信遇到问题，请 <a href="http://help.wandoujia.com/entries/21550442" target="_default">向我们反馈</a>。',SELECT_BACKUP_FILE:"请选择自动备份的短信记录",BACKUP_RECORD:"自动备份记录",BACKUP_MESSAGE_NUMBER:"短信（条）",IMPORT_FROM_FILE:"从指定文件导入",IMPORT_FROM_BACKUP:"从自动备份导入",COPY_SMS:"短信已成功复制到剪切板"}),define("nls/optimize",{root:!0,en:!0}),define("nls/root/optimize",{WELCOME:"手机体检，快速优化您的手机",LAST_TIME_TIP:'上次体检在 <span class="text-warning">{1}</span> 小时前，建议您定期体检，保持手机健康',NEVER_TIP:"您还未进行过体检，建议您定期体检，保持手机健康",SCANNING:"正在对您的手机进行扫描，请稍候...",SCAN_TIP:"正在检测第 {1} 项：扫描应用 {2}",RAM_TIP:"{1} 款应用占了 {2} 内存，减慢了手机运行速度",CACHE_TIP:"{1} 款应用产生了 {2} 缓存文件，占用了手机内存空间",INSTALL_DES:"手机体检功能由腾讯手机管家提供，豌豆荚将为您的手机安装腾讯手机管家。",UPDATE_DES:"手机体检功能由腾讯手机管家提供，豌豆荚将升级您手机中的腾讯手机管家至最新版本。",UPDATE_TIP:"{1} 款应用可升级，定期升级可有效防范应用漏洞",BACKUP_TIP:"尚未备份过手机数据，为保障数据不遗失，建议您立即备份",OPTIMIZE_TIP:"您的手机状况可优化，建议您一键优化    ",FINISH_TIP:"建议您定期优化手机，保持手机健康    ",CANCEL_TIP:"您已取消对手机体检，建议重新扫描",ACTION_TIP:'<span class="link button-restart">重新扫描</span><span class="link button-backward">返回</span>',OPTIMIZE_ALL:"一键优化",OPTIMIZE_TITLE:"可优化项目：{1} 项",FINISH_TITLE:"已完成项目：{1} 项",SUGGESTION_TITLE:"推荐项目：{1} 项",OPTIMIZE:"立即优化",UPDATE:"立即升级",BACKUP:"立即备份",OPTIMIZE_FINISH:"您的手机健康良好，建议您定期优化，保持手机健康    ",VIRUS_TIP:"{1} 个应用存在病毒或安全风险，建议卸载",OPTIMIZING:"正在优化中，请稍候",VENDOR:"腾讯手机管家提供技术支持",INSTALLING:"正在为您安装腾讯手机管家",INSTALL_ERROR:"安装出现错误，请重试",CACHE_FINISH:"清除了 {1} 垃圾文件，为您节省了更多手机空间",RAM_FINISH:"释放了 {1} 内存，提升了手机运行速度",INSTALL_CANCEL:"安装已取消。",WIFI_TIP:"请使用 USB 数据线方式连接手机",SCAN_FAILED:"扫描失败",OPTIMIZE_ERROR:"优化出错，请检查您的手机上是否正确安装了腾讯手机管家。"}),define("nls/sync",{root:!0,en:!0}),define("nls/root/sync",{ACCOUNT_GUIDE:"登陆向导",CLOUD_BACKUP:"云备份",CLOUD_PHOTO:"云相册",SOCIAL_PLATFORM:"社交平台",CLOUD_BACKUP_TITLE:"自动云备份，轻松备份，随时恢复",CLOUD_BACKUP_DESC:"自动将您的 <em>联系人、短信、应用</em> 备份到云端，不需要再手动备份。开启后同时也会在手机上生效。",CLOUD_BACKUP_OPTION:"开启自动云备份",CLOUD_PHOTO_TITLE:"云相册同步，即时上传，随时分享",CLOUD_PHOTO_DESC:"豌豆荚会将手机拍摄的 <em>照片</em> 自动上传到您的私人云相册，还可以自动下载到电脑。开启后同时也会在手机上生效。",CLOUD_PHOTO_OPTION:"开启云相册同步",SOCIAL_PLATFORM_TITLE:"绑定社交平台，轻松分享，快乐评价",SOCIAL_PLATFORM_DESC:"点击后绑定您喜爱的社交平台，分享喜爱的应用和照片",SOCIAL_PLATFORM_OPTION:"关注豌豆荚官方账号"}),function(e,t){define("Internationalization",["i18n!nls/ui","i18n!nls/misc","i18n!nls/app","i18n!nls/backup_restore","i18n!nls/common","i18n!nls/contact","i18n!nls/music","i18n!nls/photo","i18n!nls/taskManager","i18n!nls/video","i18n!nls/welcome","i18n!nls/message","i18n!nls/optimize","i18n!nls/sync"],function(t,n,r,i,s,o,u,a,f,l,c,h,p,d){console.log("Internationalization - File loaded.");var v={ui:t,misc:n,app:r,backup_restore:i,common:s,contact:o,music:u,photo:a,taskManager:f,video:l,welcome:c,message:h,optimize:p,sync:d};return e.i18n=e.i18n||v,v})}(this),function(e,t){define("contact/models/ContactModel",["backbone","underscore","jquery","Configuration","IO"],function(e,n,r,i,s){console.log("ContactModel - File loaded.");var o=e.Model.extend({defaults:{account_name:"",account_type:"",avatar:i.enums.CONTACT_DEFAULT_ICON_LARGE,avatarSmall:i.enums.CONTACT_DEFAULT_ICON,displayName:"",isNew:!1,group:[]},initialize:function(){Object.defineProperties(this,{hasPhoneNumber:{get:function(){return this.get("phone")&&this.get("phone").length>0}},defaultNumber:{get:function(){var e=this.get("phone");if(!e)return"";var t=n.filter(e,function(e){return e.is_primary});return t.length===0?e[0].number:t[0].number}},isReadOnly:{get:function(){return this.get("read_only")}},isStarred:{get:function(){return this.get("starred")===1}},birthday:{get:function(){var e="";if(this.get("event")&&this.get("event").length>0){var r=n.filter(this.get("event"),function(e){return e.type===3})[0];r!==t&&(e=r.start_date)}return e}},firstLetter:{get:function(){var e=this.get("name"),t=e&&e.prefix?e.prefix.toUpperCase():"";return t=t?t.substring(0,1):"",t}}}),this.get("group")&&this.set({group:n.sortBy(this.get("group"),function(e){return parseInt(e.group_row_id,10)})}),this.get("photo")&&this.get("photo")[0]&&this.get("photo")[0].data&&this.set({avatar:"file:///"+this.get("photo")[0].data,avatarSmall:"file:///"+this.get("photo")[0].data});if(this.get("name")){var e=this.get("name");e.display_name&&this.set({displayName:this.get("name").display_name}),e.prefix=e.prefix!=="þþþþþþþþ"&&e.prefix!=="~"?e.prefix:"",this.set({name:e})}},toggleStarAsync:function(){var e=r.Deferred(),t=this.get("starred")===1?i.actions.CONTACT_UNSTART:i.actions.CONTACT_START;return s.requestAsync({url:t,data:{contact:this.id},success:function(t){t.state_code===200?(console.log("ContactModel - Star success. "),this.set(t.body),e.resolve(t)):(console.log("ContactModel - Star failed. Error info: "+t.state_line),e.reject(t)),this.collection.trigger("refresh",this.collection)}.bind(this)}),e.promise()},isInGroup:function(e,t){return this.get("account_name")===e&&n.pluck(this.get("group"),"group_row_id").indexOf(t)>=0}});return o})}(this),function(e,t){define("IOBackendDevice",["underscore","IO","MessageRouterMixin","Environment","utilities/FilterFunction"],function(t,n,r,i,s){return console.log("IOBackendDevice - File loded."),n.Backend.Device=t.extend(function(){},n.Backend),n.Backend.Device.onmessage=function(e,r,o,u){return typeof o!="boolean"&&(u=o,o=!1),o||(e["data.deviceId"]=i.get("deviceId")),i.get("deviceId")==="Default"&&i.once("change:deviceId",function(e,n){t.each(this.callbackList,function(e){e.route["data.deviceId"]&&(e.route["data.deviceId"]=n,e.filter=s.generate(e.route))})},n.Backend.Device),n.Backend.onmessage.call(n.Backend,e,r,u)},e.IO=n,n})}(this),function(e,t){define("Log",["Configuration"],function(t){console.log("Log - File loaded.");var n=function(n){var r=!0;if(r){n=n||{};var i=t.actions.SEND_LOG,s=[],o;for(o in n)n.hasOwnProperty(o)&&s.push(o+"="+e.encodeURIComponent(n[o]));i+="?"+s.join("&"),e.OneRingRequest("get",i,"",function(e){e=JSON.parse(e),e.state_code===200&&console.log("Log: ",i)})}};return e.log=n,n})}(this),function(e,t){define("ui/EventsMapping",[],function(){console.log("EventsMapping - File loaded.");var e=Object.freeze({SHOW:"show",HIDE:"hide",REMOVE:"remove",RENDERED:"rendered",BUILD:"build",DRAGSTART:"dragStart",DRAGGING:"dragging",DRAGEND:"dragEnd",BUTTON_YES:"button_yes",BUTTON_NO:"button_no",BUTTON_CANCEL:"button_cancel",BUTTON_RETRY:"button_retry"});return e})}(this),function(e,t){define("ui/KeyMapping",[],function(){console.log("KeyMapping - File loaded.");var e=Object.freeze({BACKSPACE:8,TAB:9,ENTER:13,ESC:27,LEFT:37,UP:38,RIGHT:39,DOWN:40,END:35,HOME:36,SPACEBAR:32,PAGEUP:33,PAGEDOWN:34,J:74,k:75});return e})}(this),function(e,t,n){define("ui/MouseState",["jquery","underscore","backbone"],function(e,n,r){console.log("MouseState - File loaded.");var i,s,o,u=n.extend({},r.Events);return e(t).on("mousemove",n.throttle(function(e){i=e.clientX,s=e.clientY,o=e.originalEvent.srcElement,u.trigger("mousemove",u)},25)),Object.defineProperties(u,{x:{get:function(){return i}},y:{get:function(){return s}},currentElement:{get:function(){return o}}}),u})}(this,this.document),function(e,t){define("ui/WindowState",["jquery","underscore","backbone"],function(t,n,r){console.log("WindowState - File loaded.");var i=t(e),s=i.width(),o=i.height(),u=i.scrollLeft(),a=i.scrollTop(),f=n.extend({},r.Events);return i.on("resize",n.throttle(function(e){s=i.width(),o=i.height(),u=i.scrollLeft(),a=i.scrollTop(),f.trigger("resize",f)},25)),Object.defineProperties(f,{width:{get:function(){return s}},height:{get:function(){return o}},scrollLeft:{get:function(){return u}},scrollTop:{get:function(){return a}}}),f})}(this),function(e,t){define("ui/UIHelper",["ui/EventsMapping","ui/KeyMapping","ui/MouseState","ui/WindowState"],function(t,n,r,i){console.log("UIHelper - File loaded.");var s=e.UIHelper={};return Object.defineProperties(s,{EventsMapping:{value:t},KeyMapping:{value:n},MouseState:{value:r},WindowState:{value:i}}),s})}(this),function(e,t){define("ui/behavior/AutoCloseMixin",["underscore","jquery","ui/UIHelper","Internationalization","utilities/StringUtil"],function(t,n,r,i,s){var o=e.setInterval,u=e.clearInterval,a=r.EventsMapping,f=function(e){u(e),this.off(a.REMOVE,f)},l={};return l.initAutoClose=function(){var e=n("<span>").addClass("countdown text-thirdly").html(s.format(i.ui.AUTO_CLOSE,Math.round(this.delay/1e3)));this.$(".w-ui-window-footer-monitor").empty().append(e)},l.countDown=function(){var e=this.$(".w-ui-window-footer-monitor .countdown"),t=0,n=o(function(){t++;var r=Math.round(this.delay/1e3)-t;e.html(s.format(i.ui.AUTO_CLOSE,r)),r===0&&(f.call(this,n),this.remove())}.bind(this),1e3);this.once(a.REMOVE,f)},{mixin:function(e){t.extend(e,l);var n=!1,r=0;Object.defineProperties(e,{delay:{set:function(e){r=parseInt(e,10)},get:function(){return r}}});var i=e.options||{};if(i.hasOwnProperty("autoClose")){var s=parseInt(i.autoClose,10);t.isNaN(s)?console.warn("AutoCloseMixin - Parameter 'autoClose' is not a number."):(n=!0,r=s)}n&&(e.once(a.RENDERED,l.initAutoClose,e),e.once(a.SHOW,l.countDown,e))}}})}(this),function(e,t,n){define("ui/behavior/ClickToHideMixin",["underscore","ui/EventsMapping"],function(n,r){console.log("ClickToHideMixin - File loaded");var i=e.setTimeout,s={};return s.initClickToHideMixin=function(){this.clickToHideMixinOnShowHandler=function(){this.clickHandler=function(e){this.$el[0].contains(e.target)||(this.hide(),t.removeEventListener("click",this.clickHandler))}.bind(this),i(function(){t.addEventListener("click",this.clickHandler,!0)}.bind(this),0)},this.on(r.SHOW,this.clickToHideMixinOnShowHandler,this)},s.uninstallClickToHideMixin=function(){this.off(r.SHOW,this.clickToHideMixinOnShowHandler),t.removeEventListener("click",this.clickHandler)},{mixin:function(e){n.extend(e,s),s.initClickToHideMixin.call(e)}}})}(this,this.document),function(e,t){define("ui/behavior/ButtonSetMixin",["doT","jquery","underscore","ui/UIHelper","ui/TemplateFactory","Internationalization"],function(e,t,n,r,i,s){console.log("ButtonSetMixin - File loaded.");var o={},u=Object.freeze({YES:e.template(i.get("ui","button-set-yes")),CANCEL:e.template(i.get("ui","button-set-cancel")),RETRY:e.template(i.get("ui","button-set-retry")),YES_NO:e.template(i.get("ui","button-set-yes-no")),YES_CANCEL:e.template(i.get("ui","button-set-yes-cancel")),RETRY_CANCEL:e.template(i.get("ui","button-set-retry-cancel")),YES_NO_CANCEL:e.template(i.get("ui","button-set-yes-no-cancel"))});return o.init=function(){if(this.buttons.length>0)return;this.$(".w-ui-window-footer-button-ctn").prepend(this.$buttonSet),this.$buttonSet.on("click",function(e){t(e.target).hasClass("button-yes")?this.trigger(r.EventsMapping.BUTTON_YES):t(e.target).hasClass("button-no")?this.trigger(r.EventsMapping.BUTTON_NO):t(e.target).hasClass("button-cancel")?this.trigger(r.EventsMapping.BUTTON_CANCEL):t(e.target).hasClass("button-retry")&&this.trigger(r.EventsMapping.BUTTON_RETRY)}.bind(this))},{mixin:function(e){n.extend(e,o);var i;Object.defineProperties(e,{$buttonSet:{get:function(){return i}}});var s=e.options||{};if(s.hasOwnProperty("buttonSet")){switch(s.buttonSet){case this.BUTTON_SET.YES:i=t(u.YES({}));break;case this.BUTTON_SET.CANCEL:i=t(u.CANCEL({}));break;case this.BUTTON_SET.RETRY:i=t(u.RETRY({}));break;case this.BUTTON_SET.YES_NO:i=t(u.YES_NO({}));break;case this.BUTTON_SET.YES_CANCEL:i=t(u.YES_CANCEL({}));break;case this.BUTTON_SET.RETRY_CANCEL:i=t(u.RETRY_CANCEL({}));break;case this.BUTTON_SET.YES_NO_CANCEL:i=t(u.YES_NO_CANCEL({}));break;default:console.warn("ButtonSetMixin - ButtonSet not supported.")}e.on(r.EventsMapping.RENDERED,o.init,e)}e.on(r.EventsMapping.BUTTON_YES,e.remove),e.on(r.EventsMapping.BUTTON_CANCEL,e.remove),e.on(r.EventsMapping.BUTTON_NO,e.remove)},BUTTON_SET:Object.freeze({YES:"yes",CANCEL:"cancel",RETRY:"retry",YES_NO:"yes_no",YES_CANCEL:"yes_cancel",RETRY_CANCEL:"retry_cancel",YES_NO_CANCEL:"yes_no_cancel"})}})}(this),function(e,t,n){define("ui/behavior/DraggableMixin",["underscore","jquery","ui/UIHelper"],function(e,n,r){console.log("DraggableMixin - File loaded.");var i=n(t),s=r.MouseState,o={};o.init=function(){e.bindAll(this,"dragStart","dragEnd","mouseMoveHandler"),this.$el.on("mousedown",".drag-handel",this.dragStart).toggleClass("draggable",this.draggable)};var u,a,f,l;return o.mouseMoveHandler=function(e){var t=f+(s.x-u),n=l+(s.y-a);this.position={left:t,top:n}},o.dragEnd=function(e){e.preventDefault(),this.$el.removeClass("dragging"),i.off("mousemove",this.mouseMoveHandler).off("mouseup",this.dragEnd),this.$el.on("mousedown",".drag-handel",this.dragStart),this.trigger(r.EventsMapping.DRAGEND)},o.dragStart=function(e){if(!this.draggable||e.which!==1)return;var t=this.$el.offset();u=e.clientX,a=e.clientY,f=t.left,l=t.top,this.$el.addClass("dragging"),i.on("mousemove",this.mouseMoveHandler).on("mouseup",this.dragEnd),this.$el.off("mousedown",".drag-handel",this.dragStart),this.trigger(r.EventsMapping.DRAGSTART)},{mixin:function(t){e.extend(t,o);var n=!0;Object.defineProperties(t,{draggable:{set:function(e){n=Boolean(e)},get:function(){return n}}});var i=t.options||{};i.hasOwnProperty("draggable")&&(t.draggable=i.draggable),t.on(r.EventsMapping.RENDERED,o.init,t)}}})}(this,this.document),function(e,t,n){define("ui/behavior/ModalMixin",["underscore","jquery","ui/UIHelper","ui/TemplateFactory"],function(e,t,n,r){console.log("ModalMixin - File loaded.");var i=r.get("ui","modal-mask"),s={};return s.addMask=function(){this.$el.before(this.$modelMask)},s.removeMask=function(){this.$modelMask.remove()},{mixin:function(r){e.extend(r,s);var o=t(i);Object.defineProperties(r,{$modelMask:{get:function(){return o}}});var u=!0,a=r.options||{};a.hasOwnProperty("modal")&&(u=a.modal),u&&(r.on(n.EventsMapping.SHOW,r.addMask),r.on(n.EventsMapping.REMOVE,r.removeMask),r.on(n.EventsMapping.HIDE,r.removeMask))}}})}(this,this.document),function(e,t){define("Settings",["underscore","Environment"],function(n,r){console.log("Settings - File loaded.");var i=e.localStorage,s={},o="wdj_user_config_"+r.get("deviceId"),u="wdj_user_config_global",a=JSON.parse(i.getItem(o)||JSON.stringify({})),f=JSON.parse(i.getItem(u)||JSON.stringify({}));return r.get("deviceId")==="Default"&&r.once("change:deviceId",function(e,t){o="wdj_user_config_"+t,a=JSON.parse(i.getItem(o)||JSON.stringify({}))}),s.get=function(e){var r;return arguments.length===0?r=n.extend({},f,a):r=a[e]!==t?a[e]:f[e],r},s.set=function(e,t,n){n===!0||n===r.get("deviceId")?(a[e]=t,i.setItem(o,JSON.stringify(a))):(f[e]=t,i.setItem(u,JSON.stringify(f)))},s.remove=function(e,t){t===!0||t===r.get("deviceId")?(delete a[e],i.setItem(o,JSON.stringify(a))):(delete f[e],i.setItem(u,JSON.stringify(f)))},s.clear=function(e){throw new Error("Settings.clear is not implemented because it's not well defined")},e.Settings=s,s})}(this),function(e,t){define("ui/behavior/DisposableMixin",["underscore","doT","Settings","Environment","ui/UIHelper","ui/TemplateFactory"],function(e,n,r,i,s,o){console.log("DisposableMixin - File loaded");var u=n.template(o.get("ui","disposable-tip")),a="disposable-item-",f={};return f.init=function(){this.$(".w-ui-window-footer-monitor").append(u({})),this.disposableChecked&&this.$(".w-ui-window-footer-monitor .check-disposable").prop({checked:!0})},f.saveSetting=function(){var e=this.$(".w-ui-window-footer-monitor .check-disposable").prop("checked");r.set(this.disposableName,e,i.get("deviceId"))},f.getSetting=function(){return r.get(this.disposableName)},{mixin:function(n){e.extend(n,f);var o;Object.defineProperties(n,{disposableName:{set:function(e){o=a+e.toString()},get:function(){return o}},disposableChecked:{value:function(){var e;return n.options.hasOwnProperty("disposableChecked")?e=n.options.disposableChecked:e=!1,e}()}});var u=n.options;u.hasOwnProperty("disposableName")&&(n.disposableName=u.disposableName);var l=r.get(n.disposableName,i.get("deviceId"))===!0?!0:!1;l?n.show=function(){n.trigger(s.EventsMapping.BUTTON_YES)}:o!==t&&(n.on(s.EventsMapping.RENDERED,f.init,n),n.on(s.EventsMapping.BUTTON_YES,f.saveSetting,n))}}})}(this),function(e,t){define("ui/behavior/Behaviors",["ui/behavior/AutoCloseMixin","ui/behavior/ClickToHideMixin","ui/behavior/ButtonSetMixin","ui/behavior/DraggableMixin","ui/behavior/ModalMixin","ui/behavior/DisposableMixin"],function(e,t,n,r,i,s){console.log("Behavios - File loaded.");var o={AutoCloseMixin:e,ClickToHideMixin:t,ButtonSetMixin:n,DraggableMixin:r,ModalMixin:i,DisposableMixin:s};return o})}(this),function(e,t){define("ui/Panel",["underscore","backbone","doT","jquery","ui/UIHelper","ui/TemplateFactory","ui/behavior/Behaviors"],function(n,r,i,s,o,u,a){console.log("Panel - File loaded.");var f=e.setTimeout,l=o.EventsMapping,c=o.WindowState,h=r.View.extend({template:i.template(u.get("ui","window")),className:"w-ui-window w-layout-hide vbox",initialize:function(){a.ModalMixin.mixin(this),a.ButtonSetMixin.mixin(this),a.DisposableMixin.mixin(this),a.DraggableMixin.mixin(this);var e={},r="",i=!1,o,u,f,l=[],h=function(e){n.each(l,function(t){e.target===t.$button[0]&&this.trigger(t.eventName,e)},this)}.bind(this),p=!1,d=!1;Object.defineProperties(this,{position:{set:function(r){var i=r.left!==t?r.left:e.left,s=r.top!==t?r.top:e.top,o=[0,0,0];this.$el[0].style["-webkit-transform"].replace(/[\w\W]*?\(([\w\W]*?)\)/,function(e,t){var r=t.split(",");n.each(o,function(e,t){o[t]=Number(r[t].replace("px",""))})}),e.left=Math.max(Math.min(i,c.width-this.$el[0].offsetWidth),0),e.top=Math.max(Math.min(s,c.height-this.$el[0].offsetHeight),0),this.$el.css({"-webkit-transform":"translate3d("+Math.floor(e.left)+"px, "+Math.floor(e.top)+"px, 0)"})},get:function(){return n.clone(e)}},title:{set:function(e){r=e,this.$(".w-ui-window-header-title").html(r)},get:function(){return r}},rendered:{set:function(e){i=e},get:function(){return i}},$bodyContent:{set:function(e){typeof e=="object"?o=e:e!==t&&(o=s("<p>").html(e.toString())),this.$(".w-ui-window-body").empty().append(o)},get:function(){return o}},height:{set:function(e){u=parseInt(e,10),this.$el.height(u)}},width:{set:function(e){f=parseInt(e,10),this.$el.width(f)},get:function(){return f}},buttons:{set:function(e){e instanceof Array?l=e:e.hasOwnProperty("$button")&&e.hasOwnProperty("eventName")&&l.push(e);var t=this.$(".w-ui-window-footer-button-ctn").empty();n.each(l,function(e){t.append(e.$button)},this)},get:function(){return l}},disableX:{set:function(e){p=e,this.$(".w-ui-window-header-x")[p?"hide":"show"]()},get:function(){return p}},buttonClickHandler:{get:function(){return h}},disableFooter:{set:function(e){d=e,this.$(".w-ui-window-footer")[d?"hide":"show"]()},get:function(){return d}}});var v=this.options||{},m;for(m in v)v.hasOwnProperty(m)&&this.hasOwnProperty(m)&&(this[m]=v[m])},render:function(){if(this.rendered)return;return this.delegateEvents(),s("body").append(this.$el.html(this.template({}))),this.title=this.title,this.$bodyContent=this.$bodyContent,this.buttons=this.buttons,this.disableX=this.disableX,this.width=this.width,this.disableFooter=this.disableFooter,this.rendered=!0,this.trigger(l.RENDERED),this},resizeHandler:function(){this.draggable?this.position=this.position:this.center()},show:function(){this.rendered||this.render(),this.$el.on("click","button",this.buttonClickHandler),this.listenTo(c,"resize",this.resizeHandler),this.$el.addClass("w-layout-hide"),f(this.center.bind(this),0),this.trigger(l.SHOW)},hide:function(){this.$el.addClass("w-layout-hide"),this.$el.off("click",this.buttonClickHandler),this.trigger(l.HIDE)},remove:function(){if(this.rendered&&!this.$el.hasClass("w-layout-hide")){var e=function(){this.$el.remove(),this.stopListening(),this.trigger(l.REMOVE)}.bind(this);this.$el.one("webkitTransitionEnd",e),this.hide(),this.rendered=!1}},close:function(){this.trigger(l.BUTTON_CANCEL)},center:function(){var e=this.$el[0].offsetWidth,t=this.$el[0].offsetHeight;this.position={left:c.scrollLeft+Math.max(0,(c.width-e)/2),top:c.scrollTop+Math.max(0,(c.height-t)/2)},this.$el.removeClass("w-layout-hide")},addButton:function(e,t){this.buttons.push({$button:e,eventName:t}),this.$(".w-ui-window-footer-button-ctn").append(e)},events:{"click .w-ui-window-header-x":"close"}});return h})}(this),function(e,t){define("ui/AlertWindow",["jquery","ui/UIHelper","ui/Panel","Internationalization","ui/behavior/Behaviors","ui/behavior/ButtonSetMixin"],function(n,r,i,s,o,u){console.log("AlertWindow - File loaded.");var a=s.ui.TIP,f=i.extend({className:i.prototype.className+" w-ui-alert-window",initialize:function(){f.__super__.initialize.apply(this,arguments),o.AutoCloseMixin.mixin(this);var e=this.options||{};e.hasOwnProperty("title")?this.title=e.title:this.title=a,e.hasOwnProperty("width")&&(this.width=e.width)}}),l=new f({buttons:[{$button:n("<button>").html(s.ui.CONFIRM),eventName:"button_yes"}],disableX:!0,draggable:!0,width:360}),c=function(n,i,s){l.$bodyContent=n;var o=function(){i!==t&&i.call(s||e)};l.on(r.EventsMapping.BUTTON_YES,o);var u=function(){l.off(r.EventsMapping.BUTTON_YES,o),l.off(r.EventsMapping.REMOVE,u)};l.on(r.EventsMapping.REMOVE,u),l.show()};e.alert=c;var h=new f({buttonSet:u.BUTTON_SET.YES_NO,draggable:!0,width:360}),p=function(n,i,s,o){h.$bodyContent=n,typeof s!="function"&&(o=s,s=t);var u=function(){i!==t&&i.call(o||e)},a=function(){s!==t&&s.call(o||e)};h.on(r.EventsMapping.BUTTON_YES,u),h.on(r.EventsMapping.BUTTON_CANCEL,a);var f=function(){h.off(r.EventsMapping.BUTTON_YES,u),h.off(r.EventsMapping.BUTTON_CANCEL,a),h.off(r.EventsMapping.REMOVE,f)};h.on(r.EventsMapping.REMOVE,f),h.show()};return e.confirm=p,f})}(this),function(e,t){define("Device",["backbone","underscore","doT","jquery","Configuration","Internationalization","IOBackendDevice","Log","utilities/QueryString","Environment","ui/AlertWindow","ui/TemplateFactory","ui/Panel"],function(n,r,i,s,o,u,a,f,l,c,h,p,d){console.log("Device - File loaded. ");var v=e.alert,m=n.Model.extend({defaults:{isConnected:!1,isMounted:!1,hasSDCard:!1,hasEmulatedSD:!1,isUSB:!1,isWifi:!1,isInternet:!1,isFlashed:!1,isFastADB:!1,SDKVersion:0,productId:"",isRoot:!1,internalCapacity:0,externalCapacity:0,internalFreeCapacity:0,externalFreeCapacity:0,isAutoBackup:!1,deviceName:l.get("device_name")||u.misc.DEFAULT_DEVICE_NAME,udid:"",shell:{},screenshot:{}},initialize:function(){var e=!1;a.Backend.Device.onmessage({"data.channel":o.events.DEVICE_STATE_CHANGE},function(t){console.log("Device - Device state change."),e=!0,this.changeHandler(t)},this),a.requestAsync(o.actions.DEVICE_GET_DEVICE_STATE).done(function(t){t.state_code===200?(console.log("Device - Get device state success."),e||this.changeHandler(t.body)):console.error("Device - Get device state failed. Error info: "+t.state_line)}.bind(this)),a.requestAsync(o.actions.DEVICE_IS_AUTOBACKUP).done(function(e){e.state_code===200?(console.log("Device - Get device autobackup success."),this.offlineChangeHandler(e.body.value)):console.error("Device - Get device autobackup failed. Error info: "+e.state_line)}.bind(this)),this.isUserFlashedAsync().done(this.flashChangeHandler.bind(this)),a.Backend.Device.onmessage({"data.channel":o.events.DEVICE_OFFLINE_CHANGE},r.debounce(function(e){console.log("Device - Device offline change."),this.offlineChangeHandler(e)},500),this),this.on("change:deviceName",function(){this.isUserFlashedAsync().done(this.flashChangeHandler.bind(this))},this);var t=function(e,n){n&&(this.getUdidAsync().done(function(e){this.set("udid",e.body.value)}.bind(this)),this.off("change:isConnected",t))};this.on("change:isConnected",t,this);var n=function(){this.getShellInfoAsync().done(function(){c.get("deviceId")!=="Default"&&this.get("shell").path&&this.off("change:isConnected",n,this)}.bind(this))};this.on("change:isConnected",n,this)},getUdidAsync:function(){var e=s.Deferred();return a.requestAsync(o.actions.DEVICE_GET_UDID).done(function(t){t.state_code===200&&e.resolve(t)}),e},offlineChangeHandler:function(e){this.set({isAutoBackup:JSON.parse(e)})},flashChangeHandler:function(e){this.set({isFlashed:e.body.value})},changeHandler:function(e){this.set({isConnected:e.connection_state,isMounted:e.mmount_state===1?!0:!1,hasSDCard:e.mmount_state===2?!1:!0,hasEmulatedSD:!e.has_non_emulated_external_storage,isUSB:e.type===o.enums.USB_DEVICE,isWifi:e.type===o.enums.WIFI_DEVICE,isInternet:e.type===o.enums.INTERNET_DEVICE,isFastADB:e.type===o.enums.ADB_DEVICE,SDKVersion:e.sdk_version,productId:e.product_id,isRoot:e.is_root,deviceName:e.device_name})},getSDCapacityAsync:function(){var e=s.Deferred();return a.requestAsync({url:o.actions.DEVICE_GET_EXTERNAL_ROOM,success:function(t){t.state_code===200?(console.log("Device - Get external capacity success."),this.set({externalCapacity:parseInt(t.body.total_size,10),externalFreeCapacity:parseInt(t.body.available_size,10)}),e.resolve(t)):(console.error("Device - Get external capacity failed. Error info: "+t.state_line),e.reject(t))}.bind(this)}),e.promise()},getDeviceCapacityAsync:function(){var e=s.Deferred();return a.requestAsync({url:o.actions.DEVICE_GET_INTERNAL_ROOM,success:function(t){t.state_code===200?(console.log("Device - Get internal capacity success."),this.set({internalCapacity:parseInt(t.body.total_size,10),internalFreeCapacity:parseInt(t.body.available_size,10)}),e.resolve(t)):(console.error("Device - Get internal capacity failed. Error info: "+t.state_line),e.reject(t))}.bind(this)}),e.promise()},manageSDCardAsync:function(){var e=s.Deferred();if(this.get("isInternet"))v(u.welcome.MANAGE_SD_INTERNET);else{var t=function(){var t=function(e){var t=new h({draggable:!0,buttonSet:"retry_cancel",$bodyContent:e});t.on("button_retry",function(){this.manageSDCardAsync(),t.close()},this),t.show()};a.requestAsync({url:o.actions.DEVICE_OPEN_SD_CARD,success:function(n){if(n.state_code===200)console.log("Device - Open SD card success."),e.resolve(n);else{console.log("Device - Open SD card failed. Error info: "+n.state_line);switch(n.state_code){case 500:t(u.welcome.MANAGE_SD_UNCONNECT);break;case 703:t(i.template(p.get("misc","sd-mount"))({}));break;case 702:v(u.misc.ALERT_TIP_NO_SD_CARD);break;case 745:var r=s("<div>").html(u.misc.MTP_BLOCK_BY_SCREEN_LOCK),l=new h({draggable:!0,buttonSet:"retry_cancel",$bodyContent:r});l.on("button_retry",function(){this.manageSDCardAsync(),l.close()},this),r.one("click",".button-ftp",function(){a.requestAsync({url:o.actions.DEVICE_OPEN_SD_CARD,data:{use_ftp_directly:1}}),l.close()});var c=setInterval(function(){a.requestAsync(o.actions.DEVICE_OPEN_SD_CARD).done(function(e){e.state_code===200&&(l.close(),f({event:"debug.device_mtp_retry_success"}))})},5e3);l.on("remove",function(){clearInterval(c),r.remove()}),l.show(),f({event:"ui.show.device_mtp_block_show"});break;default:t(u.welcome.MANAGE_SD_ERROR)}e.reject(n)}}})}.bind(this);a.requestAsync(o.actions.DEVICE_CHECK_FTP_REG).done(function(e){if(e.body.value)t.call(this);else{var n=new d({buttons:[{$button:s("<button>").html(u.misc.FIX).addClass("primary"),eventName:"button_yes"},{$button:s("<button>").html(u.misc.OPEN_DERICTLY),eventName:"button_no"}],$bodyContent:u.misc.FTP_FIX,title:u.welcome.TOOL_SD});n.on("button_yes",function(){a.requestAsync(o.actions.DEVICE_FIX_FTP).done(function(){t.call(this)}).fail(function(){v(u.misc.FIX_FAILED)})},this),n.on("button_no",function(){t.call(this)},this),n.show()}})}return e.promise()},getBatteryInfoAsync:function(){var e=s.Deferred();return a.requestAsync({url:o.actions.DEVICE_GET_BATTERY,success:function(t){t.state_code===200?(console.log("Device - Get battery info success."),e.resolve(t)):(console.error("Device - Get battery info failed. Error info: "+t.state_line),e.reject(t))}}),e.promise()},getWallpaperAsync:function(e,t){var n=s.Deferred();return a.requestAsync({url:o.actions.DEVICE_GET_WALLPAPER,data:{height:e,width:t},success:function(e){e.state_code===200?(console.log("Device - Get wallpaper image success."),n.resolve(e)):(console.error("Device - Get welcome wallpaper faild:"+e.state_code),n.reject(e))}}),n.promise()},getScreenshotAsync:function(e){var n=s.Deferred();return a.requestAsync({url:o.actions.DEVICE_GET_SCREENSHOT_INFO,data:{compress:e!==t?Number(e):0},success:function(e){e.state_code===200?(console.log("Device - Get display info success.",e),this.set({screenshot:{rotation:e.body.display_info.rotation,path:e.body.screenshot.file||"",date:(new Date).getTime()}}),n.resolve(e)):(console.error("Device - Get display info failed: "+e.state_line),n.reject(e))}.bind(this)}),n.promise()},getShellInfoAsync:function(){var e=s.Deferred();return a.requestAsync({url:o.actions.DEVICE_GET_SHELL,success:function(t){t.state_code===200?(console.log("Device - Get shell info success.",t),this.set({shell:{width:t.body.shell_width,height:t.body.shell_height,path:t.body.shell_file,screenshot:t.body.screenshot}}),e.resolve(t)):(console.error("Device - Get shell info failed: "+t.state_line),e.reject(t))}.bind(this)}),e.promise()},screenShotAsync:function(e,t){var n=s.Deferred();return a.requestAsync({url:o.actions.SCREEN_SHOT,data:{save_as:e,image_type:t},success:function(e){e.state_code===200?(console.log("Device - Screen shot success.",e),n.resolve(e)):(console.error("Device - Screen shot failed: "+e.state_line),n.reject(e))}}),n.promise()},isDeviceAutoBackupAsync:function(){var e=s.Deferred();return a.requestAsync({url:o.actions.DEVICE_IS_AUTOBACKUP,success:function(t){t.state_code===200?e.resolve(t):e.reject(t)}}),e.promise()},isUserFlashedAsync:function(){var e=s.Deferred();return a.requestAsync({url:o.actions.IS_USER_FLASHED,success:function(t){t.state_code===200?e.resolve(t):e.reject(t)}}),e.promise()},getIsUserFlashed:function(){this.isUserFlashedAsync().done(function(e){e.state_code===200?(console.log("Device - Get device is isFlashed success."),this.flashChangeHandler(e.body.value)):console.error("Device - Get device is isFlashed failed. Error info: "+e.state_line)}.bind(this))},canScreenshotAsync:function(){var e=s.Deferred();return a.requestAsync({url:o.actions.DEVICE_CAN_SCREENSHOT_WIFI,success:function(t){t.state_code===200?e.resolve(t):e.reject(t)}}),e.promise()}}),g=new m;return g.on("change:isConnected",function(e,t){s("body").toggleClass("connected",t).toggleClass("disconnected",!t)}),e.Device=g,g})}(this),function(e,t){define("message/models/ConversationModel",["backbone","Configuration","Internationalization"],function(e,t,n){console.log("ConversationModel - File loaded.");var r=e.Model.extend({defaults:{contactIcon:t.enums.CONTACT_DEFAULT_ICON},initialize:function(){Object.defineProperties(this,{hasUnread:{get:function(){return this.get("unread_number")>0}},hasFailed:{get:function(){return this.get("failed_sms")>0}}}),this.set({id:this.id||this.get("conversation_id")}),this.changeAddressHandler()},changeAddressHandler:function(){var e=this.get("address")[0],r=t.enums.CONTACT_DEFAULT_ICON,i=e.contact_id==="-1"?e.phone_number:e.contact_name||n.contact.UNNAMED_CONTACT;this.get("address").length===1?r=e.contact_icon?"file:///"+e.contact_icon:t.enums.CONTACT_DEFAULT_ICON:r=t.enums.CONTACT_DEFAULT_BATCH_ICON,this.set({contactName:i,contactIcon:r})}});return r})}(this),function(e,t){define("message/collections/ConversationsCollection",["backbone","underscore","jquery","Device","IO","Configuration","message/models/ConversationModel"],function(e,n,r,i,s,o,u){console.log("ConversationsCollection - File loaded.");var a=e.Collection.extend({url:o.actions.SMS_GET_CONVERSATION,model:u,data:{type:o.enums.SMS_CONVERSATION_TYPE_ALL,start:0,number:-1},comparator:function(e){return-e.get("last_date")},parse:function(e){return e.state_code===202&&i.get("isConnected")&&(console.log("ConversationsCollection - Conversation is syncing."),this.syncing=!0,this.trigger("syncStart")),this.totalCount=e.body.total_sms||0,this.unreadCount=e.body.unread_sms||0,n.each(e.body.conversation,function(e){e.id=e.conversation_id}),e.body.conversation},syncAsync:function(){var e=r.Deferred();return this.syncing=!0,this.trigger("syncStart"),s.requestAsync({url:o.actions.SMS_SYNC,success:function(t){t.state_code===200?(console.log("ConversationsCollection - Conversation sync success."),e.resolve(t)):(console.error("ConversationsCollection - Conversation sync failed. Error info: "+t.state_line),this.syncing=!1,this.trigger("syncEnd"),e.reject(t))}.bind(this)}),e.promise()},initialize:function(){var e=0,t=0,n=!1,r=!1;Object.defineProperties(this,{totalCount:{set:function(t){e=parseInt(t,10)},get:function(){return e}},unreadCount:{set:function(e){t=parseInt(e,10)},get:function(){return t}},loading:{set:function(e){n=Boolean(e)},get:function(){return n}},syncing:{set:function(e){r=Boolean(e)},get:function(){return r}}}),this.on("update",function(){n=!0,this.fetch({success:function(e){console.log("ConversationsCollection - Conversation updated."),n=!1,e.trigger("refresh",e)}})},this),s.Backend.Device.onmessage({"data.channel":o.events.SMS_CALLLOG_SMS_UPDATED},function(e){r&&(r=!1,this.trigger("syncEnd")),!e||this.trigger("update")},this),this.on("add",function(e){e.on("change:address",e.changeAddressHandler,e),e.once("remove",function(){e.off()},e)})},updateConversationAsync:function(e){var n=r.Deferred(),i=e.get("id");return s.requestAsync({url:o.actions.SMS_GET_CONVERSATION,data:{type:o.enums.SMS_CONVERSATION_TYPE_SPECIFY_SMS_ID,filter:i},success:function(e){if(e.state_code===200){console.log("ConversationsCollection - Get conversation by SMS ID = "+i+" success."),this.totalCount=e.body.total_sms,this.unreadCount=e.body.unread_sms;if(!e.body.conversation)this.trigger("update");else{var r=new u(e.body.conversation[0]),s=this.get(r.get("id"));s!==t&&s.set(r.toJSON()),this.trigger("refresh",this)}n.resolve(e)}else console.error("ConversationsCollection - Get conversation by SMS ID = "+i+" failed. Error info: "+e.state_line),n.reject(e)}.bind(this)}),n.promise()},getConversationWithUnreadMessage:function(){return this.filter(function(e){return e.hasUnread})},deleteConversationsAsync:function(e,t){var i=r.Deferred(),u={conversations:e.join(",")};return t&&(u.session=t),s.requestAsync({url:o.actions.SMS_DELETE_CONVERSATION,data:u,success:function(t){t.state_code===200?(console.log("ConversationsCollection - Delete conversation success."),n.each(e,function(e){var t=this.get(e);this.totalCount-=t.get("total_number"),this.unreadCount-=t.get("unread_number"),this.remove(t)},this),this.trigger("refresh",this),i.resolve(t)):(console.error("ConversationsCollection - Delete conversation failed. Error info: "+t.state_line),this.trigger("update"),i.reject(t))}.bind(this)}),i.promise()},markAsReadAsync:function(e,i){var u=r.Deferred(),a={conversations:e.join(",")};return i&&(a.session=i),s.requestAsync({url:o.actions.SMS_CONVERSATION_MARK_AS_READ,data:a,success:function(r){r.state_code===200?(console.log("ConversationsCollection - Mark as read success."),n.each(e,function(e){var n=this.get(e);n!==t&&n.set("unread_number",0)},this),u.resolve(r)):(console.error("ConversationsCollection - Mark as read failed. Error info: "+r.state_line),u.reject(r))}.bind(this)}),u.promise()},exportConversationAsync:function(e,t){var n=r.Deferred();return s.requestAsync({url:o.actions.SMS_EXPORT,data:{session:t,conversations:e},success:function(e){e.state_code===200?(console.log("ConversationsCollection - Export success."),n.resolve(e)):(console.error("ConversationsCollection - Export failed. Error info: "+e.tate_line),n.reject(e))}}),n.promise()},importConversationAsync:function(e,t){var n=r.Deferred();return s.requestAsync({url:o.actions.SMS_IMPORT,data:{session:t,csv_file:e},success:function(e){e.state_code===200?(console.log("ConversationsCollection - Import success."),n.resolve(e)):(console.error("ConversationsCollection - Import failed. Error info: "+e.state_code),n.reject(e))}}),n.promise()},getAll:function(){return this.models}}),f,l=n.extend({getInstance:function(){return f||(f=new a,f.trigger("update")),f}});return l})}(this),function(e,t){define("message/models/ThreadModel",["backbone"],function(e){console.log("ThreadModel - File loaded.");var t=e.Model.extend();return t})}(this),function(e,t){define("message/models/MessageModel",["backbone","underscore","jquery","IO","Configuration","utilities/StringUtil","message/collections/ConversationsCollection"],function(e,n,r,i,s,o,u){console.log("MessageModel - File loaded.");var a="../../../images/contact-default-small.png",f=e.Model.extend({initialize:function(){Object.defineProperties(this,{isRead:{get:function(){return!!this.get("read")}}}),this.set({contact_name:this.get("contact_name")||this.get("address"),contact_icon:this.get("contact_icon")?"file:///"+this.get("contact_icon"):a,body:o.conditionalEscape(this.get("body"))})},copyMessageAsync:function(){var e=r.Deferred();return i.requestAsync({url:s.actions.SMS_COPY,data:{text:this.get("body")},success:function(t){t.state_code===200?e.resolve(t):e.reject(t)}}),e.promise()},deleteMessageAsync:function(){var e=r.Deferred();return i.requestAsync({url:s.actions.SMS_DELETE,data:{sms_id:this.get("id")},success:function(n){n.state_code===200?(console.log("MessageModel - Delete message success."),this.collection!==t&&this.collection.remove(this),e.resolve(n)):(console.error("MessageModel - Delete message failed. Error info: "+n.state_line),e.reject(n))}.bind(this)}),e.promise()},markAsReadAsync:function(){var e=r.Deferred();return this.isRead?e.resolve():i.requestAsync({url:s.actions.SMS_MARK_AS_READ,data:{sms_id:this.get("id")},success:function(t){t.state_code===200?(console.log("MessageModel - Mark message as read success."),this.set({read:!0}),e.resolve(t)):(console.error("MessageModel - Mark message as read failed. Error info: "+t.state_line),e.reject(t))}.bind(this)}),e.promise()},markAsUnreadAsync:function(){var e=r.Deferred();return this.isRead?i.requestAsync({url:s.actions.SMS_MARK_AS_UNREAD,data:{sms_id:this.get("id")},success:function(t){t.state_code===200?(console.log("MessageModel - Mark message as unread success."),this.set({read:!1}),e.resolve(t)):(console.error("MessageModel - Mark message as unread failed. Error info: "+t.state_line),e.reject(t))}.bind(this)}):e.resolve(),e.promise()},resendAsync:function(){var e=r.Deferred();return i.requestAsync({url:s.actions.SMS_RESEND,data:{sms_id:this.get("id")},success:function(t){t.state_code===200?(console.log("MessageModel - Resend message success."),this.set({type:s.enums.SMS_TYPE_SENDING}),e.resolve(t)):(console.error("MessageModel - Resend message failed. Error info: "+t.state_line),e.reject(t))}.bind(this)}),e.promise()},openOnDeviceAsync:function(){var e=r.Deferred();return i.requestAsync({url:s.actions.SMS_OPEN_ON_DEVICE,data:{sms_id:this.get("id")},success:function(t){t.state_code===200?(console.log("MessageModel - Open message on device success."),e.resolve(t)):(console.error("MessageModel - Open message on device failed. Error info: "+t.state_line),e.reject(t))}}),e.promise()}});return f})}(this),function(e,t){define("message/collections/ThreadsCollection",["backbone","underscore","jquery","Configuration","Device","IOBackendDevice","message/models/ThreadModel","message/models/MessageModel"],function(e,t,n,r,i,s,o,u){console.log("ThreadsCollection - File loaded.");var a=e.Collection.extend({url:r.actions.SMS_GET_THREADS,model:o,data:{type:r.enums.SMS_THREADS_TYPE_SPECIFY_ID,unread:0,start:0,page_number:-1},initialize:function(){var e=!1,n=!1,o=[],u;Object.defineProperties(this,{loading:{set:function(t){e=Boolean(t)},get:function(){return e}},isBatch:{get:function(){return n}},receivers:{get:function(){return o}},failedCount:{get:function(){var e=0;return t.map(this.models,function(n){var i=t.pluck(n.get("sms"),"type");e+=i.length-t.without(i,r.enums.SMS_TYPE_SENT_FAILD).length}),e}},sendingCount:{get:function(){var e=0;return t.map(this.models,function(n){var i=t.pluck(n.get("sms"),"type");e+=i.length-t.without(i,r.enums.SMS_TYPE_SENDING).length}),e}},defaultNumber:{get:function(){return u}}});var a=function(){o.length=0;if(this.length>0){var e=t.uniq(t.map(this.models,function(e){return e.get("address")}));n=e.length>1,n?t.each(e,function(e){this.receivers.push(t.find(this.models,function(t){return t.get("address")===e}))},this):u=this.models[0].get("phone_number")}};this.on("update",function(){e=!0,this.fetch({success:function(e){console.log("ThreadsCollection - Collection updated."),e.loading=!1,a.call(e),e.trigger("refresh",e)},reset:!0})},this),this.on("remove",function(e){this.length===0&&this.trigger("empty")},this),this.listenTo(i,"change:isConnected",function(e,t){t&&this.trigger("update")},this),s.Backend.Device.onmessage({"data.channel":r.events.SMS_CALLLOG_SMS_RECEIVE},function(e){this.getThreadWithMessage(e.id)&&this.trigger("update")},this),s.Backend.Device.onmessage({"data.channel":r.events.SMS_CALLLOG_SMS_UPDATED},function(e){!e||this.trigger("update")},this)},parse:function(e){return e.body.thread||[]},getThreadWithMessage:function(e){return this.filter(function(n){var r=t.pluck(n.get("sms"),"id");return r.indexOf(e)>=0})[0]},getFailedMessage:function(){var e=[];return t.map(this.models,function(n){e=e.concat(t.filter(n.get("sms"),function(e){return e.type===r.enums.SMS_TYPE_SENT_FAILD}))}),e},resendAllAsync:function(){var e=n.Deferred();return s.requestAsync({url:r.actions.SMS_BATCH_RESEND,data:{sms_id:t.pluck(this.getFailedMessage(),"id").join(",")},success:function(t){t.state_code===200?(console.log("ThreadsCollection - Batch resend SMS success."),e.resolve(t)):(console.error("ThreadsCollection - Batch resend SMS faild. Error info: "+t.state_line),e.reject(t))}}),e.promise()}}),f,l=t.extend({getInstance:function(e){return f||(f=new a(e),f.trigger("update")),f},getClass:function(){return a}});return l})}(this),function(e,t){define("contact/models/AccountModel",["underscore","backbone","Internationalization"],function(e,t,n){console.log("AccountModel - File loaded.");var r={ACCT_SRC_PHONE:1,ACCT_SRC_SIM:2,ACCT_SRC_NETWORK:3,ACCT_SRC_OTHER:4},i={1:n.contact.ACCOUNT_TYPE_PHONE,2:n.contact.ACCOUNT_TYPE_SIM,3:n.contact.ACCOUNT_TYPE_GOOGLE,4:n.contact.ACCOUNT_TYPE_OTHER},s=t.Model.extend({initialize:function(){var e=this.get("account");this.set(e),this.unset("account"),this.set({displayName:this.get("source")===3?i[this.get("source")]+this.get("name"):i[this.get("source")]}),Object.defineProperties(this,{isSimAccount:{get:function(){return this.get("source")===r.ACCT_SRC_SIM}}})},containGroup:function(t){var n=e.pluck(this.get("group"),"id");return n.indexOf(t)>=0},hasGroupWithName:function(t){var n=e.find(this.get("group"),function(e){return e.title===t});return!!n}});return s})}(this),function(e,t){define("contact/collections/AccountCollection",["backbone","underscore","jquery","IOBackendDevice","Configuration","Device","contact/models/AccountModel"],function(e,n,r,i,s,o,u){console.log("AccountCollection - File loaded.");var a=e.Model.extend({}),f=e.Collection.extend({model:a}),l=e.Collection.extend({url:s.actions.CONTACT_GROUPS_SHOW,model:u,parse:function(e){return this.syncing&&e.state_code!==202&&(console.log("AccountCollection - Collection synced."),this.syncing=!1,this.trigger("syncEnd")),e.state_code===202&&o.get("isConnected")&&(console.log("AccountCollection - Collection is syncing."),this.syncing=!0,this.trigger("syncStart")),e.body.group},initialize:function(){var e=!1,t=!1;Object.defineProperties(this,{loading:{set:function(t){e=t},get:function(){return e}},syncing:{set:function(e){t=e},get:function(){return t}}}),this.on("update",function(){e||(e=!0,this.fetch({success:function(t){console.log("AccountCollection - Collection fetched."),e=!1,t.trigger("refresh",t)}}))},this)},getAccountsWritable:function(){return this.filter(function(e){return!e.get("read_only")})},addNewGroupAsync:function(e,t){var n=r.Deferred();return i.requestAsync({type:"post",url:s.actions.CONTACT_GROUPS_ADD,data:{account_name:e.get("name"),account_type:e.get("type"),title:t},success:function(e){e.state_code===200?(console.log("AccountCollection - Add new group success. "),this.once("refresh",n.resolve,this),this.trigger("update")):(console.error("AccountCollection - Add new group failed. Error info: "+e.state_line),n.reject(e))}.bind(this)}),n.promise()},getGroupsByAccount:function(e){return new f(this.get(e).get("group"))},getGroupById:function(e){return n.compact(this.map(function(t){var n=new f(t.get("group"));return n.get(e)}))[0]},getAccountByGroupId:function(e){return this.find(function(n){var r=new f(n.get("group"));return r.get(e)!==t})},getAccountByNameAndType:function(e,t){return this.find(function(n){return n.get("name")===e&&n.get("type")===t})}}),c,h=n.extend(function(){},{getInstance:function(){return c||(c=new l,c.trigger("update")),c}});return h})}(this),function(e,t){define("contact/EditorConfig",["Internationalization","Configuration","Environment"],function(e,t,n){console.log("EditorConfig - File loaded. ");var r={CONTACT_DATA_TEMPLATE:{id:"",name:{id:"",display_name:""},photo:[{id:"",data:""}],account_name:"",account_type:"",nickname:[{id:"",name:""}],group:[],starred:0,phone:[{id:"",type:2,number:""}],email:[{id:"",type:2,address:""}],IM:[{id:"",protocol:4,data:""}],address:[{id:"",type:1,formatted_address:""}],organization:[{id:"",type:1,company:""}],note:[{id:"",note:""}]},CATEGORY_LIST:["phone","email","IM","address","organization","note"],PHONE_OPTION:[{name:e.contact.HOME_NUMBER,value:1},{name:e.contact.CELL_PHONE_NUMBER,value:2},{name:e.contact.WORK_NUMBER,value:3},{name:e.contact.WORK_FAX,value:4},{name:e.contact.HOME_FAX,value:5},{name:e.contact.BP_CALL,value:6},{name:e.contact.OTHER_NUMBER,value:7},{name:e.contact.CALLBACK,value:8},{name:e.contact.CAR,value:9},{name:e.contact.COMPANY_MAIN,value:10},{name:e.contact.ISDN,value:11},{name:e.contact.MAIN,value:12},{name:e.contact.OTHER_FAX,value:13},{name:e.contact.RADIO,value:14},{name:e.contact.TELEX,value:15},{name:e.contact.TTY_TDD,value:16},{name:e.contact.WORK_MOBILE,value:17},{name:e.contact.WORK_PAGER,value:18},{name:e.contact.ASSISTANT,value:19},{name:e.contact.MMS,value:20},{name:e.contact.CUSTOME,value:0}],EMAIL_OPTION:[{name:e.contact.HOME_MAIL,value:1},{name:e.contact.WORK_MAIL,value:2},{name:e.contact.OTHER_MAIL,value:3},{name:e.contact.CUSTOME,value:0}],IM_OPTION:n.get("locale")===t.enums.LOCALE_EN_US?[{name:"AIM",value:0},{name:"Gtalk",value:5},{name:"ICQ",value:6},{name:"MSN",value:1},{name:"Skype",value:3},{name:"Yahoo",value:2},{name:"Custom...",value:-1}]:[{name:"AIM",value:0},{name:"MSN",value:1},{name:"Yahoo",value:2},{name:"Skype",value:3},{name:"QQ",value:4},{name:"Gtalk",value:5},{name:"ICQ",value:6},{name:"Jabber",value:7},{name:"自定义...",value:-1}],ADDRESS_OPTION:[{name:e.contact.HOME_ADDRESS,value:1},{name:e.contact.WORK_ADDRESS,value:2},{name:e.contact.OTHER_ADDRESS,value:3},{name:e.contact.CUSTOME,value:0}],ORGANIZATION_OPTION:[{name:e.contact.WORK,value:1},{name:e.contact.OTHER,value:2},{name:e.contact.CUSTOME,value:0}],CATEGORY_MENU:[{name:e.contact.PHONE,value:"phone"},{name:e.contact.EMAIL,value:"email"},{name:e.contact.IM,value:"IM"},{name:e.contact.ADDRESS,value:"address"},{name:e.contact.ORG,value:"organization"}]};return r})}(this),function(e,t){define("FunctionSwitch",["backbone","underscore","Configuration","Environment","utilities/QueryString","IOBackendDevice"],function(t,n,r,i,s,o){console.log("FunctionSwitch - File loaded.");var u={},a="0x"+parseInt(s.get("privacy"),10).toString(16),f="0x00000010",l="0x00000001",c="0x00000040";Object.defineProperties(u,{RECORD_BROWSE_HISTORY:{get:function(){return a&f}},ENABLE_APP_UPGRADE:{get:function(){return a&l}},ENABLE_DEBUG:{get:function(){return!(a&c)}}});var h=n.extend({},t.Events);return Object.defineProperties(h,{PRIVACY:{get:function(){return u}},ENABLE_APP_UPGRADE:{get:function(){return u.ENABLE_APP_UPGRADE&&(i.get("locale")===r.enums.LOCALE_DEFAULT||i.get("locale")===r.enums.LOCALE_ZH_CN)}},ENABLE_APP_COMMENT:{get:function(){return i.get("locale")===r.enums.LOCALE_DEFAULT||i.get("locale")===r.enums.LOCALE_ZH_CN}},ENABLE_APP_RECOMMEND:{get:function(){return i.get("locale")===r.enums.LOCALE_DEFAULT||i.get("locale")===r.enums.LOCALE_ZH_CN}},ENABLE_APP_PERMISSION:{get:function(){return i.get("locale")===r.enums.LOCALE_DEFAULT||i.get("locale")===r.enums.LOCALE_ZH_CN}},ENABLE_APP_SEARCH:{get:function(){return i.get("locale")===r.enums.LOCALE_DEFAULT||i.get("locale")===r.enums.LOCALE_ZH_CN}},ENABLE_DORAEMON:{get:function(){return i.get("locale")===r.enums.LOCALE_DEFAULT||i.get("locale")===r.enums.LOCALE_ZH_CN}},ENABLE_PHOTO_SYNC:{get:function(){return i.get("locale")===r.enums.LOCALE_DEFAULT||i.get("locale")===r.enums.LOCALE_ZH_CN}},ENABLE_PHOTO_SYNC_DOWNLOAD:{get:function(){return(i.get("locale")===r.enums.LOCALE_DEFAULT||i.get("locale")===r.enums.LOCALE_ZH_CN)&&!i.get("internetBar")}},ENABLE_DUAL_SIM:{get:function(){return i.get("locale")===r.enums.LOCALE_DEFAULT||i.get("locale")===r.enums.LOCALE_ZH_CN}},ENABLE_OPTIMIZE:{get:function(){return i.get("locale")===r.enums.LOCALE_DEFAULT||i.get("locale")===r.enums.LOCALE_ZH_CN}},ENABLE_WDAPK:{get:function(){return i.get("locale")===r.enums.LOCALE_DEFAULT||i.get("locale")===r.enums.LOCALE_ZH_CN}},ENABLE_MY_APPS:{get:function(){return i.get("locale")===r.enums.LOCALE_DEFAULT||i.get("locale")===r.enums.LOCALE_ZH_CN}},ENABLE_SUGGESTION_INSTALL:{get:function(){return i.get("locale")===r.enums.LOCALE_DEFAULT||i.get("locale")===r.enums.LOCALE_ZH_CN}},ENABLE_MY_MUTIL_SOCIAL_PLATFORM:{get:function(){return i.get("locale")===r.enums.LOCALE_DEFAULT||i.get("locale")===r.enums.LOCALE_ZH_CN}},ENABLE_SHARE_SET_WALLPAPER:{get:function(){return i.get("locale")===r.enums.LOCALE_DEFAULT||i.get("locale")===r.enums.LOCALE_ZH_CN}},ENABLE_SHARE_SET_RINGTONE:{get:function(){return i.get("locale")===r.enums.LOCALE_DEFAULT||i.get("locale")===r.enums.LOCALE_ZH_CN}},ENABLE_CLOUD_BACKUP_RESTORE:{get:function(){return i.get("locale")===r.enums.LOCALE_DEFAULT||i.get("locale")===r.enums.LOCALE_ZH_CN}},ENABLE_SHARE_ONE_KEY_UPDATE:{get:function(){return i.get("locale")===r.enums.LOCALE_DEFAULT||i.get("locale")===r.enums.LOCALE_ZH_CN}},ENABLE_SHARE_UNINSTALL:{get:function(){return i.get("locale")===r.enums.LOCALE_DEFAULT||i.get("locale")===r.enums.LOCALE_ZH_CN}},ENABLE_BACKUP_APP_DATA:{get:function(){return i.get("locale")===r.enums.LOCALE_DEFAULT||i.get("locale")===r.enums.LOCALE_ZH_CN}},ENABLE_APP_WASH:{get:function(){return i.get("locale")===r.enums.LOCALE_DEFAULT||i.get("locale")===r.enums.LOCALE_ZH_CN}},ENABLE_AUTOBACKUP_POPUP:{get:function(){return(i.get("locale")===r.enums.LOCALE_DEFAULT||i.get("locale")===r.enums.LOCALE_ZH_CN)&&!i.get("internetBar")}},ENABLE_PHOTO_DOWNLOAD_POPUP:{get:function(){return(i.get("locale")===r.enums.LOCALE_DEFAULT||i.get("locale")===r.enums.LOCALE_ZH_CN)&&!i.get("internetBar")}}}),o.Backend.Device.onmessage({"data.channel":r.events.SETTING_PRIVACY},function(e){a="0x"+parseInt(e,10).toString(16),h.trigger("change",h)},!0),e.FunctionSwitch=h,h})}(this),function(e,t){define("main/collections/PIMCollection",["underscore","backbone","Internationalization","FunctionSwitch","Environment"],function(t,n,r,i,s){console.log("PIMCollection - File loaded.");var o=[{label:r.misc.NAV_WELCOME_TO_WDJ,id:0,root:!0,module:"welcome",tab:"welcome",count:-1,order:10,icon:"home"},{label:r.misc.NAV_OPTIMIZE,id:18,root:!0,module:"optimize",tab:"optimize",hide:!i.ENABLE_OPTIMIZE,count:-1,order:190,icon:"optimize"},{label:r.misc.NAV_CONTACT,module:"contact",tab:"all",id:1,root:!0,count:-1,order:30,icon:"contact"},{label:r.misc.NAV_SMS,module:"message",tab:"all",id:2,root:!0,count:-1,order:40,icon:"sms"},{label:r.misc.NAV_APP,module:"app",tab:"normal",id:3,root:!0,order:20,icon:"app"},{label:r.misc.NAV_MUSIC,id:4,root:!0,module:"music",tab:"music",order:50,icon:"music"},{label:r.misc.NAV_PIC,id:5,root:!0,count:-1,order:60,icon:"photo",module:"photo",tab:"phone"},{label:r.misc.NAV_VIDEO,id:6,root:!0,module:"video",tab:"video",order:70,icon:"video"},{label:r.app.APP_WASH,id:19,count:-1,root:!0,module:"app-wash",tab:"app-wash",order:200,icon:"wash",hide:!i.ENABLE_APP_WASH},{label:r.misc.NAV_CONTACT_ALL,id:7,root:!1,parent:1,module:"contact",tab:"all",order:80},{label:r.misc.NAV_CONTACT_HAS_PHONE,id:8,root:!1,parent:1,module:"contact",tab:"hasnumber",order:90},{label:r.misc.NAV_CONTACT_STARRED,id:9,root:!1,parent:1,module:"contact",tab:"starred",order:100},{label:r.misc.NAV_SMS_ALL,id:10,root:!1,parent:2,module:"message",tab:"all",order:110},{label:r.misc.NAV_SMS_UNREAD,id:11,root:!1,parent:2,module:"message",tab:"unread",order:120},{label:r.misc.NAV_APP_INSTALLED,id:12,root:!1,parent:3,module:"app",tab:"normal",order:130},{label:r.misc.NAV_APP_SYS,id:13,root:!1,parent:3,module:"app",tab:"sys",order:140},{label:r.misc.NAV_APP_UPDATABLE,id:14,root:!1,parent:3,module:"app",tab:"update",hide:!i.ENABLE_APP_UPGRADE,order:150},{label:r.misc.NAV_PIC_PHONE_LIB,id:16,root:!1,parent:5,module:"photo",tab:"phone",order:170},{label:r.misc.NAV_PIC_GALLERY,id:17,root:!1,parent:5,module:"photo",tab:"lib",order:180}],u=n.Model.extend({defaults:{selected:!1,highlight:!1,count:0,hide:!1},initialize:function(){this.on("change:selected",function(e,t){t&&this.collection.trigger("itemSelected",e)},this)}}),a=n.Collection.extend({model:u,initialize:function(){s.get("deviceId")!=="Default"&&this.listenToOnce(s,"change:deviceId",function(){this.get(0).set("selected",!0)})},getRootItems:function(){return this.filter(function(e){return e.get("root")})},getChildren:function(e){return this.filter(function(t){return t.get("parent")===e})},deselectAll:function(){var e=this.filter(function(e){return e.get("highlight")||e.get("selected")});t.each(e,function(e){e.set({selected:!1,highlight:!1})})}}),f,l=t.extend({getInstance:function(){return f||(f=new a(t.sortBy(o,"order"))),f}});return e.PIMCollection=l,l})}(this),function(e,t){define("contact/collections/ContactsCollection",["backbone","underscore","jquery","Configuration","IOBackendDevice","Device","message/collections/ConversationsCollection","message/collections/ThreadsCollection","contact/collections/AccountCollection","contact/models/ContactModel","contact/EditorConfig","main/collections/PIMCollection"],function(e,n,r,i,s,o,u,a,f,l,c,h){console.log("ContactsCollection - File loaded.");var p=new RegExp(/ungroup\[\w+\]/),d=e.Collection.extend({model:l,url:i.actions.CONTACT_GET_SHOW,comparator:function(e){var n="~";return e.get("name")!==t&&(n=e.get("name").prefix||"~"),n},parse:function(e){return e.state_code===202&&o.get("isConnected")&&(console.log("ContactsCollection - ContactCollection is syncing."),this.syncing=!0,this.trigger("syncStart")),n.filter(e.body.contact,function(e){return e.visible===!0})},syncAsync:function(){var e=r.Deferred();return this.syncing=!0,this.trigger("syncStart"),s.requestAsync({url:i.actions.CONTACT_SYNC,success:function(t){t.state_code===200?(console.log("ContactsCollection - ContactCollection sync success."),e.resolve(t)):(console.error("ContactsCollection - ContactCollection sync failed. Error info: "+t.state_line),this.syncing=!1,this.trigger("syncEnd"),e.reject(t))}.bind(this)}),e.promise()},initialize:function(){var e=!1,t=!1;Object.defineProperties(this,{loading:{set:function(t){e=t},get:function(){return e}},syncing:{set:function(e){t=e},get:function(){return t}}}),this.on("update",function(){e||(e=!0,this.fetch({success:function(t){console.log("ContactsCollection - Collection fetched."),e=!1,t.trigger("refresh",t)}}))},this),this.on("refresh",function(){f.getInstance().trigger("update")},this),s.Backend.Device.onmessage({"data.channel":i.events.CONTACT_UPDATED},function(e){t&&(t=!1,this.trigger("syncEnd")),!e||this.trigger("update")},this)},deleteContactsAsync:function(e,t){var o=r.Deferred();return s.requestAsync({url:i.actions.CONTACT_BATCH_DELETE,data:{contacts:n.filter(e,function(e){return!this.get(e).isReadOnly},this).join(","),session:t||""},success:function(e){if(e.state_code===200){console.log("ContactsCollection - Delete contacts success.");var t=e.body,r=t&&t.success?t.success:[];r.length>0&&(n.each(r,function(e){this.remove(this.get(e.item))},this),u.getInstance().trigger("update"),a.getInstance().trigger("update")),this.trigger("refresh",this),o.resolve(e)}else e.state_code===402?(this.syncAsync(),o.resolve(e)):(console.error("ContactsCollection - Delete contacts failed. Error info: "+e.state_line),o.reject(e))}.bind(this)}),o.promise()},batchGroupAsync:function(e,t,n,o){var u=r.Deferred(),a=f.getInstance().getGroupById(t),l={contacts:e.join(","),account_type:a.get("account_type"),account_name:a.get("account_name"),action:Number(n),groups:a.get("id")};return o&&(l.session=o),s.requestAsync({url:i.actions.CONTACT_BATCH_GROUP,data:l,success:function(e){e.state_code===200?(console.log("ContactsCollection - Batch group contacts success. "),u.resolve(e)):(console.error("ContactsCollection - Batch group contacts failed. Error info: "+e.state_line),u.reject(e)),this.trigger("update")}.bind(this)}),u.promise()},updateContactAsync:function(e){var t=r.Deferred();return s.requestAsync({url:i.actions.CONTACT_UPDATE,data:{contact:JSON.stringify(e)},success:function(e){if(e.state_code===200){console.log("ContactsCollection - Update contact success. ");var n=this.get(e.body);n.clear({silent:!0}),n.set((new l(e.body)).toJSON()),this.trigger("refresh",this),t.resolve(e)}else console.error("ContactsCollection - Update contact failed. Error info: "+e.state_line),t.reject(e)}.bind(this)}),t.promise()},saveContactAsync:function(e){var t=r.Deferred();return e.id?this.updateContactAsync(e).done(function(e){u.getInstance().trigger("update"),a.getInstance().trigger("update"),t.resolve(e)}).fail(function(e){t.reject(e)}):this.addNewContactAsync(e).done(function(e){u.getInstance().trigger("update"),a.getInstance().trigger("update"),t.resolve(e)}).fail(function(e){t.reject(e)}),t.promise()},addNewContactAsync:function(e){var t=r.Deferred();return s.requestAsync({url:i.actions.CONTACT_ADD,data:{contact:JSON.stringify(e)},success:function(e){e.state_code===200?(console.log("ContactsCollection - Add success. "),this.add(e.body),this.trigger("refresh",this),t.resolve(e)):(console.error("ContactsCollection - Add failed. Error info: "+e.state_line),t.reject(e))}.bind(this)}),t.promise()},importAsync:function(e,t,n,o){var u=r.Deferred();return s.requestAsync({url:i.actions.CONTACT_IMPORT,data:{account_name:e,account_type:t,vcf_file:n,session:o},success:function(e){e.state_line===200?(console.log("ContactsCollection - Import success. "),u.resolve(e)):(console.error("ContactsCollection - Import failed. Error info: "+e.state_line),u.reject(e))}}),u.promise()},exportAsync:function(e,t,n){var o=r.Deferred();return s.requestAsync({url:i.actions.CONTACT_EXPORT,data:{session:n,type:t,contacts:e.join(",")},success:function(e){e.state_code===200?(console.log("ContactsCollection - Export success. "),o.resolve(e)):(console.error("ContactsCollection - Export failed. Error info: "+e.state_line),o.reject(e))}}),o.promise()},getContactsByGroupId:function(e){var t;if(p.test(e)){var r;e.replace(/(\[)(\w+)(\])/,function(e,t,n){r=n});var i=this.getContactsByAccountName(f.getInstance().get(r).get("name"));t=n.filter(i,function(e){return!e.get("group").length})}else{var s=f.getInstance().getGroupById(e).get("id");t=this.filter(function(e){return n.pluck(e.get("group"),"group_row_id").indexOf(s)>=0})}return t},getContactsByAccountName:function(e){return this.filter(function(t){return t.get("account_name")===e})},getContactsByGroupIdAndAccountName:function(e,t){return n.filter(this.getContactsByGroupId(e),function(e){return console.log(e),e.get("account_name")===t})},getContactsHasPhoneNumber:function(){return this.filter(function(e){return e.hasPhoneNumber})},getContactsHasPhoneNumberByAccountName:function(e){return n.filter(this.getContactsByAccountName(e),function(e){return e.hasPhoneNumber})},getContactsHasPhoneNumberByGroupdId:function(e){return n.filter(this.getContactsByGroupId(e),function(e){return e.hasPhoneNumber})},getContactsHasPhoneNumberByGroupdIdAndAccountName:function(e,t){return n.filter(this.getContactsHasPhoneNumberByGroupdId(e),function(e){return e.get("account_name")===t})},getContactsStarred:function(){return this.filter(function(e){return e.isStarred})},getContactsStarredByAccountName:function(e){return n.filter(this.getContactsByAccountName(e),function(e){return e.isStarred})},getContactsStarredByGroupdId:function(e){return n.filter(this.getContactsByGroupId(e),function(e){return e.isStarred})},getContactsStarredByGroupdIdAndAccountName:function(e,t){return n.filter(this.getContactsStarredByGroupdId(e),function(e){return e.get("account_name")===t})},generateNewContact:function(){return new l({id:"",account_name:"",name:{id:"",display_name:""},nickname:[{id:"",name:""}],phone:[{id:"",type:2,number:"",label:""}],email:[{id:"",type:1,address:"",label:""}],IM:[{id:"",protocol:4,data:"",label:""}],address:[{id:"",type:1,formatted_address:"",label:""}],organization:[{id:"",type:1,company:"",label:""}],note:[{id:"",note:""}]})},containsReadOnly:function(e){var n=!1,r,i;for(i=e.length;i--;t){r=this.get(e[i]);if(r&&r.isReadOnly){n=!0;break}}return n},generateMergeModel:function(e){var t={id:"",mergeIds:e,merge:!0},r=c.CONTACT_DATA_TEMPLATE,i=n.map(e,function(e){return this.get(e)},this);i=n.filter(i,function(e){return!e.isReadOnly});if(i.length>0){var s=[],o;for(o in r)r.hasOwnProperty(o)&&(n.each(i,function(e){var i=e.toJSON();if(i.phone&&i.phone.length>0){var u=n.map(i.phone,function(e){return delete e.is_primary,e});i.phone=u}if(!n.isArray(r[o]))o==="account_name"||o==="account_type"?!e.isReadOnly&&!t.account_name&&!t.account_type&&i.account_name&&i.account_type&&(t.account_name=i.account_name,t.account_type=i.account_type):t[o]=t[o]||i[o];else{var a=0,f=0,l,c,h=[];if(i[o])for(a=0;a<i[o].length;a++){l=i[o][a],l.id="";for(f=0;f<s.length;f++){c=s[a];if(n.isEqual(l,c))break}f===s.length&&h.push(i[o][a])}s=s.concat(h)}},this),n.isArray(r[o])&&(t[o]=s,s=[]))}return t.note.length>1&&(t.note.length=1),t.photo.length>1&&(t.photo.length=1),t.nickname.length>1&&(t.nickname.length=1),t.group=[],t.starred=0,t.id="",new l(t)},getAll:function(){return this.models}}),v,m=n.extend(function(){},{getInstance:function(){return v||(v=new d,v.trigger("update"),v.on("refresh",function(e){var t=h.getInstance();t.get(7).set({count:e.models.length}),t.get(8).set({count:e.getContactsHasPhoneNumber().length}),t.get(9).set({count:e.getContactsStarred().length})})),v},getClass:function(){return d}});return m})}(this),function(e,t){define("ui/behavior/DataSetMixin",["underscore"],function(e){console.log("DataSetMixin - File loaded.");var n={};return n.switchSet=function(n,r){var i=e.find(this.dataSet,function(e){return e.name===n});if(i===t){var s={name:n,getter:r};this.dataSet.push(s),this.currentSet=s}else this.currentSet.name===n?r&&(this.currentSet.getter=r):(this.lastSelect=t,this.currentSet=i,r&&(this.currentSet.getter=r));this.trigger("switchSet",this.currentSet)},n.clearSet=function(){this.dataSet.length=0,delete this.currentSet.name,delete this.currentSet.getter},{mixin:function(t){e.extend(t,n);var r=[],i={name:"",getter:function(){}};Object.defineProperties(t,{dataSet:{set:function(e){if(e instanceof Array){var t,n=e.length;for(t=0,n=e.length;t<n;t++)r.push(e[t]),e[t].name==="default"&&(i=e[t])}else console.error("SmartList - DataSet type error.")},get:function(){return r}},currentSet:{set:function(e){e.hasOwnProperty("name")&&e.hasOwnProperty("getter")?(i=e,t.trigger("switchSet",i)):console.error("SmartList - CurrentSet type error.")},get:function(){return i}},currentModels:{get:function(){return i.getter.call(this.listenToCollection||this.options.listenToCollection)}}})}}})}(this),function(e,t){define("ui/behavior/SelectDelegateMixin",["underscore"],function(e){console.log("SelectDelegateMixin - File loaded.");var t={};return t.mixin=function(n){e.extend(n,t);var r=[],i={},s=!1,o;Object.defineProperties(n,{selected:{set:function(e){e instanceof Array?r=e:console.error("SelectDelegateMixin - Seleted type error.")},get:function(){return r}},selectedSet:{get:function(){return i}},keepSelect:{set:function(e){s=e},get:function(){return s}},currentSetName:{get:function(){return o}}}),n.on("switchSet",function(t){o&&(i[o]=r.concat());var n=o;o=t.name;var u=r.concat(),a=i[o]||(i[o]=[]),f=e.pluck(t.getter.call(this.listenToCollection),"id");if(s){var l=e.intersection(f,this.getAllSelected());r=e.uniq(a.concat(l))}else r=e.intersection(f,a.concat());i[o]=r,r.length!==0&&r.length===this.currentModels.length?this.trigger("select:all"):r===0?this.trigger("empty"):this.trigger("select:partial"),(!e.isEqual(u,r)||n!==o)&&this.trigger("select:change",r)},n),n.on("select:add select:remove",function(){n.trigger("select:change",r)},n),n.on("build",n.highlightSelected,n)},t.highlightSelected=function(){var t=this.onScreenItems,n=this.getAllSelected();e.each(t,function(e){e.toggleSelect(n.indexOf(e.model.get("id"))>=0)},this)},t.getAllSelected=function(){var t=[];if(this.keepSelect){var n=[],r;for(r in this.selectedSet)this.selectedSet.hasOwnProperty(r)&&(n=n.concat(this.selectedSet[r]));t=e.uniq(n)}else t=this.selected;return t},t.addSelect=function(t,n){t instanceof Array&&t.length===1&&(t=t[0]),n=n||{};var r,i=this.selected;t instanceof Array?(r=e.difference(t,e.intersection(i,t)),i=e.uniq(i.concat(t))):i.indexOf(t)<0&&(r=t,i.push(t)),this.selectedSet[this.currentSet.name]=this.selected=i.concat(),r instanceof Array?e.each(this.onScreenItems,function(e){r.indexOf(e.model.id)>=0&&e.toggleSelect(!0)},this):e.each(this.onScreenItems,function(e){e.model.id===r&&e.toggleSelect(!0)},this),!n.silent&&(r instanceof Array?r.length>0:r)&&(this.trigger("select:add",r),i.length===this.currentModels.length&&this.trigger("select:all"))},t.removeSelect=function(t,n){t instanceof Array&&t.length===1&&(t=t[0]),n=n||{};var r=this.keepSelect?this.getAllSelected():this.selected,i,s;t instanceof Array?(i=e.intersection(r,t),r=e.difference(r,i)):(s=r.indexOf(t),s>=0&&(i=t,r.splice(s,1)));if(this.keepSelect){var o=this.selectedSet,u;for(u in o)if(o.hasOwnProperty(u)&&u!==this.currentSetName){var a=o[u];t instanceof Array?this.selectedSet[u]=e.difference(a,t):(s=a.indexOf(t),s>=0&&(a.splice(s,1),this.selectedSet[u]=a))}}this.selectedSet[this.currentSet.name]=this.selected=r.concat(),i instanceof Array?e.each(this.onScreenItems,function(e){i.indexOf(e.model.id)>=0&&e.toggleSelect(!1)},this):e.each(this.onScreenItems,function(e){e.model.id===i&&e.toggleSelect(!1)},this),!n.silent&&(i instanceof Array?i.length>0:i)&&(this.trigger("select:remove",t),this.trigger("select:partial"),r.length===0&&this.trigger("select:empty",t))},t.deselectAll=function(e){e=e||{},this.removeSelect(this.selected.concat(),{silent:e.silent})},t.erase=function(e){e=e||{},this.removeSelect(this.getAllSelected().concat(),{silent:e.silent})},t.selectAll=function(){this.addSelect(e.pluck(this.currentModels,"id"))},t})}(this),function(e,t){define("ui/behavior/ObserverMixin",["underscore"],function(e){console.log("ObserverMixin - File loaded.");var n={};return n.toggleObserver=function(e){this.disableObserver=e!==t?!e:!this.disableObserver,this.$observer.prop({disabled:this.disableObserver})},{mixin:function(t){e.extend(t,n);var r,i=!1;Object.defineProperties(t,{$observer:{set:function(e){r=e,r.prop({disabled:t.currentModels.length===0}),t.listenTo(t,"select:change switchSet",function(){if(i)r.prop({checked:!1,disabled:!0});else{var e=this.currentModels.length;r.prop({checked:e===this.selected.length,disabled:e===0})}}),r.on("click",function(e){t[e.target.checked?"selectAll":"deselectAll"]()})},get:function(){return r}},disableObserver:{set:function(e){i=e},get:function(){return i}}})}}})}(this),function(e,t){define("ui/behavior/HeaderMixin",["underscore","jquery","ui/behavior/DataSetMixin"],function(e,n,r){console.log("HeaderMixin - File loaded.");var i=function(e){var t=e.find(".smart-list-sortable");t.append(n("<span>").addClass("sort-icon"))},s=function(e,t){this.$header&&this.$header.find(".smart-list-sortable").toggleClass("asc",!1).toggleClass("desc",!1),e.toggleClass("asc",!t),e.toggleClass("desc",t),this.$el.data({"smart-list-sortby":e.data("smart-list-sortby"),"smart-list-sort-type":e.data("smart-list-sort-type")}),this.sortModels(t)},o=function(e){var t=n(e.currentTarget);s.call(this,t,t.hasClass("asc")),this.build()},u={};return u.headerMixinInit=function(){var e=this.$header,t=e.find(".smart-list-sortable");i.call(this,e),t.on("click",o.bind(this))},u.switchComparator=function(){if(this.$header!==t){var e=this.$header,n=e.find(".asc, .desc");n.length>0&&s.call(this,n,!n.hasClass("asc"))}},u.sortModels=function(e){var t=this.$el.data("smart-list-sortby")&&this.$el.data("smart-list-sortby").split("."),n=this.$el.data("smart-list-sort-type");this.listenToCollection.comparator=function(r,i){r=r.toJSON(),i=i.toJSON();var s;for(s=0;s<t.length;s++)r=r[t[s]],i=i[t[s]];var o;return n==="string"?o=e?r.localeCompare(i):i.localeCompare(r):n==="number"&&(o=e?r-i:i-r),o},this.listenToCollection.sort()},{mixin:function(t){e.extend(t,u);var n;Object.defineProperties(t,{$header:{set:function(e){n=e,u.headerMixinInit.call(t)},get:function(){return n}}}),t.options.hasOwnProperty("$header")&&(this.$header=t.options.$header)}}})}(this),function(e,t,n){define("ui/SmartList",["jquery","underscore","backbone","doT","ui/UIHelper","ui/TemplateFactory","ui/WindowState","ui/behavior/DataSetMixin","ui/behavior/SelectDelegateMixin","ui/behavior/ObserverMixin","ui/behavior/HeaderMixin"],function(r,i,s,o,u,a,f,l,c,h,p){console.log("SmartList - File loaded.");var d=e.setTimeout,v=e.setInterval,m=e.clearInterval,g=u.EventsMapping,y={SCROLL_CTN:".w-ui-smartlist-scroll-ctn"},b=function(){this.ctnHeight=this.$(".w-ui-smartlist-body-ctn").height(),this.contentHeight=this.currentModels.length*this.itemHeight,this.contentHeight>this.ctnHeight?this.scrollHeight=this.contentHeight:this.scrollHeight=0},w=function(e){e=i.isNumber(e)?e:0;var n=this.currentModels,r=this.$(".w-ui-smartlist-body-ctn"),s=n.length,o=this.ctnHeight,u=this.onScreenItems,a=this.itemHeight;u.length>0&&i.each(u,function(e){e.remove()},this),u.length=0;var f=t.createDocumentFragment(),l,c,h;for(c=e;c<s;c++){h=n[c],l=new this.itemView({model:h}),l.setup(),u.push(l),f.appendChild(l.render().$el[0]);if(u.length*a>=o)break}this.onScreenItems.length>0&&r.toggleClass("odd",n.indexOf(this.onScreenItems[0].model)%2===1),r.append(f),this.toggleEmptyTip(n.length===0),this.trigger(g.BUILD)},E=function(e){typeof e=="object"?this.$(".empty-tip").empty().append(e):e!==n&&this.$(".empty-tip").html(e)},S=s.View.extend({className:"w-ui-smartlist hbox",template:o.template(a.get("ui","smart-list")),initialize:function(){l.mixin(this),c.mixin(this),h.mixin(this),p.mixin(this);var e=!1,t=0,r,s=0,o=0,u=0,a=[],f,d="",v=!1,m=[],y=i.throttle(function(e){this.buildQueue(e.target.scrollTop)}.bind(this),20),w=!1,S=!0,x,T=!0,N=!1;Object.defineProperties(this,{rendered:{set:function(t){e=t},get:function(){return e}},ctnHeight:{set:function(e){var n=parseInt(this.$el.parent().css("max-height"),10);t=i.isNaN(n)?parseInt(e,10):n},get:function(){return t}},itemHeight:{set:function(e){o=parseInt(e,10)},get:function(){return o}},itemView:{set:function(e){r=e},get:function(){return r}},contentHeight:{set:function(e){s=parseInt(e,10)},get:function(){return s}},scrollHeight:{set:function(e){u=e=parseInt(e,10),this.$(".w-ui-smartlist-scroll-substitution").height(e)},get:function(){return u}},onScreenItems:{set:function(e){e instanceof Array&&(a=e)},get:function(){return a}},lastSelect:{set:function(e){f=e},get:function(){return f}},emptyTip:{set:function(t){typeof t=="object"?d=t:t!==n&&(d=t=t.toString()),e?E.call(this,t):this.once(g.RENDERED,function(){E.call(this,t)},this)},get:function(){return d}},loading:{set:function(t){v=t=Boolean(t);if(e){var n=this.$(".w-ui-loading");t?n.show():n.hide()}},get:function(){return v}},renderQueue:{set:function(e){m=e},get:function(){return m}},scrollHandler:{get:function(){return y}},enableContextMenu:{set:function(e){w=Boolean(e)},get:function(){return w}},selectable:{set:function(e){S=Boolean(e)},get:function(){return S}},listenToCollection:{set:function(e){x=e},get:function(){return x}},enableMutilselect:{get:function(){return T},set:function(e){T=Boolean(e)}},enableDragAndDrop:{get:function(){return N},set:function(e){N=Boolean(e)}}});var C=this.options,k;for(k in C)C.hasOwnProperty(k)&&(this[k]=C[k]);this.on("switchSet",function(){b.call(this),this.switchComparator(),this.build()},this)},render:function(){return this.$el.html(this.template({})),this.loading=Boolean(this.loading),this.$(y.SCROLL_CTN).on("scroll",this.scrollHandler),this.listenTo(f,"resize",this.windowResizeHandler),d(function(){b.call(this),w.call(this)}.bind(this),0),this.rendered=!0,this.trigger(g.RENDERED),this},windowResizeHandler:function(){var e;this.onScreenItems[0]&&(e=this.onScreenItems[0].model),this.ctnHeight=this.$(".w-ui-smartlist-body-ctn").height(),e!==n?w.call(this,this.currentModels.indexOf(e)):w.call(this)},toggleEmptyTip:function(e){var t=this.$(".empty-tip");e!==n?t.toggleClass("w-layout-hide",!e):t.toggleClass("w-layout-hide")},build:function(e){var r=this.$(y.SCROLL_CTN);r.off("scroll",this.scrollHandler);var s=r[0];if(e===n||!i.isNumber(e))e=s.scrollTop;e===0&&(s.scrollTop=0);var o=this.currentModels,u=o.length,a=this.$(".w-ui-smartlist-body-ctn"),f=this.onScreenItems.length,l=f*this.itemHeight;if(u<f){var c=this.onScreenItems.slice(u,f);i.each(c,function(e){e.remove()},this),this.onScreenItems=this.onScreenItems.slice(0,u),f=this.onScreenItems.length}else if(l<this.ctnHeight&&u>l/this.itemHeight){w.call(this,0),r.on("scroll",this.scrollHandler);return}var h=e/this.itemHeight,p=Math.ceil(h),d;p+f>u?d=o.slice(u-f,u):d=o.slice(p,p+f);var v=i.map(this.onScreenItems,function(e){return e.model.id});if(!i.isEqual(v,i.pluck(d,"id"))){a.children().detach();var m,b,E=t.createDocumentFragment(),S,x=d.length;for(S=0;S<x;S++)m=d[S],b=this.onScreenItems[S],b.decouple(),b.model=m,b.setup(),E.appendChild(b.render().$el[0],E.firstChild);this.onScreenItems.length>0&&a.toggleClass("odd",o.indexOf(this.onScreenItems[0].model)%2===1),a.append(E)}this.onScreenItems.length!==0&&(f!==u?o[0]===this.onScreenItems[0].model?this.onScreenItems[0].$el[0].scrollIntoView():o[u-1]===this.onScreenItems[f-1].model&&(this.onScreenItems[f-1].$el[0].scrollIntoView(),s.scrollTop=s.scrollHeight):s.scrollTop===0?this.onScreenItems[0].$el[0].scrollIntoView():this.onScreenItems[f-1].$el[0].scrollIntoView()),this.toggleEmptyTip(o.length===0),this.trigger(g.BUILD),r.on("scroll",this.scrollHandler)},buildQueue:function(e){this.renderQueue.length===0?this.renderQueue.push(e):this.renderQueue[this.renderQueue.length-1]!==e&&this.renderQueue.push(e),!this.renderDelegate&&this.renderQueue.length>0&&(this.renderDelegate=v(function(){if(this.renderQueue.length>0){var e=this.renderQueue.shift();this.build(e)}else m(this.renderDelegate),this.renderDelegate=n}.bind(this),15))},mousewheelBody:i.throttle(function(e){if(this.renderQueue.length===0){var t=this.$(y.SCROLL_CTN),n=this.currentModels;if(this.onScreenItems.length!==n.length){var r=0,s=i.pluck(n,"id").indexOf(this.onScreenItems[0].model.id);e.originalEvent.wheelDelta>0?(r=Math.max((s-3)*this.itemHeight,0),s-1>=0&&(t[0].scrollTop=r)):(r=Math.min((s+3)*this.itemHeight,this.contentHeight),s+this.onScreenItems.length+1<=n.length&&(t[0].scrollTop=r))}else e.originalEvent.wheelDelta>0?t[0].scrollTop-=this.itemHeight:t[0].scrollTop+=this.itemHeight}},35),clickListItem:function(e){if(e.currentTarget.tagName==="LI"&&this.selectable){var t=this.selected.concat(),n=r(e.currentTarget).find(".item-checker")[0],s=this.currentModels;if(n){var o=n.value;if(this.enableMutilselect)if(this.lastSelect&&e.shiftKey){var u=i.pluck(s,"id"),a=u.indexOf(this.lastSelect),f=u.indexOf(o),l=a<f?a:f,c=(a>f?a:f)+1,h=s.slice(l,c);this.removeSelect(t),this.addSelect(i.pluck(h,"id"))}else e.ctrlKey?(n.checked?this.removeSelect(o):this.addSelect(o),this.lastSelect=o):(t.length===1?t[0]!==o&&(this.removeSelect(t,{silent:!0}),this.addSelect(o)):(this.removeSelect(t,{silent:!0}),this.addSelect(o)),this.lastSelect=o);else this.removeSelect(t,{silent:!0}),this.addSelect(o)}}},checkListItem:function(e){e.stopPropagation();if(e.target.tagName==="INPUT"){var t=e.target.value;e.target.checked?this.addSelect(t):this.removeSelect(t),this.lastSelect=t}},rightClickItem:function(e){if(this.enableContextMenu){e.preventDefault();if(e.currentTarget.tagName==="LI"){var t=this.selected.concat(),n=r(e.currentTarget).find(".item-checker")[0],i=n.value;n.checked||(this.removeSelect(t,{silent:!0}),this.addSelect(i),this.lastSelect=i)}this.trigger("contextMenu",this.selected)}},remove:function(){this.$(y.SCROLL_CTN).off("scroll",this.scrollHandler),i.each(this.onScreenItems,function(e){e.remove()}),this.erase(),this.clearSet(),this.off(),S.__super__.remove.call(this)},scrollTo:function(e){var t=this.currentModels.indexOf(e);this.$(y.SCROLL_CTN)[0].scrollTop=t*this.itemHeight,this.onScreenItems[0].$el[0].scrollIntoView()},dragoverBody:function(e){e.stopPropagation(),e.preventDefault(),this.enableDragAndDrop&&(e.originalEvent.dataTransfer.dropEffect="copy",this.trigger("dropover",e))},dragleaveBody:function(e){e.stopPropagation(),e.preventDefault(),this.enableDragAndDrop&&this.trigger("dragleave",e)},dragenterBody:function(e){e.stopPropagation(),e.preventDefault(),this.enableDragAndDrop&&this.trigger("dragenter",e)},dropBody:function(e){e.stopPropagation(),e.preventDefault(),this.enableDragAndDrop&&this.trigger("drop",e)},events:{"mousewheel .w-ui-smartlist-body-ctn":"mousewheelBody","click .w-ui-smartlist-body-ctn > li":"clickListItem","click .w-ui-smartlist-body-ctn > li .item-checker":"checkListItem","click .w-ui-smartlist-body-ctn > li .item-checker-wrap":"checkListItem","contextmenu .w-ui-smartlist-body-ctn > li":"rightClickItem","dragover .w-ui-smartlist-body-ctn":"dragoverBody","dragleave .w-ui-smartlist-body-ctn":"dragleaveBody","dragenter .w-ui-smartlist-body-ctn":"dragenterBody","drop .w-ui-smartlist-body-ctn":"dropBody"}});return S})}(this,this.document),function(e,t){define("ui/Button",["backbone","doT","ui/TemplateFactory"],function(e,t,n){console.log("Button - File loaded.");var r=e.View.extend({tagName:"button",className:"w-ui-button",template:t.template(n.get("ui","button")),initialize:function(){var e="";Object.defineProperties(this,{label:{set:function(t){e=t,this.$(".label").html(e).attr({title:e})},get:function(){return e}}});var t=this.options||{},n;for(n in t)t.hasOwnProperty(n)&&(this[n]=t[n])},render:function(){return this.$el.html(this.template({})),this.label=this.label,this},clickButton:function(e){this.trigger("clickButton",e)},events:{click:"clickButton"}});return r})}(this),function(e,t){define("ui/behavior/LimitInWindowMixin",["underscore","ui/UIHelper"],function(e,n){console.log("LimitInWindowMixin - File loaded.");var r=n.WindowState,i=n.MouseState,s=function(){var e=this.$host.offset(),t=0,n=0;this.$el.css({"max-height":"none",width:"auto"});var i=this.$host[0].offsetHeight,s=this.$host[0].offsetWidth,o=this.$el[0].offsetHeight,u=this.$el[0].offsetWidth,a=e.top-o;this.directionDown?e.top+i+o>r.height?a>=0?t=a:(t=e.top+i,this.$el.width(this.$el.width()+16),u=this.$el[0].offsetWidth,this.$el.css("max-height",r.height-t-(o-this.$el.height())-80)):t=e.top+i:a>0?t=a:t=e.top+i;var f;this.alignToHost?f=e.left+u>r.width:f=e.left+(s+u)/2>r.width,f?n=e.left+s-u:this.alignToHost?n=e.left:n=e.left+(s-u)/2,this.$el.offset({left:Math.max(0,n),top:t})},o=function(){var e=this.$host.offset(),t=0,n=0;this.$el.css({"max-height":"none",width:"auto"});var i=this.$host[0].offsetHeight,s=this.$host[0].offsetWidth,o=this.$el[0].offsetHeight,u=this.$el[0].offsetWidth,a=this.$("div.arrow"),f=e.top-o;this.directionDown?e.top+i+o>r.height?f>=0?(t=f,t-=8,a.addClass("bottom")):(t=e.top+i,this.$el.width(this.$el.width()+16),u=this.$el[0].offsetWidth,this.$el.css("max-height",r.height-t-(o-this.$el.height())-80)):(t=e.top+i,t+=8,a.removeClass("bottom")):f>0?(t=f,t-=8,a.addClass("bottom")):(t=e.top+i,t+=8,a.removeClass("bottom"));var l;this.alignToHost?l=e.left+u>r.width:l=e.left+(s+u)/2>r.width;if(l)n=e.left+s-u,a.css({left:u-s/2-5});else if(this.alignToHost)n=e.left,a.css({left:s/2-5});else{n=e.left+(s-u)/2;if(n<=0){var c=-n;n=0,a.css({left:u/2-5-c})}else a.css({left:u/2-5})}this.$el.offset({left:n,top:t})},u=function(){var e=0,t=0;this.$el.css({"max-height":"none",width:"auto"});var n=this.$el[0].offsetHeight;if(i.y+n>r.height){var s=i.y-n;s>=0?e=s:(e=i.y,this.$el.width(this.$el.width()+12),this.$el.css("max-height",r.height-e-(n-this.$el.height())-80))}else e=i.y;i.x+this.$el[0].offsetWidth>r.width?t=i.x-this.$el[0].offsetWidth:t=i.x,this.$el.offset({left:Math.max(0,t),top:e})},a={};return a.locate=function(){this.$host!==t?this.$("div.arrow").length===0?s.call(this):o.call(this):u.call(this)},{mixin:function(t){e.extend(t,a);if(!t.hasOwnProperty("$host")){var n,r=!0,i=!0;Object.defineProperties(t,{$host:{set:function(e){n=e},get:function(){return n}},alignToHost:{set:function(e){r=e},get:function(){return r}},directionDown:{set:function(e){i=e},get:function(){return i}}}),t.options.hasOwnProperty("$host")&&(n=t.options.$host)}}}})}(this),function(e,t){define("ui/Menu",["underscore","backbone","doT","jquery","ui/UIHelper","ui/TemplateFactory","ui/behavior/LimitInWindowMixin","ui/WindowState"],function(t,n,r,i,s,o,u,a){console.log("Menu - File loaded.");var f=s.EventsMapping,l=i(e),c=n.View.extend({tagName:"li",className:"hbox",initialize:function(){var e="",t="",n,r=!1;Object.defineProperties(this,{name:{set:function(t){e=t.toString()},get:function(){return e}},label:{set:function(e){t=e.toString()},get:function(){return t}},value:{set:function(e){n=e.toString()},get:function(){return n}},data:{get:function(){return{name:e,value:n,label:t}}},disabled:{set:function(e){r=e},get:function(){return r}}});var i=this.options||{},s;for(s in i)i.hasOwnProperty(s)&&(this[s]=i[s])},render:function(){return this.$el.html(this.template({name:this.name,label:this.label,value:this.value})).attr({disabled:this.disabled}),this},clickItem:function(e){this.$el.attr("disabled")||this.trigger("clickItem",this.data)},events:{"click input":"clickItem"}}),h=c.extend({template:r.template(o.get("ui","menu-item-radio")),initialize:function(){h.__super__.initialize.apply(this,arguments);var e=!1;Object.defineProperties(this,{checked:{set:function(t){e=t},get:function(){return e}}});var t=this.options||{},n;for(n in t)t.hasOwnProperty(n)&&(this[n]=t[n])},render:function(){return this.$el.html(this.template({name:this.name,label:this.label,value:this.value})),this.$('input[type="radio"]').prop("checked",this.checked),this}}),p=c.extend({template:r.template(o.get("ui","menu-item-normal")),events:{"click div.normal":"clickItem"}}),d=c.extend({template:r.template(o.get("ui","menu-item-group"))}),v=c.extend({template:r.template(o.get("ui","menu-item-checkbox")),initialize:function(){v.__super__.initialize.apply(this,arguments);var e=!1;Object.defineProperties(this,{checked:{set:function(t){e=t},get:function(){return e}}});var t=this.options||{},n;for(n in t)t.hasOwnProperty(n)&&(this[n]=t[n])},render:function(){return this.$el.html(this.template({name:this.name,label:this.label,value:this.value})),this.$('input[type="checkbox"]').prop("checked",this.checked),this}}),m=c.extend({className:"hr",render:function(){return this.$el.html(),this}}),g=c.extend({template:r.template(o.get("ui","menu-item-link")),initialize:function(){g.__super__.initialize.apply(this,arguments);var e;Object.defineProperties(this,{action:{set:function(t){t instanceof Function&&(e=t)},get:function(){return e}}});var t=this.options||{},n;for(n in t)t.hasOwnProperty(n)&&(this[n]=t[n])},clickItem:function(){g.__super__.clickItem.apply(this,arguments),this.action.call()},events:{"click div.link":"clickItem"}}),y=n.View.extend({tagName:"menu",className:"w-ui-menu w-layout-hide",initialize:function(){u.mixin(this);var e=!1,t=[],n=function(e){e.originalEvent.propertyName==="opacity"&&(this.$el.css("opacity")==="0"?(this.$el.detach(),this.trigger(f.HIDE)):this.$el.css("opacity")==="1"&&this.trigger(f.SHOW))}.bind(this);Object.defineProperties(this,{rendered:{set:function(t){e=t},get:function(){return e}},items:{set:function(e){e instanceof Array?t=e:console.error("MenuButton - Paramater 'item' type error!")},get:function(){return t}},transitionEndHandler:{get:function(){return n}}});var r=this.options||{},i;for(i in r)r.hasOwnProperty(i)&&(this[i]=r[i])},render:function(){this.$el.empty();var e;return t.each(this.items,function(t){switch(t.type){case"radio":e=new h({name:t.name,label:t.label,value:t.value,checked:t.checked}),this.$el.append(e.render().$el),e.on("clickItem",function(e){this.trigger("select",e),this.hide()},this);break;case"normal":e=new p({name:t.name,label:t.label,value:t.value,disabled:t.disabled}),this.$el.append(e.render().$el),e.on("clickItem",function(e){this.trigger("select",e),this.hide()},this);break;case"group":e=new d({name:t.name,label:t.label}),this.$el.append(e.render().$el.addClass("disabled"));break;case"hr":e=new m,this.$el.append(e.render().$el);break;case"link":e=new g({label:t.label,action:t.action}),e.on("clickItem",function(){this.hide()},this),this.$el.append(e.render().$el);break;case"checkbox":e=new v({name:t.name,label:t.label,value:t.value,checked:t.checked}),e.on("clickItem",function(e){this.trigger("select",e),this.hide()},this),this.$el.append(e.render().$el)}},this),this.$el.off("webkitTransitionEnd",this.transitionEndHandler),this.$el.on("webkitTransitionEnd",this.transitionEndHandler),this.rendered=!0,this.trigger(f.RENDERED),this},show:function(){this.rendered||this.render(),this.$el.css({top:0,left:0}),i("body").append(this.$el),this.locate(),this.$el.removeClass("w-layout-hide"),this.listenTo(a,"resize",this.hide)},hide:function(){this.$el.addClass("w-layout-hide")},remove:function(){this.rendered&&(this.hide(),this.$el.remove(),this.stopListening(),this.rendered=!1,this.trigger(f.REMOVE))}});return y})}(this),function(e,t){define("ui/MenuButton",["underscore","doT","ui/UIHelper","ui/TemplateFactory","ui/Button","ui/Menu"],function(t,n,r,i,s,o){console.log("MenuButton - File loaded.");var u=r.EventsMapping,a=e.document,f=s.extend({className:s.prototype.className+" w-ui-menubutton",template:n.template(i.get("ui","menu-button")),initialize:function(){f.__super__.initialize.apply(this,arguments);var e=[],t;Object.defineProperties(this,{items:{set:function(n){n instanceof Array?(e=n,t&&(t.items=e,t.render())):console.error("MenuButton - Paramater 'item' type error!")},get:function(){return e}},menu:{set:function(e){t=e},get:function(){return t}}});var n=this.options||{},r;for(r in n)n.hasOwnProperty(r)&&(this[r]=n[r]);t=new o({items:this.items,$host:this.$el}),t.on("select",function(e){this.trigger("select",e)},this);var i=function(e){!this.$el[0].contains(e.target)&&!t.$el[0].contains(e.target)&&(t.hide(),a.removeEventListener("click",i))}.bind(this);t.on("show",function(){a.addEventListener("click",i,!0),this.$el.addClass("active")},this),t.on("hide",function(){a.removeEventListener("click",i),this.$el.removeClass("active")},this),this.on("clickButton",this.toggleMenu,this)},toggleMenu:function(e){var t=this.menu;t.$el.hasClass("w-layout-hide")?t.show():t.hide()},remove:function(){this.$el.remove(),this.menu.remove(),this.trigger(u.REMOVE)}});return f})}(this),function(e,t){define("WindowController",["backbone","underscore","jquery","IO","Configuration"],function(e,t,n,r,i){console.log("WindowController - File loaded");var s=function(){};return s.blockWindowAsync=function(){var e=n.Deferred();return r.requestAsync({url:i.actions.BLOCK_WINDOW,data:{blocking:1},success:function(t){t.state_code===200?e.resolve(t):e.reject(t)}}),e.promise()},s.releaseWindowAsync=function(){var e=n.Deferred();return r.requestAsync({url:i.actions.BLOCK_WINDOW,data:{blocking:0},success:function(t){t.state_code===200?e.resolve(t):e.reject(t)}}),e.promise()},s})}(this),function(e,t){define("ui/BatchActionWindow",["doT","underscore","jquery","ui/UIHelper","ui/AlertWindow","ui/behavior/ButtonSetMixin","ui/behavior/AutoCloseMixin","ui/TemplateFactory","utilities/StringUtil","Internationalization","IOBackendDevice","WindowController"],function(e,t,n,r,i,s,o,u,a,f,l,c){console.log("BatchActionWindow - File loaded.");var h=r.EventsMapping,p={BUTTON_CTN:".w-ui-window-footer-button-ctn"},d=i.extend({initialize:function(){d.__super__.initialize.apply(this,arguments);var e=0,t=0,r=!0;Object.defineProperties(this,{total:{set:function(t){e=parseInt(t,10),this.$(".total").html(e),this.$("progress").attr({max:e*100})},get:function(){return e}},progress:{set:function(e){t=parseInt(e,10),this.$(".progress").html(t)},get:function(){return t}},progressBar:{set:function(e){this.$("progress").attr({value:e})}},blockWindow:{set:function(e){r=e},get:function(){return r}}}),this.height=140,this.width=360,this.disableX=!0;var i=l.Backend.Device.onmessage({"data.channel":this.options.session},function(e){this.options.delay&&(this.$el.is(":visible")||this.show()),this.progress=e.current,this.progressBar=Math.max(e.current*100+(e.current_progress||0),0),this.total=e.total,e.current===e.total&&(l.Backend.Device.offmessage(i),this.$(".tip").html(a.format(this.options.successText,e.total)),this.$(p.BUTTON_CTN).empty(),this.addButton(n("<button>").addClass("button-yes").html(f.ui.CONFIRM),h.BUTTON_YES),this.delay=3e3,this.initAutoClose(),this.countDown(),this.blockWindow&&c.releaseWindowAsync())},this),s=function(){l.Backend.Device.offmessage(i),this.off(h.REMOVE,s)};this.on(h.REMOVE,s),this.on(h.BUTTON_CANCEL,function(){l.requestAsync({url:this.options.cancelUrl,data:{session:this.options.session}}).always(function(){l.Backend.Device.offmessage(i),this.blockWindow&&c.releaseWindowAsync()}.bind(this))},this),this.on(h.BUTTON_YES,this.remove,this)},render:function(){d.__super__.render.apply(this,arguments),this.$bodyContent=e.template(u.get("ui","batch-action-body"))({}),this.$(".tip").html(this.options.progressText),this.total=this.options.total,this.addButton(n("<button>").html(f.ui.CANCEL),h.BUTTON_CANCEL)},show:function(){d.__super__.show.apply(this,arguments),this.blockWindow&&c.blockWindowAsync()}});return d})}(this),function(e,t){define("ui/BaseListItem",["backbone","underscore"],function(e,n){console.log("BaseListItem - File loaded. ");var r=e.View.extend({tagName:"li",initialize:function(){this.render=n.wrap(this.render,function(e){var t=this.$('input[type="checkbox"]');if(t.length>0){var n=t.prop("checked");e.call(this),this.$('input[type="checkbox"]').prop("checked",n)}else e.call(this);return this}.bind(this))},toggleSelect:function(e){e=e!==t?e:!this.$('input[type="checkbox"]').prop("checked"),this.$el.toggleClass("highlight",e),this.$('input[type="checkbox"]').prop({checked:e})},setup:function(){this.listenTo(this.model,"change",this.render)},decouple:function(){this.stopListening(this.model,"change",this.render)}});return r})}(this),function(e,t){define("ui/behavior/BlurToHideMixin",["underscore","ui/UIHelper"],function(n,r){console.log("BlurToHideMixin - File loaded");var i=e.setTimeout,s=e.setInterval,o=e.clearInterval,u=r.MouseState,a={};return a.checkMousePosition=function(){var e=u.currentElement,t=this.$host;return t[0].contains(e)||this.$el[0].contains(e)},a.initBlurToHideMixin=function(){this.mouseHoverHandeler||(this.mouseHoverHandeler=n.debounce(function(){if(a.checkMousePosition.call(this)&&this.$host.is(":visible")){this.show(),this.ignoreSelf?this.$el.css({"pointer-events":"none"}):this.$el.css({"pointer-events":"default"});var e=s(function(){a.checkMousePosition.call(this)||i(function(){a.checkMousePosition.call(this)||(this.hide(),o(e))}.bind(this),this.blurDelay)}.bind(this),25)}}.bind(this),300),this.$host.on("mouseenter",this.mouseHoverHandeler))},a.destoryBlurToHideMixin=function(){this.$host.off("mouseenter",this.mouseHoverHandeler),this.mouseHoverHandeler=t},{mixin:function(e){n.extend(e,a);var t,r=!1,i=0;e.hasOwnProperty("$host")||Object.defineProperties(e,{$host:{set:function(e){t=e},get:function(){return t}},ignoreSelf:{set:function(e){r=e},get:function(){return r}},blurDelay:{set:function(e){i=e},get:function(){return i}}}),e.options.hasOwnProperty("$host")&&(t=e.options.$host),a.initBlurToHideMixin.call(e)}}})}(this),function(e,t){define("contact/views/GroupListView",["backbone","doT","jquery","underscore","ui/TemplateFactory","ui/behavior/BlurToHideMixin","ui/WindowState","contact/collections/AccountCollection"],function(e,t,n,r,i,s,o,u){console.log("GroupListView - File loaded. ");var a=e.View.extend({className:"w-contact-group-list",template:t.template(i.get("contact","group-list")),initialize:function(){s.mixin(this)},render:function(){return this.$el.html(this.template({group:this.model.get("group")})),n("body").append(this.$el),this.locate(),this},getGroup:function(e){return u.getInstance().getGroupById(e)},show:function(){this.$el.addClass("w-layout-hide"),this.render(),this.$el.removeClass("w-layout-hide")},locate:function(){var e=this.$host.offset(),t=this.$host[0].offsetHeight,n=this.$el[0].offsetHeight;if(e.top+t+n>o.height){var r=e.top-n;this.$el.offset({left:e.left-6,top:r+25})}else this.$el.offset({left:e.left-6,top:e.top+8})},hide:function(){this.remove()}}),f=r.extend({getInstance:function(e){return new a(e)}});return f})}(this),function(e,t){define("contact/views/ContactItemView",["doT","underscore","ui/TemplateFactory","ui/BaseListItem","Log","contact/views/GroupListView","contact/collections/AccountCollection"],function(e,t,n,r,i,s,o){console.log("ContactItemView - File loaded.");var u=r.extend({template:e.template(n.get("contact","contact-item")),className:"w-contact-list-item hbox",render:function(){return this.uninstall(),this.$el.html(this.template(this.model.toJSON())),this.$(".name").toggleClass("text-secondary",this.model.get("read_only")),this.groupListView=s.getInstance({model:this.model,$host:this.$(".group-menu")}),this},uninstall:function(){this.groupListView&&(this.groupListView.remove(),delete this.groupListView)},remove:function(){u.__super__.remove.call(this),this.uninstall()},getGroup:function(e){return o.getInstance().getGroupById(e)},clickButtonStar:function(e){e.stopPropagation(),this.$el.addClass("starring"),this.model.toggleStarAsync(),i({event:"ui.click.contact.button.star",favorite:this.model.get("starred")})},events:{"click .button-star":"clickButtonStar"}}),a=t.extend({getInstance:function(e){return new n(e)},getClass:function(){return u}});return a})}(this),function(e,t){define("contact/views/AddGroupWindowView",["underscore","jquery","doT","ui/Panel","ui/TemplateFactory","ui/AlertWindow","Internationalization","contact/collections/AccountCollection"],function(t,n,r,i,s,o,u,a){console.log("AddGroupWindowView - File loaded.");var f=e.alert,l,c=i.extend({initialize:function(){c.__super__.initialize.apply(this,arguments),this.title=u.contact.ADD_GROUP,this.width=360,this.buttons=[{$button:n("<button>").addClass("primary").html(u.contact.SAVE),eventName:"button_save"},{$button:n("<button>").html(u.contact.CANCEL),eventName:"button_cancel"}],this.$bodyContent=n("<div>").html(r.template(s.get("contact","add-group-body"))),this.on("button_save",function(){var e=this.$(".input-group-name"),t=e.val().trim();t.length===0?e.focus():(this.close(),a.getInstance().addNewGroupAsync(l,t).done(function(e){this.trigger("addNewGroup",e.body.id)}.bind(this)).fail(function(){f(u.contact.ADD_GROUP_FAIL)}))},this)},show:function(e){e?(l=e,c.__super__.show.apply(this,arguments)):console.error("AddGroupWindowView - Please specify target account info! ")}}),h,p=t.extend({getInstance:function(){return h||new c}});return p})}(this),function(e,t){define("contact/models/ExportContextModel",["backbone"],function(e){console.log("ExportContextModel - File loaded.");var t=e.Model.extend({defaults:{fileType:0,selectNumber:0,allNumber:0,hasPhoneNumber:0,selectedIdList:[],hasPhoneIdList:[],dataType:0,exportFilePath:"",selectGroup:"",selectAccount:""}}),n=new t;return n})}(this),function(e,t){define("ui/Notification",["backbone","Environment"],function(t,n){console.log("Notification - File loaded.");var r=function(t){e.webkitNotifications.requestPermission(t)},i=t.View.extend({initialize:function(){var e="simple",t,n,r,i,s,o,u,a,f;Object.defineProperties(this,{type:{set:function(t){e=t},get:function(){return e}},icon:{set:function(e){t=e},get:function(){return t}},title:{set:function(e){n=e},get:function(){return n}},content:{set:function(e){r=e},get:function(){return r}},url:{set:function(e){i=e},get:function(){return i}},ondisplay:{set:function(e){e instanceof Function&&(s=e)},get:function(){return s}},onclick:{set:function(e){e instanceof Function&&(o=e)},get:function(){return o}},onclose:{set:function(e){e instanceof Function&&(u=e)},get:function(){return u}},notificationWindow:{set:function(e){a=e},get:function(){return a}},duration:{set:function(e){f=e},get:function(){return f}}});var l=this.options||{},c;for(c in l)l.hasOwnProperty(c)&&(this[c]=l[c])},show:function(){var t;if(e.webkitNotifications.checkPermission()===0){switch(this.type){case"simple":this.notificationWindow=e.webkitNotifications.createNotification(this.icon,this.title,this.content);break;case"html":this.notificationWindow=e.webkitNotifications.createHTMLNotificationwdj(this.url,this.title,n.get("deviceId"))}this.notificationWindow.ondisplay=this.ondisplay,this.notificationWindow.onclick=this.onclick,this.notificationWindow.onclose=this.onclose,this.notificationWindow.show(),this.duration&&typeof this.duration=="number"&&setTimeout(this.cancel.bind(this),this.duration),t=!0}else this.requestPermission(this.show.bind(this)),t=!1;return t},cancel:function(){this.notificationWindow.close()}});return i})}(this),function(e,t){define("contact/ContactService",["IOBackendDevice","Configuration","Environment","Internationalization","utilities/StringUtil","ui/Notification","ui/AlertWindow","ui/BatchActionWindow","contact/collections/ContactsCollection"],function(n,r,i,s,o,u,a,f,l){console.log("ContactService - File loaded.");var c=e.alert,h=e.confirm,p=_.extend(function(){},Backbone.Events);return p.deleteContactsAsync=function(e){var n=$.Deferred(),i=l.getInstance(),u=function(){var u,l=_.filter(e,function(e){return!i.get(e).isReadOnly}).length;if(l===0)return;e.length===1?u=new a({draggable:!0,disposableName:"contact-delete-contact-single",buttonSet:"yes_no",$bodyContent:s.contact.ALERT_TIP_DEL_SINGLE_CONTACT}):u=new a({draggable:!0,disposableName:"contact-delete",buttonSet:"yes_no",$bodyContent:o.format(s.contact.DELETE_TIP_TEXT,e.length)}),u.on("button_yes",function(){var o,u;e.length>1&&(o=_.uniqueId("contact.batch.delete_"),u=new f({session:o,progressText:s.contact.CONTACT_DELETE_PROGRESS,cancelUrl:r.actions.CONTACT_CANCEL,total:e.length,successText:s.contact.CONTACT_DELETE_SUCCESS}),u.show()),i.deleteContactsAsync(e,o).done(function(e){var r=_.map(e.body.failed,function(e){return e.item});if(r.length>0){u!==t&&u.remove();var o=s.contact.CONTACT_DELETE_FAILED_TEXT+"<br />";_.each(r,function(e){o+="- "+i.get(e).get("name")+"<br />"});var f=new a({draggable:!0,buttonSet:"retry_cancel",$bodyContent:$('<div class="w-misc-error-window-body">').html(o)});f.on("button_retry",function(){p.deleteContactsAsync(r).done(n.resolve).fail(n.reject),c.remove()},this),f.on("button_cancel",function(){n.reject()}),f.show()}else n.resolve(e)}).fail(function(e){n.reject(e)})},this),u.show()},d=_.filter(e,function(e){return i.get(e).isReadOnly}.bind(this));return d.length>0?h(s.contact.CONTACT_READ_ONLY_TIP,function(){u.call(this)},this):u.call(this),n.promise()},p.mergeContactAsync=function(e){function r(){var r=new a({draggable:!0,disposableName:"contact-merge",buttonSet:"yes_no",$bodyContent:$(o.format(s.contact.ALERT_TIP_MERGE_CONTACTS,e.length,e.length))});r.once("button_yes",function(){var r=n.generateMergeModel(e);t.resolve(r)}),r.show()}function i(){n.containsReadOnly(e)?h(s.contact.CONTACT_READ_ONLY_TIP,function(){r.call(this)}):r.call(this)}var t=$.Deferred(),n=l.getInstance();if(e.length>50){var u=new a({draggable:!0,disposableName:"contacts-merge-too-much",disposableChecked:!0,buttonSet:"yes_no",$bodyContent:s.contact.ALERT_TIP_MERGE_MANY_CONTACTS});u.once("button_yes",function(){i.call(this)},this),u.show()}else i.call(this);return t.promise()},p.getContactHasBackupAsync=function(){var e=$.Deferred();return n.requestAsync({url:r.actions.CONTACT_HAS_BACKUP,success:function(t){t.state_line===200?e.resolve(t):e.reject(t)}}),e.promise()},p.loadContactBackupAsync=function(){var e=$.Deferred();return n.requestAsync({url:r.actions.CONTACT_LOAD_BACKUP,success:function(t){t.state_line===200?e.resolve(t):e.reject(t)}}),e.promise()},p})}(this),function(e,t){define("contact/views/ExportProgressView",["backbone","underscore","doT","jquery","WindowController","ui/Panel","ui/TemplateFactory","ui/UIHelper","ui/AlertWindow","IOBackendDevice","Internationalization","Configuration","contact/models/ExportContextModel","contact/collections/ContactsCollection","contact/views/ExportSelectNumberView"],function(t,n,r,i,s,o,u,a,f,l,c,h,p,d,v){console.log("ExportProgressView - File loaded. ");var m=e.alert,g=t.View.extend({template:r.template(u.get("contact","export-progress")),className:"w-contact-export-body",render:function(){return this.$el.html(this.template({})),this}}),y,b,w,E,S=o.extend({finished:!1,initialize:function(){S.__super__.initialize.apply(this,arguments),E=d.getInstance(),this.on(a.EventsMapping.SHOW,function(){y=new g,this.$bodyContent=y.render().$el,this.center()},this),this.buttons=[{$button:i("<button>").html(c.ui.CANCEL).addClass("button-cancel"),eventName:"button_cancel"},{$button:i("<button>").html(c.ui.FINISH).addClass("button-finish primary"),eventName:"button_cancel"}]},render:function(){n.extend(this.events,S.__super__.events),this.delegateEvents(),S.__super__.render.apply(this,arguments);var e=i("<button>").html(c.misc.OPEN_EXPORT_FILE).addClass("button-show-file");return this.$(".w-ui-window-footer-monitor").append(e),this.initState(),this},initState:function(){this.finished=!1,this.$(".button-show-file, .button-finish").hide(),this.$(".button-cancel").show(),this.$(".progress-desc").text(c.contact.EXPORT_PROGRESS_DESC1)},exportContacts:function(){b=n.uniqueId("contact.export_");var e=this.getContactsIDList(),t=p.get("fileType");E.exportAsync(e,t,b).done(function(e){p.set({exportFilePath:e.body.value}),this.setProgressAsFinished()}.bind(this)).fail(function(e){this.trigger("_LAST_VIEW");switch(e.state_code){case 402:break;case 500:m(c.misc.CONNECTION_LOSE);break;default:m(c.contact.EXPORT_CONTACT_FAILED)}}.bind(this)).always(function(){s.releaseWindowAsync()}),s.blockWindowAsync(),w=l.Backend.Device.onmessage({"data.channel":b},function(e){this.setProgress(e.current,e.total),e.current===e.total&&l.Backend.Device.offmessage(w)},this)},getContactsIDList:function(){switch(p.get("dataType")){case 1:return p.get("selectedIdList");case 2:return[];case 3:return p.get("hasPhoneIdList");case 4:var e=p.get("selectGroup")!=="all"?E.getContactsByGroupIdAndAccountName(p.get("selectGroup"),p.get("selectAccount")):E.getContactsByAccountName(p.get("selectAccount"));return n.pluck(e,"id")}},setProgress:function(e,t){this.finished&&(e=t);var n=e+" / "+t;this.$(".progress-num").text(n),e<t&&this.$(".progress-desc").text(c.contact.EXPORT_PROGRESS_DESC2),this.$("progress").attr({max:t,value:e})},setProgressAsFinished:function(){this.finished=!0,this.$(".progress-desc").text(c.contact.EXPORT_SUCCESS_DESC2),this.$("progress").removeClass("running"),this.$(".button-cancel").hide(),this.$(".button-show-file, .button-finish").show()},clickButtonShowFile:function(){l.requestAsync({url:h.actions.SHOW_FILE,data:{file_path:p.get("exportFilePath")}})},clickButtonCancel:function(){l.requestAsync({url:h.actions.CONTACT_CANCEL,data:{session:b},success:function(){s.releaseWindowAsync(),m(c.common.CANCEL_EXPORT_TEXT),this.trigger("_CANCEL"),l.Backend.Device.offmessage(w)}.bind(this)})},events:{"click .button-show-file":"clickButtonShowFile","click .button-cancel":"clickButtonCancel"}}),x,T=n.extend({getInstance:function(){return x||(x=new S({title:c.contact.WINDOW_EXPORT_TITLE,disableX:!0,height:260,width:400})),x}});return T})}(this),function(e,t){define("contact/collections/ContactMultiNumbersCollection",["underscore","Internationalization","contact/models/ContactModel","contact/collections/ContactsCollection"],function(e,t,n,r){console.log("ContactMultiNumbersCollection - File loaded.");var i,s=r.getClass().extend({model:n,initialize:function(){var e=!1;Object.defineProperties(this,{loading:{set:function(t){e=Boolean(t)},get:function(){return e}}}),i=r.getInstance();var t=function(e){!e.loading&&!e.syncing&&(this.loading=!1,this.set(e.toJSON(),{parse:!0}),this.trigger("refresh",this))};this.listenTo(i,"refresh",t),this.listenTo(i,"update",function(){this.loading=!0}),t.call(this,i)},parse:function(n){var r=[],i=[];return e.each(n,function(n){var s=e.clone(n);s.title=n.name&&n.name.display_name?n.name.display_name:t.message.UNNAMED_CONTACT,e.each(n.phone,function(t){s.id=n.id+"|"+t.number,s.phoneNumber=t.number,i.indexOf(s.id)<0&&(r.push(e.clone(s)),i.push(s.id))})}),r}}),o,u=e.extend(function(){},{getInstance:function(){return o||(o=new s,o.trigger("update")),o}});return u})}(this),function(e){define("contact/views/AccountSelectorView",["underscore","Internationalization","ui/MenuButton","contact/collections/AccountCollection","contact/collections/ContactMultiNumbersCollection","contact/collections/ContactsCollection"],function(e,t,n,r,i,s){console.log("AccountSelectorView - File loaded.");var o,u=n.extend({className:n.prototype.className+" w-contact-account-selector",initialize:function(){u.__super__.initialize.apply(this,arguments);var n=!1,i="all",s=!1,a=!0,f="account"+e.uniqueId("_input_");Object.defineProperties(this,{hasNumber:{set:function(e){n=Boolean(e)},get:function(){return n}},accountId:{set:function(e){i=e},get:function(){return i}},disableAllLabel:{set:function(e){s=Boolean(e)},get:function(){return s}},displayReadOnly:{set:function(e){a=Boolean(e)},get:function(){return a}},inputName:{get:function(){return f}}});var l=this.options||{},c;for(c in l)l.hasOwnProperty(c)&&(this[c]=l[c]);o=r.getInstance(),o.loading||o.syncing?this.label=t.contact.ACCOUNT_LOADING:this.addItems(),o.on("refresh",function(e){this.addItems(),this.render()},this),this.menu.on("select",function(e){var n=o.get(e.value);this.accountId=e.value,this.label=e.value==="all"?t.contact.ACCOUNT_ALL:o.get(e.value).get("displayName")},this)},render:function(){return u.__super__.render.apply(this,arguments),this.$el.prop({disabled:o.loading||o.syncing}),this},addItems:function(){if(o.loading||o.syncing)return;var n=[];this.disableAllLabel||(this.label=t.contact.ACCOUNT_ALL,n.push({type:"radio",name:this.inputName,value:"all",label:t.contact.ACCOUNT_ALL+" ("+(this.hasNumber?i.getInstance().getContactsHasPhoneNumber().length:s.getInstance().length)+")",checked:this.accountId==="all"})),o.each(function(e){if(this.displayReadOnly||!this.displayReadOnly&&!e.get("read_only")){var t=e.get("displayName")+" (";this.hasNumber?t+=i.getInstance().getContactsHasPhoneNumberByAccountName(e.get("name")).length:t+=e.get("contacts"),t+=")",n.length===0&&(this.label=e.get("displayName")),n.push({type:"radio",name:this.inputName,value:e.get("id"),label:t,checked:n.length===0&&this.disableAllLabel||e.get("id")===this.accountId}),n[n.length-1].checked&&(this.label=n[n.length-1].label)}},this);var r=e.filter(n,function(e){return e.checked})[0];this.accountId=r?r.value:"all",this.items=n},selectByGroupId:function(t){var n=new RegExp(/ungroup\[\w+\]/);n.test(t)?t.replace(/(\[)(\w+)(\])/,function(e,t,n){this.accountId=n}.bind(this)):this.accountId=o.getAccountByGroupId(t).get("id");var r=this.menu.$('input[type="radio"][value="'+this.accountId+'"]');r.prop({checked:!0});var i=e.filter(this.items,function(e){return e.value===this.accountId}.bind(this))[0];this.menu.trigger("select",{name:i.name,value:i.value,label:i.label})},selectByAccountId:function(t){var n;t!=="all"?(this.accountId=t,n=this.menu.$('input[type="radio"][value="'+t+'"]')):this.disableAllLabel?(n=this.menu.$('input[type="radio"]:first'),t=n.attr("value")):n=this.menu.$('input[type="radio"][value="'+t+'"]');if(n.length>0){this.accountId=t,n.prop({checked:!0}),this.menu.$('input[type="radio"]:not([value="'+t+'"])').prop({checked:!1});var r=e.filter(this.items,function(e){return e.value===this.accountId}.bind(this))[0];this.menu.trigger("select",{name:r.name,value:r.value,label:r.label})}}}),a=e.extend(function(){},{getInstance:function(e){return new u(e)}});return a})}(this),function(e){define("contact/views/GroupSelectorView",["underscore","ui/MenuButton","Internationalization","contact/collections/AccountCollection"],function(e,t,n,r){console.log("GroupSelectorView - File loaded.");var i=new RegExp(/ungroup\[\w+\]/),s,o=function(e){var t;return i.test(e)?t=n.contact.UNGROUP_CONTACT_LABEL:t=e==="all"?n.contact.GROUP_ALL:s.getGroupById(e).get("title"),t},u=t.extend({className:t.prototype.className+" w-contact-group-selector",initialize:function(){u.__super__.initialize.apply(this,arguments);var t="all",i="all",a="group"+e.uniqueId("_input_"),f=!0,l=!0;Object.defineProperties(this,{accountId:{set:function(e){t=e},get:function(){return t}},groupId:{set:function(e){i=e},get:function(){return i}},inputName:{get:function(){return a}},enableAllLabel:{set:function(e){f=e},get:function(){return f}},enableManagement:{set:function(e){l=e},get:function(){return l}}});var c=this.options||{},h;for(h in c)c.hasOwnProperty(h)&&(this[h]=c[h]);s=r.getInstance(),s.loading||s.syncing?this.label=n.contact.GROUP_LOADING:this.addItems(),s.on("refresh",function(e){this.addItems(),this.render()},this),this.on("select",function(e){this.groupId=e.value,this.label=o.call(this,e.value)},this)},render:function(){return u.__super__.render.apply(this,arguments),this.$el.prop({disabled:s.loading||s.syncing}),this},addItems:function(){if(s.loading||s.syncing)return;var e=[];this.enableAllLabel&&(this.label=o.call(this,this.groupId),e.push({type:"radio",name:this.inputName,value:"all",label:n.contact.GROUP_ALL,checked:this.groupId==="all"}),e.push({type:"hr"}));if(this.accountId==="all")s.each(function(t){e.length>2&&e.push({type:"hr"});var r=s.getGroupsByAccount(t.get("id"));if(r.length>0||t.get("ungroup_contacts")>0)e.push({type:"group",name:t.get("id"),label:t.get("displayName")}),r.each(function(t){var n=t.get("title")+" (";n+=t.get("contacts")+")",e.push({type:"radio",name:this.inputName,value:t.get("id"),label:n,checked:this.groupId===t.get("id")})},this),t.get("ungroup_contacts")>0&&e.push({type:"radio",name:this.inputName,value:"ungroup["+t.get("id")+"]",label:n.contact.UNGROUP_CONTACT_LABEL+" ("+t.get("ungroup_contacts")+")",checked:i.test(this.groupId)})},this);else{s.getGroupsByAccount(this.accountId).each(function(t){var n=t.get("title")+" (";n+=t.get("contacts")+")",e.push({type:"radio",name:this.inputName,value:t.get("id"),label:n,checked:this.groupId===t.get("id")})},this);var t=s.get(this.accountId);t.get("ungroup_contacts")>0&&e.push({type:"radio",name:this.inputName,value:"ungroup["+t.get("id")+"]",label:n.contact.UNGROUP_CONTACT_LABEL+" ("+t.get("ungroup_contacts")+")",checked:i.test(this.groupId)}),this.enableAllLabel||this.trigger("select",e[0])}this.enableManagement&&(e.push({type:"hr"}),e.push({type:"link",label:n.contact.MANAGE_GROUP,action:function(){wonder.contact.groupManager.setCurAccountId(this.accountId),wonder.contact.groupManager.show()}.bind(this)})),this.items=e},update:function(e,t){this.accountId=e,t!=="all"&&!i.test(t)?this.groupId=s.get(e).containGroup(t)?t:"all":this.groupId=t,this.menu.hide(),this.addItems()}}),a=e.extend({getInstance:function(e){return new u(e)}});return a})}(this),function(e,t){define("contact/views/ExportSelectNumberView",["backbone","underscore","doT","jquery","ui/Panel","ui/TemplateFactory","ui/UIHelper","utilities/StringUtil","Internationalization","contact/collections/AccountCollection","contact/collections/ContactsCollection","contact/models/ExportContextModel","contact/views/ExportProgressView","contact/views/AccountSelectorView","contact/views/GroupSelectorView"],function(e,t,n,r,i,s,o,u,a,f,l,c,h,p,d){console.log("ExportSelectNumberView - File loaded. ");var v,m,g,y,b=e.View.extend({template:n.template(s.get("contact","export-select-number")),className:"w-contact-export-body",initialize:function(){y=l.getInstance(),v=p.getInstance({disableAllLabel:!0,displayReadOnly:!1}),m=d.getInstance({enableAllLabel:!0,enableManagement:!1}),v.on("select",function(e){m.update(e.value),c.set({selectAccount:f.getInstance().get(e.value).get("name")})}),m.on("select",function(e){c.set({selectGroup:e.value}),g.setButtonStatus()})},render:function(){return this.$el.html(this.template({selectNumber:c.get("selectNumber"),allNumber:c.get("allNumber"),hasPhoneNumber:c.get("hasPhoneNumber")})),this.$(".account").append(v.render().$el).append(m.render().$el),v.$el.prop({disabled:!0}),m.$el.prop({disabled:!0}),m.update(v.accountId),c.set({selectAccount:f.getInstance().get(v.accountId).get("name"),selectGroup:m.groupId}),this},setDataType:function(e){var t=this.$('input[name="contact-export"]:checked');c.set({dataType:parseInt(t.attr("value"),10)}),t.val()==="4"&&c.set({selectGroup:m.groupId})},changeRadio:function(e){v.$el.prop({disabled:r(e.currentTarget).val()!=="4"}),m.$el.prop({disabled:r(e.currentTarget).val()!=="4"}),this.trigger("radioChange")},events:{'change input[name="contact-export"]':"changeRadio"}}),w,E=i.extend({initialize:function(){E.__super__.initialize.apply(this,arguments),this.on(o.EventsMapping.SHOW,function(){w=new b,w.on("radioChange",this.setButtonStatus.bind(this)),w.setDataType(),this.$bodyContent=w.render().$el,this.setButtonStatus(),this.center()},this),this.buttons=[{$button:r("<button>").html(a.ui.NEXT).addClass("primary button-next"),eventName:"button_next"},{$button:r("<button>").html(a.ui.CANCEL),eventName:"button_cancel"}]},clickButtonNext:function(){w.setDataType(),this.trigger("_NEXT_STEP")},setButtonStatus:function(e){w.setDataType();var t=[0,c.get("selectNumber"),c.get("allNumber"),c.get("hasPhoneNumber"),c.get("selectGroup")!=="all"?y.getContactsByGroupIdAndAccountName(c.get("selectGroup"),c.get("selectAccount")).length:y.getContactsByAccountName(c.get("selectAccount")).length];this.$(".button-next").prop({disabled:t[c.get("dataType")]<=0})},events:{"click .button-next":"clickButtonNext"}}),S=t.extend({getInstance:function(){return g||(g=new E({title:a.contact.WINDOW_EXPORT_TITLE,disableX:!0,height:260,width:400})),g}});return S})}(this),function(e,t){define("contact/views/ExportTipWindowView",["backbone","underscore","doT","jquery","ui/Panel","ui/TemplateFactory","Internationalization","contact/models/ExportContextModel","contact/views/ExportSelectNumberView"],function(e,t,n,r,i,s,o,u,a){console.log("ExportTipWindowView - File loaded. ");var f=i.extend({initialize:function(){f.__super__.initialize.apply(this,arguments),this.setFileType(),this.buttons=[{$button:r("<button>").html(o.contact.EXPORT_USING_VCARD),eventName:"button_vcard"},{$button:r("<button>").addClass("primary").html(o.ui.CONTINUE),eventName:"button_next"},{$button:r("<button>").html(o.ui.CANCEL),eventName:"button_cancel"}],this.on("rendered",this.setFileType),this.on("button_vcard",this.clickButtonVCard),this.on("button_next",this.clickButtonNext)},setFileType:function(){switch(u.get("fileType")){case 1:this.$bodyContent=n.template(s.get("contact","export-tip"))({tip:o.contact.ALERT_TIP_EXOPRT_OUTLOOK});break;case 2:this.$bodyContent=n.template(s.get("contact","export-tip"))({tip:o.contact.ALERT_TIP_EXOPRT_WINDOWS_MAIL});break;case 3:this.$bodyContent=n.template(s.get("contact","export-tip"))({tip:o.contact.ALERT_TIP_EXOPRT_NOKIA})}},clickButtonVCard:function(){u.set({fileType:0}),this.trigger("_NEXT_STEP")},clickButtonNext:function(){this.trigger("_NEXT_STEP")}}),l,c=t.extend({getInstance:function(){return l||(l=new f({title:o.contact.WINDOW_EXPORT_TITLE,disableX:!0,height:260,width:400})),l}});return c})}(this),function(e,t){define("contact/views/ExportSelectTypeView",["backbone","doT","jquery","underscore","Device","Internationalization","ui/Panel","ui/UIHelper","ui/TemplateFactory","contact/models/ExportContextModel","contact/views/ExportTipWindowView","contact/views/ExportSelectNumberView"],function(e,t,n,r,i,s,o,u,a,f,l,c){console.log("ExportSelectTypeView - File loaded. ");var h=e.View.extend({template:t.template(a.get("contact","export-select-type")),className:"w-contact-export-body",render:function(){return this.$el.html(this.template({})),this},setFileType:function(e){var t=this.$('input[name="contact-export-type"]:checked');f.set({fileType:parseInt(t.attr("value"),10)})}}),p,d=o.extend({initialize:function(){d.__super__.initialize.apply(this,arguments),this.on(u.EventsMapping.SHOW,function(){p=new h,this.$bodyContent=p.render().$el,this.setButtonState(),this.center()},this),i.on("change:isConnected",this.setButtonState,this),this.buttons=[{$button:n("<button>").html(s.ui.NEXT).addClass("button-next primary"),eventName:"button_next"},{$button:n("<button>").html(s.ui.CANCEL),eventName:"button_cancel"}]},setButtonState:function(){this.$('input[value="1"], input[value="2"], input[value="3"]').prop({disabled:!i.get("isConnected")})},clickButtonNext:function(){p.setFileType(),this.trigger("_NEXT_STEP")},events:{"click .button-next":"clickButtonNext"}}),v,m=r.extend({getInstance:function(){return v||(v=new d({title:s.contact.WINDOW_EXPORT_TITLE,disableX:!0,height:260,width:400})),v}});return m})}(this),function(e,t){define("contact/ExportController",["backbone","doT","jquery","underscore","contact/models/ExportContextModel","contact/views/ExportSelectTypeView","contact/views/ExportTipWindowView","contact/views/ExportSelectNumberView","contact/views/ExportProgressView"],function(e,t,n,r,i,s,o,u,a){console.log("ExportController - File loaded. ");var f,l,c,h,p=e.View.extend({buildEvents:function(){f.off("_NEXT_STEP"),l.off("_NEXT_STEP"),c.off("_NEXT_STEP"),h.off("_LAST_VIEW"),h.off("_CANCEL"),f.on("_NEXT_STEP",function(){var e=i.get("fileType")===0,t=e?c:l;this.showNextAndRemoveCurrent(f,t)},this),l.on("_NEXT_STEP",function(){this.showNextAndRemoveCurrent(l,c)},this),c.on("_NEXT_STEP",function(){this.showNextAndRemoveCurrent(c,h),h.exportContacts()},this),h.on("_LAST_VIEW",function(){this.showNextAndRemoveCurrent(h,c)},this),h.on("_CANCEL",function(){h.remove()},this)},showNextAndRemoveCurrent:function(e,t){var n=function(){t.show(),e.off("hide",n)};e.on("hide",n,this),e.remove()},start:function(){f=f||s.getInstance(),l=l||o.getInstance(),c=c||u.getInstance(),h=h||a.getInstance(),this.buildEvents(),f.show()}}),d=new p;return d})}(this),function(e,t){define("contact/views/ContactContextMenu",["underscore","backbone","ui/Menu","ui/behavior/ClickToHideMixin","Internationalization","Device","Log","contact/models/ExportContextModel","contact/collections/ContactsCollection","contact/ContactService","contact/ExportController"],function(e,t,n,r,i,s,o,u,a,f,l){console.log("ContactContextMenu - File loaded. ");var c,h=n.extend({initialize:function(){h.__super__.initialize.apply(this,arguments),r.mixin(this),c=a.getInstance(),this.addItems(),this.on("select",function(e){switch(e.value){case"delete":this.deleteContact();break;case"merge":this.mergeContact();break;case"export":this.exportContact()}},this)},deleteContact:function(){f.deleteContactsAsync(this.options.selected),o({event:"ui.click.contact.button.delete.contextmenu",count:this.options.selected.length})},mergeContact:function(){t.trigger("contactContextMenuMerge",this.options.selected),o({event:"ui.click.contact.button.merge.contextmenu",count:this.options.selected.length})},exportContact:function(){u.set({fileType:0,dataType:0,selectedIdList:this.options.selected,hasPhoneIdList:e.map(c.getContactsHasPhoneNumber(),function(e){return e.get("id")}),selectNumber:this.options.selected.length,allNumber:c.length,hasPhoneNumber:c.getContactsHasPhoneNumber().length}),l.start(),o({event:"ui.click.contact.button.export.contextmenu",count:this.options.selected.length})},addItems:function(){var e=this.options.selected;this.items=[{type:"normal",name:"delete",value:"delete",label:i.misc.DELETE,disabled:!s.get("isConnected")||e.length===0},{type:"normal",name:"merge",value:"merge",label:i.contact.MERGE,disabled:!s.get("isConnected")||e.length<=1||c.containsReadOnly(e)},{type:"hr"},{type:"normal",name:"export",value:"export",label:i.misc.EXPORT,disabled:!1}]}}),p,d=e.extend({getInstance:function(e){return p?(p.options.selected=e.selected,p.addItems(),p.render()):p=new h(e),p}});return d})}(this),function(e,t,n){define("contact/views/ContactsListView",["backbone","doT","jquery","underscore","ui/TemplateFactory","ui/SmartList","Internationalization","Device","utilities/StringUtil","contact/collections/ContactsCollection","contact/collections/AccountCollection","contact/views/ContactItemView","contact/views/ContactContextMenu"],function(r,i,s,o,u,a,f,l,c,h,p,d,v){console.log("ContactsListView - File loaded. ");var m=o.debounce(function(){this.$(".pinyin-hint").hide()},1e3),g,y,b,w="all",E="all",S="all",x=r.View.extend({template:i.template(u.get("contact","list-ctn")),className:"w-contact-list vbox",initialize:function(){Object.defineProperties(this,{selected:{get:function(){return b?b.selected:[]}},currentAccountId:{get:function(){return E}},currentGroupId:{get:function(){return S}},list:{get:function(){return b}}}),y=p.getInstance(),g=h.getInstance(),this.bindContactsCollectionEvents(),r.on("switchModule",function(e){e.module==="contact"&&(w=e.tab)}),s(t).on("keydown",function(t){if(e.SnapPea.CurrentModule==="contact"&&s("input:focus, textarea:focus").length===0){var r=String.fromCharCode(t.keyCode),i=o.find(b.currentModels,function(e){return e.firstLetter===r});i!==n&&(b.scrollTo(i),b.on("build",function(){this.showPinyinHint()},this))}}.bind(this))},refresh:function(e,t,n){e=e||w,S=n||S,E=t||E;var r;switch(e){case"all":S==="all"?E==="all"?r=g.getAll:r=function(){return g.getContactsByAccountName(y.get(E).get("name"))}:E==="all"?r=function(){return g.getContactsByGroupId(S)}:r=function(){return g.getContactsByGroupIdAndAccountName(S,y.get(E).get("name"))},b.switchSet("default",r);break;case"starred":S==="all"?E==="all"?r=g.getContactsStarred:r=function(){return g.getContactsStarredByAccountName(y.get(E).get("name"))}:E==="all"?r=function(){return g.getContactsStarredByGroupdId(S)}:r=function(){return g.getContactsStarredByGroupdIdAndAccountName(S,y.get(E).get("name"))},b.switchSet("starred",r);break;case"hasnumber":S==="all"?E==="all"?r=g.getContactsHasPhoneNumber:r=function(){return g.getContactsHasPhoneNumberByAccountName(y.get(E).get("name"))}:E==="all"?r=function(){return g.getContactsHasPhoneNumberByGroupdId(S)}:r=function(){return g.getContactsHasPhoneNumberByGroupdIdAndAccountName(S,y.get(E).get("name"))},b.switchSet("hasnumber",r)}this.updateHeader()},bindContactsCollectionEvents:function(){g.on("syncStart update syncEnd refresh",function(){b!==n&&(b.loading=g.loading||g.syncing)}),g.on("refresh",function(){this.updateHeader(),this.refresh()},this)},toggleEmptyTip:function(){if(g.loading||g.syncing||l.get("isFastADB")){b.toggleEmptyTip(!1);return}if(b.currentModels.length===0){var e;switch(b.currentSet.name){case"default":E==="all"&&S==="all"?e=f.contact.NON_CONTACT_TEXT_PERMISSION:e=f.contact.NON_CONTACT_TEXT;break;case"starred":e=f.contact.NON_STAR_CONTACT_TEXT;break;case"hasnumber":e=f.contact.NON_PHONE_CONTACT_TEXT}b.emptyTip=e,b.toggleEmptyTip(!0)}else b.toggleEmptyTip(!1)},buildList:function(){b=new a({itemView:d.getClass(),dataSet:[{name:"default",getter:g.getAll}],enableContextMenu:!0,keepSelect:!1,itemHeight:45,$observer:this.options.$observer,listenToCollection:g,loading:g.loading||g.syncing}),this.listenTo(b,"select:change",function(e){this.trigger("select:change",e)}),this.listenTo(l,"change:isFastADB",this.toggleEmptyTip),this.$el.append(b.render().$el),b.on("switchSet",this.toggleEmptyTip,this),b.$(".w-ui-smartlist-scroll-ctn").on("scroll",o.throttle(this.showPinyinHint.bind(this),15)),b.on("contextMenu",this.showContextMenu,this)},showContextMenu:function(e){var t=v.getInstance({selected:e});t.show()},showPinyinHint:function(){b.once("build",function(){var e=b.onScreenItems[0];e&&(this.$(".pinyin-hint").html(e.model.firstLetter).show(),m.call(this))},this)},render:function(){return this.$el.html(this.template({})),this.buildList(),this.updateHeader(),this.$el.append(s("<div>").addClass("pinyin-hint")),this.toggleEmptyTip(),this},updateHeader:function(){var e="",t=b.currentModels.length;S!=="all"?e=c.format(f.contact.CONTACT_GROUP_TEXT,t):E==="all"?e=c.format(f.contact.CONTACT_ALL_TEXT,t):y.get(E).isSimAccount?e=f.contact.CONTACT_SIM_SELECT_TEXT_1:e=c.format(f.contact.CONTACT_ACCOUNT_TEXT,t),this.$(".count-tip").html(e)},highlight:function(e){if(o.pluck(b.currentModels,"id").indexOf(e.id)<0)this.trigger("select:change",b.selected);else{var t=g.get(e.id);b.deselectAll({silent:!0}),b.addSelect(t.id),b.scrollTo(t)}}}),T,N=o.extend({getInstance:function(e){return T||(T=new x(e)),T}});return N})}(this,this.document),function(e,t){define("ui/Toolbar",["backbone"],function(e){console.log("Toolbar - File loaded.");var t=e.View.extend({className:"w-ui-toolbar hbox"});return t})}(this),function(e,t){define("message/collections/Threads4ContactCollection",["backbone","underscore","message/collections/ThreadsCollection"],function(e,t,n){console.log("threads4ContactCollection - File loaded.");var r=n.getClass().extend({initialize:function(){r.__super__.initialize.apply(this,arguments),Object.defineProperties(this,{is4Contact:{get:function(){return!0}}})}}),i,s=t.extend({getInstance:function(e){return i||(i=new r(e),i.trigger("update")),i}});return s})}(this),function(e,t){define("message/MessageService",["IOBackendDevice","Configuration","Environment","Internationalization","utilities/StringUtil","ui/AlertWindow","ui/BatchActionWindow","message/collections/ConversationsCollection","message/collections/ThreadsCollection","message/collections/Threads4ContactCollection"],function(t,n,r,i,s,o,u,a,f,l){console.log("MessageService - File loaded.");var c=e.confirm,h,p=_.extend(function(){},Backbone.Events);return p.getServiceCenterAsync=function(){var e=$.Deferred();return t.requestAsync({url:n.actions.SMS_GET_SERVICE_CENTER,success:function(t){t.state_code===200?(console.log("MessageService - Get SMS service center success."),e.resolve(t)):(console.error("MessageService - Get SMS service center faild. Error info: "+t.state_line),e.reject(t))}}),e.promise()},p.sendMessageAsync=function(e,r,i,s){var o=$.Deferred(),u=function(e){e.state_code===200?(console.log("MessageSenderView - Send message success."),o.resolve(e)):(console.error("MessageSenderView - Send message failed. Error info: "+e.state_line),o.reject(e))};return e instanceof Array&&e.length>1?t.requestAsync({type:"POST",url:n.actions.SMS_BATCH_SEND+"?sendFrom="+(s||""),data:{address:{value:e},body:r,service_center:i},success:u}):(e instanceof Array&&(e=e[0]),t.requestAsync({type:"post",url:n.actions.SMS_SEND+"?sendFrom="+(s||""),data:{address:e,body:r,service_center:i},success:u})),o.promise()},p.markAsReadAsync=function(e){h=h||a.getInstance();var t=$.Deferred(),r=0;return _.each(e,function(e){r+=h.get(e).get("unread_number")}),c(s.format(i.message.CONFIRM_MARK_AS_READ,e.length),function(){var s;if(e.length>1&&r>1){s=_.uniqueId("sms.batch.mark_as_read_");var o=new u({session:s,progressText:i.message.CONVERSATION_MARK_AS_READ_PROGRESS,cancelUrl:n.actions.SMS_CANCEL,total:r,successText:i.message.CONVERSATION_MARK_AS_READ_SUCCESS});o.show()}h.markAsReadAsync(e,s).done(function(e){f.getInstance().trigger("update"),l.getInstance().trigger("update"),t.resolve(e)}).fail(function(e){t.reject(e)})}),t.promise()},p.deleteConversationAsync=function(e){h=h||a.getInstance();var t=$.Deferred(),r=0;_.each(e,function(e){r+=h.get(e).get("total_number")});var f=new o({draggable:!0,disposableName:"sms-conversation-delete-single",buttonSet:"yes_no",$bodyContent:s.format(i.message.CONFIRM_DELETE_CONVERSATION,e.length,r)});return f.once("button_yes",function(){var s;if(e.length>1&&r>1){s=_.uniqueId("sms.batch.delete_");var o=new u({session:s,progressText:i.message.CONVERSATION_DELETE_PROGRESS,cancelUrl:n.actions.SMS_CANCEL,total:r,successText:i.message.CONVERSATION_DELETE_SUCCESS});o.show()}h.deleteConversationsAsync(e,s).done(function(e){t.resolve(e)}).fail(function(e){t.reject(e)}).always(function(){l.getInstance().trigger("update")})},this),f.show(),t.promise()},p.getSmsHasBackupAsync=function(){var e=$.Deferred();return t.requestAsync({url:n.actions.SMS_HAS_BACKUP,success:function(t){t.state_line===200?e.resolve(t):e.reject(t)}}),e.promise()},p.loadSmsBackupAsync=function(){var e=$.Deferred();return t.requestAsync({url:n.actions.SMS_LOAD_BACKUP,success:function(t){t.state_line===200?e.resolve(t):e.reject(t)}}),e.promise()},p})}(this),function(e,t){define("ui/TipPanel",["backbone","underscore","doT","jquery","ui/UIHelper","ui/TemplateFactory","ui/behavior/LimitInWindowMixin","ui/behavior/BlurToHideMixin","ui/behavior/AutoCloseMixin","ui/WindowState"],function(t,n,r,i,s,o,u,a,f,l){console.log("TipPanel - File loaded.");var c=e.setTimeout,h=s.EventsMapping,p=t.View.extend({template:r.template(o.get("ui","tip")),initialize:function(){u.mixin(this),a.mixin(this),f.mixin(this);var e=!1,t,n=!1;Object.defineProperties(this,{rendered:{set:function(t){e=t},get:function(){return e}},$content:{set:function(e){t=e},get:function(){return t}},popIn:{set:function(e){n=e},get:function(){return n}}});var r=this.options||{},i;for(i in r)r.hasOwnProperty(i)&&(this[i]=r[i])},beforeRender:function(){},render:function(){return this.beforeRender(),this.$el.html(this.template({})),this.$el.append(this.$content),this.$el.css({top:0,left:0}),i("body").append(this.$el),this.rendered=!0,this.trigger(h.RENDERED),this},show:function(){this.rendered||this.render(),this.listenTo(l,"resize",this.hide),this.locate(),this.$el.removeClass("w-layout-hide"),this.$el.toggleClass("w-anima-pop-in",this.popIn);var e=function(){this.trigger(h.SHOW)}.bind(this);this.$el.one("webkitTransitionEnd",e)},hide:function(){this.$el.addClass("w-layout-hide"),this.rendered=!1,c(function(){this.trigger(h.REMOVE),p.__super__.remove.call(this)}.bind(this),500)},remove:function(){this.hide()}});return p})}(this),function(e,t){define("ui/PopupPanel",["underscore","jquery","ui/TipPanel","ui/UIHelper"],function(t,n,r,i){console.log("PopupPanel - File loaded.");var s=e.setTimeout,o=i.EventsMapping,u=r.extend({className:"w-ui-popup-panel w-layout-hide",initialize:function(){u.__super__.initialize.apply(this,arguments),this.alignToHost=!0,this.blurDelay=300;var e=this.options||{},t;for(t in e)e.hasOwnProperty(t)&&(this[t]=e[t])}});return u})}(this),function(e,t){define("ui/PopupTip",["underscore","jquery","ui/TipPanel","ui/UIHelper"],function(t,n,r,i){console.log("PopupTip - File loaded.");var s=e.setTimeout,o=i.EventsMapping,u=r.extend({className:"w-ui-popup-tip w-layout-hide",initialize:function(){u.__super__.initialize.apply(this,arguments),this.alignToHost=!1,this.ignoreSelf=!0,this.directionDown=!1},beforeRender:function(){this.$content=this.$host.data("title")}});return u})}(this),function(e,t){define("ui/UI",["backbone","underscore","ui/UIHelper","ui/TemplateFactory","ui/Panel","ui/AlertWindow","ui/SmartList","ui/Button","ui/MenuButton","ui/TipPanel","ui/PopupTip","ui/Menu"],function(t,n,r,i,s,o,u,a,f,l,c,h){console.log("UI - File loaded.");var p={UIHelper:r,TemplateFactory:i,Panel:s,AlertWindow:o,SmartList:u,Button:a,MenuButton:f,TipPanel:l,PopupTip:c,Menu:h};return e.UI=p,p})}(this),function(e,t,n){define("message/views/ContactSuggestionView",["backbone","underscore","doT","jquery","IO","Configuration","ui/UI","ui/behavior/ClickToHideMixin","contact/collections/ContactsCollection"],function(e,r,i,s,o,u,a,f,l){console.log("ContactSuggestionView - File loaded.");var c=a.TemplateFactory,h=a.UIHelper.KeyMapping,p=a.UIHelper.EventsMapping,d,v=e.Model.extend({defaults:{highlight:!1},initialize:function(){d=d||l.getInstance();var e=d.get(this.get("id"));this.set({id:this.get("id")+"|"+this.get("description_item")[0].value,displayTitle:this.get("title"),title:this.get("title").replace(/<em>|<\/em>/gi,""),displayNumber:this.get("sub_title"),phoneNumber:this.get("sub_title").replace(/<em>|<\/em>/gi,""),avatar:e?e.get("avatarSmall")||u.enums.CONTACT_DEFAULT_ICON:u.enums.CONTACT_DEFAULT_ICON})}}),m=e.Collection.extend({model:v,getCurrentSelectContact:function(){var e=this.filter(function(e){return e.get("highlight")});return e.length>0?e[0]:n}}),g=e.View.extend({tagName:"li",className:"hbox",template:i.template(c.get("message","search-result-item")),initialize:function(){this.listenTo(this.model,"change:highlight",function(e,t){this.$el.toggleClass("highlight",t);if(t){var r=e.collection.find(function(t){return t.get("highlight")&&t.id!==e.id});r!==n&&r.set({highlight:!1})}}),this.listenTo(this.model,"remove",this.remove)},render:function(){return this.$el.html(this.template(this.model.toJSON())),this.$el.toggleClass("highlight",this.model.get("highlight")),this},mouseoverContact:function(){this.model.set({highlight:!0})},mouseoutContact:function(){this.model.set({highlight:!1})},events:{mouseover:"mouseoverContact",mouseout:"mouseoutContact"}}),y=e.View.extend({tagName:"ul",className:"w-message-suggestion-ctn",initialize:function(){f.mixin(this);var e,t,n="",r,i=!0;Object.defineProperties(this,{$host:{set:function(t){e=t},get:function(){return e}},lastQuery:{set:function(e){n=e.toString()},get:function(){return n}},rendered:{set:function(e){r=e},get:function(){return r}},width:{get:function(e){var n;return this.options.hasOwnProperty("width")?n=this.options.width:t?n=this.$locator.outerWidth()-2:n=this.$host.outerWidth()-2,n}},autoHighlight:{set:function(e){i=e},get:function(){return i}},$locator:{set:function(e){t=e},get:function(){return t}}});var s=this.options||{},o;for(o in s)s.hasOwnProperty(o)&&(this[o]=s[o]);this.collection=new m,this.listenTo(this.collection,"reset",this.renderList),this.$host&&e.on("focus",this.focusHost.bind(this))},render:function(){return this.delegateEvents(),s("body").append(this.$el),this.$el.width(this.width),this.rendered=!0,this.trigger(p.RENDERED),this},renderList:function(){if(!this.$host.is(":visible"))return;if(this.collection.length>0){var e=this.$el.hide().empty(),n=t.createDocumentFragment();this.collection.each(function(e){var t=new g({model:e});n.appendChild(t.render().$el[0])},this),e.append(n).show(),this.show()}else this.close()},locate:function(){var e=this.$locator||this.$host,t=e.offset();this.$el.offset({left:t.left,top:t.top+e[0].offsetHeight})},show:function(){this.rendered||this.render(),this.locate(),this.$el.show(),this.trigger(p.SHOW)},sendQuery:function(){var e=this.$host.val().trim();e!==this.lastQuery&&(this.lastQuery=e,this.lastQuery.length>0?this.searchAsyc().done(function(e){this.collection.reset(e.body.result),this.autoHighlight&&this.collection.length>0&&this.collection.at(0).set({highlight:!0})}.bind(this)).fail(function(){this.close()}.bind(this)):this.close())},searchAsyc:function(){var e=s.Deferred();return o.requestAsync(u.actions.CONTACT_SEARCH,{data:{filter:"just_phone",query:this.lastQuery,is_detail:!0,max_result:5}}).done(function(t){t.state_code===200||t.state_code===202?(console.log("ContactSuggestionView - Search contact success."),e.resolve(t)):(console.log("ContactSuggestionView - Search contact failed. Error info: "+t.state_line),e.reject(t))}),e.promise()},remove:function(){this.collection.set([]),delete this.collection,y.__super__.remove.call(this)},close:function(){this.$el.remove(),this.rendered=!1},hide:function(){this.close()},next:function(){var e=this.collection,t=e.getCurrentSelectContact();if(e.length>0&&!t)e.at(0).set({highlight:!0});else{var n=e.models.indexOf(t);e.at(n+1===e.length?0:n+1).set({highlight:!0})}},prev:function(){var e=this.collection,t=e.getCurrentSelectContact();if(e.length>0&&!t)e.at(e.length-1).set({highlight:!0});else{var n=e.models.indexOf(t);e.at(n===0?e.length-1:n-1).set({highlight:!0})}},selectContact:function(){this.trigger("selectContact",this.collection.getCurrentSelectContact()),this.$host.val("")},keydownHost:function(e){var t=e.keyCode;if(this.rendered)switch(t){case h.DOWN:e.preventDefault(),this.next();break;case h.UP:e.preventDefault(),this.prev();break;case h.ENTER:e.preventDefault(),e.stopPropagation(),this.collection.getCurrentSelectContact()&&this.selectContact(),this.close();break;case h.ESC:e.preventDefault(),this.close()}else t===h.ENTER&&(e.preventDefault(),e.stopPropagation())},focusHost:function(){var e=this.$host;if(e.hasClass("focus"))return;var t=setInterval(this.sendQuery.bind(this),100),n=this.keydownHost.bind(this);e.on("keydown",n);var r=function(){clearInterval(t),this.lastQuery="",e.off("keydown",n).off("blur",r).removeClass("focus")}.bind(this);e.on("blur",r).addClass("focus"),this.trigger("focused")},clickContact:function(e){this.close(),this.selectContact()},events:{"click li":"clickContact"}}),b=r.extend(function(){},{getInstance:function(e){return new y(e)}});return b})}(this,this.document),function(e,t){define("message/views/MonitorItemView",["underscore","backbone","doT","ui/TemplateFactory"],function(e,t,n,r){console.log("MonitorItemView - File loaded.");var i=t.View.extend({tagName:"li",className:"w-message-contact-selector-monitor-item",template:n.template(r.get("message","monitor-item-sender")),render:function(){return this.$el.html(this.template(this.model.toJSON())),this},clickButtonDelete:function(e){this.$el.remove(),this.trigger("delete",this.model)},events:{"click .button-delete":"clickButtonDelete"}}),s=e.extend({getInstance:function(e){return new i(e)}});return s})}(this),function(e,t,n){define("message/views/BatchContactsSelectorView",["backbone","underscore","doT","Internationalization","utilities/StringUtil","ui/UIHelper","ui/TemplateFactory","ui/Panel","ui/behavior/ButtonSetMixin","ui/MenuButton","ui/SmartList","ui/BaseListItem","message/views/ContactSuggestionView","message/views/MonitorItemView","contact/views/AccountSelectorView","contact/views/GroupSelectorView","contact/collections/AccountCollection","contact/collections/ContactMultiNumbersCollection"],function(e,n,r,i,s,o,u,a,f,l,c,h,p,d,v,m,g,y){console.log("BatchContactsSelectorView - File loaded.");var b=o.EventsMapping,w,E,S=h.extend({className:"w-message-contact-selector-list-item hbox",template:r.template(u.get("message","contact-list-item")),render:function(){return this.$el.html(this.template(this.model.toJSON())),this},clickItem:function(){this.$(".item-checker").click()},events:{click:"clickItem"}}),x=e.View.extend({template:r.template(u.get("message","contact-selector-footer")),render:function(){return this.$el.html(this.template({})),this}}),T,N=e.View.extend({template:r.template(u.get("message","contact-seletor-body")),className:"w-message-contact-selector-body",initialize:function(){w=y.getInstance(),E=E||g.getInstance()},addSelector:function(){this.accountSelectorView=v.getInstance({hasNumber:!0}),this.groupSelectorView=m.getInstance({enableManagement:!1}),this.$(".selector-ctn").append(this.accountSelectorView.render().$el).append(this.groupSelectorView.render().$el);var e,t;e=function(e){this.stopListening(this.groupSelectorView,"select",t),this.contactList.toggleEmptyTip(this.contactList.currentModels.length===0),e.value!==this.groupSelectorView.accountId||e.value==="all"?this.groupSelectorView.update(e.value,"all"):this.groupSelectorView.update(e.value,this.groupSelectorView.groupId),this.buildList(),this.listenTo(this.groupSelectorView,"select",t)},t=function(t){this.stopListening(this.accountSelectorView,"select",e),t.value!=="all"&&this.accountSelectorView.selectByGroupId(t.value),this.buildList(),this.listenTo(this.accountSelectorView,"select",e)},this.listenTo(this.accountSelectorView,"select",e),this.listenTo(this.groupSelectorView,"select",t)},buildList:n.debounce(function(){var e=this.accountSelectorView.accountId,t=this.groupSelectorView.groupId,n;t==="all"?e==="all"?n=w.getAll:n=function(){return w.getContactsByAccountName(E.get(e).get("name"))}:e==="all"?n=function(){return w.getContactsByGroupId(t)}:n=function(){return w.getContactsByGroupIdAndAccountName(t,E.get(e).get("name"))},this.contactList.switchSet("default",n)}),addSuggestion:function(){this.contactSuggestionView=p.getInstance({$host:this.$(".searchbox")}),this.listenTo(this.contactSuggestionView,"selectContact",this.addContact)},addContctList:function(){this.contactList=new c({itemView:S,dataSet:[{name:"default",getter:w.getContactsHasPhoneNumber}],keepSelect:!0,$observer:this.$(".w-message-contact-selector-ctrl .check-select-all"),itemHeight:31,selectable:!1,listenToCollection:w,emptyTip:i.message.NO_CONTACT_UNDER_THIS_ACCOUNT}),this.$(".list-ctn").append(this.contactList.render().$el);if(w.loading){var e=function(){this.contactList.switchSet("default",w.getContactsHasPhoneNumber)};w.once("refresh",e)}var r=[],o=function(e){var i=t.createDocumentFragment();n.each(e,function(e){var t=d.getInstance({model:w.get(e)});i.appendChild(t.render().$el[0]),r.push(t);var n=function(e){this.contactList.removeSelect(e.id),t.off("delete",n)};t.on("delete",n,this)},this),this.$(".selector-monitor").append(i)},u=function(e){var t=0,i=e.length;n.each(e,function(e){n.find(r,function(t,n){if(t.model.id===e)return r.splice(n,1)[0].off().remove(),!0})})};this.listenTo(this.contactList,"select:change",function(e){var t=n.map(r,function(e){return e.model.id}),a=this.contactList.getAllSelected(),f=n.difference(t,a),l=n.difference(a,t);f.length>0&&u.call(this,f),o.length>0&&o.call(this,l),T.$(".count").html(s.format(i.message.CONTACT_SELECT,this.contactList.getAllSelected().length))})},addContact:function(e){this.contactList.addSelect(e.get("id"))},render:function(){return this.delegateEvents(),this.$el.html(this.template({})),this.addSelector(),this.addSuggestion(),this.addContctList(),this.trigger(b.RENDERED),this},clickButtonSelectAll:function(){this.contactList.selectAll()},remove:function(){this.contactSuggestionView.remove(),this.contactList.remove(),this.accountSelectorView.remove(),N.__super__.remove.call(this)},events:{"click .button-select-all":"clickButtonSelectAll"}}),C,k=a.extend({initialize:function(){k.__super__.initialize.apply(this,arguments),this.title=i.message.ADD_CONTACT,this.width=410,this.on(b.SHOW,function(){T=new x,this.$(".w-ui-window-footer-monitor").append(T.render().$el),C=new N,this.$bodyContent=C.render().$el,this.once(b.REMOVE,C.remove,C),this.once(b.REMOVE,T.remove,T)},this)},getSelectedContacts:function(){var e=[];return n.each(C.contactList.selected,function(t){e.push(w.get(t))}),e},render:function(){n.extend(this.events,k.__super__.events),k.__super__.render.call(this)},clickButtonClearAll:function(){C.contactList.erase()},events:{"click .button-clear-all":"clickButtonClearAll"}}),L=n.extend(function(){},{getInstance:function(){return new k({buttonSet:f.BUTTON_SET.YES_NO})}});return L})}(this,this.document),function(e,t){define("message/views/MessageSenderView",["backbone","underscore","doT","jquery","Internationalization","Device","Configuration","FunctionSwitch","IO","ui/UIHelper","ui/TemplateFactory","ui/Panel","ui/AlertWindow","ui/PopupPanel","utilities/StringUtil","message/MessageService","message/views/ContactSuggestionView","message/views/MonitorItemView","message/views/BatchContactsSelectorView","contact/collections/ContactMultiNumbersCollection"],function(n,r,i,s,o,u,a,f,l,c,h,p,d,v,m,g,y,b,w,E){console.log("MessageSenderView - File loaded.");var S=e.document,x=e.confirm,T=e.clearInterval,N=e.setInterval,C=c.EventsMapping,k=c.KeyMapping,L=c.MouseState,A={CONTACT_ADDRESS_INPUT:".input-contact",CONTACT_ITEM:".text",MONITOR_ITEM:".w-message-contact-selector-monitor-item",CONTACTS_COUNT:".monitor .contacts-count",CONTENT_COUNT:".monitor .content-count"},O=function(e){return!0},M,_,D,P=[],H,B=n.View.extend({className:"w-message-sender-window",template:i.template(h.get("message","message-sender")),initialize:function(){var e=0,t=0;Object.defineProperties(this,{contactsCount:{set:function(e){this.$(A.CONTACTS_COUNT).html(m.format(o.message.CONTACTS_COUNT,e))},get:function(){return e}},contentCount:{set:function(e){var t=m.format(o.message.CONTENT_COUNT,e),n=Math.round(parseInt(e,10)/a.enums.SINFGLE_MESSAGE_CHAR_NUMBER);n>0&&(t+=m.format(o.message.MESSAGE_COUNT,n)),this.$(A.CONTENT_COUNT).html(t)},get:function(){return t}}}),P.length=0,M=E.getInstance(),this.on(C.RENDERED,this.buildContent,this)},addContact:function(e){var t;if(e instanceof Array){var n=S.createDocumentFragment();r.each(e,function(e){var t=e.id?M.get(e.id):e;if(P.indexOf(t.get("phoneNumber"))<0){P.push(t.get("phoneNumber"));var r=b.getInstance({model:t}),i=function(e){P.splice(P.indexOf(e.get("phoneNumber")),1),this.contactsCount=P.length,r.off("delete",i)};r.on("delete",i,this),n.appendChild(r.render().$el[0])}},this),t=n}else{var s=e.id?M.get(e.id):e;if(P.indexOf(s.get("phoneNumber"))<0){P.push(s.get("phoneNumber"));var o=b.getInstance({template:i.template(h.get("message","monitor-item-sender")),model:s}),u=function(e){P.splice(P.indexOf(e.get("phoneNumber")),1),this.contactsCount=P.length,o.off("delete",u)};o.on("delete",u,this),t=o.render().$el}}var a=this.$(".searchbox");a.before(t),a[0].scrollIntoView(),this.contactsCount=P.length},buildSuggestion:function(){H=y.getInstance({$host:this.$(".searchbox"),$locator:this.$(".address"),autoHighlight:!1}),H.bind("selectContact",function(e){this.$(".searchbox").val(""),this.addContact(e)},this),H.on("focused",this.focusInputContact,this)},buildContent:function(){this.buildSuggestion()},render:function(){this.delegateEvents(),this.$el.html(this.template({})),this.contentCount=0,this.contactsCount=0;var e;if(!f.ENABLE_DUAL_SIM)this.$(".multi-sim-tip").remove();else{var t=this.$(".multi-sim-tip");e=new v({$content:o.message.PROBLEM_WITH_DUAL_SIM_PHONE_TIP,$host:t})}var n=this.$(".batch-send-tip");return e=new v({$content:o.message.ADD_BATCH_RECEIVER_TIP,$host:n}),this.trigger(C.RENDERED),this},addPlaceholder:function(){var e=this.$(".input-content"),t=e[0],n="$NAME";if(S.selection){e.focus();var r=S.selection.createRange();r.text=n,e.focus()}else if(t.selectionStart||t.selectionStart===0){var i=t.selectionStart,s=t.selectionEnd,o=t.scrollTop;t.value=t.value.substring(0,i)+n+t.value.substring(s,t.value.length),e.focus(),t.selectionStart=i+n.length,t.selectionEnd=i+n.length,t.scrollTop=o}else e.value+=n,e.focus()},keydownContent:function(e){this.contentCount=e.target.value.length},keyupInputContact:function(){var e=s(A.CONTACT_ADDRESS_INPUT).val();if(e.length===0){var t=this.$(A.CONTACT_ITEM);s(t[t.length-1]).remove()}},addContatInputValueToList:function(){var e=this.$(".input-contact"),t=e.val();if(t.trim().length!==0){t=t.replace(/,|，|;|；/gi,",");var i=t.split(",");r.each(i,function(e){if(O(e)){var t=new n.Model({displayNumber:e,phoneNumber:e});this.addContact(t)}},this),e.val("")}},keydownInputContact:function(e){var t=e.keyCode,n=this.$(".input-contact"),r=n.val();if(t===k.BACKSPACE){if(r.length===0){var i=this.$(A.MONITOR_ITEM),o=s(i[i.length-1]).remove().find("span").prop("title");P.splice(P.indexOf(o),1),this.contactsCount=P.length}}else{var u=[k.ENTER,k.SPACEBAR,186,188];if(u.indexOf(t)>=0){if(t===k.ENTER&&H.collection.getCurrentSelectContact())return;e.preventDefault(),this.addContatInputValueToList()}}},clickAddress:function(e){this.$(".input-contact").focus()},focusInputContact:function(){var e=this.$(".input-contact"),t=this.keydownInputContact.bind(this);e.on("keydown",t);var n=function(){this.$(".address").removeClass("focus"),H.$(s(c.MouseState.currentElement)).length===0&&H.$el[0]!==c.MouseState.currentElement&&this.addContatInputValueToList(),e.off("keydown",t),e.off("blur",n),e.removeClass("focus")}.bind(this);e.on("blur",n)},focusInputContent:function(){var e=this.$(".input-content");if(e.hasClass("focus"))return;var t=N(function(){this.contentCount=this.$(".input-content").val().length}.bind(this),100),n=function(){T(t),e.off("blur",n).removeClass("focus")}.bind(this);e.on("blur",n).addClass("focus")},clickButtonAddContact:function(){D.show()},setContent:function(e){this.$(".input-content").val(e),this.contentCount=e.length},events:{"click .address":"clickAddress","click .button-add-contact":"clickButtonAddContact","focus .input-content":"focusInputContent"}}),j=p.extend({initialize:function(){j.__super__.initialize.call(this,arguments);var e,t="";Object.defineProperties(this,{serviceCenter:{set:function(t){e=t},get:function(){return e}},sendFrom:{set:function(e){t=e},get:function(){return t}}});var n=s("<button>").html(o.message.SEND).addClass("button-send primary");u.on("change:isConnected",function(e){n.prop({disabled:!e.get("isConnected")})}),this.buttons=[{$button:n,eventName:"button_send"},{$button:s("<button>").html(o.message.CANCEL),eventName:C.BUTTON_CANCEL}],this.buildButton(),this.on(C.SHOW,function(){_=new B,this.$bodyContent=_.render().$el,this.center()},this),D=w.getInstance(),D.on(C.BUTTON_YES,function(){var e=D.getSelectedContacts();_.addContact(e)},this)},addReceivers:function(e){if(e instanceof Array&&e.length>0)e=r.map(e,function(e){if(e.defaultNumber)return new n.Model({displayTitle:e.get("displayName"),title:e.get("displayName"),displayNumber:e.defaultNumber,phoneNumber:e.defaultNumber})}),_.addContact(r.compact(e));else{var t=new n.Model({displayNumber:e,phoneNumber:e});_.addContact(t)}P.length>0&&_.$(".input-content").focus()},setContent:function(e){e=e.replace(/<em>|<\/em>/gi,""),_.setContent(e),P.length===0&&_.$(".input-contact").focus()},setSource:function(e){this.sendFrom=e},buildButton:function(){g.getServiceCenterAsync().done(function(e){var t=e.body.value||[];if(t.length>0){this.buttons.shift();var n=s("<button>").html(o.message.SEND_WITH_SIM1).addClass("button-send-sim1 primary"),r=s("<button>").html(o.message.SEND_WITH_SIM2).addClass("button-send-sim2 primary");this.buttons.unshift({$button:r,eventName:"button_send_sim_2"}),this.buttons.unshift({$button:n,eventName:"button_send_sim_1"}),u.on("change:isConnected",function(e){n.prop({disabled:!e.get("isConnected")}),r.prop({disabled:!e.get("isConnected")})}),this.on("button_send_sim_1",function(){this.serviceCenter=null,this.sendMessage()},this),this.on("button_send_sim_2",function(){this.serviceCenter=t[0],this.sendMessage()},this),this.buttons=this.buttons}}.bind(this))},render:function(){r.extend(this.events,j.__super__.events),this.delegateEvents(),j.__super__.render.apply(this,arguments)},disabled:function(e){e=e===t?!0:e;var n=this.$(".input-content"),r=this.$(".button-send, .button-send-sim1, .button-send-sim2");n.prop({disabled:e}),r.prop({disabled:e})},sendMessage:function(){var e=this.$(".input-content"),t=e.val();if(t.length===0)e.prop({placeholder:o.message.PLEASE_INPUT_CONTENT}),e.focus();else if(P.length===0)_.$(".input-contact").focus();else{var n=function(){this.disabled(),g.sendMessageAsync(P,t,this.serviceCenter,this.sendFrom).always(function(){this.disabled(!1),this.close()}.bind(this)).fail(function(e){if(e.state_code===740){var t=new d({title:o.message.BATCH_SEND_TITLE,$bodyContent:o.message.BATCH_SEND_TOO_MANY_TIP,buttonSet:"yes",width:360});t.show()}})};t.length>=350?x(o.message.MESSAGE_TOO_LONG,n,this):n.call(this)}},clickButtonSend:function(){this.sendMessage()},clickButtonAddPlaceholder:function(){_.addPlaceholder()},keydownInputContent:function(e){e.ctrlKey&&e.keyCode===k.ENTER&&this.sendMessage()},events:{"click .button-send":"clickButtonSend","click .button-add-placeholder":"clickButtonAddPlaceholder","keydown .input-content":"keydownInputContent"}}),F,I=r.extend(function(){},{getInstance:function(){return F||(F=new j({draggable:!0,title:o.message.SEND_MESSAGE,width:480})),F},getClass:function(){return j}});return I})}(this),function(e,t){define("message/views/ConversationItemView",["underscore","doT","ui/TemplateFactory","ui/BaseListItem","utilities/StringUtil","Configuration","Environment"],function(e,t,n,r,i,s,o){console.log("ConversationItemView - File loaded.");var u=r.extend({className:"w-message-conversation-list-item hbox",template:t.template(n.get("message","conversation-list-item")),render:function(){return this.$el.html(this.template(this.model.toJSON())),this}}),a=e.extend({getInstance:function(e){return new u(e)},getClass:function(){return u}});return a})}(this),function(e,t){define("message/views/ExportSelectView",["backbone","doT","jquery","underscore","Device","Internationalization","IO","Configuration","ui/Panel","ui/TemplateFactory","ui/UIHelper"],function(e,t,n,r,i,s,o,u,a,f,l){console.log("File ExportSelectView - File loaded");var c=e.View.extend({template:t.template(f.get("message","export-select")),className:"w-message-export-select-body-ctn",initialize:function(){c.__super__.initialize.call(this,arguments)},render:function(){return this.$el.html(this.template({})),this},update:function(e,t,n){this.$(".cover-count").text(" "+e+" "),this.$(".sms-count").text(t+" "),this.$('input[value="2"] + .count').text("("+n+")"),t===0?(this.$('input[name="sms_export"][value="1"]').prop("disabled",!0),this.$('input[name="sms_export"][value="2"]').attr({checked:!0})):this.$('input[name="sms_export"][value="1"]').prop("disabled",!1).attr({checked:!0})}}),h,p=a.extend({initialize:function(){p.__super__.initialize.call(this,arguments),this.on(l.EventsMapping.SHOW,function(){var e=new c;this.$bodyContent=e.render().$el,this.update=function(t,n,r){this.typeCount.coversation=parseInt(t,10),this.typeCount.all=parseInt(r,10),e.update(t,n,r)},this.once("remove",function(){e.remove(),delete this.update},this),this.$el.delegate("label","click",this.switchTypeState.bind(this))}),this.listenTo(i,"change:isConnected",function(e,t){this.setNextBtnDisable(!t)}),this.buttons=[{$button:n("<button>").html(s.ui.NEXT).addClass("button-next primary"),eventName:"button-next"},{$button:n("<button>").html(s.ui.CANCEL).addClass("button-cancel"),eventName:"button-cancel"}]},typeCount:{coversation:0,all:0},ExportTypes:{CONVERSATION:1,ALL:2},switchTypeState:function(){var e=this.$('input[name="sms_export"]:checked').val();parseInt(e,10)===this.ExportTypes.CONVERSATION?this.setNextBtnDisable(this.typeCount.coversation<=0):parseInt(e,10)===this.ExportTypes.ALL&&this.setNextBtnDisable(this.typeCount.all<=0)},setNextBtnDisable:function(e){this.$(".button-next").prop("disabled",e)},clickNextBtn:function(){this.trigger("_NEXT_BTN",this.ExportTypes)},clickCancelBtn:function(){this.remove(),this.trigger("_CANCEL_BTN")},events:{"click .button-next":"clickNextBtn","click .button-cancel":"clickCancelBtn"}}),d={getInstance:function(){return h||(h=new p({title:s.message.EXPORT_MESSAGE,width:400,disableX:!0})),h}};return d})}(this),function(e,t){define("message/models/ExportContextModel",["backbone","doT","jquery","underscore"],function(e,t,n,r){console.log("Message ExportContextModel - File Loaded");var i=e.Model.extend({defaults:{ids:[]}}),s=new i;return s})}(this),function(e,t){define("message/views/ExportProgressView",["backbone","doT","jquery","underscore","IO","Device","Internationalization","Configuration","WindowController","ui/Panel","ui/AlertWindow","ui/TemplateFactory","ui/UIHelper","message/collections/ConversationsCollection","message/models/ExportContextModel"],function(t,n,r,i,s,o,u,a,f,l,c,h,p,d,v){console.log("ExportProgressView - file loader");var m=e.alert,g=d.getInstance(),y=t.View.extend({template:n.template(h.get("message","export-progress")),className:"w-message-export-progress-body",render:function(){return this.$el.html(this.template({})),this},setProgress:function(e,t){var n=e+" / "+t;this.$(".progress-num").text(n),e===t&&(this.$(".progress-desc").text(u.message.EXPORT_SMS_FINISH),this.$("progress").removeClass("running")),this.$("progress").attr({max:t,value:e})}}),b,w=l.extend({initialize:function(){w.__super__.initialize.call(this,arguments);var e="";Object.defineProperties(this,{export_dir:{get:function(){return e},set:function(t){e=t}}}),this.on(p.EventsMapping.SHOW,function(){var e=new y;this.$bodyContent=e.render().$el,this.setProgress=e.setProgress;var t=r("<button>").html(u.misc.OPEN_EXPORT_FILE).addClass("button-checkFile").hide();this.$(".w-ui-window-footer-monitor").append(t),this.once("remove",function(){e.remove(),t.remove(),delete this.setProgress}),this.center()}),this.buttons=[{$button:r("<button>").html(u.ui.FINISH).addClass("button-finish primary").hide(),eventName:"button-finish"},{$button:r("<button>").html(u.ui.CANCEL).addClass("button-cancel"),eventName:"button-cancel"}]},render:function(){i.extend(this.events,w.__super__.events),this.delegateEvents(),w.__super__.render.apply(this,arguments)},exportConversations:function(e){var t=i.uniqueId("Export_sms");this.lastSessionId=t;var n=s.Backend.Device.onmessage({"data.channel":t},function(e){this.setProgress(e.current,e.total),e.current===e.total&&(s.Backend.Device.offmessage(n),g.syncAsync(),this.$(".button-finish").show(),this.$(".button-cancel").hide(),this.$(".button-checkFile").show())}.bind(this)),r=function(e){f.releaseWindowAsync();if(e.state_code===200)this.export_dir=e.body.value;else{this.trigger("_EXPORT_SMS_CANCEL",e),this.remove();switch(e.state_code){case 402:s.Backend.Device.offmessage(n);break;case 500:m(u.misc.CONNECTION_LOSE);break;default:m(u.message.EXPORT_FAILED)}}}.bind(this);f.blockWindowAsync(),e===2?g.exportConversationAsync(i.pluck(g.models,"id"),t).always(r):g.exportConversationAsync(v.get("ids"),t).always(r)},clickFinishBtn:function(){this.remove()},clickCancelBtn:function(){this.remove(),s.requestAsync({url:a.actions.SMS_CANCEL,data:{session:this.lastSessionId}}).done(function(e){m(u.common.CANCEL_EXPORT_TEXT),g.syncAsync()}).always(function(){f.releaseWindowAsync()})},clickCheckFileBtn:function(){s.requestAsync({url:a.actions.SHOW_FILE,data:{file_path:this.export_dir}}),this.remove()},events:{"click .button-finish":"clickFinishBtn","click .button-cancel":"clickCancelBtn","click .button-checkFile":"clickCheckFileBtn"},initState:function(){this.$(".button-finish").hide(),this.$(".button-cancel").show(),this.$(".button-checkFile").hide()}}),E={getInstance:function(){return b||(b=new w({title:u.message.EXPORT_MESSAGE,width:400,disableX:!0})),b}};return E})}(this),function(e,t){define("message/ExportController",["backbone","doT","jquery","underscore","message/views/ExportSelectView","message/views/ExportProgressView","Internationalization"],function(e,t,n,r,i,s,o){console.log("Messgae ExportController - File loaded");var u,a,f,l=e.View.extend({start:function(e,t,n){a=i.getInstance(),f=s.getInstance(),a.show(),a.update(e,t,n),f.initState(),this.buildEvents()},buildEvents:function(){a.off("_NEXT_BTN"),f.off("_EXPORT_SMS_CANCEL"),a.on("_NEXT_BTN",function(e){this.showNextAndRemoveCurrent(a,f),f.exportConversations(e)},this),f.on("_EXPORT_SMS_CANCEL",function(){this.showNextAndRemoveCurrent(f,a)},this)},showNextAndRemoveCurrent:function(e,t){var n=function(){t.show(),e.off("hide",n)};e.on("hide",n,this),e.remove()}});return u=new l,u})}(this),function(e,t){define("message/views/ConversationContextMenu",["underscore","jquery","ui/Menu","ui/behavior/ClickToHideMixin","ui/AlertWindow","Internationalization","Device","Log","message/collections/ConversationsCollection","message/MessageService","message/ExportController","message/models/ExportContextModel"],function(t,n,r,i,s,o,u,a,f,l,c,h){console.log("ConversationContextMenu - File loaded. ");var p=e.alert,d,v=function(e){var t=0,n,r=e.length;for(n=0;n<r;n++){t+=d.get(e[n]).get("unread_number");if(t)break}return t},m=r.extend({initialize:function(){m.__super__.initialize.apply(this,arguments),i.mixin(this),d=f.getInstance(),this.addItems(),this.on("select",function(e){switch(e.value){case"delete":this.deleteConversations();break;case"markAsRead":this.markAsReadConversations();break;case"export":this.exportConversations()}},this)},deleteConversations:function(){l.deleteConversationAsync(this.options.selected),a({event:"ui.click.message.button.delete.contextmenu",count:this.options.selected.length})},markAsReadConversations:function(){l.markAsReadAsync(this.options.selected),a({event:"ui.click.message.button.markasread.contextmenu",count:this.options.selected.length})},exportConversations:function(){var e=this.options.selected,n=0,r=0;h.set("ids",e),t.each(e,function(e){var t=d.get(e);t&&(n+=t.get("total_number"),r+=t.get("mms_number"))}),r>0?p(o.message.ALERT_TIP_EXPORT_MMS,function(){c.start(e.length,n-r,d.totalCount)}):c.start(e.length,n-r,d.totalCount),a({event:"ui.click.message.button.export.contextmenu",count:this.options.selected.length})},addItems:function(){var e=this.options.selected;this.items=[{type:"normal",name:"delete",value:"delete",label:o.misc.DELETE,disabled:e.length===0||!u.get("isConnected")},{type:"normal",name:"markAsRead",value:"markAsRead",label:o.message.MARK_AS_READ,disabled:v(e)===0||!u.get("isConnected")},{type:"hr"},{type:"normal",name:"export",value:"export",label:o.misc.EXPORT,disabled:!1}]}}),g,y=t.extend({getInstance:function(e){return g?(g.options.selected=e.selected,g.addItems(),g.render()):g=new m(e),g}});return y})}(this),function(e,t){define("message/collections/MessageCollection",["backbone","underscore","message/collections/ConversationsCollection","message/models/MessageModel"],function(e,n,r,i){console.log("MessageCollection - File loaded.");var s=e.Collection.extend({model:i,initialize:function(){Object.defineProperties(this,{unreadCount:{get:function(){return this.filter(function(e){return!e.isRead}).length}}}),this.on("add",function(e){e.collection!==t&&e.on("change:read change:type",function(e){r.getInstance().updateConversationAsync(e)},e),e.on("remove",function(){this.off()},e)}),this.on("remove",function(e){this.length===0&&this.trigger("empty")},this)}}),o=n.extend(function(){},{getInstance:function(e){return new s(e)}});return o})}(this),function(e,t){define("ui/ToastBox",["jquery","underscore","backbone","ui/WindowState","ui/MouseState","ui/EventsMapping"],function(t,n,r,i,s,o){console.log("ToastBox - File loaded. ");var u=e.setTimeout,a=e.setInterval,f=e.clearInterval,l=r.View.extend({className:"w-ui-toast-box w-layout-hide",initialize:function(){var e;Object.defineProperties(this,{$content:{set:function(n){typeof n=="object"?e=n:e=t("<div>").html(n)},get:function(){return e}}});var n=this.options||{},r;for(r in n)n.hasOwnProperty(r)&&this.hasOwnProperty(r)&&(this[r]=n[r])},render:function(){this.$el.append(this.$content),t("body").append(this.$el)},show:function(){this.render(),this.center(),this.countDown(),this.listenTo(i,"resize",this.center)},center:function(){var e=this.$el[0].offsetWidth,t=i.scrollLeft+Math.max(0,(i.width-e)/2);t=Math.max(Math.min(t,i.width-this.$el[0].offsetWidth),0),this.$el.offset({left:t}),this.$el.removeClass("w-layout-hide")},countDown:function(){u(function(){if(!this.$el[0].contains(s.currentElement))this.remove();else var e=a(function(){this.$el[0].contains(s.currentElement)||(this.remove(),f(e))}.bind(this),50)}.bind(this),5e3)},remove:function(){if(!this.$el.hasClass("w-layout-hide")){this.$el.addClass("w-layout-hide");var e=function(){l.__super__.remove.call(this),this.trigger(o.REMOVE)}.bind(this);this.$el.one("webkitTransitionEnd",e)}}});return l})}(this),function(e,t){define("message/views/ThreadsMessageItemView",["backbone","underscore","doT","jquery","Device","ui/TemplateFactory","ui/AlertWindow","ui/ToastBox","Internationalization","Configuration","message/views/MessageSenderView"],function(n,r,i,s,o,u,a,f,l,c,h){console.log("ThreadsMessageItemView - File loaded.");var p=e.alert,d=function(){this.$el[0].scrollIntoView()},v=function(e,t){this.$("button, .button-open-on-device").prop("disabled",!t)},m=function(e){this.$el.toggleClass("text-bold",!e.isRead)},g,y=n.View.extend({tagName:"li",template:i.template(u.get("message","threads-item-message")),className:"hbox",initialize:function(){this.listenTo(this.model,"change:read",m),this.listenTo(this.model,"change:type change:body",this.render),this.listenTo(this.model,"remove",this.remove),this.listenTo(this.model,"scrollTo",d),this.listenTo(o,"change:isConnected",v),this.$el.toggleClass("from-me",this.model.get("type")!==c.enums.SMS_TYPE_RECEIVE).toggleClass("text-bold",!this.model.isRead)},render:function(){return this.$el.html(this.template(this.model.toJSON())),v.call(this,o,o.get("isConnected")),this.model.isRead||setTimeout(function(){this.model.markAsReadAsync()}.bind(this),3e3),this},clickItem:function(){this.model.isRead||this.model.markAsReadAsync()},clickButtonCopy:function(){this.model.copyMessageAsync().done(function(){g||(g=new f({$content:l.message.COPY_SMS})),g.once("remove",function(){g=t}),g.show()})},clickButtonDelete:function(){this.model.deleteMessageAsync().done(this.remove.bind(this)).fail(function(){p(l.message.DELETE_FAILD)})},clickButtonForward:function(){var e=h.getInstance(),t=function(){e.setContent(this.model.get("body"))};e.once("show",t,this),e.show()},clickButtonResend:function(){this.model.resendAsync()},clickButtonOpenOnDevice:function(){this.model.openOnDeviceAsync()},clickButtonToggle:function(){var e=this.$(".mms-content"),t=this.$(".button-toggle");e.hasClass("wc")?(e.removeClass("wc"),t.html(l.message.FOLD)):(e.addClass("wc"),t.html(l.message.EXPEND)),this.$el[0].scrollIntoView()},events:{click:"clickItem","click .button-delete":"clickButtonDelete","click .button-reply":"clickButtonForward","click .button-resend":"clickButtonResend","click .button-open-on-device":"clickButtonOpenOnDevice","click .button-toggle":"clickButtonToggle","click .button-copy":"clickButtonCopy"}}),b=r.extend({getInstance:function(e){return new y(e)}});return b})}(this),function(e,t,n){define("message/views/ThreadsItemView",["backbone","underscore","doT","jquery","Configuration","Device","Log","ui/TemplateFactory","utilities/StringUtil","IO","message/collections/ConversationsCollection","message/collections/MessageCollection","message/views/ThreadsMessageItemView","contact/collections/ContactsCollection","Internationalization"],function(e,n,r,i,s,o,u,a,f,l,c,h,p,d,v){console.log("ThreadsItemView - File loaded.");var m={MESSAGE_CTN:".w-message-item-ctn"},g=function(t){e.trigger("updateConversation",t)},y=e.View.extend({template:r.template(a.get("message","threads-item")),tagName:"li",className:"w-message-thread",initialize:function(){var e=[];Object.defineProperties(this,{subViews:{get:function(){return e}}}),this.collection=h.getInstance().set(this.model.get("sms")),this.listenTo(this.collection,"empty",this.remove),this.listenTo(this.collection,"remove",g)},render:function(){this.$el.html(this.template(this.model.toJSON()));var e=this.$(m.MESSAGE_CTN),r=t.createDocumentFragment(),i;return n.each(this.collection.models,function(e){i=p.getInstance({model:e}),r.appendChild(i.render().$el[0]),this.subViews.push(i)},this),e.append(r),this},smartDate:function(e){var t=e*24*60*60*1e3,n=new Date(t),r=new Date,i=new Date(r.getDate())-new Date(n.getDate());if(n.getFullYear()!==r.getFullYear()||n.getMonth()!==r.getMonth()){var s=r.getFullYear()-n.getFullYear(),o;return s>0?o=f.formatDate("yyyy 年 MM 月 dd 日",t):o=f.formatDate("MM 月 dd 日",t),o}switch(i){case 0:return f.formatDate("今天 MM 月 dd 日",t);case 1:return f.formatDate("昨天 MM 月 dd 日",t);case 2:return f.formatDate("前天 MM 月 dd 日",t);default:return f.formatDate("MM 月 dd 日",t)}},highlightSearch:function(e){var t=this.collection.get(e.id);t.set({body:f.conditionalEscape(t.get("body").replace(new RegExp(e.keyword),function(e){return"<em>"+e+"</em>"}),"em")})},scrollTo:function(e){var t=this.collection.get(e.id);t.trigger("scrollTo")},showPreviousButton:function(){this.$el.prepend('<div class="button-previous link">'+v.message.LOAD_MORE+"</div>")},showNextButton:function(){this.$el.append('<div class="button-next link">'+v.message.LOAD_MORE+"</div>")},remove:function(){this.collection&&(this.$el.hide(),n.each(this.subViews,function(e){e.remove()}),delete this.collection),y.__super__.remove.call(this)}}),b=n.extend({getInstance:function(e){return new y(e)}});return b})}(this,this.document),function(e,t){define("message/views/ThreadsHeaderView",["backbone","underscore","doT","Configuration","Internationalization","Log","IO","ui/TemplateFactory","ui/AlertWindow","Device","message/collections/ThreadsCollection","contact/collections/ContactsCollection"],function(e,t,n,r,i,s,o,u,a,f,l,c){console.log("ThreadsHeaderView - File loaded.");var h=e.View.extend({template:n.template(u.get("message","threads-header")),className:"nameplate-top hbox",initialize:function(){this.listenTo(f,"change:isConnected",function(e,t){this.setDisabled(!t)}),this.listenTo(this.model,"change",this.render)},setDisabled:function(e){this.$("button.button-addToContact, button.button-resend-all")[e?"hide":"show"](),this.$("span.button-addToContact").prop("disabled",e)},render:function(){return this.$el.html(this.template(this.model.toJSON())),this.setDisabled(!f.get("isConnected")),this},clickButtonAddToContact:function(){f.get("isConnected")&&(o.requestAsync({url:r.actions.PUBLISH_EVENT,data:{channel:r.events.WEB_NAVIGATE,value:JSON.stringify({id:c.getInstance().generateNewContact().set({phone:[{id:"",type:2,number:this.model.get("phoneNumber")}]}).toJSON(),type:r.enums.NAVIGATE_TYPE_CONTACT_CREATE})}}),s({event:"ui.click.contact.button.add",source:"sms"}))},clickButtonNavigateToContact:function(){o.requestAsync({url:r.actions.PUBLISH_EVENT,data:{channel:r.events.WEB_NAVIGATE,value:JSON.stringify({id:this.model.get("contactId"),type:r.enums.NAVIGATE_TYPE_CONTACT})}})},clickButtonResendAll:function(){l.getInstance().resendAllAsync().fail(function(e){if(e.state_code===740){var t=new a({title:i.message.BATCH_SEND_TITLE,$bodyContent:i.message.BATCH_SEND_TOO_MANY_TIP,buttonSet:"yes",width:360});t.show()}})},events:{"click .button-resend-all":"clickButtonResendAll","click .button-addToContact":"clickButtonAddToContact","click .button-navigateToContact":"clickButtonNavigateToContact"}}),p=t.extend({getInstance:function(e){return new h(e)}});return p})}(this),function(e,t){define("message/views/QuickSenderView",["backbone","underscore","IO","Internationalization","Device","ui/TemplateFactory","ui/UIHelper","ui/AlertWindow","message/MessageService"],function(n,r,i,s,o,u,a,f,l){console.log("QuickSenderView - File loaded. ");var c=e.confirm,h=a.KeyMapping,p=n.View.extend({initialize:function(){var e=!0;Object.defineProperties(this,{enableTip:{set:function(t){e=t},get:function(){return e}}}),this.listenTo(o,"change:isConnected",function(e,t){this.disabled(!t)}),this.options.hasOwnProperty("enableTip")&&(e=this.options.enableTip)},disabled:function(e){e=e===t?!0:e,this.$(".input-content, .button-send").prop({disabled:e})},sendMessage:function(){var e=this.$(".input-content");if(!e.prop("disabled")){var t=e.val();if(t.length===0)e.prop({placeholder:s.message.PLEASE_INPUT_CONTENT});else{var n=function(){this.disabled(),l.sendMessageAsync(this.addresses,t).done(function(){this.trigger("sendSuccess")}.bind(this)).always(function(){this.disabled(!1),e.prop({placeholder:""}).val("")}.bind(this))};this.enableTip?t.length>=350?c(s.message.MESSAGE_TOO_LONG,n,this):n.call(this):n.call(this)}}},clickButtonSend:function(){this.sendMessage()},keydownInputContent:function(e){e.ctrlKey&&e.keyCode===h.ENTER&&this.sendMessage(),e.keyCode===h.ESC&&this.$(".input-content").blur()},events:{"click .button-send":"clickButtonSend","keydown .input-content":"keydownInputContent"}}),d=r.extend(function(){},{getInstance:function(e){return new p(e)},getClass:function(){return p}});return d})}(this),function(e,t){define("message/views/MessageSender4ThreadsPanelView",["doT","underscore","Device","utilities/StringUtil","ui/TemplateFactory","ui/MenuButton","ui/MouseState","Internationalization","message/views/QuickSenderView"],function(t,n,r,i,s,o,u,a,f){console.log("MessageSender4ThreadsPanelView - File loaded.");var l=e.setInterval,c=e.clearInterval,h=e.setTimeout,p=function(){var e=400,t=this.$(".input-content"),n=t.height();e>n&&(n=Math.max(t[0].scrollHeight-4,n),n=Math.min(e,n),t.css({height:n})),this.$(".count-down").html(i.format(a.message.CONTENT_COUNT2,t.val().length))},d=function(e){this.addresses=e.defaultNumber;var t=e.get("phone");if(t.length>1){var r=n.map(e.get("phone"),function(t){return{type:"radio",name:e.get("id"),label:t.number,checked:this.addresses===t.number,value:t.number}},this);this.numberSelectorView?(this.numberSelectorView.items=r,this.numberSelectorView.label=this.addresses):(this.numberSelectorView=new o({label:this.addresses,items:r}),this.numberSelectorView.on("select",function(e){this.numberSelectorView.label=e.label,this.addresses=e.value},this),this.$(".number-selector").append(this.numberSelectorView.render().$el)),this.$(".selector-ctn").css({display:"-webkit-box"})}else this.$(".selector-ctn").css({display:"none"})},v=function(e){e=e.split("-"),e.shift();var t=e,r=i.formatDate("yyyy-MM-dd").split("-");r.shift();var s=r;return n.isEqual(t,s)},m=function(e,t){t?(this.addresses=t,this.$(".selector-ctn").hide()):e.get("id")!=="-1"?d.call(this,e):(this.addresses=e.defaultNumber,this.$(".selector-ctn").hide()),this.model.birthday&&v.call(this,this.model.birthday)?this.$(".input-content").prop({placeholder:a.message.BIRTHDAY_TIP}):this.$(".input-content").prop({placeholder:a.message.SENDER_PLACEHOLDER})},g=f.getClass().extend({template:t.template(s.get("message","message-sender-threads-panel")),className:"w-message-quick-sender vbox",initialize:function(){g.__super__.initialize.apply(this,arguments);var e,t=!0,n=!1;Object.defineProperties(this,{addresses:{set:function(t){e=t},get:function(){return e}},hideNumberSelector:{set:function(e){t=e},get:function(){return t}},isFocused:{set:function(e){n=Boolean(e)},get:function(){return n}}}),this.on("sendSuccess",function(){this.$(".input-content").focus()},this),r.on("change:isConnected",function(e,t){this.disabledSender(!t)},this)},disabledSender:function(e){this.$el.toggle(!e)},update:function(e,t){n.isEqual(e.toJSON(),this.model.toJSON())||(this.model=e.clone(),this.$(".input-content").val(""),m.call(this,e,t)),h(function(){this.$(".input-content").focus()}.bind(this),150)},render:function(){return n.extend(this.events,g.__super__.events),this.delegateEvents(),this.$el.html(this.template({})),this.$(".count-down").hide(),h(function(){this.disabledSender(!r.get("isConnected"))}.bind(this),0),m.call(this,this.model,this.options.defaultNumber),this},focusInputContent:function(){if(this.isFocused)return;this.isFocused=!0;var e=this.$(".input-content"),t=this.$(".count-down"),n=l(function(){e.val().length!==0&&(t.show(),e.css("min-height","38px"),c(n))}.bind(this),25),r=l(function(){p.call(this)}.bind(this),25),i=function(){e.css("min-height","20px"),e.css("height","20px"),t.hide(),c(r),c(n),this.$(".button-send")[0].contains(u.currentElement)&&this.sendMessage(),this.isFocused=!1}.bind(this);e.one("blur",i)},events:{"focus .input-content":"focusInputContent"}}),y=n.extend({getInstance:function(e){return new g(e)}});return y})}(this),function(e,t,n){define("message/views/ThreadsPanelView",["backbone","underscore","doT","jquery","Configuration","Internationalization","Device","ui/TemplateFactory","contact/models/ContactModel","contact/collections/ContactsCollection","message/collections/ThreadsCollection","message/collections/Threads4ContactCollection","message/collections/ConversationsCollection","message/views/ThreadsItemView","message/views/ThreadsHeaderView","message/views/MessageSender4ThreadsPanelView"],function(r,i,s,o,u,a,f,l,c,h,p,d,v,m,g,y){console.log("ThreadsPanelView - File loaded. ");var b=e.setTimeout,w={THREADS_LIST_CTN:".w-message-threads-list-ctn"},E=r.Model.extend({}),S,x,T=20,N=function(e){var t={};if(e.isBatch){var n=i.pluck(e.toJSON(),"phone_number");t={isBatch:!0,contactId:-1,contactIcon:u.enums.CONTACT_DEFAULT_ICON,contactName:e.toJSON(),phoneNumber:n,failedCount:e.failedCount}}else{var r=e.models[0];t={isBatch:!1,contactId:r.get("contact_id"),contactIcon:r.get("contact_icon")?"file:///"+r.get("contact_icon"):u.enums.CONTACT_DEFAULT_ICON,contactName:r.get("contact_name")||r.get("phone_number")||a.contact.UNNAMED_CONTACT,phoneNumber:r.get("phone_number"),failedCount:0}}S?S.model.clear({silent:!0}).set(t):(S=g.getInstance({model:new E(t)}),this.$el.prepend(S.render().$el))},C=function(e){var t=function(t){x?e.isBatch?x.$el.hide():(x.update(t,e.defaultNumber),f.get("isConnected")&&x.$el.show()):e.isBatch||(x=y.getInstance({model:t,defaultNumber:e.defaultNumber}),this.$el.append(x.render().$el))},n=e.models[0],r,i=h.getInstance();n.get("contact_id")!=="-1"?i.loading?i.once("refresh",function(e){r=e.get(n.get("contact_id")),t.call(this,r)},this):(r=i.get(n.get("contact_id")),t.call(this,r)):(r=new c({id:"-1",phone:[{number:n.get("phone_number"),address:n.get("address")}]}),t.call(this,r))},k=r.View.extend({template:s.template(l.get("message","threads-panel")),className:"w-message-threads-ctn vbox",initialize:function(){var e=[],t=[],n={},i=[];Object.defineProperties(this,{modelPool:{set:function(t){t instanceof Array?e=t:console.error("ThreadsPanelView - Paramater type error.")},get:function(){return e}},modelSlibingNextPool:{set:function(e){e instanceof Array?t=e:console.error("ThreadsPanelView - Paramater type error.")},get:function(){return t}},searchMsg:{set:function(e){n=e},get:function(){return n}},subViews:{get:function(){return i}}}),r.on("updateConversation",function(e){v.getInstance().updateConversationAsync(e),d.getInstance().getThreadWithMessage(e.get("id"))&&d.getInstance().trigger("update")}),this.collection.on("refresh",function(e){e.length>0&&(C.call(this,e),N.call(this,e)),this.$el.toggleClass("batch",e.isBatch),this.buildList()},this),this.collection.on("empty",this.restore,this)},render:function(){return this.$el.html(this.template({})),this},update:function(e,t){return this.searchMsg=t,this.collection.data.filter===e?t?this.collection.loading||this.buildList():this.trigger("rendered"):(this.collection.data.filter=e,this.collection.trigger("update")),this},buildList:function(){i.each(this.subViews,function(e){e.remove()}),this.subViews.length=0;var e=this.collection.models.concat(),n=[],r=[],s=0,o=0,u,a,f,l=this.$(w.THREADS_LIST_CTN);if(this.searchMsg&&this.searchMsg.hasOwnProperty("id")){u=t.createDocumentFragment();var c=this.collection.getThreadWithMessage(this.searchMsg.id),h=m.getInstance({model:c});u.appendChild(h.render().$el[0]),this.subViews.push(h),i.each(e.slice(e.indexOf(c)+1,e.length),function(e){n.push(e)}),i.each(e.slice(0,e.indexOf(c)),function(e){r.push(e)});while(n.length>0){a=n.shift(),f=m.getInstance({model:a}),u.insertBefore(f.render().$el[0],u.firstChild),this.subViews.push(f),o+=a.get("sms").length;if(o>T){n.length>0&&f.showPreviousButton();break}}o=0;while(r.length>0){a=r.pop(),f=m.getInstance({model:a}),u.appendChild(f.render().$el[0]),this.subViews.push(f),o+=a.get("sms").length;if(o>T){r.length>0&&f.showNextButton();break}}l.append(u),h.highlightSearch(this.searchMsg),h.scrollTo(this.searchMsg),this.searchMsg={}}else{n=e,u=t.createDocumentFragment();while(n.length>0){a=n.shift(),f=m.getInstance({model:a}),u.insertBefore(f.render().$el[0],u.firstChild),this.subViews.push(f),o+=a.get("sms").length;if(o>=T){n.length>0&&f.showPreviousButton();break}}l.append(u);var p=l.find("li:last-child > ul > li:last-child")[0];p&&b(function(){p.scrollIntoView()},0)}this.modelPool=n,this.modelSlibingNextPool=r,this.trigger("rendered")},onMouseWheel:function(e){this.supplementItem(e.originalEvent.wheelDelta>0)},supplementItem:function(e){var r=this[e?"modelPool":"modelSlibingNextPool"],i=this.$(w.THREADS_LIST_CTN),s=i[0].scrollTop,o=i[0].scrollHeight,u=0,a,f=t.createDocumentFragment();for(a=r.length;a--;n){var l=r[e?"shift":"pop"](),c=m.getInstance({model:l});f[e?"insertBefore":"appendChild"](c.render().$el[0],f[e?"firstChild":"lastChild"]),this.subViews.push(c),u+=l.get("sms").length;if(u>T)break}i[e?"prepend":"append"](f);var h=i[0].scrollHeight,p=h-o;return p!==0&&(i[0].scrollTop=s+p),r.length>0},restore:function(){this.collection.reset([],{silent:!0})},clickButtonPrevious:function(e){o(e.target).remove();if(this.supplementItem(!0))var t=setInterval(function(){this.supplementItem(!0)||clearInterval(t)}.bind(this),300)},clickButtonNext:function(e){o(e.target).remove();if(this.supplementItem(!1))var t=setInterval(function(){this.supplementItem(!1)||clearInterval(t)}.bind(this),300)},events:{"click .button-previous":"clickButtonPrevious","click .button-next":"clickButtonNext"}}),L,A=i.extend({getInstance:function(){return L||(L=new k({collection:p.getInstance()})),L},getClass:function(){return k}});return A})}(this,this.document),function(e,t,n){define("message/views/ConversationsListView",["backbone","underscore","doT","jquery","Configuration","Internationalization","IO","Device","ui/TemplateFactory","ui/UIHelper","ui/SmartList","utilities/StringUtil","utilities/FormatDate","message/MessageService","message/collections/ConversationsCollection","message/collections/ThreadsCollection","message/collections/Threads4ContactCollection","message/views/ConversationItemView","message/views/ConversationContextMenu","message/views/ThreadsPanelView"],function(e,t,r,i,s,o,u,a,f,l,c,h,p,d,v,m,g,y,b,w){console.log("ConversationsListView - File loaded");var E=l.EventsMapping,S,x,T=e.View.extend({template:r.template(f.get("message","conversation-list-ctn")),className:"w-message-conversation-list vbox",initialize:function(){var e=!1;Object.defineProperties(this,{selected:{get:function(){return x?x.selected:[]}},unreadMessageInSelected:{get:function(){var e=0,t=this.selected,r,i=t.length,s;for(r=0;r<i;r++){s=S.get(t[r]);if(s!==n){e+=s.get("unread_number");if(e)break}}return e}},rendered:{set:function(t){e=t},get:function(){return e}},list:{get:function(){return x}}}),this.bindConversationsCollectionEvents()},bindConversationsCollectionEvents:function(){S=v.getInstance(),S.on("syncStart update syncEnd refresh",function(){x!==n&&(x.loading=S.loading||S.syncing)}),S.on("refresh",function(e){this.updateHeader();var n=x.selected.concat();x.switchSet("default",e.getAll),t.isEqual(n,x.selected)||this.trigger("select:change",x.selected)},this)},highlightSearchAsync:function(e){var t=i.Deferred(),n=function(n){u.requestAsync({url:s.actions.SMS_GET_CONVERSATION,data:{type:s.enums.SMS_CONVERSATION_TYPE_SPECIFY_SMS_ID,filter:e.id},success:function(r){if(r.state_code===200){console.log('ConversationsListView - Get conversion by specify SMS ID = "'+e.id+'" success.');var i=n.get(r.body.conversation[0].conversation_id);x.deselectAll({silent:!0}),x.addSelect(i.id),x.scrollTo(i),w.getInstance().update(i.get("id"),e),t.resolve(r)}else console.error('ConversationsListView - Get conversion by specify SMS ID = "'+e.id+'" failed. Error info: '+r.state_line),t.reject(r)}})};return S.loading?S.once("refresh",n):n(S),t.promise()},toggleEmptyTip:function(){if(S.loading||S.syncing||a.get("isFastADB")){x.toggleEmptyTip(!1);return}x.toggleEmptyTip(x.currentModels.length===0)},renderConversationList:function(){x=new c({itemView:y.getClass(),dataSet:[{name:"default",getter:S.getAll}],enableContextMenu:!0,keepSelect:!1,$observer:this.options.$observer,itemHeight:45,listenToCollection:S,emptyTip:o.message.NO_CONVERSATION,loading:S.loading||S.syncing}),this.listenTo(x,"switchSet",this.toggleEmptyTip),this.listenTo(x,"contextMenu",this.showContextMenu),this.listenTo(x,"select:change",function(e){this.trigger("select:change",e)}),this.listenTo(a,"change:isFastADB",this.toggleEmptyTip),this.$el.append(x.render().$el)},showContextMenu:function(){var e=b.getInstance({selected:x.selected});e.show()},render:function(){return this.$el.html(this.template({})),this.renderConversationList(),this.toggleEmptyTip(),this.updateHeader(),this.rendered=!0,this.trigger(E.RENDERED),this},updateHeader:function(){this.$(".count-tip").html(h.format(o.message.SMS_SUMMARY,S.totalCount,S.unreadCount))},deleteSelectedAsync:function(){var e=i.Deferred();return d.deleteConversationAsync(x.selected).done(function(t){e.resolve(t)}).fail(function(t){e.reject(t)}),e.promise()},markAsReadAsync:function(){var e=i.Deferred();return d.markAsReadAsync(x.selected).done(function(t){e.resolve(t)}).fail(function(t){e.reject(t)}).always(function(){this.updateHeader()}.bind(this)),e.promise()}}),N,C=t.extend({getInstance:function(e){return N||(N=new T(e)),N}});return C})}(this,this.document),function(e,t){define("message/models/ImportContextModel",["backbone","doT","jquery","underscore"],function(e,t,n,r){console.log("Message ImportContextModel - File Loaded");var i=e.Model.extend({defaults:{files:""}}),s=new i;return s})}(this),function(e,t){define("message/views/ImportAutoBackupView",["underscore","backbone","doT","jquery","IO","Internationalization","Configuration","ui/UIHelper","ui/TemplateFactory","ui/Panel","utilities/StringUtil","message/models/ImportContextModel","Device"],function(e,n,r,i,s,o,u,a,f,l,c,h,p){console.log("Message - ImportAutoBackupView - File loaded.");var d=n.View.extend({template:r.template(f.get("message","import-backup")),className:"w-import-autobackup-body-ctn",initialize:function(){var e=[],t=!1;Object.defineProperties(this,{backList:{set:function(t){t instanceof Array&&(e=t)},get:function(){return e}},loading:{set:function(e){t=Boolean(e),this.$(".loading").toggle(t)},get:function(){return t}}})},render:function(){this.$el.html(this.template({loading:this.loading,list:this.backList}));var e=this.$("ul li input").first()[0];return e!==t&&(e.checked=!0),this},loadSmsBackupData:function(){this.loading=!0,this.loadSmsBackupAsync().done(function(e){this.backList=e.body.file,this.render(),this.loading=!1}.bind(this))},loadSmsBackupAsync:function(){var e=i.Deferred();return s.requestAsync({url:u.actions.SMS_LOAD_BACKUP,success:function(t){t.state_line===200?e.resolve(t):e.reject(t)}}),e.promise()}}),v=l.extend({initialize:function(){v.__super__.initialize.call(this,arguments);var e;Object.defineProperties(this,{serviceCenter:{set:function(t){e=t},get:function(){return e}}}),p.on("change:isConnected",function(e,t){this.setNextBtnDisable(!t)},this),this.on(a.EventsMapping.SHOW,function(){var e=new d;this.$bodyContent=e.render().$el,e.loadSmsBackupData(),this.center(),this.once("remove",e.remove,e)},this),this.buttons=[{$button:i("<button>").html(o.common.NEXT_STEP).addClass("button-next primary"),eventName:"button-next"},{$button:i("<button>").html(o.message.CANCEL),eventName:a.EventsMapping.BUTTON_CANCEL}]},render:function(){e.extend(this.events,v.__super__.events),this.delegateEvents(),v.__super__.render.apply(this,arguments);var t=i("<button>").html(o.message.IMPORT_FROM_FILE).addClass("button-switch");return this.$(".w-ui-window-footer-monitor").append(t),this},clickButtonNext:function(){var e=this.$(".file-radio:checked").val();h.set("files",e),this.trigger("_NEXT_BUTTON")},clickButtonSwitch:function(){this.trigger("_SWITCH_BUTTON")},events:{"click .button-next":"clickButtonNext","click .button-switch":"clickButtonSwitch"},setNextBtnDisable:function(e){this.$(".button-next").prop("disabled",e)}}),m,g=e.extend(function(){},{getInstance:function(){return m||(m=new v({draggable:!0,disableX:!0,title:o.message.WINDOW_IMPORT_TITLE,width:450})),m},getClass:function(){return m}});return g})}(this),function(e,t){define("message/views/ImportSelectFileView",["backbone","doT","jquery","underscore","Device","Internationalization","Configuration","ui/Panel","ui/UIHelper","ui/AlertWindow","ui/TemplateFactory","contact/ContactService","IO","message/models/ImportContextModel","message/MessageService"],function(e,t,n,r,i,s,o,u,a,f,l,c,h,p,d){console.log("Message ImportSelectFileView - File Loaded");var v=/\.csv$/,m=n("<button>").html(s.misc.EXPLORE).addClass("button_browser").addClass("primary"),g=e.View.extend({template:t.template(l.get("message","import-file-select")),className:"w-message-import-selectfile-body-ctn",initialize:function(){g.__super__.initialize.apply(this,arguments),this.listenTo(i,"change:isConnected",function(e,t){this.$("input[file=name]").prop("disabled",!t),m.prop("disabled",!t)})},render:function(){return this.$el.html(this.template({})),this.$(".browser").append(m),this.$("input[name=file]").on("keyup",function(){var e=this.getFilePath();this.checkFile(e)}.bind(this)),this},clickBrowserBtn:function(){h.requestAsync(o.actions.SMS_SELECT_SMS_FILE).done(function(e){e.state_code===200&&(this.setFilePath(e.body.value),this.checkFile(e.body.value))}.bind(this))},getFilePath:function(){return this.$("input[name=file]").val().trim()},setFilePath:function(e){this.$("input[name=file]").val(e)},checkFile:function(e){h.requestAsync({url:o.actions.CHECK_FILE_PATH,data:{file_path:e}}).done(function(t){t.body.value==="2"&&v.test(e)?(this.trigger("_CHECK_FILE",!1),this.$(".invalid").hide()):(this.trigger("_CHECK_FILE",!0),this.$(".invalid").show())}.bind(this))},events:{"click .button_browser":"clickBrowserBtn"}}),y,b=n("<button>").html(s.contact.IMPORT_FROM_BACKUP).addClass("button_switch"),w,E=u.extend({initialize:function(){E.__super__.initialize.apply(this,arguments);var e=!1;Object.defineProperties(this,{fileValid:{set:function(t){e=t},get:function(){return e}}}),this.on(a.EventsMapping.SHOW,function(){y=new g,y.on("_CHECK_FILE",function(e){this.fileValid=!e,this.setConfirmBtnDisable(e)},this),this.$bodyContent=y.render().$el,this.center(),this.once("remove",y.remove,y),this.setConfirmBtnDisable(!0)},this),this.listenTo(i,"change:isConnected",function(e,t){t?this.setConfirmBtnDisable(!y.getFilePath()):this.setConfirmBtnDisable(!0)}),this.buttons=[{$button:n("<button>").html(s.ui.CONFIRM).addClass("button_confirm primary"),eventName:"button_confirm"},{$button:n("<button>").html(s.ui.CANCEL),eventName:"button_cancel"}]},setConfirmBtnDisable:function(e){this.$(".button_confirm").prop("disabled",e)},clickCancelBtn:function(){this.remove()},clickConfirmBtn:function(){if(!this.fileValid)return;p.set("files",y.getFilePath()),this.trigger("_CONFIRM_BUTTON")},clickSwitchBtn:function(){this.trigger("_SWITCH_BUTTON")},render:function(){r.extend(this.events,E.__super__.events),this.delegateEvents(),E.__super__.render.apply(this,arguments),this.$(".w-ui-window-footer-monitor").append(b)},refreshSwitchBtn:function(){d.getSmsHasBackupAsync().done(function(e){b.toggle(e.body.value)})},events:{"click .button_confirm":"clickConfirmBtn","click .button_cancel":"clickCancelBtn","click .button_switch":"clickSwitchBtn"}}),S={getInstance:function(){return w||(w=new E({title:s.message.WINDOW_IMPORT_TITLE,disableX:!0,height:260,width:450})),w}};return S})}(this),function(e,t){define("message/views/ImportProgressView",["backbone","doT","jquery","underscore","Device","Internationalization","IO","Configuration","WindowController","message/models/ImportContextModel","ui/Panel","ui/AlertWindow","message/collections/MessageCollection","message/collections/ConversationsCollection","ui/TemplateFactory","ui/UIHelper","utilities/StringUtil"],function(t,n,r,i,s,o,u,a,f,l,c,h,p,d,v,m,g){console.log("Message ImportProgressView - File loaded");var y=e.alert,b=t.View.extend({template:n.template(v.get("message","import-progress")),className:"w-message-import-progress-body",render:function(){return this.$el.html(this.template({})),this},setDuplicate:function(e){var t=e===null?"":g.format(o.message.DUPLICATE,e);this.$(".duplicate").text(t)}}),w,E,S=d.getInstance(),x=c.extend({initialize:function(){x.__super__.initialize.apply(this,arguments),this.on(m.EventsMapping.SHOW,function(){E=new b,this.$bodyContent=E.render().$el,this.center(),this.once("remove",E.remove,E)}.bind(this)),this.buttons=[{$button:r("<button>").html(o.contact.FINISH).addClass("button-finish primary").hide(),eventName:"button-finish"},{$button:r("<button>").html(o.contact.CANCEL).addClass("button-cancel"),eventName:"button-cancel"}]},setProgress:function(e,t){var n=e+" / "+t;this.$(".progress-num").text(n),e===t&&(this.$(".progress-desc").text(o.message.IMPORT_SMS_FINISH),this.$(".running").removeClass("running")),this.$("progress").attr({max:t,value:e})},importSms:function(){var e=l.get("files"),t=i.uniqueId("Import_sms");this.lastSessionId=t;var n=u.Backend.Device.onmessage({"data.channel":t},function(e){if(e.info==="dup"){var t=parseInt(e.current,10);t>0&&E.setDuplicate(e.current)}else this.setProgress(e.current,e.total),e.current===e.total&&(S.syncAsync(),u.Backend.Device.offmessage(n),this.$(".button-finish").show(),this.$(".button-cancel").hide())}.bind(this)),r=function(e){f.releaseWindowAsync(),S.syncAsync(),this.trigger("_IMPORT_SMS",e)}.bind(this);f.blockWindowAsync(),S.importConversationAsync(e,t).always(r)},refreshBtn:function(){this.$(".button-finish").hide(),this.$(".button-cancel").show()},clickFinishBtn:function(){this.remove()},clickCancelBtn:function(){this.remove(),u.requestAsync({url:a.actions.SMS_CANCEL,data:{session:this.lastSessionId}}).done(function(){y(o.common.CANCEL_IMPORT_TEXT),S.syncAsync()}).always(function(){f.releaseWindowAsync()})},events:{"click .button-finish":"clickFinishBtn","click .button-cancel":"clickCancelBtn"}}),T={getInstance:function(){return w||(w=new x({title:o.message.WINDOW_IMPORT_TITLE,disableX:!0,draggable:!0,width:450})),w}};return T})}(this),function(e,t){define("message/ImportController",["backbone","doT","jquery","underscore","message/views/ImportAutoBackupView","message/views/ImportSelectFileView","message/views/ImportProgressView","Internationalization"],function(t,n,r,i,s,o,u,a){console.log("Messgae ImportController - File loaded");var f=e.alert,l,c,h,p,d=t.View.extend({start:function(e){l=s.getInstance(),c=o.getInstance(),h=u.getInstance(),this.buildEvents(),e?l.show():(c.refreshSwitchBtn(),c.show())},buildEvents:function(){c.off("_SWITCH_BUTTON"),c.off("_CONFIRM_BUTTON"),l.off("_SWITCH_BUTTON"),l.off("_NEXT_BUTTON"),h.off("_IMPORT_SMS"),l.on("_NEXT_BUTTON",function(){h.refreshBtn(),this.showNextAndRemoveCurrent(l,h),h.importSms()},this),c.on("_CONFIRM_BUTTON",function(){h.refreshBtn(),this.showNextAndRemoveCurrent(c,h),h.importSms()},this),l.on("_SWITCH_BUTTON",function(){c.refreshSwitchBtn(),c.setConfirmBtnDisable(!0),this.showNextAndRemoveCurrent(l,c)},this),c.on("_SWITCH_BUTTON",function(){this.showNextAndRemoveCurrent(c,l)},this),h.on("_IMPORT_SMS",function(e){if(e.state_code!==200){c.refreshSwitchBtn(),c.setConfirmBtnDisable(!0);var t=function(){this.showNextAndRemoveCurrent(h,c)}.bind(this);switch(e.state_code){case 500:f(a.misc.CONNECTION_LOSE,t);break;case 704:f(a.misc.NOT_ENOUGH_ROOM_FOR_IMPORT,t);break;case 709:f(a.backup_restore.ERROR_WHEN_WRITE_ROM,t);break;default:f(a.message.IMPORT_FAILED,t)}}},this)},showNextAndRemoveCurrent:function(e,t){var n=function(){t.show(),e.off("hide",n)};e.on("hide",n,this),e.remove()}});return p=new d,p})}(this),function(e){define("message/views/MessageModuleToolbarView",["underscore","doT","jquery","Internationalization","Device","Log","ui/Toolbar","ui/TemplateFactory","message/MessageService","message/collections/ConversationsCollection","message/views/MessageSenderView","message/views/ConversationsListView","main/collections/PIMCollection","message/ImportController","message/ExportController","message/models/ExportContextModel"],function(t,n,r,i,s,o,u,a,f,l,c,h,p,d,v,m){console.log("MessageModuleToolbarView - File loaded.");var g=e.alert,y,b,w,E=u.extend({template:n.template(a.get("message","toolbar")),initialize:function(){s.on("change:isConnected",this.setButtonState,this),b=l.getInstance(),b.on("refresh",this.setButtonState,this)},render:function(){return this.$el.html(this.template({})),y=h.getInstance({$observer:this.$(".check-select-all")}),y.on("select:change",this.setButtonState,this),this.setButtonState(),this},setButtonState:function(){var e=s.get("isConnected");this.$(".button-send").prop({disabled:!e}),this.$(".button-delete").prop({disabled:y.selected.length===0||!e}),this.$(".button-mark-as-read").prop({disabled:!y.unreadMessageInSelected||!e}),this.$(".button-import").prop({disabled:!e}),this.$(".button-export").prop({disabled:b.length===0}),this.$(".button-refresh").prop({disabled:!e})},clickButtonSend:function(){c.getInstance().show(),o({event:"ui.click.message.button.send"})},clickButtonDelete:function(){y.deleteSelectedAsync()},clickButtonMarkAsRead:function(){y.markAsReadAsync()},clickButtonImport:function(){f.getSmsHasBackupAsync().done(function(e){d.start(e.body.value)})},clickButtonExport:function(){var e=y.selected,n=0,r=0;m.set("ids",e),t.each(e,function(e){var t=b.get(e);t&&(n+=t.get("total_number"),r+=t.get("mms_number"))}),r>0?g(i.message.ALERT_TIP_EXPORT_MMS,function(){v.start(e.length,n-r,b.totalCount)}):v.start(e.length,n-r,b.totalCount)},clickButtonRefresh:function(){b.syncAsync().fail(function(){g(i.common.REFRESH_ERROR)})},events:{"click .button-send":"clickButtonSend","click .button-delete":"clickButtonDelete","click .button-mark-as-read":"clickButtonMarkAsRead","click .button-import":"clickButtonImport","click .button-export":"clickButtonExport","click .button-refresh":"clickButtonRefresh"}}),S,x=t.extend({getInstance:function(){return S||(S=new E),S}});return x})}(this),function(e,t){define("message/views/BatchConversationsView",["backbone","doT","jquery","underscore","Internationalization","Device","ui/TemplateFactory","ui/SmartList","ui/AlertWindow","utilities/StringUtil","message/collections/ConversationsCollection","message/views/ConversationItemView"],function(e,t,n,r,i,s,o,u,a,f,l,c){console.log("BatchConversationsView - File loaded.");var h={CONVERSATION_LIST_CTN:".w-message-batch-conversations-list-ctn"},p,d,v=e.View.extend({className:"w-message-batch-conversations vbox",template:t.template(o.get("message","batch-conversations")),initialize:function(){d=d||l.getInstance(),s.on("change:isConnected",this.setButtonState,this)},render:function(){return this.$el.html(this.template({})),this},setButtonState:function(){this.$(".button-delete").prop({disabled:!s.get("isConnected")})},update:function(e){var t=function(){return r.map(e,function(e){return d.get(e)})};return this.$(".title .count").html(f.format(i.message.BATCH_CONVERSATION_TITLE,e.length)),p?(p.switchSet("default",t),p.deselectAll()):(p=new u({itemView:c.getClass(),dataSet:[{name:"default",getter:t}],keepSelect:!1,itemHeight:45,selectable:!1,listenToCollection:d}),this.$(h.CONVERSATION_LIST_CTN).append(p.render().$el)),this.setButtonState(),this},clickButtonDeselect:function(){this.trigger("deselect")},clickItemButtonClose:function(e){var t=n(e.currentTarget).data("id").toString();this.trigger("remove",t)},events:{"click .button-deselect":"clickButtonDeselect","click .w-message-conversation-list-item .button-close":"clickItemButtonClose"}}),m,g=r.extend({getInstance:function(e){return m||(m=new v(e)),m}});return g})}(this),function(e){define("message/views/MessagePanelView",["doT","backbone","underscore","ui/TemplateFactory","message/views/ConversationsListView","message/views/BatchConversationsView","message/views/ThreadsPanelView"],function(e,t,n,r,i,s,o){console.log("MessagePanelView - File loaded. ");var u,a,f,l=[".empty-info",".w-message-threads-ctn",".w-message-batch-conversations"],c=t.View.extend({className:"w-message-panel",template:e.template(r.get("message","message-panel")),initialize:function(){u=i.getInstance(),this.listenTo(u,"select:change",this.switchState)},switchState:function(e){switch(e.length){case 0:this.$([".w-message-threads-ctn",".w-message-batch-conversations"].join(",")).addClass("w-layout-hidden"),this.$(".empty-info").removeClass("w-layout-hidden");break;case 1:this.$([".empty-info",".w-message-batch-conversations"].join(",")).addClass("w-layout-hidden"),f?f.once("rendered",function(){f.$el.removeClass("w-layout-hidden")}):(f=o.getInstance(),f.render(),f.once("rendered",function(){this.$el.append(f.$el)},this)),f.update(e[0]);break;default:this.$([".w-message-threads-ctn",".empty-info"].join(",")).addClass("w-layout-hidden"),a?a.update(e).$el.removeClass("w-layout-hidden"):(a=s.getInstance(),a.render().update(e),this.$el.append(a.$el),a.on("deselect",function(){u.list.deselectAll()}),a.on("remove",function(e){u.list.removeSelect(e)}))}},render:function(){return this.$el.html(this.template({})),this}}),h,p=n.extend({getInstance:function(){return h||(h=new c),h}});return p})}(this),function(e,t){define("message/views/MessageModuleView",["backbone","underscore","doT","ui/TemplateFactory","ui/Notification","utilities/StringUtil","IOBackendDevice","Configuration","Internationalization","Environment","message/models/MessageModel","message/views/MessageModuleToolbarView","message/views/ConversationsListView","message/views/BatchConversationsView","message/views/ThreadsPanelView","message/views/MessageSenderView","message/views/MessagePanelView","message/collections/ConversationsCollection","message/collections/ThreadsCollection","message/collections/Threads4ContactCollection","main/collections/PIMCollection"],function(t,n,r,i,s,o,u,a,f,l,c,h,p,d,v,m,g,y,b,w,E){console.log("MessageModuleView - File loaded.");var S=e.setInterval,x=e.clearInterval,T=e.document,N,C,k,L,A=t.View.extend({template:r.template(i.get("message","message-main")),className:"w-message-module-main module-main vbox",initilize:function(){var e=!1;Object.defineProperties(this,{rendered:{set:function(t){e=t},get:function(){return e}}})},render:function(){this.$el.html(this.template({})),this.$el.prepend(h.getInstance().render().$el),N=p.getInstance();var e=this.$(".w-message-ctn"),t=T.createDocumentFragment();return t.appendChild(N.render().$el[0]),t.appendChild(g.getInstance().render().$el[0]),e.append(t),this.rendered=!0,this}});u.Backend.Device.onmessage({"data.channel":a.events.MESSAGE_MARK_AS_READ},function(e){var t=new c(e);t.markAsReadAsync().done(function(){b.getInstance().getThreadWithMessage(t.id)&&b.getInstance().trigger("update"),w.getInstance().getThreadWithMessage(t.id)&&w.getInstance().trigger("update"),y.getInstance().updateConversationAsync(t)})},this);var O=!0;u.Backend.Device.onmessage({"data.channel":a.events.SMS_CALLLOG_SMS_RECEIVE},function(e){var t=e.contact_name||e.address,n=new s({type:"html",url:a.BASE_PATH+"modules/message/message_notification_receive.html"+l.get("search")+"&data="+encodeURIComponent(JSON.stringify(e)),title:o.format(f.message.MESSAGE_FROM,t),onclose:function(){var t=new c(e);t.markAsReadAsync().done(function(){b.getInstance().getThreadWithMessage(t.id)&&b.getInstance().trigger("update"),w.getInstance().getThreadWithMessage(t.id)&&w.getInstance().trigger("update"),y.getInstance().updateConversationAsync(t)}),O=!0}});if(O){O=!n.show();var r=u.Backend.Device.onmessage({"data.channel":a.events.MESSAGE_CLOSE_MESSAGE_NOTIFICATION},function(){n.cancel(),O=!0,u.Backend.Device.offmessage(r)})}});var M,_=n.extend({enablePreload:!1,getInstance:function(){return M||(M=new A),M},preload:function(){y.getInstance(),b.getInstance()},navigate:function(e){E.getInstance().get(2).set({selected:!0});var t=function(){N.highlightSearchAsync(e)};if(N)t();else var n=S(function(){N&&(x(n),t())},10)},sendMessage:function(e){L=L||m.getInstance();var t=e.receivers||[],n=e.content||"",r=e.source||"unknown";L.rendered?L.setContent(n):(L.once("show",function(){L.addReceivers(t),L.setContent(n)}),L.show(),L.setSource(r))}});return _})}(this),function(e,t){define("contact/views/BatchContactsView",["backbone","doT","jquery","underscore","Log","Device","Configuration","ui/TemplateFactory","ui/SmartList","ui/AlertWindow","ui/MenuButton","ui/BatchActionWindow","utilities/StringUtil","Internationalization","contact/collections/ContactsCollection","contact/collections/AccountCollection","contact/views/ContactItemView","contact/views/AddGroupWindowView","contact/views/ContactsListView","contact/ContactService","message/views/MessageModuleView"],function(e,n,r,i,s,o,u,a,f,l,c,h,p,d,v,m,g,y,b,w,E){console.log("BatchContactsView - File loaded.");var S={CONTACTS_LIST_CTN:".w-contact-batch-contacts-list-ctn"},x,T,N,C,k=e.View.extend({template:n.template(a.get("contact","batch-contacts")),className:"w-contact-batch-contacts vbox",initialize:function(){o.on("change:isConnected",this.setButtonState,this)},render:function(){return this.$el.html(this.template({})),this},buildGroupsButton:function(){N||(N=m.getInstance());var e=[],n=i.flatten(i.map(x.currentModels,function(e){return i.map(e.get("group"),function(e){return e.group_row_id})})),r=[];i.each(x.currentModels,function(e){var n=N.filter(function(t){return t.get("name")===e.get("account_name")&&t.get("type")===e.get("account_type")&&t.get("read_only")})[0];n!==t&&i.pluck(r,"id").indexOf(n.id)<0&&r.push(n)}),N.each(function(n){if(!n.get("read_only")||n.get("read_only")&&r.length===1&&n.get("id")===r[0].get("id")){var s=N.getGroupsByAccount(n.id);if(s.length>0||!n.get("read_only"))e.length>0&&e.push({type:"hr"}),e.push({type:"group",name:n.get("id"),label:n.get("displayName")}),s.each(function(n){e.push({type:"checkbox",name:n.get("id"),label:n.get("title"),checked:i.find(x.currentModels,function(e){return!e.isInGroup(n.get("account_name"),n.id)})===t,value:n.get("id")})},this),n.get("read_only")||e.push({type:"link",label:d.contact.ADD_GROUP,action:function(){var e=y.getInstance();e.show(n),e.on("addNewGroup",function(e){this.batchGroupAsync(e,!0)},this)}.bind(this)})}},this),C?C.items=e:(C=new c({label:d.contact.GROUP,items:e}),C.on("select",function(e){this.batchGroupAsync(e.value,C.menu.$('input[type="checkbox"][name="'+e.name+'"]')[0].checked)},this),this.$(".actions").append(C.render().$el.addClass("button-group")))},batchGroupAsync:function(e,t){var n=N.getAccountByGroupId(e),s=x.currentModels,o=i.filter(s,function(e){return e.get("account_name")!==n.get("name")||e.get("account_type")!==n.get("type")}),a=function(){var n=i.uniqueId("contact.batch.group_"),r=new h({session:n,progressText:d.contact.CONTACT_BATCH_GROUP_PROGRESS,cancelUrl:u.actions.CONTACT_CANCEL,total:s.length,successText:d.contact.CONTACT_BATCH_GROUP_SUCCESS});r.show();var o=i.map(s,function(e){return e.get("id")});T.batchGroupAsync(o,e,t,n).always(function(t){(t.state_code!==200||t.body&&t.body.failed&&t.body.failed.length>0)&&C.menu.$('input[type="checkbox"][value="'+e+'"]').prop({checked:!1})}.bind(this))}.bind(this);if(o.length>0){var f;o.length>1?f=p.format(d.contact.ALERT_BATCH_MOVE_GROUP,o[0].get("name").display_name||d.contact.UNNAMED_CONTACT,o.length,n.get("displayName")):o.length===1&&(f=p.format(d.contact.ALERT_BATCH_MOVE_GROUP_SINGLE,o[0].get("name").display_name||d.contact.UNNAMED_CONTACT,n.get("displayName")));var c=new l({draggable:!0,disposableName:"contact-group",disposableChecked:!1,buttonSet:"yes_no",$bodyContent:r(f)});c.on("button_yes",a,this),c.on("button_no",function(){C.menu.$('input[type="checkbox"][value="'+e+'"]').prop({checked:!1})}),c.show()}else a()},update:function(e){T=T||v.getInstance(),this.$(".title .count").html(p.format(d.contact.BATCH_CONTACT_TITLE,e.length)),x?(x.switchSet("default",function(){return i.map(e,function(e){return T.get(e)})}),x.deselectAll()):(x=new f({itemView:g.getClass(),dataSet:[{name:"default",getter:function(){return i.map(e,function(e){return T.get(e)})}}],keepSelect:!1,itemHeight:45,selectable:!1,listenToCollection:T}),this.$(S.CONTACTS_LIST_CTN).append(x.render().$el),x.on("switchSet",this.buildGroupsButton)),this.buildGroupsButton(),this.setButtonState()},setButtonState:function(){var e=function(){var e=!1,n=x.currentModels,r;for(r=n.length;r--;t){var i=T.get(n[r]);if(i){e=i.get("read_only");if(e)break}}return e}();this.$(".button-delete").prop({disabled:!o.get("isConnected")}),this.$(".button-merge").prop({disabled:!o.get("isConnected")||e}),this.$(".button-send").prop({disabled:!o.get("isConnected")}),this.$(".button-group").prop({disabled:!o.get("isConnected")}),o.get("isConnected")||C!==t&&C.menu.$el.hide()},clickButtonSend:function(){var e=i.pluck(x.currentModels,"id"),t=i.map(e,function(e){return T.get(e)});E.sendMessage({receivers:t})},clickButtonDeselect:function(){b.getInstance().list.deselectAll()},clickItemButtonClose:function(e){var t=r(e.currentTarget).data("id").toString();b.getInstance().list.removeSelect(t)},events:{"click .button-send":"clickButtonSend","click .button-deselect":"clickButtonDeselect","click .w-contact-list-item .button-close":"clickItemButtonClose"}}),L,A=i.extend({getInstance:function(){return L||(L=new k),L}});return A})}(this),function(e,t){define("contact/models/ImportContextModel",["backbone","doT","jquery","underscore"],function(e,t,n,r){console.log("ImportContextModel - File loaded.");var i=e.Model.extend({defaults:{files:"",accountId:""}}),s=new i;return s})}(this),function(e,t){define("contact/views/ImportSelectAccountView",["backbone","doT","jquery","underscore","Device","Internationalization","ui/AlertWindow","ui/UIHelper","ui/TemplateFactory","contact/views/AccountSelectorView","IO","contact/models/ImportContextModel"],function(e,t,n,r,i,s,o,u,a,f,l,c){console.log("ImportSelectAccount - File loaded");var h=e.View.extend({template:t.template(a.get("contact","import-account-select")),className:"w-contact-import-select-account-body-ctn",render:function(){return this.$el.html(this.template({})),this}}),p,d=o.extend({initialize:function(){d.__super__.initialize.apply(this,arguments),this.on(u.EventsMapping.SHOW,function(){this.importSelectAccountBodyView=new h,this.accountSelectorView=f.getInstance({disableAllLabel:!0,displayReadOnly:!1}),this.$bodyContent=this.importSelectAccountBodyView.render().$el.append(this.accountSelectorView.render().$el),this.center(),this.once("remove",this.importSelectAccountBodyView.remove,this.importSelectAccountBodyView),this.once("remove",this.accountSelectorView.remove,this.accountSelectorView)}),i.on("change:isConnected",function(e,t){this.$(".button_yes").prop("disabled",!t)},this),this.buttons=[{$button:n("<button>").html(s.ui.CONFIRM).addClass("button_yes primary"),eventName:"button_yes"},{$button:n("<button>").html(s.ui.CANCEL),eventName:"button_cancel"}]},clickButtonYes:function(){c.set({accountId:this.accountSelectorView.accountId}),this.trigger("_NEXT_STEP")},events:{"click .button_yes":"clickButtonYes"}}),v={getInstance:function(){return p||(p=new d({title:s.contact.WINDOW_IMPORT_TITLE})),p}};return v})}(this),function(e,t){define("contact/views/ImportAutoBackupView",["backbone","doT","jquery","underscore","Internationalization","Configuration","ui/UIHelper","ui/TemplateFactory","ui/Panel","utilities/StringUtil","contact/ContactService","contact/views/ImportSelectAccountView","contact/models/ImportContextModel","Device"],function(e,t,n,r,i,s,o,u,a,f,l,c,h,p){console.log("Contact - ImportAutoBackupView - File loaded.");var d=e.View.extend({template:t.template(u.get("contact","import-backup")),className:"w-import-autobackup-body-ctn",initialize:function(){var e=[],t=!1;Object.defineProperties(this,{backList:{set:function(t){t instanceof Array&&(e=t)},get:function(){return e}},loading:{set:function(e){t=Boolean(e),this.$(".loading").toggle(t)},get:function(){return t}}})},render:function(){this.$el.html(this.template({loading:this.loading,list:this.backList}));var e=this.$("ul li input").first().prop({checked:!0});return this},loadSmsBackupData:function(){this.loading=!0,l.loadContactBackupAsync().done(function(e){this.backList=e.body.file,this.render(),this.loading=!1}.bind(this))}}),v=c.getInstance(),m=a.extend({initialize:function(){m.__super__.initialize.call(this,arguments);var e;Object.defineProperties(this,{serviceCenter:{set:function(t){e=t},get:function(){return e}}}),p.on("channel:isConnected",function(e,t){this.setNextBtnDisable(!t)},this),this.on(o.EventsMapping.SHOW,function(){var e=new d;this.$bodyContent=e.render().$el,e.loadSmsBackupData(),this.center(),this.once("remove",e.remove,e)},this),this.buttons=[{$button:n("<button>").html(i.common.NEXT_STEP).addClass("button-next primary"),eventName:"button-next"},{$button:n("<button>").html(i.contact.CANCEL),eventName:o.EventsMapping.BUTTON_CANCEL}]},setNextBtnDisable:function(e){this.$(".button-next").prop("disabled",e)},render:function(){r.extend(this.events,m.__super__.events),this.delegateEvents(),m.__super__.render.apply(this,arguments);var e=n("<button>").html(i.contact.IMPORT_FROM_FILE).addClass("button-switch");return this.$(".w-ui-window-footer-monitor").append(e),this},clickButtonNext:function(){var e=this.$(".file-radio:checked").val();h.set("files",e),this.trigger("_NEXT_STEP")},clickButtonSwitch:function(){this.trigger("_SWITCH_BUTTON")},events:{"click .button-next":"clickButtonNext","click .button-switch":"clickButtonSwitch"}}),g,y=r.extend(function(){},{getInstance:function(){return g||(g=new m({draggable:!0,disableX:!0,title:i.contact.WINDOW_IMPORT_TITLE,width:450})),g},getClass:function(){return g}});return y})}(this),function(e,t){define("contact/views/CategoryMenuView",["ui/MenuButton","Internationalization","contact/EditorConfig"],function(e,t,n){console.log("CategoryMenuVirw - File loaded. ");var r=e.extend({initialize:function(){r.__super__.initialize.apply(this,arguments);var e=[];_.each(n.CATEGORY_MENU,function(t){e.push({name:"category",type:"normal",value:t.value,label:t.name})}),this.items=e,this.label=t.contact.ADD_CONTACT_METHOD,this.$el.width(145),this.menu.$el.width(143)}}),i,s=_.extend({getInstance:function(){return i||(i=new r),i}});return s})}(this),function(e,t){define("contact/views/CustomInfoWindowView",["backbone","underscore","jquery","doT","ui/Panel","ui/UIHelper","ui/TemplateFactory","Internationalization"],function(e,t,n,r,i,s,o,u){console.log("CustomInfoWindowView - File loaded. ");var a=e.View.extend({template:r.template(o.get("contact","custom-info")),render:function(){return this.$el.html(this.template({})),this},getLabel:function(){return this.$(".input-label").val()}}),f,l=i.extend({initialize:function(){l.__super__.initialize.apply(this,arguments),this.on(s.EventsMapping.SHOW,function(){f=new a,this.$bodyContent=f.render().$el},this)},getLabel:function(){return f.getLabel()}}),c,h=t.extend({getInstance:function(){return c||(c=new l({title:u.contact.CUSTOME_CONTACT_INFO,draggable:!0,buttonSet:"yes_no"})),c}});return h})}(this),function(e,t){define("photo/models/PhotoModel",["backbone","IO","Configuration","jquery","Device"],function(e,t,n,r,i){console.log("PhotoModel - File loaded. ");var s=e.Model.extend({defaults:{isIgnore:!1,selected:!1,originalPic:"",orientation:0,loading:!1,error:!1,widthLtHeight:!0},getThumbnailAsync:function(){var e=r.Deferred();return t.requestAsync({url:n.actions.PHOTO_THUMBNAIL,data:{photo_id:this.id},success:function(t){t.state_code===200?(this.set({thumb:"file:///"+t.body.value}),e.resolve(t)):(this.set({error:!0}),e.reject(t))}.bind(this)}),e.promise()},exportAsync:function(){var e=r.Deferred();return t.requestAsync({url:n.actions.PHOTO_GET,data:{photo_id:this.id},success:function(t){t.state_code===200?e.resolve(t):e.reject(t),this.set({loading:!1})}.bind(this)}),e.promise()},deleteAsync:function(){var e=r.Deferred();return t.requestAsync({url:n.actions.PHOTO_DELETE,data:{photo_id_list:this.id},success:function(t){t.state_code===200?(this.collection&&this.collection.remove(this),e.resolve(t)):e.reject(t)}.bind(this)}),e.promise()},rotateAsync:function(e){var i=r.Deferred();return t.requestAsync({url:n.actions.PHOTO_ROTATE,data:{photo_id:this.id,orientation:e,is_cloud:Number(this.get("is_cloud"))},success:function(t){t.state_code===200?(this.set({orientation:e}),i.resolve(t)):i.reject(t)}.bind(this)}),i.promise()},setAsWallpaperAsync:function(){var e=r.Deferred();return t.requestAsync({url:n.actions.PHOTO_SET_WALLPAPER,data:{photo_id:this.id,is_cloud:Number(this.get("is_cloud"))},success:function(t){t.state_code===200?e.resolve(t):e.reject(t)}}),e.promise()},getOriginalPicAsync:function(){var e=r.Deferred();return this.get("loading")?this.once("change:loading",function(){e.resolve()}):(this.set({loading:!0}),t.requestAsync({url:n.actions.PHOTO_GET,data:{photo_id:this.id,is_cloud:Number(this.get("is_cloud"))},success:function(t){t.state_code===200?(this.set({originalPic:"file:///"+t.body.path,orientation:parseInt(t.body.orientation,10)}),e.resolve(t)):e.reject(t),this.set({loading:!1})}.bind(this)})),e.promise()}});return s})}(this),function(e,t){define("photo/collections/PhotoCollection",["underscore","backbone","jquery","IOBackendDevice","Environment","Configuration","Device","photo/models/PhotoModel"],function(e,t,n,r,i,s,o,u){console.log("PhotoCollection - File loaded. ");var a=t.Collection.extend({model:u,url:s.actions.PHOTO_SHOW,data:{photo_type:s.enums.PHOTO_ALL_TYPE},comparator:function(e){return-parseInt(e.get("date"),10)},parse:function(t){t.state_code===202&&o.get("isConnected")&&(console.log("PhotoCollection - Photo is syncing."),this.syncing=!0,this.trigger("syncStart"));var n=[];return t.body=t.body||{},e.each(t.body.list,function(t){n=n.concat(t.photo_info),e.each(t.photo_info,function(e){e.key=t.key})}),n},initialize:function(){var e=!1,t=!1;Object.defineProperties(this,{loading:{set:function(t){e=Boolean(t)},get:function(){return e}},syncing:{set:function(e){t=Boolean(e)},get:function(){return t}}}),this.on("update",function(){this.loading=!0,this.fetch({success:function(t,n){console.log("PhotoCollection - Collection fetched."),e=!1,t.trigger("refresh",t)}})},this),this.updateHandler=r.Backend.Device.onmessage({"data.channel":s.events.PHOTO_UPDATED},function(e){t&&(t=!1,this.trigger("syncEnd")),!e||this.trigger("update")},this),this.listenTo(o,"change:isMounted",function(e,t){t?(this.update([]),this.trigger("refresh",this)):this.trigger("update")}),this.on("add",function(e){e.once("remove",function(){this.off()},e)})},dispose:function(){this.set([]),this.off(),this.stopListening(),r.Backend.Device.offmessage(this.updateHandler)},syncAsync:function(){var e=n.Deferred();return this.syncing=!0,this.trigger("syncStart"),r.requestAsync({url:s.actions.PHOTO_SYNC,data:{photo_type:this.data.photo_type},success:function(t){t.state_code===200?(console.log("PhotoCollection - Photo sync success."),e.resolve(t)):(console.error("PhotoCollection - Photo sync failed. Error info: "+t.state_line),this.syncing=!1,this.trigger("syncEnd"),e.reject(t))}.bind(this)}),e.promise()},getThumbsAsync:function(t){var i=n.Deferred(),o=e.uniqueId("photo_get_thumbnails_"),u=0,a=r.Backend.Device.onmessage({"data.channel":o},function(n){u===t.length&&r.Backend.Device.offmessage(a),u+=n.val.length,u===t.length&&r.Backend.Device.offmessage(a),e.each(n.val,function(e){this.get(e.key).set({thumb:"file:///"+e.value,error:!1})},this)},this);return r.requestAsync({url:s.actions.PHOTO_THUMBNAILS,data:{photo_id_list:t.join(","),session:o,width:128,height:128},success:function(n){if(u===t.length)r.Backend.Device.offmessage(a);else if(n.body&&n.body.value!==t.length){var s=this.filter(function(e){return e.get("thumb")}).length;s===n.body.value?r.Backend.Device.offmessage(a):u=t.length}n.state_code===200?(n.body.value!==t.length&&e.each(t,function(e){var t=this.get(e);t.set({error:!t.get("thumb")})},this),i.resolve(n)):(e.each(t,function(e){this.get(e).set({error:!0})},this),i.reject(n))}.bind(this)}),i.promise()},getSelectedPhoto:function(){return this.filter(function(e){return e.get("selected")})}}),f,l=e.extend({getInstance:function(){return f||(f=new a,f.trigger("update")),f},getClass:function(){return a}});return l})}(this),function(e,t){define("photo/collections/PhonePhotoCollection",["underscore","Configuration","photo/collections/PhotoCollection"],function(e,n,r){console.log("PhonePhotoCollection - File loaded. ");var i=r.getClass().extend({data:{photo_type:n.enums.PHOTO_PHONE_TYPE}}),s,o=e.extend({getInstance:function(){return s||(s=new i,s.trigger("update")),s},dispose:function(){s.dispose(),s=t}});return o})}(this),function(e,t){define("photo/collections/LibraryPhotoCollection",["underscore","jquery","Configuration","IO","photo/collections/PhotoCollection"],function(e,n,r,i,s){console.log("LibraryPhotoCollection - File loaded. ");var o=s.getClass().extend({data:{photo_type:r.enums.PHOTO_LIBRARY_TYPE},ignoreThreadAsync:function(e){var t=n.Deferred();return i.requestAsync({url:r.actions.PHOTO_IGNORE_FOLDER,data:{folder:e},success:function(n){n.state_code===200?(this.each(function(t){t.get("key")===e&&t.set({isIgnore:!0})}),t.resolve(n)):t.reject(n)}.bind(this)}),t.promise()}}),u,a=e.extend({getInstance:function(){return u||(u=new o,u.trigger("update")),u},dispose:function(){u.dispose(),u=t}});return a})}(this),function(e,t){define("Account",["backbone","underscore","jquery","IOBackendDevice","Configuration"],function(n,r,i,s,o){function f(e){return/(\.|^){1}((wandou\.in)|(wandoujia\.com)){1}(\/|$){1}/.test(e)}function l(){var e=i("iframe"),n,r;for(r=e.length;r--;t)n=e[r],f(n.src)&&typeof n.contentWindow.updateUserStatus=="function"&&n.contentWindow.updateUserStatus({auth:a.get("auth")})}console.log("Account - File loaded.");var u=n.Model.extend({SINA:"sina",QZONE:"qzone",RENREN:"renren",TQQ:"tqq",QQ:"QQ",defaults:{isLogin:!1,auth:"",uid:"",userName:"",userMail:"",userAvatar:"",platforms:{}},initialize:function(){s.requestAsync(o.actions.ACCOUNT_INFO).done(function(e){e.state_code===200?(console.log("Account - Init account state success."),this.changeHandler(e.body)):console.error("Account - Init account state failed. Error info: "+e.state_line)}.bind(this))},isActive:function(e){return this.get("platforms")[e]===!0},bindAsync:function(e){var t=i.Deferred();return this.isActive(e)?t.resolve():s.requestAsync({url:o.actions.ACCOUNT_BIND,data:{plat:e===this.TQQ||e===this.QZONE?this.QQ:e},success:function(n){n.state_code===200?(console.log("Account - Bind "+e+" success."),t.resolve(n)):(console.error("Account - Bind "+e+" failed. Error info: "+n.state_line),t.reject(n))}}),t.promise()},loginAsync:function(e,t,n){var r=i.Deferred();return this.get("isLogin")?r.resolve():(n&&(n=n===this.TQQ||n===this.QZONE?this.QQ:n),s.requestAsync({url:o.actions.ACCOUNT_LOGIN,data:{title:e||"",source:t||"",platform:n||""},success:function(e){e.state_code===200?r.resolve(e):r.reject(e)}})),r.promise()},shareAsync:function(e,t,n){var r=i.Deferred();return s.requestAsync({url:o.actions.ACCOUNT_SHARE,data:e,success:function(e){e.state_code===200?(t&&t.call(this,e.body),r.resolve(e)):(n&&n.call(this,e.body),r.reject(e))}}),r.promise()},changeHandler:function(e){if(e.auth){var n=e.member,r={};r[this.SINA]=n.activesina!==t&&parseInt(n.activesina,10)!==0,r[this.QZONE]=n.activeqq!==t&&parseInt(n.activeqq,10)!==0,r[this.TQQ]=n.activeqq!==t&&parseInt(n.activeqq,10)!==0,r[this.RENREN]=n.activerenren!==t&&parseInt(n.activerenren,10)!==0,this.set({auth:e.auth,uid:n.uid,userName:n.username,userMail:n.email,userAvatar:n.avatar,isLogin:!0,platforms:r})}else this.set(this.defaults)}}),a=new u;return a.on("change:isLogin",function(e,t){i("body").toggleClass("login",t),i("body").toggleClass("unlogin",!t)}),s.Backend.Device.onmessage({"data.channel":o.events.ACCOUNT_STATE_CHANGE},function(e){console.log("Account - Account state change."),a.changeHandler(e),l.call()}),e.Account=a,a})}(this),function(e,t){define("photo/collections/CloudPhotoCollection",["underscore","Configuration","Account","photo/collections/PhotoCollection"],function(e,n,r,i){console.log("CloudPhotoCollection - File loaded. ");var s=i.getClass().extend({data:{photo_type:n.enums.PHOTO_CLOUD_TYPE},getThumbsAsync:function(e){}}),o,u=e.extend({getInstance:function(){return o||(o=new s,r.get("isLogin")&&o.trigger("update"),r.on("change:isLogin",function(e,t){t?o.trigger("update"):(o.reset([]),o.trigger("refresh",o))})),o},dispose:function(){o.dispose(),o=t}});return u})}(this),function(e){define("IframeMessageWorker",["underscore","backbone","IO","Configuration"],function(t,n,r,i){console.log("IframeMessageWorker - File loaded. ");var s=t.extend({},n.Events);return s.alert=function(e){r.sendCustomEventsAsync(i.events.CUSTOM_IFRAME_ALERT,{data:e})},s.confirm=function(n,s,o,u){typeof o!="function"&&(u=o||e);var a=function(){s!==undefined&&s.call(u||e)},f=function(){o!==undefined&&typeof o=="function"&&o.call(u||e)},l=t.uniqueId("iframe_confirm_");r.sendCustomEventsAsync(i.events.CUSTOM_IFRAME_CONFIRM,{data:n,listenerId:l});var c=r.Backend.Device.onmessage({"data.channel":l},function(e){e.action==="yes"?a.call(this):f.call(this),r.Backend.Device.offmessage(c)})},s.disposable=function(e){r.sendCustomEventsAsync(i.events.CUSTOM_IFRAME_DISPOSABLE,{data:e})},s.trigger=function(e,t){r.sendCustomEventsAsync(e,{data:t||{}})},s})}(this),function(e,t){define("ui/KeyboardHelper",["underscore","backbone","jquery"],function(e,n,r){var i=e.extend({},n.Events);r(t).on("keydown",function(e){i.trigger("keydown",e)}),r(t).on("keyup",function(e){i.trigger("keyup",e)}),r(t).on("keypress",function(e){i.trigger("keypress",e)});var s=Object.freeze({BACKSPACE:8,TAB:9,ENTER:13,ESC:27,LEFT:37,UP:38,RIGHT:39,DOWN:40,END:35,HOME:36,SPACEBAR:32,PAGEUP:33,PAGEDOWN:34,J:74,K:75});return Object.defineProperty(i,"Mapping",{get:function(){return s}}),i})}(this,this.document),function(e){define("photo/views/SlideShowView",["underscore","backbone","doT","jquery","ui/TemplateFactory","ui/WindowState","ui/KeyboardHelper","ui/MouseState","ui/PopupTip","Device","Environment","FunctionSwitch","Internationalization","IframeMessageWorker","IOBackendDevice","Configuration"],function(t,n,r,i,s,o,u,a,f,l,c,h,p,d,v,m){console.log("SlideShowView - File loaded. ");var g=!1,y=n.View.extend({template:r.template(s.get("photo","slide-show")),className:"w-photo-slideshow vbox",initialize:function(){var e=!1;Object.defineProperties(this,{loading:{get:function(){return e},set:function(t){e=Boolean(t),this.$(".w-ui-loading").toggle(e)}}}),this.listenTo(l,"change:isConnected change:isMounted",t.debounce(function(e){if(this.currentPhoto&&this.currentPhoto.get("is_cloud"))return;e.get("isMounted")?this.$(".control .tip").html(p.taskManager.INSTALL_FAILED_SDCARD_MOUNT):e.get("isConnected")||this.$(".control .tip").html(p.welcome.CONNECT_UR_PHONE),e.get("isConnected")&&!e.get("isMounted")?this.$(".control .tip").slideUp("fast",function(){this.$(".control .buttons").slideDown("fast")}.bind(this)):this.$(".control .buttons").slideUp("fast",function(){this.$(".control .tip").slideDown("fast")}.bind(this))}))},adjustSize:function(){if(this.currentPhoto){var e=this.currentPhoto.get("orientation");!this.currentPhoto.get("widthLtHeight")||e!==270&&e!==90?this.$(".photo").css({"max-height":this.$(".photo-ctn").height()-100,"max-width":this.$(".photo-ctn").width()-160}):this.$(".photo").css({"max-height":this.$(".photo-ctn").width()-100,"max-width":this.$(".photo-ctn").height()-160})}},remove:function(){delete this.currentPhoto,y.__super__.remove.call(this)},render:function(){this.$el.html(this.template({})),this.listenTo(o,"resize",this.adjustSize),this.$(".photo").on("error",function(){this.$(".photo").attr("src")&&this.$(".error").show()}.bind(this));if(!l.get("isConnected")||l.get("isMounted"))l.get("isMounted")?this.$(".control .tip").html(p.taskManager.INSTALL_FAILED_SDCARD_MOUNT).show():this.$(".control .tip").html(p.welcome.CONNECT_UR_PHONE).show(),this.$(".control .buttons").hide();var e=this.$(".button-share"),t;switch(c.get("locale")){case m.enums.LOCALE_EN_US:t=p.common.SHARE_TO_FACEBOOK;break;case m.enums.LOCALE_ZH_CN:case m.enums.LOCALE_DEFAULT:t=p.common.SHARE}return e.attr("title",t),this},showNext:function(){g&&this.next()},showPic:function(){this.loading=!1,this.$(".error").hide();var t=i(new e.Image),n=function(){this.currentPhoto.get("originalPic")===t.data("path")&&(this.currentPhoto.set("widthLtHeight",t[0].width>t[0].height),this.$(".photo").attr({src:t[0].src}).addClass("rotate-"+this.currentPhoto.get("orientation")),this.adjustSize(),this.$(".photo").removeClass("hide"),g&&(this.playingTimer=setTimeout(this.showNext.bind(this),4e3))),t.remove()}.bind(this),r=function(){this.$(".error").show(),t.remove()}.bind(this);t.one("load",n).one("error",r).attr("src",this.currentPhoto.get("originalPic")).data("path",this.currentPhoto.get("originalPic"))},loadAsync:function(){var e=i.Deferred();return this.$(".error").hide(),this.currentPhoto.getOriginalPicAsync().done(this.showPic.bind(this)).fail(function(){this.loading=!1,this.$(".error").show(),e.resolve()}.bind(this)).done(e.resolve),e.promise()},start:function(e,t){this.currentPhoto=e;var n=this.currentPhoto.get("is_cloud");this.$(".button-wallpaper").toggle(!n),n&&this.$(".control .tip").slideUp("fast",function(){this.$(".control .buttons").slideDown("fast")}.bind(this)),this.$(".button-previous, .button-next").toggle(this.currentPhoto.collection.length!==1),this.$el.addClass("show").css({visibility:"visible"}).one("webkitTransitionEnd",function(){e.get("originalPic")?this.showPic():(this.loading=!0,this.loadAsync()),this.listenTo(u,"keydown",this.keyboardControl)}.bind(this)),t&&(g=!0,this.$(".button-play").removeClass("button-play").addClass("button-pause").attr("title",p.photo.SLIDES_STOP_TEXT))},close:function(){g=!1,this.loading=!1,this.$(".error").hide(),this.$(".button-pause").removeClass("button-pause").addClass("button-play"),this.$el.one("webkitTransitionEnd",function(){this.$el.css({visibility:"hidden"}),this.$(".photo").attr({src:""}).removeClass("rotate-90 rotate-180 rotate-270").addClass("hide")}.bind(this)).removeClass("show"),this.stopListening(u,"keydown",this.keyboardControl),this.playTimer&&clearTimeout(this.playTimer),this.playingTimer&&clearTimeout(this.playingTimer),this.trigger("close")},keyboardControl:function(e){e.stopPropagation(),e.preventDefault();var t=e.keyCode;switch(t){case u.Mapping.ESC:this.close();break;case u.Mapping.SPACEBAR:case u.Mapping.ENTER:case u.Mapping.RIGHT:case u.Mapping.PAGEDOWN:case u.Mapping.DOWN:case u.Mapping.J:this.next();break;case u.Mapping.LEFT:case u.Mapping.PAGEUP:case u.Mapping.UP:case u.Mapping.K:this.previous()}},next:function(){if(this.currentPhoto.collection.length>1){var e=this.currentPhoto.collection,t=e.indexOf(this.currentPhoto),n=t+1>=e.length?e.models[0]:e.models[t+1];this.showNextPhoto(n,!0)}},previous:function(){if(this.currentPhoto.collection.length>1){var e=this.currentPhoto.collection,t=e.indexOf(this.currentPhoto),n=t-1<0?e.models[e.length-1]:e.models[t-1];this.showNextPhoto(n,!1)}},showNextPhoto:function(e,t){var n=this.$(".photo"),r=function(){n.attr({src:""}).removeClass("rotate-90 rotate-180 rotate-270"),this.currentPhoto=e,e.get("originalPic")?this.showPic():(this.loading=!0,this.loadAsync().done(function(){this.preload(t)}.bind(this)))}.bind(this);n.hasClass("hide")?r.call(this):n.one("webkitTransitionEnd",r).addClass("hide")},preload:function(e){var t=this.currentPhoto.collection,n=t.indexOf(this.currentPhoto),r;e?r=n+1>=t.length?t.models[0]:t.models[n+1]:r=n-1<0?t.models[t.length-1]:t.models[n-1],r.get("originalPic")||r.getOriginalPicAsync()},rotatePhoto:function(e){var t=this.$(".photo"),n;t.hasClass("rotate-90")?n=e?180:0:t.hasClass("rotate-180")?n=e?270:90:t.hasClass("rotate-270")?n=e?0:180:n=e?90:270,this.loading=!0;var r=this.currentPhoto.id;this.currentPhoto.rotateAsync(n).done(function(){this.loading=!1,this.currentPhoto.id===r&&(t.removeClass("rotate-0 rotate-90 rotate-180 rotate-270").addClass("rotate-"+n),this.adjustSize())}.bind(this))},play:function(){g||(g=!0,this.playTimer=setTimeout(function(){g&&this.next()}.bind(this),3e3),this.$(".button-play").removeClass("button-play").addClass("button-pause").attr("title",p.photo.SLIDES_STOP_TEXT))},stopPlaying:function(){g&&(g=!1,this.$(".button-pause").removeClass("button-pause").addClass("button-play").attr("title",p.photo.SLIDE_SHOW))},sharePic:function(e){var t=function(){d.trigger(m.events.CUSTOM_IFRAME_PHOTO_SHARE,{path:this.currentPhoto.get("originalPic"),orientation:this.currentPhoto.get("orientation"),type:e,size:this.currentPhoto.get("size")})}.bind(this);this.currentPhoto.get("originalPic")?t.call(this):this.loadAsync().done(t)},clickPhoto:function(e){e.stopPropagation();var t=i(e.target),n;t.hasClass("rotate-270")||t.hasClass("rotate-90")?n="height":n="width",a.x>=t.offset().left+t[n]()/2?this.next():this.previous()},clickButtonClose:function(){this.close()},clickButtonPlay:function(e){this.play()},clickButtonPause:function(e){this.stopPlaying()},clickButtonPrevious:function(){this.previous(),g&&clearTimeout(this.playingTimer)},clickButtonNext:function(){this.next(),g&&clearTimeout(this.playingTimer)},clickButtonRotateLeft:function(){this.stopPlaying(),this.rotatePhoto(!1)},clickButtonRotateRight:function(){this.stopPlaying(),this.rotatePhoto(!0)},clickButtonDelete:function(){this.stopPlaying(),this.loading=!0;var e=this.currentPhoto.collection.indexOf(this.currentPhoto),t=this.currentPhoto.collection,n=e+1>=t.length?t.models[0]:t.models[e+1];d.trigger(m.events.CUSTOM_IFRAME_PHOTO_DELETE,{ids:[this.currentPhoto.id],models:t.models});var r=v.Backend.Device.onmessage({"data.channel":m.events.CUSTOM_IFRAME_PHOTO_DELETED},function(e){v.Backend.Device.offmessage(r),t.remove(e.data),this.loading=!1,e.data.length>0&&(t.length>0?this.showNextPhoto(n,!0):this.close())},this)},clickButtonExport:function(){this.stopPlaying(),d.trigger(m.events.CUSTOM_IFRAME_PHOTO_EXPORT,{ids:[this.currentPhoto.id],models:this.currentPhoto.collection.models})},clickButtonWallpaper:function(e){var t=g;this.stopPlaying(),this.loading=!0,this.currentPhoto.setAsWallpaperAsync().done(function(){var n=new f({$host:i(e.currentTarget),alignToHost:!1,popIn:!0,autoClose:2e3});n.destoryBlurToHideMixin(),n.show(),this.loading=!1,t&&this.play()}.bind(this))},clickButtonShare:function(){var e=g;this.stopPlaying(),this.sharePic(m.enums.SOCIAL_PHOTO)},clickButtonRetry:function(e){e.stopPropagation(),this.loading=!0,this.loadAsync()},events:{"click .photo":"clickPhoto","click .button-close":"clickButtonClose","click .button-play":"clickButtonPlay","click .button-pause":"clickButtonPause","click .button-previous":"clickButtonPrevious","click .button-next":"clickButtonNext","click .button-rotate-left":"clickButtonRotateLeft","click .button-rotate-right":"clickButtonRotateRight","click .button-delete":"clickButtonDelete","click .button-export":"clickButtonExport","click .button-wallpaper":"clickButtonWallpaper","click .button-share":"clickButtonShare","click .button-retry":"clickButtonRetry"}}),b,w=t.extend({getInstance:function(){return b||(b=new y),b}});return w})}(this),function(e,t){define("photo/views/PhotoInfoPanelView",["doT","underscore","Internationalization","ui/TemplateFactory","ui/PopupPanel","utilities/StringUtil"],function(e,t,n,r,i,s){console.log("PhotoInfoPanelView - File loaded. ");var o=i.extend({className:"w-ui-popup-tip",initialize:function(){o.__super__.initialize.apply(this,arguments),this.$content=e.template(r.get("photo","info"))(this.model.toJSON())}}),u=t.extend({getInstance:function(e){return new o(e)}});return u})}(this),function(e){define("photo/views/PhotoItemView",["underscore","backbone","doT","jquery","Configuration","IframeMessageWorker","ui/TemplateFactory","ui/WindowState","photo/views/SlideShowView","photo/views/PhotoInfoPanelView"],function(e,t,n,r,i,s,o,u,a,f){console.log("PhotoItemView - File loaded. ");var l=function(e,t){this.loading=!1,t?this.$(".error").show():this.$(".error").hide()},c=function(e,t){this.loading=!1,this.$(".error").hide(),this.$(".thumb").attr({src:t}).addClass("show rotate-"+e.get("orientation")),this.listenTo(this.model,"change:orientation",function(e){this.$(".thumb").removeClass("rotate-0 rotate-90 rotate-180 rotate-270").addClass("rotate-"+e.get("orientation"))}),this.stopListening(this.model,"change:thumb",c),this.stopListening(this.model,"change:error",l)},h=function(e,t){this.$el.toggleClass("selected",t),this.$(".check-item").prop({checked:t})},p=function(){this.isItemSawn()&&(this.renderContent(),this.stopListening(t,"photo:list:scroll",p),this.stopListening(u,"resize",p))},d=t.View.extend({template:n.template(o.get("photo","photo-item")),tagName:"li",className:"w-photo-item",initialize:function(){var e=!1,n={};Object.defineProperties(this,{loading:{get:function(){return e},set:function(t){e=Boolean(t),e?this.$(".w-ui-loading").show():this.$(".w-ui-loading").hide()}},position:{get:function(){return n},set:function(e){n=e}}}),this.listenTo(t,"photo.item.select",this.selectItem),this.listenTo(u,"resize",function(){n={top:this.$el[0].offsetTop,left:this.$el[0].offsetLeft}}),this.listenTo(u,"resize",p),this.listenTo(this.model.collection,"remove",function(e){e.id!==this.model.id&&(n={top:this.$el[0].offsetTop,left:this.$el[0].offsetLeft},setTimeout(p.call(this)))}),this.options.template&&(this.template=this.options.template)},selectItem:function(e,t){if(this.model.collection.data.photo_type===e){var n=this.position.left,r=this.position.top,i=this.position.left+130,s=this.position.top+130,o=t.left,u=t.top,a=t.left+t.width,f=t.top+t.height;Math.abs(a+o-i-n)<=i-n+a-o&&Math.abs(f+u-s-r)<=s-r+f-u&&this.model.set({selected:!0})}},renderContent:function(){this.$el.html(this.template(this.model.toJSON())),this.model.get("thumb")?c.call(this,this.model,this.model.get("thumb")):(this.model.get("error")?l.call(this,this.model,this.model.get("error")):this.loading=!0,this.listenTo(this.model,"change:thumb",c),this.listenTo(this.model,"change:error",l)),this.listenTo(this.model,"change:selected",h),h.call(this,this.model,this.model.get("selected")),this.$(".thumb").on("error",function(){this.$(".thumb").attr("src")&&this.model.set({error:!0})}.bind(this)).on("load",function(){this.model.get("is_cloud")&&this.$(".thumb").css("margin-left",-(this.$(".thumb").width()/2)).off("load").off("error")}.bind(this)),this.infoPanel=f.getInstance({$host:this.$(".button-info"),model:this.model})},remove:function(){this.infoPanel&&(this.infoPanel.remove(),delete this.infoPanel),d.__super__.remove.call(this)},render:function(){return setTimeout(function(){this.isItemSawn()?this.renderContent():this.listenTo(t,"photo:list:scroll",p),this.position={top:this.$el[0].offsetTop,left:this.$el[0].offsetLeft}}.bind(this)),this},isItemSawn:function(){var e=this.options.$ctn;return e[0].scrollTop+this.options.$ctn.height()>this.$el[0].offsetTop},mousedownItem:function(e){e.stopPropagation()},clickItem:function(e){this.model.set({selected:!this.model.get("selected")})},dblclickThumb:function(){a.getInstance().start(this.model)},clickButtonShare:function(e){e.stopPropagation();var t=function(){s.trigger(i.events.CUSTOM_IFRAME_PHOTO_SHARE,{path:this.model.get("originalPic"),orientation:this.model.get("orientation"),type:i.enums.SOCIAL_PHOTO,size:this.model.get("size")})}.bind(this);this.model.get("originalPic")?t.call(this):(this.loading=!0,this.model.getOriginalPicAsync().done(function(){this.loading=!1,t.call(this)}.bind(this)))},clickButtonRetry:function(e){e.stopPropagation(),this.loading=!0,this.model.set({error:!1}).getThumbnailAsync().always(function(){this.loading=!1}.bind(this))},clickButtonInfo:function(e){e.stopPropagation()},events:{mousedown:"mousedownItem",click:"clickItem","click .button-share":"clickButtonShare","dblclick .thumb":"dblclickThumb","click .button-retry":"clickButtonRetry","click .button-info":"clickButtonInfo"}}),v=e.extend({getInstance:function(e){return new d(e)}});return v})}(this),function(e,t,n){define("photo/views/PhotoThreadView",["underscore","backbone","doT","IO","Configuration","Environment","ui/TemplateFactory","utilities/StringUtil","photo/views/PhotoItemView"],function(e,r,i,s,o,u,a,f,l){console.log("PhotoThreadView - File loaded. ");var c=r.View.extend({template:i.template(a.get("photo","photo-thread")),className:"w-photo-thread",initialize:function(){var t=[],i=e.debounce(function(){var t=e.filter(this.options.models,function(e){return e.get("selected")});this.$(".checker").prop({checked:t.length===this.options.models.length}),this.$(".count").html(this.options.models.length),r.trigger("photo:selected:change",t)}.bind(this));Object.defineProperties(this,{subView:{get:function(){return t}},changeSelectedHandler:{get:function(){return i}}}),this.listenTo(this.options.models[0].collection,"remove",function(r){var s=e.find(t,function(e){return e.model.id===r.id});s!==n&&(t.splice(this.subView.indexOf(s),1),s.remove(),this.subView.length===0&&this.remove());var o=e.find(this.options.models,function(e){return e.id===r.id});o!==n&&(this.options.models.splice(this.options.models.indexOf(o),1),i.call(this))}),this.options.template&&(this.template=this.options.template)},render:function(){var n,r=this.options.models[0].collection.data.photo_type;r===o.enums.PHOTO_PHONE_TYPE||r==o.enums.PHOTO_CLOUD_TYPE?u.get("locale")===o.enums.LOCALE_DEFAULT||u.get("locale")===o.enums.LOCALE_ZH_CN?n=f.formatDate("yyyy 年 MM 月",this.options.models[0].get("date")):n=f.formatDate("yyyy-MM",this.options.models[0].get("date")):n=this.options.models[0].get("key"),this.$el.html(this.template({key:n,count:this.options.models.length}));var i=t.createDocumentFragment();return e.each(this.options.models,function(e){var t=new l.getInstance({model:e,$ctn:this.options.$ctn,template:this.options.itemTemplate});i.appendChild(t.render().$el[0]),this.subView.push(t),this.listenTo(e,"change:selected",this.changeSelectedHandler)},this),this.changeSelectedHandler(),this.$(".photo-ctn").append(i),this},remove:function(){e.each(this.subView,function(e){e.remove()}),this.subView.length=0,c.__super__.remove.call(this)},getThumbsAsync:function(){var t=this.options.models[0].collection;t.getThumbsAsync(e.pluck(this.options.models,"id"))},clickChecker:function(t){e.each(this.options.models,function(e){e.set({selected:t.target.checked})})},clickButtonIgnore:function(){this.options.models.collection.ignoreThreadAsync(this.options.models[0].get("key"))},mousedownLabel:function(e){e.stopPropagation()},events:{"mousedown .label":"mousedownLabel","click .checker":"clickChecker","click .button-ignore":"clickButtonIgnore"}}),h=e.extend({getInstance:function(e){return new c(e)}});return h})}(this,this.document),function(e,t){define("photo/views/PhotoListView",["underscore","backbone","doT","jquery","Configuration","Internationalization","Account","ui/TemplateFactory","ui/WindowState","ui/MouseState","Device","photo/views/PhotoThreadView"],function(e,n,r,i,s,o,u,a,f,l,c,h){console.log("PhotoListView -File loaded. ");var p=n.View.extend({className:"w-photo-gallery",template:r.template(a.get("photo","photo-list")),initialize:function(){var t=[],r=[],i=e.throttle(function(e){this.renderThread(),n.trigger("photo:list:scroll",e)}.bind(this),20),a=!1;Object.defineProperties(this,{subView:{get:function(){return t}},threads:{set:function(e){r=e},get:function(){return r}},scrollHandler:{get:function(){return i}},loading:{get:function(){return a},set:function(e){a=Boolean(e),a?this.$("> .w-ui-loading").show():this.$("> .w-ui-loading").hide()}}}),this.listenTo(this.collection,"refresh",function(t){e.each(this.subView,function(e){e.remove()}),this.subView.length=0,this.buildList(t)}),this.listenTo(this.collection,"syncStart update syncEnd refresh",function(){this.loading=this.collection.loading||this.collection.syncing}),this.listenTo(this.collection,"remove",e.debounce(function(){this.collection.length>0?this.renderThread():this.toggleEmptyTip(!0)})),this.options.template&&(this.template=this.options.template),this.listenTo(c,"change:hasSDCard change:hasEmulatedSD",e.debounce(function(){!c.get("hasSDCard")&&!c.get("hasEmulatedSD")?(this.collection.set([]),this.collection.trigger("refresh",this.collection)):this.collection.trigger("update")})),this.listenTo(c,"change:isFastADB",function(e,t){if(this.collection.loading||this.collection.syncing||t){this.$(".empty-tip").toggle(!1);return}}),this.listenTo(u,"change:isLogin",function(e,t){if(this.collection.data.photo_type===s.enums.PHOTO_CLOUD_TYPE&&t){this.$(".empty-tip").html(o.photo.EMPTY_TIP_PHOTO_CLOUD_NOT_LOGIN).show();return}})},toggleEmptyTip:function(e){e&&(c.get("isConnected")&&!c.get("hasSDCard")&&!c.get("hasEmulatedSD")?this.$(".empty-tip").html(o.common.NO_SD_CARD_TIP_TEXT):this.$(".empty-tip").html(this.getEmptyTip(this.collection.data.photo_type))),this.$(".empty-tip").toggle(e)},remove:function(){e.each(this.subView,function(e){e.remove()}),this.subView.length=0,this.$el.off("scroll",this.scrollHandler),p.__super__.remove.call(this)},buildList:function(t){if(!t)return;this.threads=e.sortBy(t.groupBy("key"),function(e,t){return-Number(t)}),!t.loading&&!t.syncing&&this.toggleEmptyTip(t.length===0),this.collection.length!==0&&(this.toggleEmptyTip(!1),this.renderThread())},renderThread:function(){if(this.spyIsSawn()){var e=0,t;for(t in this.threads)if(this.threads.hasOwnProperty(t)){var n=this.threads[t],r=new h.getInstance({models:n,$ctn:this.$el,template:this.options.threadTemplate,itemTemplate:this.options.itemTemplate});this.$(".spy").before(r.render().$el),r.getThumbsAsync(),this.subView.push(r),delete this.threads[t];if(!this.spyIsSawn())break}}},spyIsSawn:function(){return this.$(".spy")[0].offsetTop<=Math.max(this.$el.height()+this.$el[0].scrollTop+140,0)},getEmptyTip:function(e){switch(e){case s.enums.PHOTO_PHONE_TYPE:return o.photo.EMPTY_PHONE_LIST;case s.enums.PHOTO_LIBRARY_TYPE:return o.photo.EMPTY_LIBRARY_LIST;case s.enums.PHOTO_CLOUD_TYPE:return o.photo.EMPTY_CLOUD_LIST;default:return o.photo.EMPTY_PHONE_LIST}},render:function(){return this.$el.html(this.template({})),!this.collection.loading&&!this.collection.syncing&&setTimeout(function(){this.buildList(this.collection)}.bind(this),0),this.$el.on("scroll",this.scrollHandler),this.loading=this.collection.loading||this.collection.syncing,this.listenTo(f,"resize",this.renderThread),this.$(".empty-tip").html(this.getEmptyTip(this.collection.data.type)),this},startDraw:function(){var e=this.$(".mask");if(e.length>0&&f.width-l.x>20&&this.collection.length>0){var r={x:l.x,y:l.y+this.$el[0].scrollTop},s={left:this.$el.offset().left,top:this.$el.offset().top};e.show().css({left:r.x-s.left,top:r.y-s.top});var o=this.$el[0].clientWidth,u=function(t){t.x<r.x?e.css("left",t.x-s.left):e.css("left",r.x-s.left);var n=this.$el[0].scrollTop;t.y+n<r.y?e.css("top",t.y+n-s.top):e.css("top",r.y-s.top),e.css({width:Math.abs(Math.min(t.x,o)-r.x),height:Math.abs(Math.min(t.y+n,this.$el[0].scrollHeight+s.top)-r.y)})}.bind(this);l.on("mousemove",u),i(t).one("mouseup",function(){n.trigger("photo.item.select",this.collection.data.photo_type,{top:e[0].offsetTop,left:e[0].offsetLeft,height:e[0].offsetHeight,width:e[0].offsetWidth}),e.hide().css({height:0,width:0}),l.off("mousemove",u)}.bind(this))}},clickButtonLogin:function(){u.loginAsync("","cloud-photo")},events:{"click .button-login":"clickButtonLogin",mousedown:"startDraw"}}),d=e.extend({getInstance:function(e){return new p(e)}});return d})}(this,this.document),function(e){define("photo/views/PhotoGalleryView",["underscore","backbone","doT","jquery","ui/TemplateFactory","ui/WindowState","Internationalization","Log","IOBackendDevice","Configuration","photo/collections/PhonePhotoCollection","photo/collections/LibraryPhotoCollection","photo/collections/CloudPhotoCollection","photo/views/PhotoListView"],function(e,t,n,r,i,s,o,u,a,f,l,c,h,p){console.log("PhotoGalleryView - File loaded. ");var d=t.View.extend({template:n.template(i.get("photo","gallery")),className:"w-photo-gallery-ctn",initialize:function(){var n="phone";Object.defineProperties(this,{currentTab:{get:function(){return n},set:function(e){n=e}}}),this.phonePhotoCollection=l.getInstance(),this.libraryPhotoCollection=c.getInstance(),this.cloudPhotoCollection=h.getInstance(),this.listenTo(t,"switchModule",function(e){e.module==="photo"&&(this.selectTab(e.tab),n=e.tab)}),a.Backend.Device.onmessage({"data.channel":f.events.CUSTOM_IFRAME_PHOTO_SELECT_TAB},function(e){this.selectTab(e.tab),n=e.tab},this),this.listenTo(this.phonePhotoCollection,"refresh add remove",e.debounce(function(){this.$('.tab li[data-tab="phone"] .count').html(this.phonePhotoCollection.length),this.relocatePointer()})),this.listenTo(this.libraryPhotoCollection,"refresh add remove",e.debounce(function(){this.$('.tab li[data-tab="lib"] .count').html(this.libraryPhotoCollection.length),this.relocatePointer()})),this.listenTo(this.cloudPhotoCollection,"refresh add remove",e.debounce(function(){this.$('.tab li[data-tab="cloud"] .count').html(this.cloudPhotoCollection.length),this.relocatePointer()}))},render:function(){return this.$el.html(this.template({phone:this.phonePhotoCollection.length,lib:this.libraryPhotoCollection.length,cloud:this.cloudPhotoCollection.length})),this.selectTab("phone"),a.sendCustomEventsAsync(f.events.CUSTOM_IFRAME_PHOTO_RENDERED),setTimeout(this.relocatePointer.bind(this),0),this.listenTo(s,"resize",this.relocatePointer),this},remove:function(){this.phonePhotoView&&(this.phonePhotoView.remove(),delete this.phonePhotoView),this.libPhotoView&&(this.libPhotoView.remove(),delete this.libPhotoView),this.cloudPhotoView&&(this.cloudPhotoView.remove(),delete this.cloudPhotoView),l.dispose(),delete this.phonePhotoCollection,c.dispose(),delete this.libraryPhotoCollection,h.dispose(),delete this.cloudPhotoCollection,d.__super__.remove.call(this)},relocatePointer:function(){var e=this.$(".tab li.selected");if(e.length>0){var t=this.$(".pointer"),n=t.css("-webkit-transition");t.css({"-webkit-transition":"none"}),this.$(".pointer").css({left:e[0].offsetLeft,width:e[0].offsetWidth}),setTimeout(function(){t.css({"-webkit-transition":n})},0)}},hideTabs:function(e,t,n){e&&this.phonePhotoView&&this.phonePhotoView.$el.addClass("w-layout-hidden"),t&&this.libPhotoView&&this.libPhotoView.$el.addClass("w-layout-hidden"),n&&this.cloudPhotoView&&this.cloudPhotoView.$el.addClass("w-layout-hidden")},selectTab:function(e){this.$(".tab li.selected").removeClass("selected");var t=this.$('.tab li[data-tab="'+e+'"]');t.addClass("selected"),this.$(".pointer").css({left:t[0].offsetLeft,width:t[0].offsetWidth});switch(e){case"phone":this.hideTabs(!1,!0,!0),this.phonePhotoView?this.phonePhotoView.$el.removeClass("w-layout-hidden"):(this.phonePhotoView=p.getInstance({collection:this.phonePhotoCollection,template:this.options.listTemplate,threadTemplate:this.options.threadTemplate,itemTemplate:this.options.itemTemplate}),this.$el.prepend(this.phonePhotoView.render().$el));break;case"lib":this.hideTabs(!0,!1,!0),this.libPhotoView?this.libPhotoView.$el.removeClass("w-layout-hidden"):(this.libPhotoView=p.getInstance({collection:this.libraryPhotoCollection,template:this.options.listTemplate,threadTemplate:this.options.threadTemplate,itemTemplate:this.options.itemTemplate}),this.$el.prepend(this.libPhotoView.render().$el));break;case"cloud":this.hideTabs(!0,!0,!1),this.cloudPhotoView?this.cloudPhotoView.$el.removeClass("w-layout-hidden"):(this.cloudPhotoView=p.getInstance({collection:this.cloudPhotoCollection,template:this.options.listTemplate,threadTemplate:this.options.threadTemplate,itemTemplate:this.options.itemTemplate}),this.$el.prepend(this.cloudPhotoView.render().$el.addClass("cloud")))}},clickTab:function(e){var n=r(e.currentTarget).data("tab");t.trigger("switchModule",{module:"photo",tab:n}),u({event:"ui.click.photo_tab",tab:n})},events:{"click .tab li":"clickTab"}}),v,m=e.extend({getInstance:function(e){return v||(v=new d(e)),v},getClass:function(){return d}});return m})}(this),function(e){define("contact/views/AvatarEditorWindowView",["backbone","underscore","doT","ui/Panel","ui/TemplateFactory","Internationalization"],function(e,t,n,r,i,s){console.log("AvatarEditorWindowView - File loaded. ");var o=e.View.extend({render:function(){return this}}),u=r.extend({initialize:function(){u.__super__.initialize.apply(this,arguments),this.once("show",function(){var e=new o({parentView:this.options.parentView});this.$bodyContent=e.render().$el,this.once("remove",e.remove,e)},this)}}),a=t.extend({getInstance:function(e){return new u(t.extend({title:s.contact.EDIT_CONTACT_HEAD,height:465,width:660},e))}});return a})}(this),function(e){define("contact/views/AvatarGalleryView",["underscore","jquery","Log","doT","ui/TemplateFactory","photo/views/PhotoGalleryView","photo/collections/PhonePhotoCollection","photo/collections/LibraryPhotoCollection","contact/views/AvatarEditorWindowView"],function(e,t,n,r,i,s,o,u,a){console.log("AvatarGalleryView - File loaded. ");var f=s.getClass().extend({className:"w-photo-gallery-ctn w-contact-avatar-list",initialize:function(){this.phonePhotoCollection=o.getInstance(),this.libraryPhotoCollection=u.getInstance(),this.listenTo(this.phonePhotoCollection,"refresh add remove",e.debounce(function(e){this.$('.tab li[data-tab="phone"] .count').html(e.length),this.relocatePointer()})),this.listenTo(this.libraryPhotoCollection,"refresh add remove",e.debounce(function(e){this.$('.tab li[data-tab="lib"] .count').html(e.length),this.relocatePointer()}))},clickTab:function(e){var r=t(e.currentTarget).data("tab");this.selectTab(r),n({event:"ui.click.contact_avatar_tab",tab:r})},render:function(){return e.extend(this.events,f.__super__.events),this.delegateEvents(),f.__super__.render.call(this)},clickItem:function(){a.getInstance({parentView:this.options.parentView}).show()},events:{"click .w-photo-item":"clickItem"}}),l=e.extend({getInstance:function(t){return new f(e.extend({listTemplate:r.template(i.get("contact","avatar-list")),threadTemplate:r.template(i.get("contact","avatar-list-thread")),itemTemplate:r.template(i.get("contact","avatar-list-item"))}),t)}});return l})}(this),function(e){define("contact/views/AvatarEditorView",["backbone","underscore","doT","ui/Panel","ui/TemplateFactory","ui/AlertWindow","Internationalization","contact/views/AvatarGalleryView"],function(t,n,r,i,s,o,u,a){console.log("AvatarEditorView - File loaded. ");var f=e.confirm,l=t.View.extend({template:r.template(s.get("contact","avatar-editor")),className:"w-contact-avatar-editor vbox",initialize:function(){},render:function(){return this.$el.html(this.template({})),this.listView=a.getInstance({parentView:this.options.parentView}),this.$el.append(this.listView.render().$el),this},remove:function(){this.listView.remove(),l.__super__.remove.call(this)},clickButtonDelete:function(){f(u.contact.ALERT_DEL_CONTACT_HEAD,function(){this.options.parentView.refreshAvatar(""),this.trigger("remove")},this)},events:{"click .button-delete":"clickButtonDelete"}}),c=i.extend({initialize:function(){c.__super__.initialize.apply(this,arguments),this.once("show",function(){var e=new l({parentView:this.options.parentView});this.$bodyContent=e.render().$el,this.listenToOnce(e,"remove",this.remove),this.$(".w-ui-window-footer-monitor").html(u.contact.ALERT_PIC_FORMAT_TIP),this.once("remove",e.remove,e)},this)}}),h=n.extend({getInstance:function(e){return new c(n.extend({title:u.contact.EDIT_CONTACT_HEAD,height:465,width:660},e))}});return h})}(this),function(e,t,n){define("message/views/ThreadsPanel4ContactView",["backbone","underscore","doT","Configuration","Internationalization","ui/TemplateFactory","message/collections/ConversationsCollection","message/collections/ThreadsCollection","message/collections/Threads4ContactCollection","message/views/ThreadsItemView"],function(e,r,i,s,o,u,a,f,l,c){console.log("ThreadsPanel4ContactView - File loaded.");var h={THREADS_LIST_CTN:".w-message-threads-list-ctn"},p=e.View.extend({template:i.template(u.get("message","threads-panel")),className:"w-message-threads-ctn vbox",initialize:function(){var t="";Object.defineProperties(this,{emptyTip:{set:function(e){t=String(e),this.$(".empty-tip").html(t)}}}),this.collection.on("refresh",function(e){this.buildList(),this.toggleEmptyTip(e.length===0),this.$(".w-message-threads-nameplate").hide()},this),this.collection.on("empty",function(){this.toggleEmptyTip(!0)},this),e.on("updateConversation",function(e){a.getInstance().updateConversationAsync(e),f.getInstance().getThreadWithMessage(e.get("id"))&&f.getInstance().trigger("update")})},render:function(){return this.$el.html(this.template({})),this.emptyTip=o.message.EMPTY_TIP_4_CONTACT,this},buildList:function(){var e=this.$(h.THREADS_LIST_CTN).hide().empty(),n=t.createDocumentFragment();r.each(this.collection.models,function(e){var t=c.getInstance({model:e,parentView:this});n.appendChild(t.render().$el[0])},this),e.append(n).show()},toggleEmptyTip:function(e){var t=e,r=this.$(".empty-tip");t!==n?r[t?"show":"hide"]():r.toggle()}}),d,v=r.extend({getInstance:function(){return d||(d=new p({collection:l.getInstance()})),d}});return v})}(this,this.document),function(e,t){define("contact/views/DetailPanelView",["backbone","underscore","doT","jquery","ui/TemplateFactory","ui/MenuButton","ui/AlertWindow","ui/PopupTip","ui/PopupPanel","utilities/StringUtil","Configuration","Device","Internationalization","IO","Log","contact/EditorConfig","contact/collections/ContactsCollection","contact/collections/AccountCollection","contact/views/AddGroupWindowView","contact/views/CategoryMenuView","contact/views/ContactsListView","contact/views/CustomInfoWindowView","contact/views/AvatarEditorView","contact/views/AccountSelectorView","message/views/ThreadsPanel4ContactView","message/views/MessageSender4ThreadsPanelView","message/collections/Threads4ContactCollection"],function(n,r,i,s,o,u,a,f,l,c,h,p,d,v,m,g,y,b,w,E,S,x,T,N,C,k,L){console.log("DetailPanelView - File loaded. ");var A=e.alert,O=s("<div>").addClass("w-ui-helper"),M=function(e,t,n){var r=!1;return e?(n=n||"",String(e[t])!==String(n)?r=!0:r=!1):n?r=!0:r=!1,r},_=function(e,t){return!e||e.length===0||e.length===1&&!e[0][t]},D=function(e,t,n,r){var i=_(e,r),s=_(t,"value"),o=!1;if(!i&&!s)if(e.length!==t.length)o=!0;else{var u,a,f;for(f=0;f<e.length;f++){u=e[f],a=t[f];if(String(u[n])!==String(a.type)||String(u.label)!==String(a.label)||String(u[r])!==String(a.value))o=!0}}else i&&s?o=!1:o=!0;return o},P=function(e){var n=[],i=e.data("cate");switch(i){case"phone":n=g.PHONE_OPTION;break;case"email":n=g.EMAIL_OPTION;break;case"im":n=g.IM_OPTION;break;case"address":n=g.ADDRESS_OPTION;break;case"org":n=g.ORGANIZATION_OPTION;break;default:return}var o=[],a=e.data("type"),f=e.data("label"),l=r.uniqueId("contact-editor-"+i),c,h=r.find(n,function(e){return e.value===parseInt(a,10)}),p;for(p=0;p<n.length;p++)c=n[p],o.push({type:"radio",name:l,value:c.value,label:c.name,checked:h?r.isEqual(c,h):!1});h===t&&(o[0].checked=!0);var d=new u({items:o,label:h?r.isEqual(h,n[n.length-1])?f:h.name:o[0].label});d.on("select",function(e){e.value=parseInt(e.value,10);var t=r.find(n,function(t){return t.value===e.value});if(r.isEqual(t,n[n.length-1])){var i=x.getInstance();i.show();var o=function(){var t=i.getLabel();t&&(d.label=t,s(d.$el.parent().next().find("input")).data({type:e.value,label:t}))};i.on("button_yes",o);var u=function(){i.off("remove",u),i.off("button_yes",o)};i.on("remove",u)}else d.label=e.label,s(d.$el.parent().next().find("input")).data({type:e.value,label:e.label})}),e.append(d.render().$el)},H,B,j,F,I,q,R,U,z,W,X,V,$=n.View.extend({className:"w-contact-detail-panel vbox",initialize:function(){H=y.getInstance(),H.on("refresh",function(e){var n=e.get(this.model.id);n!==t&&this.update(n.id)},this),B=b.getInstance(),B.on("refresh",this.buildGroupsButton,this),I=C.getInstance(),j=L.getInstance(),F=S.getInstance(),U=E.getInstance(),U.on("select",function(e){var t=e.value.toLowerCase(),n,r;switch(t){case"phone":n=o.get("contact","edit-phone"),r=this.$("li.phone dl");break;case"email":n=o.get("contact","edit-email"),r=this.$("li.email dl");break;case"im":n=o.get("contact","edit-im"),r=this.$("li.im dl");break;case"address":n=o.get("contact","edit-address"),r=this.$("li.address dl");break;case"organization":n=o.get("contact","edit-organization"),r=this.$("li.organization dl")}r.append(i.template(n)({})),P.call(this,s(r.find("dt:last")))},this),W=i.template(o.get("contact","detail-panel")),X=i.template(o.get("contact","detail-panel-edit")),p.on("change:isConnected",function(e,t){this.$el.hasClass("edit")||this.$(".button-edit, .button-group").prop({disabled:!t}),this.$(".button-dial").toggle(t)},this),O.on("click",function(){if(this.isChanged()){var e=new a({draggable:!0,buttons:[{$button:s("<button>").html(d.contact.SAVE).addClass("primary"),eventName:"button_yes"},{$button:s("<button>").html(d.contact.DONTSAVE),eventName:"button_no"}],title:d.contact.ALERT_TEXT,$bodyContent:d.contact.SAVE_TIP_TEXT});e.on("button_no",this.clickButtonCancel,this),e.on("button_yes",this.clickButtonSave,this),e.show()}else this.clickButtonCancel()}.bind(this))},createNewContact:function(e){e=e||H.generateNewContact();if(F.currentAccountId!=="all"){var t=B.get(F.currentAccountId);e.set({account_name:t.get("name"),account_type:t.get("type")})}if(F.currentGroupId!=="all")var n=B.getGroupById(F.currentGroupId);this.model=e,this.template=X,this.renderEditor()},groupContact:function(e,n){var r=function(){H.batchGroupAsync([this.model.id],e,n,t).always(function(t){(t.state_code!==200||t.body&&t.body.failed&&t.body.failed.length>0)&&R.menu.$('input[type="checkbox"][value="'+e+'"]').prop({checked:!1})}.bind(this))}.bind(this),i=B.getAccountByGroupId(e),o=this.model.get("account_name")!==i.get("name")||this.model.get("account_type")!==i.get("type");if(o){var u=new a({draggable:!0,disposableName:"contact-group-detail-panel",disposableChecked:!1,buttonSet:"yes_no",$bodyContent:s(c.format(d.contact.ALERT_BATCH_MOVE_GROUP_SINGLE,this.model.get("name").display_name||d.contact.UNNAMED_CONTACT,i.get("displayName")))});u.on("button_yes",r,this),u.on("button_no",function(){R.menu.$('input[type="checkbox"][value="'+e+'"]').prop({checked:!1})}),u.show()}else r.call(this)},buildGroupsButton:function(){if(this.$el.hasClass("edit"))return;var e=[],t=r.pluck(this.model.get("group"),"group_row_id");B.each(function(n){n.get("read_only")||(e.length>0&&e.push({type:"hr"}),e.push({type:"group",name:n.get("id"),label:n.get("displayName")}),B.getGroupsByAccount(n.id).each(function(n){e.push({type:"checkbox",name:n.get("id"),label:n.get("title"),checked:t.indexOf(n.get("id"))!==-1,value:n.get("id")})},this),e.push({type:"link",label:d.contact.ADD_GROUP,action:function(){var e=w.getInstance();e.show(n),e.on("addNewGroup",function(e){this.groupContact(e,!0)},this)}.bind(this)}))},this),R?R.items=e:(R=new u({label:d.contact.GROUP,items:e}),R.on("select",function(e){this.groupContact(e.value,R.menu.$('input[type="checkbox"][name="'+e.name+'"]')[0].checked)},this),R.render().$el.addClass("button-group")),this.model.isReadOnly||this.$(".switch").append(R.$el)},buildMenuButtons:function(){var e=this.$(".info-ctn dl dt");r.each(e,function(e){P.call(this,s(e))},this)},renderEditor:function(){this.$el.addClass("edit"),q&&q.$el.detach(),R&&R.$el.detach(),U&&U.$el.detach(),z&&z.$el.detach(),this.$el.html(this.template({contact:this.model.toJSON(),config:g})),z||(z=N.getInstance({disableAllLabel:!0,displayReadOnly:!1})),this.$(".button-edit").prop({disabled:!0}),this.$(".button-group").prop({disabled:!0}),this.buildMenuButtons(),this.$(".category-selector").append(U.render().$el);if(this.model.get("isNew")){this.$(".account-ctn").append(z.render().$el);var e=B.getAccountByNameAndType(this.model.get("account_name"),this.model.get("account_type"));e!==t&&!e.get("read_only")?z.selectByAccountId(e.id):(e=B.find(function(e){return!e.get("read_only")}),e!==t&&z.selectByAccountId(e.id)),this.$(".account-label").show()}else this.$(".account-label").hide();this.$el.parent().prepend(O)},render:function(){return O.detach(),this.$el.removeClass("edit"),q&&q.$el.detach(),R&&R.$el.detach(),U&&U.$el.detach(),z&&z.$el.detach(),this.$el.html(this.template({contact:this.model.toJSON(),config:g})),this.$(".sms-ctn").append(I.render().$el),j.data={type:h.enums.SMS_THREADS_TYPE_SPECIFY_CONTACT,filter:this.model.id,start:0,number:100},j.trigger("update"),this.model.get("phone")&&r.compact(r.pluck(this.model.get("phone"),"number")).length>0&&(q?q.update(this.model):q=k.getInstance({model:this.model}).render(),this.$el.append(q.$el)),this.model.isReadOnly?this.$(".switch").html(s("<span>").html(d.contact.CANNOT_EDIT_CONTACTS_UNDER_READONLY_ACCOUNT)):this.buildGroupsButton(),this.$(".button-edit, .button-group").prop({disabled:!p.get("isConnected")}),this.$("[data-title]").each(function(){var e=new f({$host:s(this)})}),p.get("isConnected")||this.$(".button-dial").hide(),this},update:function(e){var n=H.get(e);this.model!==t&&this.model.id===n.id?(this.model=n,this.$el.hasClass("edit")?(this.template=X,this.renderEditor()):(this.template=W,this.render())):(this.model=n,this.template=W,this.render())},buildContactData:function(){var e=this.getAtomicData("avatar"),t=this.getAtomicData("avatar_photo"),n=this.getAtomicData("merge");n&&(t=this.getAtomicData("avatar_path")),!t||(e="");var r={id:this.model.id||"",account_name:this.model.get("isNew")?B.get(z.accountId).get("name"):this.model.get("account_name"),account_type:this.model.get("isNew")?B.get(z.accountId).get("type"):this.model.get("account_type"),group:this.model.get("group"),name:this.getAtomicData("name")[0],nickname:this.getAtomicData("nickname"),phone:this.getAtomicData("phone"),photo_id:e,photo:[{value:t,id:e}],email:this.getAtomicData("email"),IM:this.getAtomicData("im"),address:this.getAtomicData("address"),organization:this.getAtomicData("organization"),note:this.getAtomicData("note")};return n&&(r.mergeIds=this.model.get("mergeIds")),r},getAtomicData:function(e){var t=this.model.toJSON(),n=this.$(".avatar img");if(e==="avatar"){var i=null;return t&&t.photo&&t.photo.length>0&&(i=t.photo[0].id),i}if(e==="merge"){var o=!1;return t&&t.merge&&(o=!0),o}if(e==="avatar_path"){var u=n.attr("src").replace("file:///","");return u===h.enums.CONTACT_DEFAULT_ICON_LARGE&&(u=""),u}if(e==="avatar_photo")return n.data("path");var a=this.$(".input-"+e),f=r.map(a,function(t){var n=s(t),i=n.data("id"),o=n.val(),u=n.data("type");if(!i&&!o)return;var a={id:i||"",value:o||""};if(!r.isUndefined(u)){a.type=u;if(e.toLowerCase()==="im"&&parseInt(u,10)===-1||e.toLowerCase()!=="im"&&parseInt(u,10)===0)a.label=n.data("label")||""}return a});return r.compact(f)},getAvatarSize:function(){var e=this.$(".avatar img");return e.width()+";"+e.height()},refreshAvatar:function(e){var t=this.$(".avatar img");if(e===""){var n=this.model.toJSON();t.attr("src",h.enums.CONTACT_DEFAULT_ICON_LARGE).data("path",""),n&&n.photo&&(n.photo[0].id=null)}else t.attr("src","file:///"+e).data("path",e)},validate:function(){var e=!1,t=this.$("input"),n=r.find(t,function(e){return s(e).val().trim()!==""});return n?this.$("input:invalid").length>0?(this.$("input:invalid").focus(),e=!1):e=!0:(s("input").eq(0).focus(),e=!1),e},isChanged:function(){if(this.model.get("isNew"))return!0;var e=this.model.toJSON(),t=this.buildContactData();return M(e.name,"display_name",t.name?t.name.value:"")?!0:M(e,"account_name",t.account_name)?!0:M(e,"account_type",t.account_type)?!0:D(e.nickname,t.nickname,"type","name")?!0:D(e.phone,t.phone,"type","number")?!0:D(e.email,t.email,"type","address")?!0:D(e.address,t.address,"type","formatted_address")?!0:D(e.organization,t.organization,"type","company")?!0:D(e.note,t.note,"type","note")?!0:D(e.photo,t.photo,"type","data")?!0:D(e.IM,t.IM,"protocol","data")?!0:!1},clickButtonEmail:function(e){var t=s(e.target).data("email-id").toString(),n=this.model.toJSON(),i=r.find(n.email,function(e){return e.id===t});v.requestAsync({url:h.actions.MAILTO,data:{email:i.address},success:function(e){e.state_code===405?A(d.contact.NO_EMAIL_CLIENT_TIP):e.state_code!==200&&A(d.common.SEND_MAIL_FAILD)}}),m({event:"ui.click.contact.email"})},clickButtonEdit:function(){this.template=X,this.renderEditor(),m({event:"ui.click.contact.edit"})},clickButtonCancel:function(){this.$el.removeClass("edit"),O.detach(),this.trigger("cancel")},clickButtonAvatar:function(){!p.get("hasSDCard")&&!p.get("hasEmulatedSD")?A(d.misc.ALERT_TIP_NO_SD_CARD):e.wonder.contact.avatarEditor.saveHandleAndShow(this),m({event:"ui.click.contact.edit.avatar"})},clickButtonDelete:function(e){var t=s(e.target),n=t.parent();n.prev().remove(),n.remove()},clickButtonSave:function(){if(!this.validate())return;if(!this.isChanged()){this.template=W,this.render();return}O.detach();var e=this.$('input[type="text"], input[type="email"], textarea, .button-save').prop({disabled:!0}),t=this.buildContactData();H.saveContactAsync(t).done(function(e){this.$el.removeClass("edit"),this.trigger("save",e.body.id),t.mergeIds&&H.deleteContactsAsync(t.mergeIds),j.data.filter=e.body.id,j.trigger("update")}.bind(this)).always(function(){e.prop({disabled:!1})})},clickButtonDial:function(n){if(V===t){var r=s(n.target).data("phone-number"),i=new e.AndroidIntent("android.intent.action.DIAL","","tel:"+r,"","","");i.startActivity(),V=new l({$host:s(n.originalEvent.srcElement),$content:s("<div>").width(140).html(d.contact.DIAL_SUCCESS),alignToHost:!1,popIn:!0,autoClose:2e3}),V.destoryBlurToHideMixin(),V.show(),V.once("remove",function(){V=t}),m({event:"ui.click.contact.dial"})}},events:{"click .button-dial":"clickButtonDial","click .button-email":"clickButtonEmail","click .button-edit":"clickButtonEdit","click .button-cancel":"clickButtonCancel","click .button-avatar":"clickButtonAvatar","click .button-delete":"clickButtonDelete","click .button-save":"clickButtonSave"}}),J,K=r.extend({getInstance:function(){return J||(J=new $),J}});return K})}(this),function(e,t){define("contact/Contact",["contact/models/ContactModel","contact/collections/ContactsCollection","contact/collections/AccountCollection","contact/views/BatchContactsView","contact/views/AccountSelectorView","contact/views/GroupSelectorView","contact/views/ImportAutoBackupView","contact/views/DetailPanelView","contact/views/ExportTipWindowView","contact/ContactService"],function(t,n,r,i,s,o,u,a,f,l){var c={ContactModel:t,ContactCollection:n,AccountCollection:r,BatchContactsView:i,AccountSelectorView:s,GroupSelectorView:o,ImportAutoBackupView:u,DetailPanelView:a,ExportTipWindowView:f,ContactService:l};return e.Contact=c,c})}(this),function(e,t){define("backuprestore/BackupRestoreService",["backbone","underscore","jquery","IOBackendDevice","Device","Configuration","Environment","Internationalization","Log","utilities/StringUtil","utilities/FormatDate","ui/Notification","ui/AlertWindow","ui/BatchActionWindow"],function(n,r,i,s,o,u,a,f,l,c,h,p,d,v){console.log("BackupRestoreService - File loaded.");var m=e.alert,g=r.extend(function(){},n.Events);return g.CONSTS={ViewHeight:360,ViewWidth:520,ViewWidthTip:380,DefaultSnapshot:{Base:864e5,Size:20},AllDataTypes:[1,2,3],ErrorCodeToMessage:{3:f.backup_restore.SD_CARD_ERROR,4:f.backup_restore.SD_CARD_ERROR,5:f.backup_restore.SD_CARD_ERROR,6:f.backup_restore.SD_CARD_ERROR,9:f.backup_restore.SD_CARD_ERROR,400:f.backup_restore.FILE_DOWNLOAD_ERROR,402:f.backup_restore.CANCELED,412:f.backup_restore.SD_CARD_ERROR,500:f.backup_restore.RESTORE_CONNECTION_LOST,709:f.backup_restore.ERROR_WHEN_WRITE_ROM,720:f.backup_restore.RESTORE_INVLID_FILE,723:f.backup_restore.BACKUP_RESTORE_RUNING,733:f.backup_restore.BACKUP_TO_CLOUD_FAILED,735:f.backup_restore.BACKUP_APP_DATA_ERROR_DEVICE_INCOMPATIBLE,736:f.backup_restore.BACKUP_APP_DATA_ERROR_DEVICE_WIFI,737:f.backup_restore.BACKUP_APP_DATA_ERROR_ENCRYPT,738:f.backup_restore.BACKUP_APP_DATA_ERROR_CONNECT_ERROR,739:f.backup_restore.USER_CANCELED,740:f.backup_restore.CUSTOM_AUTH_FAILED_ERROR,741:f.backup_restore.CUSTOM_SERVER_UNAVALABEL_ERROR,746:f.backup_restore.CUSTOM_UNZIP_BACKUP_FILE_ERROR},BR_STATUS:{READY:1,RUNNING:2,PAUSED:3,STOPPED:4,FINISHED:5,ERROR:6,ABORT:7,PC_ZIP_ERROR:8},BR_PI_STATUS:{WAITING:0,READY:1,RUNNING:2,FINISHED:3,ERROR:4},SYNC_PROGRESS:{FAILED:0,START:1,RUNNING:2,COMPLETED:3}},g.recordCurrentBackupAsync=function(){var e=i.Deferred();return s.requestAsync({url:u.actions.RECORD_CURRENT_BACKUP_TIME,success:function(t){t.state_code===200?e.resolve(t):e.reject(t)}}),e.promise()},g.closeAllNotificationAsync=function(){var e=i.Deferred();return s.requestAsync({url:u.actions.CLOSE_ALL_NOTIFICATION,success:function(t){t.state_code===200?e.resolve(t):e.reject(t)}}),e.promise()},g.closeAllNotificationInHelperAsync=function(){var e=i.Deferred();return s.requestAsync({url:u.actions.CLOSE_ALL_NOTIFICATION_HELPER,success:function(t){t.state_code===200?e.resolve(t):e.reject(t)}}),e.promise()},g.closeAllNotificationAutoAsync=function(e){e?g.closeAllNotificationInHelperAsync():g.closeAllNotificationAsync()},g.prepareBackupAsync=function(){var e=i.Deferred();return s.requestAsync({url:u.actions.BACKUP_PREPARE,success:function(t){t.state_code===200?e.resolve(t):e.reject(t)}}),e.promise()},g.getAppDataCountAsync=function(){var e=i.Deferred();return s.requestAsync({url:u.actions.APP_GET_APP_DATA_COUNT,success:function(t){t.state_code===200?e.resolve(t):e.reject(t)}}),e.promise()},g.getDeviceTitleAsync=function(){var e=i.Deferred();return s.requestAsync({url:u.actions.DEVICE_TITLE,success:function(t){t.state_code===200?e.resolve(t):e.reject(t)}}),e.promise()},g.getSettingPathAsync=function(){var e=i.Deferred();return s.requestAsync({url:u.actions.BACKUP_GET_SETTING,success:function(t){t.state_code===200?e.resolve(t):e.reject(t)}}),e.promise()},g.setSettingPathAsync=function(e){var t=i.Deferred();return s.requestAsync({url:u.actions.BACKUP_SET_SETTING,data:{should_change:e?1:0},success:function(e){e.state_code===200||e.state_code===402?t.resolve(e):t.reject(e)}}),t.promise()},g.checkFileAsync=function(e){var t=i.Deferred();return s.requestAsync({url:u.actions.BACKUP_CHECK_FILE,data:{file_dir:e},success:function(e){var n=parseInt(e.body.value,10),r=n===0||n===1;e.state_code===200&&r?t.resolve(e):t.reject(e)}}),t.promise()},g.backupStartNonAppsAsync=function(e,t,n){var r=i.Deferred();return s.requestAsync({type:"POST",url:u.actions.BACKUP_START+"?file_dir="+encodeURIComponent(e)+"&session="+t,data:n,success:function(e){e.state_code===200?r.resolve(e):r.reject(e)}}),r.promise()},g.backupStartAppsAsync=function(e,t,n){var r=i.Deferred();return s.requestAsync({url:u.actions.APP_EXPORT,data:{export_dir:e,session:t,file_type:n,source:"welcome_backup"},success:function(e){e.state_code===200?r.resolve(e):r.reject(e)}}),r.promise()},g.loadAppListAsync=function(e){var t=i.Deferred();return s.requestAsync({url:u.actions.APP_SHOW,data:{filter:5,package_name:r.pluck(e,"item").join(",")},success:function(e){e.state_code===200?t.resolve(e):t.reject(e)}}),t.promise()},g.backupCancelAsync=function(e){var t=i.Deferred();return s.requestAsync({url:u.actions.BACKUP_CANCEL,data:{session:e},success:function(e){e.state_code===200?t.resolve(e):t.reject(e)}}),t.promise()},g.backupFinishAsync=function(e){var t=i.Deferred();return s.requestAsync({url:u.actions.BACKUP_FINISH,data:{file_dir:e},success:function(e){e.state_code===200?t.resolve(e):t.reject(e)}}),t.promise()},g.showFileAsync=function(e){var t=i.Deferred();return s.requestAsync({url:u.actions.SHOW_FILE,data:{file_path:e},success:function(e){e.state_code===200?t.resolve(e):t.reject(e)}}),t.promise()},g.backupStartAppDataAsync=function(e,t){var n=i.Deferred();return s.requestAsync({url:u.actions.APP_EXPORT_APP_DATA,data:{export_dir:e,session:t},success:function(e){e.state_code===200?n.resolve(e):n.reject(e)}}),n.promise()},g.syncContactAccountsAsync=function(){var e=i.Deferred();return s.requestAsync({url:u.actions.CONTACT_SYNCED_ACCOUNTS,success:function(t){t.state_code===200?e.resolve(t):e.reject(t)}}),e.promise()},g.listRestoreFileAsync=function(){var e=i.Deferred();return s.requestAsync({url:u.actions.RESTORE_BACKUP_FILE,success:function(t){t.state_code===200?e.resolve(t):e.reject(t)}}),e.promise()},g.selectRestoreFileAsync=function(){var e=i.Deferred();return s.requestAsync({url:u.actions.RESTORE_FILE_SELECT,success:function(t){t.state_code===200||t.state_code===402?e.resolve(t):e.reject(t)}}),e.promise()},g.readRestoreFileAsync=function(e){var t=i.Deferred();return s.requestAsync({url:u.actions.RESTORE_READ_FILE,data:{file_name:e},success:function(e){e.state_code===200?t.resolve(e):t.reject(e)}}),t.promise()},g.restoreStartNonAppsAsync=function(e,t,n,r,o){var a=i.Deferred();return s.requestAsync({type:"POST",url:u.actions.RESTORE_START+"?file_name="+encodeURIComponent(e)+"&account_type="+encodeURIComponent(n)+"&account_name="+encodeURIComponent(r)+"&session="+t,data:o,success:function(e){e.state_code===200?a.resolve(e):a.reject(e)}}),a.promise()},g.restoreStartAppsAsync=function(e,t){var n=i.Deferred();return s.requestAsync({url:u.actions.RESTORE_APPS,data:{file_name:e,app_data:t?1:0},success:function(e){e.state_code===200?n.resolve(e):n.reject(e)}}),n.promise()},g.restoreFinishAsync=function(e){var t=i.Deferred();return s.requestAsync({url:u.actions.RESTORE_FINISH,data:{file_name:e},success:function(e){e.state_code===200?t.resolve(e):t.reject(e)}}),t.promise()},g.restoreRetryAsync=function(){var e=i.Deferred();return s.requestAsync({url:u.actions.RESTORE_RETRY,success:function(t){t.state_code===200?e.resolve(t):e.reject(t)}}),e.promise()},g.restoreResumeAsync=function(e){var t=i.Deferred();return s.requestAsync({url:u.actions.RESTORE_RESUME,data:{session:e},success:function(e){e.state_code===200?t.resolve(e):t.reject(e)}}),t.promise()},g.restoreCancelAsync=function(e){var t=i.Deferred();return s.requestAsync({url:u.actions.RESTORE_CANCEL,data:{session:e},success:function(e){e.state_code===200?t.resolve(e):t.reject(e)}}),t.promise()},g.restoreClearDataAsync=function(){var e=i.Deferred();return s.requestAsync({url:u.actions.RESTORE_CLEAR,success:function(t){t.state_code===200?e.resolve(t):e.reject(t)}}),e.promise()},g.remoteManualBackupAsync=function(e,t){var n=i.Deferred();return s.requestAsync({url:u.actions.SYNC_MANUAL_BACKUP,data:{types:e.join(","),session:t},success:function(e){e.state_code===200?n.resolve(e):n.reject(e)}}),n.promise()},g.getRemoteAutoBackupSwitchAsync=function(){var e=i.Deferred();return s.requestAsync({url:u.actions.SYNC_IS_SWITCH_ON,success:function(t){t.state_code===200?e.resolve(t):e.reject(t)}}),e.promise()},g.setRemoteAutoBackupSwitchAsync=function(){var e=i.Deferred();return s.requestAsync({url:u.actions.SYNC_SET_SWITCH,data:{contact:1,sms:1,app:1},success:function(t){t.state_code===200?e.resolve(t):e.reject(t)}}),e.promise()},g.stopRemoteSyncAsync=function(){var e=i.Deferred();return s.requestAsync({url:u.actions.SYNC_STOP_REMOTE_SYNC,success:function(t){t.state_code===200?e.resolve(t):e.reject(t)}}),e.promise()},g.getTomorrowTime=function(){var e=new Date;return e.setHours(24),e.setMinutes(0),e.setSeconds(0),e.getTime()},g.remoteSnapshotListAutoAsync=function(e){var n=e===t?g.getTomorrowTime():e.timestamp-1,r=g.CONSTS.DefaultSnapshot.Base,i=g.CONSTS.DefaultSnapshot.Size;return g.remoteSnapshotListAsync(n,r,i)},g.remoteSnapshotListAsync=function(e,t,n){var r=i.Deferred();return s.requestAsync({url:u.actions.SYNC_SNAPSHOT_LIST,data:{timestamp:e,base:t,size:n},success:function(e){e.state_code===200?r.resolve(e):r.reject(e)}}),r.promise()},g.remoteSnapshotInfoAllTypesAsync=function(e,t){return g.remoteSnapshotInfoAsync(e,t,g.CONSTS.AllDataTypes)},g.remoteSnapshotInfoAsync=function(e,t,n){var r=i.Deferred();return s.requestAsync({url:u.actions.SYNC_SNAPSHOT_INFO,data:{version:e,udid:t,types:n.join(",")},success:function(e){e.state_code===200?r.resolve(e):r.reject(e)}}),r.promise()},g.remoteSnapshotFileAsync=function(e,t,n,r){var o=i.Deferred();return s.requestAsync({url:u.actions.SYNC_SNAPSHOT_FILE,data:{version:e,udid:t,types:n.join(","),session:r},success:function(e){e.state_code===200?o.resolve(e):o.reject(e)}}),o.promise()},g.getServerTypeFromBRType=function(e){switch(e){case 1:return u.enums.BR_TYPE_CONTACT;case 2:return u.enums.BR_TYPE_SMS;case 3:return u.enums.BR_TYPE_APP;default:return console.error(e),-1}},g.getBRTypeFromServerType=function(e){switch(e){case u.enums.BR_TYPE_CONTACT:return 1;case u.enums.BR_TYPE_SMS:return 2;case u.enums.BR_TYPE_APP:return 3;default:return console.error(e),-1}},g.GetBRTypeBy30x0x=function(e){switch(Math.round(e/100)){case Math.round(u.enums.SYNC_DATA_TYPE_CONTACTS/100):return u.enums.BR_TYPE_CONTACT;case Math.round(u.enums.SYNC_DATA_TYPE_SMS/100):return u.enums.BR_TYPE_SMS;case Math.round(u.enums.SYNC_DATA_TYPE_APP/100):return u.enums.BR_TYPE_APP;default:return-1}},g.FormatRestoreSnapshotList=function(e){var t=function(e,t){return e.getYear()===t.getYear()&&e.getMonth()===t.getMonth()&&e.getDate()===t.getDate()},n=function(e){var n=new Date(e),r=new Date,i=new Date(r-864e5),s="";t(n,r)?s=f.common.TODAY:t(n,i)?s=f.common.YESTODAY:a.get("locale")===u.enums.LOCALE_EN_US?s=h("MM / dd / yyyy",e):s=h("yyyy-MM-dd",e);var o=n.toString().substr(16,8);return s+" "+o},i=[];return r.each(e,function(e){var t={version:e.version,timestamp:n(e.timestamp),deviceName:e.deviceName||f.backup_restore.RESTORE_UNKNOW_DEVICE,udid:e.udid};i.push(t)}),i},g.getErrorMessage=function(e){var t=g.CONSTS.ErrorCodeToMessage[e];return t=t||f.backup_restore.UNKNOW_ERROR+e,t.toString()},g.recordError=function(e,t,n){l({event:e,state_code:t.state_code||-1,state_line:t.state_line||"",type:n})},g.showAndRecordError=function(e,t,n){m(this.getErrorMessage(t.state_code)),this.recordError(e,t,n)},g.logBackupContextModel=function(e,t){l({event:"debug.backup.context."+(t?"success":"failed"),is_local:e.IsLocal,data_id_list:e.get("dataIDList").join(","),appt_type:e.get("appType"),full_file_name:e.GetFullFilePath,sms_error_num:e.get("smsErrorList").length,contacts_error_num:e.get("contactsErrorList").length,app_error_num:e.get("appErrorList").length,product_id:o.get("productId")})},g.logRestoreContextModel=function(e,t){l({event:"restore.context."+(t?"success":"failed"),is_local:e.IsLocal,backup_file_list:e.get("backupFileList").length,full_file_name:e.get("fileName"),data_id_list:e.get("dataIDList").join(","),udid:e.get("udid"),snapshot_list_num:e.get("snapshotList").length,product_id:o.get("productId")})},g})}(this),function(e,t){define("message/views/MessageSender4NotificationView",["doT","underscore","Configuration","IOBackendDevice","Environment","Device","ui/TemplateFactory","message/views/QuickSenderView","message/models/MessageModel","message/collections/ThreadsCollection","message/collections/Threads4ContactCollection","backuprestore/BackupRestoreService"],function(e,t,n,r,i,s,o,u,a,f,l,c){console.log("MessageSender4NotificationView - File loaded.");var h=u.getClass().extend({className:"w-sms-notification-sender vbox",template:e.template(o.get("message","message-notification-sender")),initialize:function(){var e=[],t=[];Object.defineProperties(this,{addresses:{get:function(){return this.model.get("address")}},nextList:{get:function(){return e}},prevList:{get:function(){return t}}}),s.on("change:isConnected",function(e,t){this.$(".button-send").prop({disabled:!t})},this),r.Backend.Device.onmessage({"data.channel":n.events.SMS_CALLLOG_SMS_RECEIVE},function(e){this.nextList.push((new a(e)).toJSON()),this.$(".button-next").show()},this),this.on("sendSuccess",function(){this.nextList.length===0&&this.prevList.length===0?r.requestAsync({url:n.actions.PUBLISH_EVENT,data:{value:JSON.stringify(this.model.toJSON()),channel:n.events.MESSAGE_CLOSE_MESSAGE_NOTIFICATION}}):this.nextList.length>0?(this.markAsRead(),this.nextMessage(!0)):(this.markAsRead(),this.prevMessage(!0))},this)},render:function(){return t.extend(this.events,h.__super__.events),this.delegateEvents(),this.$el.html(this.template({})),this.$(".button-send").prop({disabled:!s.get("isConnected")}),this.$(".button-delete").show(),this},nextMessage:function(e){this.$(".input-content").val(""),e||this.prevList.push(this.model.toJSON()),this.prevList.length>0&&this.$(".button-prev").show(),this.model.clear({silent:!0}),this.model.set(this.nextList.shift()),this.nextList.length===0&&this.$(".button-next").hide()},prevMessage:function(e){this.$(".input-content").val(""),e||this.nextList.unshift(this.model.toJSON()),this.nextList.length>0&&this.$(".button-next").show(),this.model.clear({silent:!0}),this.model.set(this.prevList.pop()),this.prevList.length===0&&this.$(".button-prev").hide()},markAsRead:function(){r.requestAsync({url:n.actions.PUBLISH_EVENT,data:{value:JSON.stringify(this.model.toJSON()),channel:n.events.MESSAGE_MARK_AS_READ}})},deleteMessage:function(){this.$(".button-delete").removeClass("link"),this.model.deleteMessageAsync().done(function(){c.closeAllNotificationAsync()}).always(function(){this.$(".button-delete").addClass("link")})},clickButtonDelete:function(){this.deleteMessage()},clickButtonNext:function(){this.markAsRead(),this.nextMessage()},clickButtonPrev:function(){this.markAsRead(),this.prevMessage()},events:{"click .button-delete":"clickButtonDelete","click .button-next":"clickButtonNext","click .button-prev":"clickButtonPrev"}}),p=t.extend(function(){},{getInstance:function(e){return new h(e)}});return p})}(this),function(e,t){define("message/views/NewMessageNotificationView",["backbone","doT","underscore","IO","Configuration","Environment","Internationalization","utilities/QueryString","utilities/StringUtil","ui/TemplateFactory","message/views/MessageSender4NotificationView"],function(t,n,r,i,s,o,u,a,f,l,c){console.log("NewMessageNotificationView - File loaded.");var h=e.document,p,d=t.View.extend({className:"w-sms-notification",template:n.template(l.get("message","message-notification")),initialize:function(){p=c.getInstance({model:this.model,enableTip:!1}),this.model.on("change",function(e){this.$(".w-sms-notification-avatar img").attr({src:e.get("contact_icon"),alt:e.get("contact_name")}),this.$(".w-sms-notification-body .body").html(e.get("body")),this.$(".w-sms-notification-body .date").html(f.formatDate(" - hh:mm",e.get("date"))),this.updateNotificationTitle()},this)},updateNotificationTitle:function(){i.requestAsync({url:s.actions.UPDATE_NOTIFICATION_TITLE,data:{title:f.format(u.message.MESSAGE_FROM,this.model.get("contact_name")),url:h.URL},success:function(e){e.state_code===200?console.log("NewMessageNotificationView - Update window title success."):console.error("NewMessageNotificationView - Update window title failed. Error info: "+e.state_line)}})},render:function(){return this.$el.html(this.template(this.model.toJSON())),this.$el.append(p.render().$el),this}}),v=r.extend(function(){},{getInstance:function(e){return new d(e)}});return v})}(this),function(e,t){define("message/Message",["message/views/ThreadsMessageItemView","message/collections/MessageCollection","message/collections/ThreadsCollection","message/collections/Threads4ContactCollection","message/collections/ConversationsCollection","message/views/NewMessageNotificationView","message/views/MessageSenderView","message/views/BatchContactsSelectorView","message/views/ThreadsPanelView","message/views/ThreadsPanel4ContactView","message/views/MessageSender4ThreadsPanelView","message/views/ConversationsListView","message/views/MessageModuleToolbarView","message/views/BatchConversationsView","message/views/ImportAutoBackupView","message/MessageService"],function(t,n,r,i,s,o,u,a,f,l,c,h,p,d,v,m){console.log("Message - File loaded.");var g={ThreadsMessageItemView:t,NewMessageNotificationView:o,ThreadsCollection:r,Threads4ContactCollection:i,MessageCollection:n,ConversationsCollection:s,MessageSenderView:u,BatchContactsSelectorView:a,ThreadsPanelView:f,ThreadsPanel4ContactView:l,MessageSender4ThreadsPanelView:c,ConversationsListView:h,MessageModuleToolbarView:p,BatchConversationsView:d,ImportAutoBackupView:v,MessageService:m};return e.Message=g,g})}(this),function(e,t){define("video/models/VideoModel",["backbone"],function(e){console.log("VideoModel - File loaded. ");var t=e.Model.extend({});return t})}(this),function(e,t){define("video/collections/VideosCollection",["underscore","backbone","jquery","IOBackendDevice","Configuration","Device","video/models/VideoModel","main/collections/PIMCollection"],function(e,t,n,r,i,s,o,u){console.log("VideosCollection - File loaded.");var a=t.Collection.extend({model:o,url:i.actions.VIDEO_SHOW,parse:function(t){t.state_code===202&&s.get("isConnected")&&(console.log("VideosCollection - Video is syncing."),this.syncing=!0,this.trigger("syncStart"));var n=[];return e.each(t.body,function(e){n.concat(e)}),n},syncAsync:function(){var e=n.Deferred();return this.syncing=!0,this.trigger("syncStart"),r.requestAsync({url:i.actions.VIDEO_SYNC,success:function(t){t.state_code===200?(console.log("VideosCollection - Video sync success."),e.resolve(t)):(console.error("VideosCollection - Video sync failed. Error info: "+t.state_line),e.reject(t))}}),e.promise()},initialize:function(){var e=!1,t=!1;Object.defineProperties(this,{loading:{set:function(t){e=Boolean(t)},get:function(){return e}},syncing:{set:function(e){t=Boolean(e)},get:function(){return t}}}),this.on("update",function(){e=!0,this.fetch({success:function(t){console.log("VideosCollection - Collection fetched."),e=!1,t.trigger("refresh",t)}})},this),r.Backend.Device.onmessage({"data.channel":i.events.VIDEO_UPDATED},function(e){t&&(t=!1,this.trigger("syncEnd")),e?this.trigger("update"):this.trigger("refresh",this)},this)},importAsync:function(t,s){var o=n.Deferred();return r.requestAsync({url:i.actions.VIDEO_IMPORT,data:{file_path_list:JSON.stringify({video:e.map(t,function(e){return{path:e}})}),session:s||""},success:function(e){e.state_code===200?(console.log("VideosCollection - Import success. "),this.syncAsync(),o.resolve(e)):e.state_code===402?(this.syncAsync(),o.reject(e)):(console.error("VideosCollection - Import failed. Error info: "+e.state_line),o.reject(e))}.bind(this)}),o.promise()},deleteAsync:function(e,t){var s=n.Deferred();return r.requestAsync({url:i.actions.VIDEO_DELETE,data:{video_id_list:e.join(","),session:t},success:function(e){e.state_code===200?(console.log("VideosCollection - Delete success. "),this.syncAsync(),s.resolve(e)):e.state_code===402?(this.syncAsync(),s.reject(e)):(console.error("VideosCollection - Delete failed. Error info: "+e.state_line),s.reject(e))}.bind(this)}),s.promise()}}),f,l=e.extend({getInstance:function(){return f||(f=new a,f.trigger("update"),f.on("refersh",function(e){u.getInstance().get(6).set({count:e.length})}),s.on("change:isMounted",function(e,t){t?u.getInstance().get(6).set({count:0}):u.getInstance().get(6).set({count:f.length})})),f}});return l})}(this),function(e){define("main/views/BatchErrorView",["backbone","underscore","jquery","doT","ui/AlertWindow","Device","Internationalization","ui/TemplateFactory"],function(e,t,n,r,i,s,o,u){console.log("BatchErrorView - File loaded. ");var a=e.View.extend({template:r.template(u.get("misc","batch-error-window")),className:"w-misc-error-window-body",render:function(){return this.$el.html(this.template(this.options)),this}}),f=i.extend({initialize:function(){f.__super__.initialize.apply(this,arguments),this.buttons=[{$button:n("<button>").html(o.ui.RETRY).addClass("primary").prop({disabled:this.options.needConnection?!s.get("isConnected"):!1}),eventName:"button_retry"},{$button:n("<button>").html(o.ui.CANCEL),eventName:"button_cancel"}],this.once("show",function(){var e=new a(this.options);this.$bodyContent=e.render().$el,this.once("remove",function(){e.remove(),this.off()},this)},this),this.options.needConnection&&this.listenTo(s,"change:isConnected",function(e,t){this.buttons[0].$button.prop({disabled:!t})})}}),l=t.extend({getInstance:function(e){return new f(e)}});return l})}(this),function(e,t){define("video/VideoService",["jquery","backbone","underscore","ui/BatchActionWindow","ui/AlertWindow","utilities/StringUtil","Settings","Device","Internationalization","IOBackendDevice","Configuration","video/collections/VideosCollection","main/views/BatchErrorView"],function(n,r,i,s,o,u,a,f,l,c,h,p,d){console.log("VideoService - File loaded. ");var v=e.alert,m=i.extend(function(){},r.Events),g,y=function(e,t,r){var i=n.Deferred();return c.requestAsync({url:h.actions.VIDEO_EXPORT,data:{video_id_list:e.join(","),session:t,export_dir:r||"",default_path:a.get("video_export_default_path")},success:function(e){e.state_code===200?i.resolve(e):i.reject(e)}}),i.promise()};return m.exportVideosAsync=function(e){var t=n.Deferred(),r=p.getInstance(),o=i.uniqueId("video_export_"),u=new s({session:o,progressText:l.video.EXPORT_PROGRESS_TEXT,cancelUrl:h.actions.VIDEO_CANCEL,total:e.length,successText:l.video.EXPORT_SUCCESS_TEXT,delay:!0});if(!g)var f=c.Backend.Device.onmessage({"data.channel":o},function(e){g||(g=e.info,c.Backend.Device.offmessage(f))});return y(e,o,g).done(function(e){a.set("video_export_default_path",g,!0);var n=i.map(e.body.failed,function(e){return e.item});if(n.length>0){u.remove();var s=d.getInstance({tip:l.video.VIDEO_EXPORT_ERROR_TEXT,items:i.map(n,function(e){return r.get(e).get("display_name")}),errorInfo:i.find(e.body.failed,function(e){return e.error_message})});s.once("button_retry",function(){m.exportVideosAsync(n).done(t.resolve).fail(t.reject),s.remove()},this),s.once("button_cancel",function(){g=null,t.reject()}),s.show()}else g=null,t.resolve(e)}).fail(function(e){e.state_code===402?g=null:(v(l.video.EXPORT_FAILED_TEXT),u.remove()),t.reject(e)}),t.promise()},m.importVideosAsync=function(e){var r=n.Deferred(),o=p.getInstance(),u=i.uniqueId("video.import_"),a=new s({session:u,progressText:l.video.IMPORT_PROGRESS_TEXT,cancelUrl:h.actions.VIDEO_CANCEL,total:e.length,successText:l.video.IMPORT_SUCCESS_TEXT,delay:!0});return o.importAsync(e,u).done(function(e){var n=i.map(e.body.failed,function(e){return e.item});if(n.length>0){a!==t&&a.remove();var s=d.getInstance({tip:l.video.VIDEO_IMPORT_ERROR_TEXT,items:i.map(n,function(e){return e.replace(/^.*[\\\/](?=[^\\\/]+$)/,"")}),errorInfo:i.find(e.body.failed,function(e){return e.error_message})});s.on("button_retry",function(){f.get("isConnected")&&(f.get("hasSDCard")||f.get("hasEmulatedSD"))&&(m.importVideosAsync(n).done(r.resolve).fail(r.reject),s.remove())}),s.once("button_cancel",function(){r.reject()}),s.show()}else r.resolve(e)}).fail(function(e){e.state_code!==402&&(e.state_code===500?v(l.video.IMPORT_UNCONNECT_TEXT):v(l.video.IMPORT_FAILED_TEXT),a!==t&&a.remove()),r.reject(e)}),r.promise()},m.selectVideosAsync=function(e){var t=n.Deferred();return c.requestAsync({url:h.actions.VIDEO_SELECT_VIDEO,data:{type:e},success:function(e){e.state_code===200?(console.log("VideoService - Get selected videos success."),t.resolve(e)):(console.error("VideoService - Get selected videos faild. Error info: "+e.state_line),t.reject(e))}}),t.promise()},m.deleteVideosAsync=function(e){var r=n.Deferred(),a=p.getInstance(),f=new o({draggable:!0,disposableName:"videos-delete",buttonSet:"yes_no",$bodyContent:u.format(l.video.DELETE_TIP,e.length)});return f.on("button_yes",function(){var n,o;e.length>1&&(n=i.uniqueId("videos.batch.delete_"),o=new s({session:n,progressText:l.video.DELETE_PROGRESS_TEXT,cancelUrl:h.actions.VIDEO_CANCEL,total:e.length,successText:l.video.DELETE_SUCCESS_TEXT}),o.show()),a.deleteAsync(e,n).done(function(e){var n=i.map(e.body.failed,function(e){return e.item});if(n.length>0){o!==t&&o.remove();var s=d.getInstance({needConnection:!0,tip:l.video.VIDEO_DELETE_ERROR_TEXT,items:i.map(n,function(e){var t=a.get(e);return t?t.get("display_name"):""}),errorInfo:i.find(e.body.failed,function(e){return e.error_message})});s.once("button_retry",function(){m.deleteVideosAsync(n).done(r.resolve).fail(r.reject),s.remove()}),s.once("button_cancel",function(){r.reject()}),s.show()}else r.resolve(e)}).fail(function(e){e.state_code!==402&&v(l.video.DELETE_VIDEO_ERROR),r.reject(e)})},this),f.show(),r.promise()},m})}(this),function(e,t){define("video/views/VideoItemView",["underscore","doT","ui/TemplateFactory","ui/BaseListItem"],function(e,t,n,r){console.log("VideoItemView - File loaded. ");var i=r.extend({template:t.template(n.get("video","video-item")),className:"w-video-list-item hbox",render:function(){return this.$el.html(this.template(this.model.toJSON())),this}}),s=e.extend({getInstance:function(e){return new i(e)},getClass:function(){return i}});return s})}(this),function(e,t){define("video/views/ImportVideoView",["backbone","doT","underscore","ui/Panel","ui/TemplateFactory","ui/AlertWindow","ui/SmartList","ui/behavior/ButtonSetMixin","utilities/StringUtil","IOBackendDevice","Configuration","Internationalization","Device","video/VideoService","video/models/VideoModel","video/views/VideoItemView"],function(e,n,r,i,s,o,u,a,f,l,c,h,p,d,v,m){console.log("ImportVideoView - File loaded.");var g,y,b,w=e.View.extend({initialize:function(){p.on("change",this.setContent,this),p.get("hasEmulatedSD")?p.getDeviceCapacityAsync():p.getSDCapacityAsync()},render:function(){var e=f.format(h.misc.SELECTOR_DESCRIPTION_TEXT,y.selected.length,y.currentModels.length);return p.get("hasEmulatedSD")?(e+=f.format(h.misc.DEVICE_CAPACITY_REMAIN,f.readableSize(p.get("internalFreeCapacity"))),p.getDeviceCapacityAsync().done(this.setContent.bind(this))):(e+=f.format(h.misc.SD_CAPACITY_REMAIN,f.readableSize(p.get("externalFreeCapacity"))),p.getSDCapacityAsync().done(this.setContent.bind(this))),this.$el.html(e),this},setContent:function(){var e=0;r.each(y.selected,function(t){e+=parseInt(g.collection.get(t).get("size"),0)});var t=f.format(h.misc.SELECTOR_DESCRIPTION_TEXT,y.selected.length,y.currentModels.length);p.get("hasEmulatedSD")?t+=f.format(h.misc.DEVICE_CAPACITY_REMAIN,f.readableSize(Math.max(p.get("internalFreeCapacity")-e,0))):t+=f.format(h.misc.SD_CAPACITY_REMAIN,f.readableSize(Math.max(p.get("externalFreeCapacity")-e,0))),this.$el.html(t)}}),E,S=e.View.extend({template:n.template(s.get("video","local-import-body")),className:"w-video-local-import vbox",initialize:function(){this.collection=new e.Collection,E=new o({$bodyContent:h.video.ADD_VIDEO_LOADING})},render:function(){return this.$el.html(this.template({})),y=new u({itemView:m.getClass(),dataSet:[{name:"default",getter:function(){return[]}}],keepSelect:!1,$observer:this.$(".check-select-all"),$header:this.$("header"),itemHeight:29,listenToCollection:this.collection}),y.on("switchSet",function(e){y.emptyTip=h.video.VIDEO_ADDOR_GRID_TIP,y.toggleEmptyTip(y.currentModels.length===0),b&&b.setContent()}),y.on("select:change",function(){b&&b.setContent()}),this.$(".w-video-local-import-list").append(y.render().$el),y.emptyTip=h.video.VIDEO_ADDOR_GRID_TIP,y.toggleEmptyTip(!0),this},parseVideos:function(e){var n=[],i=[];r.each(e.body.video,function(e){e.id=f.MD5(e.path),n.push(new v(e))});var s=[];r.each(n,function(e){var n=this.collection.get(e.id);n!==t?n.set(e.toJSON()):this.collection.add(e),s.push(e.id)},this),y.switchSet("default",function(){return this.collection.models}.bind(this)),y.addSelect(s)},selectVideos:function(e){E.show(),d.selectVideosAsync(e).done(this.parseVideos.bind(this)).always(function(){E.close()})},clickButtonAddFile:function(){this.selectVideos(0)},clickButtonAddFolder:function(){this.selectVideos(1)},clickButtonManageSD:function(){var e=this.$(".button-manage-sd").prop("disabled",!0);setTimeout(function(){e.prop("disabled",!1)}.bind(this),2e3),p.manageSDCardAsync()},events:{"click .button-add-file":"clickButtonAddFile","click .button-add-folder":"clickButtonAddFolder","click .button-manage-sd":"clickButtonManageSD"}}),x=i.extend({initialize:function(){x.__super__.initialize.apply(this,arguments),this.on("show",function(){g=(new S).render(),this.resp&&(g.parseVideos(this.resp),delete this.resp),this.$bodyContent=g.$el,b=new w,this.$(".w-ui-window-footer-monitor").append(b.render().$el)},this),this.on("button_yes",this.import,this)},"import":function(){var e=[];r.each(y.selected,function(n){var r=g.collection.get(n);r!==t&&e.push(r.get("path"))}),e.length>0&&d.importVideosAsync(e),this.close()}}),T,N=r.extend({getInstance:function(){return T||(T=new x({title:h.video.ADD_LOCAL_VIDEO_TEXT,height:480,width:630,buttonSet:a.BUTTON_SET.YES_CANCEL})),T}});return N})}(this),function(e,t){define("utilities/FlashDetector",["underscore"],function(n){console.log("FlashDetector - File loaded. ");var r=e.navigator,i=n.extend({getVersion:function(){var e=0;if(r.plugins&&r.plugins.length>0){var i=r.plugins["Shockwave Flash"];if(i){e=1;var s=i.description.split(" "),o;for(o=s.length;o--;t)n.isNaN(parseInt(s[o],10))||(e=parseInt(s[o],10))}}return e}});return i})}(this),function(e,t){define("browser/views/BrowserMenuView",["underscore","backbone","doT","jquery","Log","ui/TemplateFactory"],function(e,t,n,r,i,s){console.log("BrowserMenuView - File loaded.");var o=t.View.extend({tagName:"ul",className:"w-browser-menu hbox",template:n.template(s.get("doraemon","browser-menu")),initialize:function(){this.options.$iframe.on("readystatechange",function(e){e.originalEvent.srcElement.readyState==="loading"&&this.selectTargetItem()}.bind(this)),this.listenTo(this.model,"change:extension",this.render)},remove:function(){this.options.$iframe.remove(),o.__super__.remove.call(this)},selectTargetItem:function(){var e=this.options.$iframe[0].contentDocument;if(e){var t=this.$('li.root-item[data="'+e.location.href+'"]');t.length>0&&(this.$(".root-item.selected").removeClass("selected"),t.addClass("selected"))}},render:function(){return this.$el.html(this.template(this.model.toJSON())),this.selectTargetItem(),this},clickRootItem:function(e){var t=r(e.currentTarget);t.hasClass("selected")||(this.$(".root-item.selected").removeClass("selected"),t.addClass("selected"));var n=t.attr("data");this.trigger("select",n),i({event:"ui.click.dora.browser.menu",extensionId:this.model.id,url:n})},events:{"click .root-item":"clickRootItem"}}),u=e.extend({getInstance:function(e){return new o(e)}});return u})}(this),function(e,t){define("doraemon/models/ExtensionModel",["IOBackendDevice","Configuration","Internationalization"],function(e,t,n){console.log("ExtensionModel - File loaded.");var r=function(e){var t=_.pluck(this.collection.getNormalPlugins(),"id"),n=t.indexOf(this.id),r=t[n+e]||(e>0?t[t.length-1]:t[0]),i=t.indexOf(r),s=[],o=[],u=[],a=[];return e>0?(o=t.slice(0,n),t.indexOf(r)!==t.length?(u=t.slice(n+1,i+1),a=t.slice(i+1,t.length)):u=t.slice(n+1,t.length),s=s.concat(o).concat(u).concat([this.id]).concat(a)):(t.indexOf(r)!==0?(o=t.slice(0,i),u=t.slice(i,n)):u=t.slice(0,n),a=t.slice(n+1,t.length),s=s.concat(o).concat([this.id]).concat(u).concat(a)),s},i=Backbone.Model.extend({defaults:{selected:!1,highlight:!1,preview:!1,developer:"",category:"",displayCategory:"",fav:"",star:0},initialize:function(){this.on("change:selected",function(e,t){t&&this.collection.trigger("itemSelected",e)},this),this.get("dev_mode")&&this.set({cateid:"dev",catetitle:"本地插件"}),this.get("cateid")&&this.set({displayCategory:n.misc["EXT_CATE_"+this.get("cateid").toUpperCase()]})},setCategory:function(e,t){this.set({displayCategory:n.misc["EXT_CATE_"+this.get("category").toUpperCase()]})},zipAsync:function(){var n=$.Deferred();return e.requestAsync({url:t.actions.ZIP_PACKAGE,data:{src_path:this.get("path"),dst_path:this.get("path")+".wdx"},success:function(e){e.state_code===200?(console.log("ExtensionModel - Zip extension success."),n.resolve(e)):(console.error("ExtensionModel - Zip extension faild. Error info: "+e.state_line),n.reject(e))}}),n.promise()},downloadAsync:function(){var n=$.Deferred(),r=function(e){e.state_code===200?(console.log('ExtensionModel - Load extension with id = "'+this.get("id")+'" success. '),this.set(JSON.parse(e.body.value)),n.resolve(e)):e.state_code!==202&&(console.error('ExtensionModel - Load extension with id = "'+this.get("id")+'" failed. Error info: '+e.state_line),n.reject(e))}.bind(this);return this.id!==305?e.requestAsync({url:this.get("preview")?t.actions.PLUGIN_PREVIEW:t.actions.PLUGIN_LOAD,data:{id:this.get("id"),name:this.get("name"),dev_mode:Number(this.get("dev_mode")===!0)},success:r}):e.requestAsync({url:t.actions.PLUGIN_LOAD_LOCAL,data:{id:this.get("id"),name:this.get("name")},success:r}),n.promise()},setOrderAsync:function(n){var i=$.Deferred(),s=r.call(this,n);return e.requestAsync({url:t.actions.PLUGIN_UPDATE,data:{list:s.join(",")},success:function(e){e.state_code===200?(console.log("ExtensionModel - Update success."),i.resolve(e)):(console.error("ExtensionModel - Update failed. Error info: "+e.state_line),i.reject(e))}}),i.promise()},unstarredAsync:function(){var n=$.Deferred();return e.requestAsync({url:t.actions.PLUGIN_REMOVE,data:{id:this.id,dev_mode:Number(this.get("dev_mode")===!0)},success:function(e){e.state_code===200?(console.log("ExtensionModel - Remove success."),this.collection&&this.collection.remove(this),n.resolve(e)):(console.error("ExtensionModel - Remove failed. Error info: "+e.state_line),n.reject(e))}.bind(this)}),n.promise()},starAsync:function(){var n=$.Deferred();return e.requestAsync({url:t.actions.PLUGIN_ADD,data:{id:this.id,name:this.get("name"),dev_mode:Number(this.get("dev_mode")===1),star:this.get("star")},success:function(e){e.state_code===200?(console.log("ExtensionModel - Add success."),this.set(JSON.parse(e.body.value)).unset("extensionPreview",{silent:!0}),n.resolve(e)):(console.error("ExtensionModel - Add failed. Error info: "+e.state_line),n.reject(e))}.bind(this)}),n.promise()}});return i})}(this),function(e,t){define("doraemon/collections/ExtensionsCollection",["backbone","jquery","underscore","Configuration","Account","Device","IOBackendDevice","Internationalization","doraemon/models/ExtensionModel"],function(e,n,r,i,s,o,u,a,f){console.log("ExtensionsCollection - File loaded.");var l=function(e){var t=n.Deferred();return e.length!==0?u.requestAsync({url:i.actions.PLUGIN_REMOVE,data:{id:e.join(","),dev_mode:0},success:function(e){e.state_code===200?(console.log("ExtensionsCollection - Remove success."),t.resolve(e)):(console.error("ExtensionsCollection - Remove failed. Error info: "+e.state_line),t.reject(e))}}):t.resolve(),t.promise()},c=function(e){var t=n.Deferred();return e.length===0?t.resolve():u.requestAsync({url:i.actions.PLUGIN_REMOVE,data:{id:e.join(","),dev_mode:1},success:function(e){e.state_code===200?t.resolve(e):(console.error("ExtensionsCollection - Remove failed. Error info: "+e.state_line),t.reject(e))}}),t.promise()},h=e.Collection.extend({url:i.actions.PLUGIN_LIST,model:f,parse:function(e){var t=[];try{t=JSON.parse(e.body.value).sidebar,r.each(t,function(e,t){e.order=t})}catch(n){}return t},comparator:function(e){return e.get("order")},initialize:function(){var e=!1;Object.defineProperties(this,{loading:{set:function(t){e=Boolean(t)},get:function(){return e}}}),this.on("update",function(){e||(e=!0,this.fetch({success:function(t){console.log("ExtensionsCollection - Collection fetched.",t),e=!1,t.trigger("refresh",t)}}))},this),u.Backend.Device.onmessage({"data.channel":i.events.SIDEBAR_UPDATED},function(e){var n=this.find(function(e){return e.get("selected")});r.each(e.sidebar,function(e,t){e.order=t}),this.set(e.sidebar);if(n){var i=this.get(n.id);i!==t&&i.set({selected:!0})}this.trigger("refresh",this)},this),u.Backend.Device.onmessage({"data.channel":i.events.SIDEBAR_STAR},function(e){if(!s.get("isLogin"))s.loginAsync(a.misc.LOGIN_TO_STAR,"star-item-in-gallery");else if(!this.get(e.id)){var t=new f(e);t.starAsync().done(function(e){this.add(t),this.trigger("star",t)}.bind(this))}},this),u.Backend.Device.onmessage({"data.channel":i.events.SIDEBAR_ITEM_UPDATED},function(e){var n=this.get(e.id);n!==t&&n.set(e),this.trigger("itemUpdate")},this),this.on("add",function(e){e.on("change:cateid",e.setCategory,e),e.once("remove",function(){this.off()},e)})},getNormalPlugins:function(){return this.filter(function(e){return!e.get("dev_mode")})},unstarredAsync:function(e){var t=n.Deferred(),i=[],s=[];return r.each(e,function(e){var t=this.get(e);t&&(t.get("dev_mode")?i.push(e):s.push(e))},this),n.when(c.call(this,i),l.call(this,s)).done(function(){this.remove(e),t.resolve()}.bind(this)).fail(t.reject),t.promise()},deselectAll:function(){var e=this.find(function(e){return e.get("selected")});e&&e.set({selected:!1,highlight:!1})},getAll:function(){return this.models}}),p,d=r.extend({getInstance:function(){return p||(p=new h,p.trigger("update")),p}});return d})}(this),function(e,t){define("doraemon/views/ReportWindowView",["backbone","underscore","doT","jquery","Internationalization","Account","Configuration","Environment","ui/TemplateFactory","ui/AlertWindow","ui/Panel"],function(t,n,r,i,s,o,u,a,f,l,c){console.log("ReportWindowView - File loaded.");var h=e.alert,p=e.encodeURIComponent,d=t.View.extend({template:r.template(f.get("doraemon","report")),className:"w-browser-report",render:function(){return this.$el.html(this.template(this.model.toJSON())),this.$(".input-email").val(o.get("userMail")),this}}),v,m=c.extend({initialize:function(){m.__super__.initialize.apply(this,arguments),Object.defineProperties(this,{extensionModel:{set:function(e){v.model=e}}}),v=new d({model:this.model}),this.on("show",function(){this.$bodyContent=v.render().$el},this),this.off("button_yes"),this.on("button_yes",function(){var e=this.$(".input-email"),t=this.$(".input-content");if(!e[0].validity.valid||e.val().length===0)e.focus();else if(t.val().length===0)t.focus();else{var n=[u.enums.REPORT_URL];n.push("?id="+p(v.$(".input-id").val())),n.push("&email="+p(v.$(".input-email").val())),n.push("&content="+p(v.$(".input-content").val())),n.push("&version="+p(a.get("backendVersion"))),n.push("&extversion="+(this.model.get("extension")?this.model.get("extension").version:"unknow")),n.push("&currenturl="+p(this.options.currentURL)),n.push("&callback=?"),i.getJSON(n.join("")).success(function(e){e?h(s.misc.REPORT_SUCCESS):h(s.misc.REPORT_FAILED)}).error(function(){h(s.misc.REPORT_FAILED)}),this.remove()}},this)}}),g=n.extend({getInstance:function(e){return new m(n.extend(e,{height:350,width:550,title:s.misc.REPORT_PROBLEM,buttonSet:"yes_cancel"}))}});return g})}(this),function(e,t){define("social/SocialData",["IO","Configuration"],function(e,t){var n=function(){return{getUserAuthAsync:function(n,r,i){var s=$.Deferred();return e.requestAsync({url:t.actions.USER_SHOW,success:function(e){e.state_code===200?(n&&n.call(this,e.body),s.resolve(e)):e.state_code===401?(r&&r.call(this,e.body),s.reject(e)):(i&&i.call(this,e.body),s.reject(e))}}),s.promise()},authAsync:function(n,r,i){var s=$.Deferred();return e.requestAsync({url:t.actions.AUTH,data:n,success:function(e){e.state_code===200?(r&&r.call(this,e.body),s.resolve(e)):(i&&i.call(this,e.body),s.reject(e))}}),s.promise()},shareAsync:function(n,r,i,s){var o=$.Deferred();return e.requestAsync({url:t.actions.STATUS_UPLOAD,data:n,success:function(e){e.state_code===200?(r&&r.call(this,e.body),o.resolve(e)):e.state_code===401?(i&&i.call(this,e.body),o.reject(e)):(s&&s.call(this,e.body),o.reject(e))}}),o.promise()},exitAuthAsync:function(n,r){var i=$.Deferred();return e.requestAsync({url:t.actions.USER_LOGOUT,success:function(e){e.state_code===200?(n&&n.call(this,e),i.resolve(e)):(r&&r.call(this,e),i.reject(e))}}),i.promise()},viewOriginPicFromPicAsync:function(n,r,i){var s=$.Deferred();return e.requestAsync({url:t.actions.OPEN_FILE,data:n,success:function(e){e.state_code===200?(r&&r.call(this,e),s.resolve(e)):(i&&i.call(this,e),s.reject(e))}}),s.promise()},authInfoAsync:function(n,r,i){var s=$.Deferred();return e.requestAsync({url:t.actions.AUTH_INFO,data:n,success:function(e){e.state_code===200?(r&&r.call(this,e),s.resolve(e)):(i&&i.call(this,e),s.reject(e))}}),s.promise()},getTokenAsync:function(n,r){var i=$.Deferred();return e.requestAsync({url:t.actions.GET_TOKEN,success:function(e){e.state_code===200?(n&&n.call(this,e),i.resolve(e)):(r&&r.call(this,e),i.reject(e))}}),i.promise()}}},r=new n;return r})}(this),function(e,t){define("social/views/SocialPlatformSelectorView",["underscore","backbone","doT","jquery","Account","Configuration","ui/TemplateFactory"],function(e,t,n,r,i,s,o){console.log("SocialPlatformSelectorView - File loaded. ");var u=t.View.extend({className:"w-social-platform-selector",initialize:function(){i.on("change:platforms",this.refreshState,this)},render:function(){return this.delegateEvents(),this.$el.html(n.template(o.get("social",this.options.templateID))),this.refreshState(i),console.log("SocialPlatformSelectorView - SocialPlatformSelectorView rendered."),this},refreshState:function(e){e.get("isLogin")?(this.$('.social-platform[data-type="sina"], .social-platform-big[data-type="sina"]').prop({checked:e.isActive(e.SINA)}),this.$('span[data-type="sina"]').text(e.isActive(e.SINA)?i18n.common.SHARE_BINDED:i18n.common.SHARE_TO_SINA),this.$('.social-platform[data-type="qzone"], .social-platform-big[data-type="qzone"]').prop({checked:e.isActive(e.QZONE)}),this.$('span[data-type="qzone"]').text(e.isActive(e.QZONE)?i18n.common.SHARE_BINDED:i18n.common.SHARE_TO_QZONE),this.$('.social-platform[data-type="tqq"], .social-platform-big[data-type="tqq"]').prop({checked:e.isActive(e.TQQ)}),this.$('span[data-type="tqq"]').text(e.isActive(e.TQQ)?i18n.common.SHARE_BINDED:i18n.common.SHARE_TO_QQ),this.$('.social-platform[data-type="renren"], .social-platform-big[data-type="renren"]').prop({checked:e.isActive(e.RENREN)}),this.$('span[data-type="renren"]').text(e.isActive(e.RENREN)?i18n.common.SHARE_BINDED:i18n.common.SHARE_TO_RENREN)):this.$(".social-platform").prop({checked:!1})},getActivePlatformString:function(){var t=this.$(".social-platform:checked"),n=e.map(t,function(e){return r(e).data("type")});return n.join(",")},hasPlatformSelected:function(){return this.$(".social-platform:checked").length>0},selectPlatformCallback:function(e){var t=r(e.target),n=t.data("type");i.get("isLogin")?t[0].checked&&!i.isActive(n)&&(r(t[0]).prop({checked:!1}),i.bindAsync(n)):t[0].checked&&(r(t[0]).prop({checked:!1}),i.loginAsync("","social_share",n))},selectPlatformCallbackBig:function(e){if(!i.get("isLogin"))return;var t=r(e.target),n=t.data("type");if(i.isActive(n)){r(t[0]).prop({checked:!0});return}this.refreshState(i),i.bindAsync(n)},events:{"click .social-platform":"selectPlatformCallback","click .social-platform-big":"selectPlatformCallbackBig"}}),a=e.extend(function(){},{getInstance:function(e){return new u({templateID:e?"social-platform-selector-big":"social-platform-selector"})}});return a})}(this),function(e,t){define("music/models/MusicModel",["IOBackendDevice","Configuration"],function(e,n){console.log("MusicModel - File loaded. ");var r=Backbone.Model.extend({defaults:{title:"",artist:"",duration:0,format:"",size:0,album:"",playing:!1,loading:!1,error:!1},initialize:function(){var e=this.get("display_name"),n;e!==t&&(e=e.split("."),e.length>1&&(n=e[e.length-1])),this.set({artist:this.get("artist")||this.get("artist_name")||"",album:this.get("album")||this.get("album_name")||"",format:this.get("format")||n||this.get("mime_type").replace("audio/","")})},getPathAsync:function(){var t=$.Deferred();return e.requestAsync({url:n.actions.MUSIC_LOAD,data:{music_id:this.id},success:function(e){e.state_code===200?(console.log("MusicModel - Delete success. "),t.resolve(e)):(console.error("MusicModel - Delete faild. Error info: "+e.state_line),t.reject(e))}}),t.promise()},setRingAsync:function(t){var r=$.Deferred();return e.requestAsync({url:n.actions.MUSIC_SET_RINGTONE,data:{music_id:this.id,type:t},success:function(e){if(e.state_code===200){console.log("MusicModel - Set ring success. ");switch(t){case 0:this.collection.settings.ringtone=this.id;break;case 1:this.collection.settings.notification=this.id;break;case 2:this.collection.settings.alarm=this.id}r.resolve(e)}else console.error("MusicModel - Set ring faild. Error info: "+e.state_line),r.reject(e)}.bind(this)}),r.promise()}});return r})}(this),function(e,t){define("music/collections/MusicsCollection",["underscore","backbone","jquery","IOBackendDevice","Configuration","Device","music/models/MusicModel","main/collections/PIMCollection"],function(e,n,r,i,s,o,u,a){console.log("MusicsCollection - File loaded.");var f=n.Collection.extend({model:u,url:s.actions.MUSID_SHOW,parse:function(e){return e.state_code===202&&o.get("isConnected")&&(console.log("MusicsCollection - Music is syncing."),this.syncing=!0,this.trigger("syncStart")),e.body.audio},syncAsync:function(){var e=r.Deferred();return this.syncing=!0,this.trigger("syncStart"),i.requestAsync({url:s.actions.MUSIC_SYNC,success:function(t){t.state_code===200?(console.log("MusicsCollection - Music sync success."),e.resolve(t)):(console.error("MusicsCollection - Music sync failed. Error info: "+t.state_line),this.syncing=!1,this.trigger("syncEnd"),e.reject(t))}.bind(this)}),e.promise()},initialize:function(){var e=!1,t=!1,n={},r={ringtone:"",notification:"",alarm:""};Object.defineProperties(this,{loading:{set:function(t){e=t},get:function(){return e}},syncing:{set:function(e){t=e},get:function(){return t}},currentPlayingAudio:{set:function(e){n=e},get:function(){return n}},settings:{set:function(e){r=e},get:function(){return r}}}),this.on("update",function(){e=!0,this.fetch({success:function(t){console.log("MusicsCollection - Collection fetched."),e=!1;var n=t.get(t.currentPlayingAudio.id);t.currentPlayingAudio.status===1&&n.set({playing:!0}),t.getRingAsync().always(function(e){if(e.state_code===200){t.settings={ringtone:e.body.val[0],notification:e.body.val[1],alarm:e.body.val[2]};var n=t.get(e.body.val[0]),r=t.get(e.body.val[1]),i=t.get(e.body.val[2]);n&&n.set({type:0}),r&&r.set({type:1}),i&&i.set({type:2})}t.trigger("refresh",t)})}})},this),i.Backend.Device.onmessage({"data.channel":s.events.MUSIC_UPDATED},function(e){t&&(t=!1,this.trigger("syncEnd")),!e||this.trigger("update")},this)},getMusics:function(){return this.filter(function(e){return parseInt(e.get("size"),10)/1024>=50})},deleteAsync:function(n,o){var u=r.Deferred();return i.requestAsync({url:s.actions.MUSIC_DELETE,data:{music_id_list:n.join(","),session:o||""},success:function(n){switch(n.state_code){case 200:console.log("MusicsCollection - Delete music success. ");var r=n.body.success;e.each(r,function(e){var n=this.get(e.item);if(n!==t){this.remove(n);switch(n.id){case this.settings.ringtone:this.resetRingAsync(0);break;case this.settings.notification:this.resetRingAsync(1);break;case this.settings.alarm:this.resetRingAsync(2)}}},this),this.trigger("refresh",this),u.resolve(n);break;case 402:console.log("MusicsCollection - Delete music cancled. "),this.syncAsync(),u.reject(n);break;default:console.error("MusicsCollection - Delete music faild. Error info: "+n.state_line),u.reject(n)}}.bind(this)}),u.promise()},resetRingAsync:function(e){var t=r.Deferred();return i.requestAsync({url:s.actions.MUSIC_RESET_RINGTONE,data:{type:e},success:function(n){if(n.state_code===200){switch(e){case 0:this.settings.ringtone="";break;case 1:this.settings.notification="";break;case 2:this.settings.alarm=""}t.resolve(n)}else t.reject(n)}.bind(this)}),t.promise()},importAsync:function(t,n){var o=r.Deferred();return i.requestAsync({url:s.actions.MUSIC_IMPORT,data:{file_path_list:JSON.stringify({audio:e.map(t,function(e){return{path:e}})}),session:n||""},success:function(e){e.state_code===200?(console.log("MusicsCollection - Import success. "),this.syncAsync(),o.resolve(e)):e.state_code===402?(this.syncAsync(),o.reject(e)):(console.error("MusicsCollection - Import failed. Error info: "+e.state_line),o.reject(e))}.bind(this)}),o.promise()},getRingAsync:function(){var e=r.Deferred();return i.requestAsync({url:s.actions.MUSIC_GET_RINGTONE,success:function(t){t.state_code===200?e.resolve(t):e.reject(t)}.bind(this)}),e.promise()},getAll:function(){return this.models}}),l,c=e.extend({getInstance:function(){return l||(l=new f,l.trigger("update"),l.on("refresh",function(e){a.getInstance().get(4).set({count:e.getMusics().length})})),l}});return c})}(this),function(e,t){define("music/MusicService",["ui/BatchActionWindow","ui/AlertWindow","utilities/StringUtil","Internationalization","IOBackendDevice","Configuration","Device","Settings","music/collections/MusicsCollection","main/views/BatchErrorView"],function(n,r,i,s,o,u,a,f,l,c){console.log("MusicService - File loaded.");var h=e.alert,p=_.extend(function(){},Backbone.Events),d,v=function(e,t,n){var r=$.Deferred();return o.requestAsync({url:u.actions.MUSIC_EXPORT,data:{music_id_list:e.join(","),session:t,export_dir:n||"",default_path:f.get("music_export_default_path")},success:function(e){e.state_code===200?(console.log("MusicService - Export success. "),r.resolve(e)):(console.error("MusicService - Export failed. Error info: "+e.state_line),r.reject(e))}}),r.promise()};return p.exportMusicsAsync=function(e){var t=$.Deferred(),r=l.getInstance(),i=_.uniqueId("music.export_"),a=new n({session:i,progressText:s.music.EXPORT_PROGRESS_TEXT,cancelUrl:u.actions.MUSIC_CANCEL,total:e.length,successText:s.music.EXPORT_SUCCESS_TEXT,delay:!0});if(!d)var m=o.Backend.Device.onmessage({"data.channel":i},function(e){d||(d=e.info,o.Backend.Device.offmessage(m))});return v(e,i,d).done(function(e){f.set("music_export_default_path",d,!0);var n=_.map(e.body.failed,function(e){return e.item});if(n.length>0){a.remove();var i=c.getInstance({tip:s.music.MUSIC_EXPORT_ERROR_TEXT,items:_.map(n,function(e){return r.get(e).get("title")}),errorInfo:_.find(e.body.failed,function(e){return e.error_message})});i.once("button_retry",function(){p.exportMusicsAsync(n).done(t.resolve).fail(t.reject),i.remove()},this),i.once("button_cancel",function(){d=null,t.reject()}),i.show()}else d=null,t.resolve(e)}).fail(function(e){e.state_code===402?d=null:(h(s.music.EXPORT_FAILED_TEXT),a.remove()),t.reject(e)}),t.promise()},p.loadMusicAsync=function(e){var t=$.Deferred();return o.requestAsync({url:u.actions.MUSIC_LOAD,data:{music_id:e,play:!1},success:function(e){e.state_code===200?(console.log("MusicService - Load success. "),t.resolve(e.body.value)):(console.error("MusicService - Load faild. Error info: "+e.state_line),t.reject(e))}}),t.promise()},p.importMusicsAsync=function(e){var r=$.Deferred(),i=l.getInstance(),o=_.uniqueId("music.import_"),f=new n({session:o,progressText:s.music.IMPORT_PROGRESS_TEXT,cancelUrl:u.actions.MUSIC_CANCEL,total:e.length,successText:s.music.IMPORT_SUCCESS_TEXT,delay:!0});return i.importAsync(e,o).done(function(e){var n=_.map(e.body.failed,function(e){return e.item});if(n.length>0){f!==t&&f.remove();var i=c.getInstance({needConnection:!0,tip:s.music.MUSIC_IMPORT_ERROR_TEXT,items:_.map(n,function(e){return e.replace(/^.*[\\\/](?=[^\\\/]+$)/,"")}),errorInfo:_.find(e.body.failed,function(e){return e.error_message})});i.on("button_retry",function(){a.get("isConnected")&&(a.get("hasSDCard")||a.get("hasEmulatedSD"))&&(p.importMusicsAsync(n).done(r.resolve).fail(r.reject),i.remove())},this),i.once("button_cancel",function(){r.reject()}),i.show()}else r.resolve(e)}).fail(function(e){e.state_code!==402&&(h(s.music.MUSIC_IMPORT_OPERATION_FAILED),f!==t&&f.remove()),r.reject(e)}),r.promise()},p.deleteMusicsAsync=function(e){var o=$.Deferred(),a=l.getInstance(),f=new r({draggable:!0,disposableName:"musics-delete",buttonSet:"yes_no",$bodyContent:i.format(s.music.DELETE_TIP,e.length)});return f.on("button_yes",function(){e.indexOf(p.currentPlayingAudio.id)>=0&&p.stopAsync();var r,i;e.length>1&&(r=_.uniqueId("music.batch.delete_"),i=new n({session:r,progressText:s.music.DELETE_PROGRESS_TEXT,cancelUrl:u.actions.MUSIC_CANCEL,total:e.length,successText:s.music.DELETE_SUCCESS_TEXT}),i.show()),a.deleteAsync(e,r).done(function(e){var n=_.map(e.body.failed,function(e){return e.item});if(n.length>0){i!==t&&i.remove();var r=c.getInstance({needConnection:!0,tip:s.music.DELETE_MUSIC_ERROR_TEXT,items:_.map(n,function(e){var t=a.get(e);return t?t.get("display_name"):""}),errorInfo:_.find(e.body.failed,function(e){return e.error_message})});r.once("button_retry",function(){p.deleteMusicsAsync(n).done(o.resolve).fail(o.reject),r.remove()}),r.once("button_cancel",function(){o.reject()}),r.show()}else o.resolve(e)}).fail(function(e){e.state_code!==402&&h(s.music.DELETE_MUSIC_ERROR),o.reject(e)})},this),f.show(),o.promise()},p.stopAsync=function(){var e=$.Deferred();return o.requestAsync({url:u.actions.MUSIC_STOP,success:function(t){t.state_code===200?(console.log("MusicService - Stop success. "),e.resolve(t)):(console.error("MusicService - Stop faild. Error info: "+t.state_line),e.reject(t))}}),e.promise()},p.resetRingAsync=function(e){var t=$.Deferred();return o.requestAsync({url:u.actions.MUSIC_RESET_RINGTONE,type:{type:e},success:function(e){e.state_code===200?(console.log("MusicService - Reset ring success. "),t.resolve(e)):(console.error("MusicService - Reset ring faild. Error info: "+e.state_line),t.reject(e))}}),t.promise()},p.selectMusicsAsync=function(e){var t=$.Deferred();return o.requestAsync({url:u.actions.MUSIC_SELECT,data:{type:e},success:function(e){e.state_code===200?(console.log("MusicService - Get selected musics success."),t.resolve(e)):(console.error("MusicService - Get selected musics faild. Error info: "+e.state_line),t.reject(e))}}),t.promise()},p.currentPlayingAudio={},p.playAsync=function(e){var n=$.Deferred(),r=l.getInstance();r.currentPlayingAudio=p.currentPlayingAudio;var i=r.get(p.currentPlayingAudio.id);i&&i.set({playing:!1}),p.currentPlayingAudio.id=e;var s=r.get(e);s.set({loading:!0});var a=_.uniqueId("music_play_"),f=function(e){e=typeof e=="number"?e:e.parseInt(e,10);var t=r.get(s.id);p.currentPlayingAudio.id=t.id,p.currentPlayingAudio.status=e,t.set({loading:!1});switch(e){case p.STATUS.FILE_READY:break;case p.STATUS.FILE_PLAYING:t.set({playing:!0});break;case p.STATUS.FILE_COMPLETE:t.set({playing:!1});break;case p.STATUS.FILE_ERROR:t.set({playing:!1,error:!0})}},c=o.Backend.Device.onmessage({"data.channel":a},f,this);return o.requestAsync({url:u.actions.MUSIC_PLAY,data:{music_id:e,session:a},success:function(e){o.Backend.Device.offmessage(c);var i=r.get(p.currentPlayingAudio.id);i.set({playing:!1}),p.currentPlayingAudio.id=t,p.currentPlayingAudio.status=t,e.state_code===200?(f.call(this,p.STATUS.FILE_COMPLETE),n.resolve(e)):(f.call(this,p.STATUS.FILE_ERROR),n.reject(e))}}),n.promise()},p.stopAsync=function(){var e=$.Deferred();return o.requestAsync({url:u.actions.MUSIC_STOP,success:function(t){t.state_code===200?e.resolve(t):e.reject(t)}}),e.promise()},p.STATUS={FILE_READY:0,FILE_PLAYING:1,FILE_STOP:2,FILE_COMPLETE:3,FILE_ERROR:4},p})}(this),function(e,t){define("social/views/ShareView",["doT","jquery","underscore","ui/UIHelper","ui/TemplateFactory","Configuration","ui/Panel","ui/KeyMapping","ui/AlertWindow","Environment","Internationalization","utilities/StringUtil","Device","FunctionSwitch","social/SocialData","Log","Account","social/views/SocialPlatformSelectorView","IOBackendDevice","music/MusicService"],function(n,r,i,s,o,u,a,f,l,c,h,p,d,v,m,g,y,b,w,E){console.log("Share View loaded");var S=e.alert,x,T=a.extend({className:a.prototype.className+" w-social-share-panel",socialPlatformSelectorView:b.getInstance(),type:u.enums.SOCIAL_SCREENSHOT,render:function(){i.extend(this.events,T.__super__.events),this.delegateEvents(),T.__super__.render.call(this),v.ENABLE_MY_MUTIL_SOCIAL_PLATFORM&&this.$(".w-ui-window-footer-monitor").prepend(this.socialPlatformSelectorView.render().$el)},showPanel:function(e){this.$("textarea").html("").val(""),this.$(".share-preview-content").html(""),this.hasPreview?r(this.el).removeClass("compact-mode"):r(this.el).addClass("compact-mode"),x.show(),this.disableShareBtn(!1);try{e=JSON.parse(e.value)}catch(t){}this.defaultText?this.$("textarea").val(this.defaultText):this.defaultTextUrl&&(this.defaultTextData?(this.defaultTextData.wdj_auth=y.get("auth"),r.ajax({url:this.defaultTextUrl,type:"POST",data:this.defaultTextData,success:function(e){e&&e.text&&(this.$("textarea").val(e.text),this.countDown())}.bind(this)})):r.ajax({url:this.defaultTextUrl,type:"POST",data:{wdj_auth:y.get("auth")},success:function(e){e&&e.text&&(this.$("textarea").val(e.text),this.countDown())}.bind(this)})),this.countDown(),this.setPreviewContent(),g({event:"social.share_"+this.type+".display",sns:"weibo"})},disableShareBtn:function(e){var t=this.$(".share-btn");this.size>u.enums.SINA_SHARE_PIC_LIMIT_SIZE*1024*1024?(t.prop({disabled:!0}),this.$(".pic-size-tip").html(p.format(h.common.SHARE_WIDGET_PIC_LIMIT_SIZE_TIP,u.enums.SINA_SHARE_PIC_LIMIT_SIZE)).show()):(t.prop({disabled:!!e}),this.$(".pic-size-tip").hide())},getPreviewContentSize:function(){var e={width:350,height:205};return Object.freeze(e),e},setPreviewContent:function(){var e=r(n.template(o.get("social","preview"))({}));this.$(".w-ui-window-footer-monitor").append(e);var t=this.$(".share-preview"),i=this.$(".share-preview-content").html(""),s=this.$(".w-ui-loading").show(),u=this.$(".view-from-pc"),a=this.getPreviewContentSize(),f=20;i.css({width:a.width+f,height:a.height+f}),this.hasPreview?(t.show(),setTimeout(function(){i.html(this.previewContent),s.hide()}.bind(this),200)):(t.hide(),i.html("")),this.hasViewPicFromPC?this.$(".view-from-pc").show():this.$(".view-from-pc").hide()},setContent:function(e){this.defaultText=e.text||"",this.defaultTextUrl=e.textUrl||"",this.defaultTextData=e.textData,this.hasPreview=e.hasPreview||!1,this.previewContent=e.previewContent||"",this.shareData=e.shareData||"",this.hasViewPicFromPC=e.hasViewPicFromPC||!1,this.shareCallback=e.shareCallback||null,this.size=parseInt(e.size,10)||0;if(this.hasPreview){var t=this.$(".share-preview-content");t.html(this.previewContent)}this.type=e.type||u.enums.SOCIAL_SCREENSHOT,this.extraData=e.extraData||null,this.type&&(this.title=this.generateTitle()),this.disableShareBtn(),this.countDown()},generateTitle:function(){var e="";switch(this.type){case u.enums.SOCIAL_SCREENSHOT:e=h.common.SHARE_CONTENT_TYPE_SCREENSHOT;break;case u.enums.SOCIAL_PHOTO:e=h.common.SHARE_CONTENT_TYPE_PHOTO;break;case u.enums.SOCIAL_WELCOME:e=h.common.SHARE_CONTENT_TYPE_WELCOME;break;case u.enums.SOCIAL_APP:this.extraData&&this.extraData.app_title?e="「"+this.extraData.app_title+"」":e=h.common.SHARE_CONTENT_TYPE_APP;break;case u.enums.SOCIAL_DORAEMON_EXTENSION:this.extraData&&this.extraData.extension_title?e="「"+this.extraData.extension_title+"」":e=h.common.SHARE_CONTENT_TYPE_DORAEMON_EXTENSION;break;case u.enums.SOCIAL_DORAEMON_CONTENT:this.extraData&&this.extraData.title&&(e="「"+this.extraData.title+"」");break;case u.enums.SOCIAL_WANDOUJIA_THEME:this.extraData&&this.extraData.theme_name&&(e="「"+this.extraData.theme_name+"」");break;case u.enums.SOCIAL_SET_RINGTONE:case u.enums.SOCIAL_SET_MUSIC_AS_RINGTONE:this.extraData&&this.extraData.ringtone_title&&(e="「"+this.extraData.ringtone_title+"」");break;case u.enums.SOCIAL_UNINSTALL_APP:return this.extraData&&this.extraData.app_title?e=p.format(h.common.SHARE_WIDGET_TITLE_2,"「"+this.extraData.app_title+"」"):e=h.common.SHARE_WIDGET_TITLE_2,e;case u.enums.SOCIAL_ONE_KEY_UPDATE:return h.common.SHARE_WIDGET_TITLE_ONE_KEY_UPDATE}return p.format(h.common.SHARE_WIDGET_TITLE,e)},recoveryContent:function(){var e={text:"",hasPreview:!0,previewContent:"",shareData:"",hasViewPicFromPC:!1,shareCallback:null,size:0};this.setContent(e)},showShareTip:function(e,t){var n=this.$(".share-tip"),r=this.$(".send-loading");switch(t){case"sending":n.removeClass("error").hide(),r.addClass("sending");break;case"success":case"count":n.removeClass("error").show(),r.removeClass("sending");break;case"error":n.addClass("error").show(),r.removeClass("sending")}n.html(e).show()},shareSuccess:function(){g({event:"social.share_"+this.type+".success",sns:"weibo"});if(this.automaticClosing){this.showShareTip(h.common.SHARE_WIDGET_SENT_TEXT,"success");var e=setTimeout(function(){this.shareCallback&&this.shareCallback(),this.close(),clearTimeout(e)}.bind(this),1e3)}},shareFailed:function(e){g({event:"social.share_"+this.type+".failed",sns:"weibo"});var t=h.common.SHARE_WIDGET_FAILED_TEXT;if(e&&e.value)switch(e.value){case u.enums.SOCIAL_SHARE_COOKIE_EXPIRED:t=h.common.SHARE_WIDGET_COOKIE_EXPIRED_TEXT}this.showShareTip(t,"error"),this.disableShareBtn(!1)},clickViewOriginPicFromPC:function(){var e={file_path:this.shareData.pic};m.viewOriginPicFromPicAsync(e,this.viewOriginPicFromPCSuccess.bind(this),this.viewOriginPicFromPCFail.bind(this))},viewOriginPicFromPCSuccess:function(){},viewOriginPicFromPCFail:function(){S(h.common.SHARE_WIDGET_VIEW_FROM_PC_ERROR)},countDown:function(){var e=this.$(".input-content").val(),t=e?e.length:0,n=120,r=n-t;r>=0?(this.showShareTip(p.format(h.common.SHARE_WIDGET_INPUT_COUNT_TEXT,r),"count"),this.disableShareBtn(!1)):(this.showShareTip(p.format(h.common.SHARE_WIDGET_INPUT_OVER_COUNT_TEXT,t-n),"error"),this.disableShareBtn(!0))},focusInputContent:function(){var e=this.$(".input-content");if(!e.hasClass("focus")){var t=setInterval(function(){this.countDown()}.bind(this),100),n=function(){clearInterval(t),e.off("blur",n).removeClass("focus")}.bind(this);e.on("blur",n).addClass("focus")}},keydownInputContent:function(e){e.ctrlKey&&e.keyCode===f.ENTER&&(this.trigger("button_share"),this.$(".input-content").blur()),e.keyCode===f.ESC&&this.$(".input-content").blur()},events:{"click .view-from-pc":"clickViewOriginPicFromPC","focus .input-content":"focusInputContent","keydown .input-content":"keydownInputContent"}}),N=[{$button:r("<button/>").html(h.common.SHARE).addClass("primary share-btn"),eventName:"button_share"},{$button:r("<button/>").html(h.common.CANCEL),eventName:"button_no"}],C=i.extend({getInstance:function(){return x||(x=new T({width:400,buttons:N,$bodyContent:r(n.template(o.get("social","share"))({}))}),x.on("button_share",function(){if(!this.socialPlatformSelectorView.hasPlatformSelected()){this.showShareTip(h.common.SHARE_WIDGET_ERROR_NEED_SELECT_PLATFORM,"error");return}this.automaticClosing=!0,this.showShareTip("","sending");var e={user_comment:this.$("textarea").val(),content_type:this.type,target_platforms:this.socialPlatformSelectorView.getActivePlatformString(),title:""};switch(this.type){case u.enums.SOCIAL_SCREENSHOT:e.need_shell=this.shareData.need_shell,e.rotation=this.shareData.rotation,e.content=this.shareData.pic;break;case u.enums.SOCIAL_PHOTO:case u.enums.SOCIAL_SET_WALLPAPER:e.rotation=this.shareData.rotation,e.content=this.shareData.pic;break;case u.enums.SOCIAL_WELCOME:e.content=this.shareData.pic;break;case u.enums.SOCIAL_APP:if(!(this.extraData&&this.extraData.app_package_name&&this.extraData.app_title)){this.showShareTip(h.common.SHARE_WIDGET_FAILED_TEXT,"error");return}e.content=this.extraData.app_package_name;break;case u.enums.SOCIAL_DORAEMON_EXTENSION:if(!(this.extraData&&this.extraData.extension_id&&this.extraData.extension_title)){this.showShareTip(h.common.SHARE_WIDGET_FAILED_TEXT,"error");return}e.content=this.extraData.extension_id;break;case u.enums.SOCIAL_ONE_KEY_UPDATE:if(!this.extraData||!this.extraData.apps){this.showShareTip(h.common.SHARE_WIDGET_FAILED_TEXT,"error");return}e.content=this.extraData.apps.join();break;case u.enums.SOCIAL_DORAEMON_CONTENT:if(!this.extraData||!this.extraData.extension_id){this.showShareTip(h.common.SHARE_WIDGET_FAILED_TEXT,"error");return}e.content=JSON.stringify({id:this.extraData.extension_id,title:this.extraData.title,image:this.extraData.image});break;case u.enums.SOCIAL_WANDOUJIA_THEME:if(!this.extraData||!this.extraData.theme_id){this.showShareTip(h.common.SHARE_WIDGET_FAILED_TEXT,"error");return}e.content=this.extraData.theme_id;break;case u.enums.SOCIAL_SET_RINGTONE:if(!(this.extraData&&this.extraData.ringtone_id&&this.extraData.ringtone_title&&this.extraData.ringtone_artist)){this.showShareTip(h.common.SHARE_WIDGET_FAILED_TEXT,"error");return}var n=this;E.loadMusicAsync(this.extraData.ringtone_id).done(function(t){e.content=t,n.disableShareBtn(!0),y.shareAsync(e,n.shareSuccess.bind(n),n.shareFailed.bind(n))});break;case u.enums.SOCIAL_SET_MUSIC_AS_RINGTONE:if(!(this.extraData&&this.extraData.ringtone_title&&this.extraData.ringtone_artist)){this.showShareTip(h.common.SHARE_WIDGET_FAILED_TEXT,"error");return}e.content=JSON.stringify({ringtone_title:this.extraData.ringtone_title,ringtone_artist:this.extraData.ringtone_artist});break;case u.enums.SOCIAL_UNINSTALL_APP:if(!(this.extraData&&this.extraData.uninstall_reason&&this.extraData.app_title&&this.extraData.app_package_name)){this.showShareTip(h.common.SHARE_WIDGET_FAILED_TEXT,"error");return}e.content=JSON.stringify({uninstall_reason:this.extraData.uninstall_reason,app_title:this.extraData.app_title,app_package_name:this.extraData.app_package_name});break;case u.enums.SOCIAL_WASH:if(!this.extraData||this.extraData.mockNum===t&&this.extraData.adsNum===t){this.showShareTip(h.common.SHARE_WIDGET_FAILED_TEXT,"error");return}e.content=JSON.stringify({mockNum:this.extraData.mockNum||0,adsNum:this.extraData.adsNum||0});break;default:this.showShareTip(h.common.SHARE_WIDGET_FAILED_TEXT,"error");return}this.disableShareBtn(!0),y.shareAsync(e,this.shareSuccess.bind(this),this.shareFailed.bind(this))}).on("button_no",function(){g({event:"social.share_"+this.type+".cancel",sns:"weibo"}),x.close()}).on("button_cancel",function(){g({event:"social.share_"+this.type+".cancel",sns:"weibo"})}),x.on(s.EventsMapping.BUTTON_CANCEL,function(){this.automaticClosing=!1,this.previewContent="",this.recoveryContent()}.bind(x))),x}});return C})}(this),function(e,t){define("social/views/FacebookOauthView",["underscore","jquery","ui/Panel","utilities/QueryString","Internationalization","Configuration","social/SocialData","social/views/FacebookShareView"],function(e,t,n,r,i,s,o,u){var a=s.enums.FACEBOOK_OAUTH_API+s.enums.FACEBOOK_REDIRECT_URI+"&state="+(new Date).getTime(),f=n.extend({render:function(){f.__super__.render.apply(this,arguments);var e=this;this.$("iframe").on("load",function(){var t=this.contentWindow.location.href;if(/error=access_denied/i.test(t))e.close();else if(/access_token/i.test(t)){var n=r.get("access_token",t),i=r.get("expires_in",t),s={access_token:n,expires_in:i};o.authInfoAsync(s,function(e){this.close(),u.getInstance().showPanel({screen_name:e.body.name})}.bind(e),function(){this.close()}.bind(e))}})}}),l=new f({title:i.common.SHARE_TO_FACEBOOK,draggable:!0,width:660,height:540,buttons:[],$bodyContent:t("<iframe/>").attr({src:a}).css({width:630,height:477})}),c=e.extend({getInstance:function(){return l}});return c})}(this),function(e,t){define("social/views/FacebookShareView",["jquery","underscore","doT","ui/UIHelper","ui/TemplateFactory","ui/AlertWindow","Configuration","ui/Panel","ui/KeyMapping","Environment","Internationalization","utilities/StringUtil","Device","social/SocialData","social/views/FacebookOauthView","Log"],function(t,n,r,i,s,o,u,a,f,l,c,h,p,d,v,m){console.log("Share View loaded");var g=e.alert,y=a.extend({className:a.prototype.className+" w-social-share-panel",render:function(){n.extend(this.events,y.__super__.events),this.delegateEvents(),y.__super__.render.call(this)},showPanel:function(e){this.$("textarea").html("").val(""),this.$(".share-preview-content").html(""),this.show(),this.disableShareBtn(!1);try{e=JSON.parse(e.value)}catch(t){}var n=e.screen_name||"";n?this.$(".nickname").html(n):d.getUserAuthAsync(function(e){e=JSON.parse(e.value),n=e.screen_name||e.name,this.$(".nickname").html(n)}.bind(this)),this.showShareTip(h.format(c.common.SHARE_WIDGET_INPUT_COUNT_TEXT,0),"count"),this.setPreviewContent()},disableShareBtn:function(e){var t=this.$(".share-btn");this.size>u.enums.SINA_SHARE_PIC_LIMIT_SIZE*1024*1024?(t.prop({disabled:!0}),this.$(".pic-size-tip").html(h.format(c.common.SHARE_WIDGET_PIC_LIMIT_SIZE_TIP,u.enums.SHARE_WIDGET_PIC_LIMIT_SIZE)).show()):(t.prop({disabled:!!e}),this.$(".pic-size-tip").hide())},getPreviewContentSize:function(){var e={width:310,height:205};return Object.freeze(e),e},setPreviewContent:function(){var e=t(r.template(s.get("social","preview"))({}));this.$(".w-ui-window-footer-monitor").append(e);var n=this.$(".share-preview"),i=this.$(".share-preview-content").html(""),o=this.$(".view-from-pc");i.addClass("loading");var u=this.getPreviewContentSize(),a=20;i.css({width:u.width+a,height:u.height+a}),this.hasPreview?(n.show(),setTimeout(function(){i.html(this.previewContent),i.removeClass("loading")}.bind(this),200)):(n.hide(),i.html(""),i.removeClass("loading")),this.hasViewPicFromPC?this.$(".view-from-pc").show():this.$(".view-from-pc").hide()},setContent:function(e){this.defaultText=e.text||"",this.hasPreview=e.hasPreview||!0,this.previewContent=e.previewContent||"",this.shareData=e.shareData||"",this.hasViewPicFromPC=e.hasViewPicFromPC||!1,this.shareCallback=e.shareCallback||null,this.size=parseInt(e.size,10)||0;if(this.hasPreview){var t=this.$(".share-preview-content");t.html(this.previewContent)}this.disableShareBtn()},recoveryContent:function(){var e={text:"",hasPreview:!0,previewContent:"",shareData:"",hasViewPicFromPC:!1,shareCallback:null,size:0};this.setContent(e)},showShareTip:function(e,t){var n=this.$(".share-tip");switch(t){case"sending":n.removeClass("error").addClass("sending");break;case"success":case"count":n.removeClass("error sending");break;case"error":n.removeClass("sending").addClass("error")}n.html(e).show()},showOauth:function(){this.close(),v.getInstance().show()},shareSuccess:function(){m({event:"social.share_"+this.type+".success",sns:"weibo"});if(this.automaticClosing){this.showShareTip(c.common.SHARE_WIDGET_SENT_TEXT,"success");var e=setTimeout(function(){this.shareCallback&&this.shareCallback(),this.close(),clearTimeout(e)}.bind(this),1e3)}},shareFail:function(e){m({event:"social.share_"+this.type+".failed",sns:"weibo"});var t=e.value,n=c.common.SHARE_TO_FACEBOOK_FAILD;this.showShareTip(n,"error"),this.disableShareBtn(!1)},clickExitOauth:function(){d.getTokenAsync(function(e){var n=u.enums.FACEBOOK_LOGOUT_URI+"?next="+u.enums.FACEBOOK_REDIRECT_URI+"&access_token="+e.body.value,r=t("<iframe/>").attr("src",n).appendTo(this.$el).hide();r.on("load",function(){d.exitAuthAsync(function(){this.close(),r.remove()}.bind(this))}.bind(this))}.bind(this))},clickViewOriginPicFromPC:function(){var e={file_path:this.shareData.pic};d.viewOriginPicFromPicAsync(e,this.viewOriginPicFromPCSuccess.bind(this),this.viewOriginPicFromPCFail.bind(this))},viewOriginPicFromPCSuccess:function(){},viewOriginPicFromPCFail:function(){g(c.common.SHARE_WIDGET_VIEW_FROM_PC_ERROR)},KeyupTexterea:function(e){var t=this.$("textarea").val(),n=t?t.length:0,r=120,i=r-n;if(e.which===f.ENTER&&e.ctrlKey){this.trigger("button_share");return}e.ctrlKey||(i>=0?(this.showShareTip(h.format(c.common.SHARE_WIDGET_INPUT_COUNT_TEXT,n),"count"),this.disableShareBtn(!1)):(this.showShareTip(h.format(c.common.SHARE_WIDGET_INPUT_OVER_COUNT_TEXT,n-r),"error"),this.disableShareBtn(!0)))},events:{"click .exit-oauth":"clickExitOauth","click .view-from-pc":"clickViewOriginPicFromPC","keyup textarea":"KeyupTexterea"}}),b=[{$button:t("<button/>").html(c.common.SHARE).addClass("primary share-btn"),eventName:"button_share"},{$button:t("<button/>").html(c.common.CANCEL),eventName:"button_no"}],w,E=n.extend({getInstance:function(){return w||(w=new y({title:c.common.SHARE_TO_FACEBOOK,width:400,height:480,buttons:b,$bodyContent:t(r.template(s.get("social","facebook-share"))({}))}),w.on("button_share",function(){this.automaticClosing=!0,this.showShareTip("","sending"),this.shareData.content=h.format(c.common.WANDOUJIA_TOPIC)+this.$("textarea").val()+h.format(c.common.FACEBOOK_MESSAGE_FROM,p.get("deviceName")),this.disableShareBtn(!0),d.shareAsync(this.shareData,this.shareSuccess.bind(this),this.showOauth.bind(this),this.shareFail.bind(this))}).on("button_no",function(){w.close()}),w.on(i.EventsMapping.BUTTON_CANCEL,function(){this.automaticClosing=!1,this.previewContent="",this.recoveryContent()}.bind(w))),w}});return E})}(this),function(e,t){define("social/SocialService",["underscore","backbone","jquery","social/SocialData","social/views/ShareView","social/views/FacebookShareView","social/views/FacebookOauthView","Environment","Configuration","IOBackendDevice","utilities/StringUtil"],function(n,r,i,s,o,u,a,f,l,c,h){console.log("SocialService - File loaded. ");var p=n.extend(function(){},r.Events);return p.show=function(e){!e||this.setContent(e);if(f.get("locale")===l.enums.LOCALE_EN_US){var t=u.getInstance();s.getUserAuthAsync(t.showPanel.bind(t),function(){a.getInstance().show()})}else o.getInstance().showPanel()},p.setContent=function(e){f.get("locale")===l.enums.LOCALE_EN_US?e!==t&&u.getInstance().setContent(e):e!==t&&o.getInstance().setContent(e)},p.getPreviewContentSize=function(){return o.getInstance().getPreviewContentSize()},p.showFacebookOauth=function(){a.getInstance().show()},p.sharePhotoAsync=function(e,t,n,r){var s=i.Deferred(),o=p.getPreviewContentSize(),u=i("<img/>").attr("src",e+" ?date= "+(new Date).getTime()).css({"max-width":o.width,"max-height":o.height}),a;switch(t){case 0:a=0;break;case 3:case 90:u.addClass("turn-right"),a=3;break;case 2:case 180:u.addClass("turn-down"),a=2;break;case 1:case 270:u.addClass("turn-left"),a=1}var f={textUrl:h.format(l.enums.SOCIAL_TEXT_PREVIEW_URL,n,""),hasPreview:n===l.enums.SOCIAL_PHOTO,previewContent:u,shareData:{need_shell:0,pic:e.replace(/^file:\/\/\//,""),rotation:a},type:n,size:r};return p.show(f),s.promise()},c.Backend.Device.onmessage({"data.channel":"social.share_app"},function(e){var t=p.getPreviewContentSize(),n=h.format(l.enums.SOCIAL_APP_BIO_URL,e.app_package_name);e.app_image&&(n=e.app_image);var r=i("<img/>").attr("src",n).css({"max-width":t.width}),s={textUrl:h.format(l.enums.SOCIAL_TEXT_PREVIEW_URL,l.enums.SOCIAL_APP,e.app_package_name),hasPreview:!0,previewContent:r,shareData:{need_shell:0,pic:n,rotation:0},extraData:{app_title:e.app_title,app_package_name:e.app_package_name},type:l.enums.SOCIAL_APP};p.setContent(s),p.show()},this),c.Backend.Device.onmessage({"data.channel":"social.doraemon_share"},function(e){var t=p.getPreviewContentSize(),n=!1,r;e.image&&(n=!0,r=i("<img/>").attr("src",e.image).css({"max-width":t.width}));var s={text:e.content,hasPreview:n,previewContent:r,extraData:e,type:l.enums.SOCIAL_DORAEMON_CONTENT};p.setContent(s),p.show()},this),c.Backend.Device.onmessage({"data.channel":"social.share_wandoujia_theme"},function(e){var t=p.getPreviewContentSize(),n=i("<img/>").attr("src",h.format(l.enums.SOCIAL_IMAGE_PREVIEW_URL,l.enums.SOCIAL_WANDOUJIA_THEME,e.theme_id)).css({"max-width":t.width}),r={textUrl:h.format(l.enums.SOCIAL_TEXT_PREVIEW_URL,l.enums.SOCIAL_WANDOUJIA_THEME,e.theme_id),hasPreview:!0,previewContent:n,extraData:e,type:l.enums.SOCIAL_WANDOUJIA_THEME};p.setContent(r),p.show()},this),e.socialService=p,p})}(this),function(e,t){define("browser/views/BrowserToolbarView",["underscore","doT","jquery","ui/Toolbar","ui/TemplateFactory","ui/AlertWindow","ui/Panel","Account","FunctionSwitch","Log","IOBackendDevice","Internationalization","Configuration","browser/views/BrowserMenuView","doraemon/collections/ExtensionsCollection","doraemon/views/ReportWindowView","social/SocialService","utilities/StringUtil"],function(t,n,r,i,s,o,u,a,f,l,c,h,p,d,v,m,g,y){console.log("BrowserToolbarView - File loaded.");var b=e.alert,w=e.setTimeout,E=e.history,S,x=i.extend({template:n.template(s.get("doraemon","browser-toolbar")),initialize:function(){var e,n,r;Object.defineProperties(this,{$iframe:{set:function(t){e=t,n=e.attr("id"),r=e.attr("branch")},get:function(){return e}},frameId:{get:function(){return n}},frameBranch:{get:function(){return r}}}),S=v.getInstance(),this.listenTo(S,"refresh add remove",t.debounce(this.setButtonState)),this.listenTo(f,"change",this.setButtonState),this.listenTo(this.model,"change:extension",this.render),this.options.hasOwnProperty("$iframe")&&(this.$iframe=this.options.$iframe),this.historyChangeHandler=c.Backend.Device.onmessage({"data.channel":p.events.HISTORY_CHANGED},function(e){e.frame_id===this.$iframe[0].id&&this.setButtonState()},this)},remove:function(){c.Backend.Device.offmessage(this.historyChangeHandler),this.menuView.remove(),x.__super__.remove.call(this)},setButtonState:function(){this.$(".button-back").prop({disabled:E.backCount(this.frameId,this.frameBranch)===0}),this.$(".button-forward").prop({disabled:E.forwardCount(this.frameId,this.frameBranch)===0});var e=this.$(".button-star"),t=this.$(".button-share");if(f.ENABLE_DORAEMON){e.prop({disabled:this.model.get("dev_mode")===!0});var n=!!S.get(this.model.id);r(".star",e).toggleClass("starred",n),e.prop({disabled:this.model.get("dev_mode")===!0})}else e.remove(),t.remove();S.get(this.model.id)?e.attr({title:h.misc.REMOVE_COLLECT}):e.attr({title:h.misc.ADD_TO_COLLECT}),this.$(".button-report").prop({disabled:this.model.get("dev_mode")===!0}),this.$(".developer-wrap").toggle(f.PRIVACY.ENABLE_DEBUG&&this.model.get("dev_mode")===!0)},render:function(){return this.$el.html(this.template(this.model.toJSON())),this.menuView=d.getInstance({model:this.model,$iframe:this.$iframe}),this.$el.append(this.menuView.render().$el),this.listenTo(this.menuView,"select",function(e){this.$iframe[0].src=e}),this.$(".developer-wrap").hide(),w(this.setButtonState.bind(this),0),this},refreshBrowser:function(){var e=this.$iframe[0];e.reload(e.contentDocument.location.href)},clickButtonRefresh:function(){this.refreshBrowser()},clickButtonBack:function(){E.back2(this.frameId,this.frameBranch)},clickButtonForward:function(){E.forward2(this.frameId,this.frameBranch)},clickButtonStar:function(){a.get("isLogin")?S.get(this.model.id)?(this.model.unstarredAsync(),l({event:"ui.click.dora.toolbar.button.unstar",id:this.model.id})):(this.model.starAsync().done(function(){S.add(this.model),S.trigger("star",this.model),this.clickButtonShare()}.bind(this)),l({event:"ui.click.dora.toolbar.button.star",id:this.model.id})):a.loginAsync(h.misc.LOGIN_TO_STAR,"star-button-on-toolbar")},clickButtonShare:function(){var e={textUrl:y.format(p.enums.SOCIAL_TEXT_PREVIEW_URL,p.enums.SOCIAL_DORAEMON_EXTENSION,this.model.id),hasPreview:!1,shareData:{need_shell:0,rotation:0},extraData:{extension_id:this.model.id,extension_title:this.model.get("name")},type:p.enums.SOCIAL_DORAEMON_EXTENSION};g.setContent(e),g.show()},clickButtonReport:function(){var e=m.getInstance({model:this.model,currentURL:this.$iframe[0].contentDocument.location.href});e.show()},clickButtonReload:function(){this.model.downloadAsync().done(function(e){var t=JSON.parse(e.body.value),n=S.get(t.id);n.set(t),this.refreshBrowser()}.bind(this)).fail(function(e){b(e.state_line)})},events:{"click .button-refresh":"clickButtonRefresh","click .button-back":"clickButtonBack","click .button-forward":"clickButtonForward","click .button-star":"clickButtonStar","click .button-share":"clickButtonShare","click .button-report":"clickButtonReport","click .button-reload":"clickButtonReload"}}),T=t.extend({getInstance:function(e){return new x(e)}});return T})}(this),function(e,t){define("browser/views/InfoPanelView",["backbone","underscore","doT","ui/TemplateFactory","utilities/StringUtil","Log","Account","Configuration","Internationalization","doraemon/collections/ExtensionsCollection","social/SocialService"],function(e,t,n,r,i,s,o,u,a,f,l){console.log("InfoPanelView - File loaded. ");var c,h=function(e){e.id===this.model.id&&this.$el.slideUp("fast",this.remove.bind(this))},p=e.View.extend({template:n.template(r.get("doraemon","info-panel")),className:"w-browser-info-panel hbox",initialize:function(){c=c||f.getInstance(),this.listenToOnce(c,"add",h),this.listenTo(this.model,"change:extension",this.render)},render:function(){return this.model.get("extension")?(this.$el.html(this.template(this.model.toJSON())).css({display:"-webkit-box"}),this.$el.slideDown("fast")):this.$el.hide(),this},clickButtonStar:function(){o.get("isLogin")?this.model.starAsync().done(function(){c.add(this.model).trigger("star",this.model);var e={textUrl:i.format(u.enums.SOCIAL_TEXT_PREVIEW_URL,u.enums.SOCIAL_DORAEMON_EXTENSION,this.model.id),hasPreview:!1,shareData:{need_shell:0,rotation:0},extraData:{extension_id:this.model.id,extension_title:this.model.get("name")},type:u.enums.SOCIAL_DORAEMON_EXTENSION};l.setContent(e),l.show(),this.$el.slideUp("fast",this.remove.bind(this))}.bind(this)):o.loginAsync(a.misc.LOGIN_TO_STAR,"star-button-on-info-panel"),s({event:"ui.click.dora.star.button.info.panel",id:this.model.id})},clickButtonClose:function(){this.$el.slideUp("fast",this.remove.bind(this)),s({event:"ui.click.dora.close.button.info.panel",id:this.model.id})},events:{"click .button-star":"clickButtonStar","click .button-close":"clickButtonClose"}}),d=t.extend({getInstance:function(e){return new p(e)}});return d})}(this),function(e,t){define("task/models/TaskModel",["IO","Internationalization","Configuration","utilities/StringUtil"],function(e,t,n,r){console.log("TaskModel - File loaded.");var i=["INSTALL_FAILED_ALREADY_EXISTS","INSTALL_PARSE_FAILED_INCONSISTENT_CERTIFICATES"],s=["UNKNOWN_VEDIO_URL","NO_VEDIO_SEGMENT_FOUND","INSTALL_FAILED_CPU_ABI_INCOMPATIBLE","INSTALL_FAILED_DUPLICATE_PACKAGE","INSTALL_FAILED_MISSING_SHARED_LIBRARY","INSTALL_FAILED_NEWER_SDK","INSTALL_FAILED_OLDER_SDK","INSTALL_FAILED_SHARED_USER_INCOMPATIBLE","INSTALL_FAILED_TEST_ONLY","INSTALL_FAILED_MISSING_FEATURE","INSTALL_FAILED_UNKOWNED_ERROR","INSTALL_FAILED_INVALID_URI","INSTALL_PARSE_FAILED_BAD_MANIFEST","INSTALL_PARSE_FAILED_BAD_SHARED_USER_ID","INSTALL_PARSE_FAILED_CERTIFICATE_ENCODING","INSTALL_PARSE_FAILED_MANIFEST_EMPTY","INSTALL_PARSE_FAILED_MANIFEST_MALFORMED","INSTALL_PARSE_FAILED_NO_CERTIFICATES","INSTALL_PARSE_FAILED_NOT_APK","INSTALL_PARSE_FAILED_UNEXPECTED_EXCEPTION","INSTALL_PARSE_FAILED_UNKNOWN_FORMAT"],o={"wdj://icon/photo":n.enums.TASK_DEFAULT_ICON_PATH_PHOTO,"wdj://icon/music":n.enums.TASK_DEFAULT_ICON_PATH_MUSIC,"wdj://icon/app":n.enums.TASK_DEFAULT_ICON_PATH_APP,"wdj://icon/video":n.enums.TASK_DEFAULT_ICON_PATH_VIDEO,"wdj://icon/book":n.enums.TASK_DEFAULT_ICON_PATH_BOOK,"wdj://icon/file":n.enums.TASK_DEFAULT_ICON_PATH_FILE},u=Backbone.Model.extend({defaults:{state:n.enums.TASK_STATE_ADDED,processing:0,status:t.taskManager.TASK_ADDED,size:0},initialize:function(){this.pretreatment(),Object.defineProperties(this,{isRunning:{get:function(){var e=this.get("state");return e===n.enums.TASK_STATE_WAITING||e===n.enums.TASK_STATE_PROCESSING}},isInQueue:{get:function(){var e=this.get("type");return e!==n.enums.TASK_STATE_SUCCESS&&e!==n.enums.TASK_STATE_FAILD}},isStoped:{get:function(){var e=this.get("state");return e===n.enums.TASK_STATE_ADDED||e===n.enums.TASK_STATE_FAILD}}})},pretreatment:function(){this.set({downloadUrl:this.get("downloadUrl")||this.get("url"),title:this.get("title")||this.get("name")||t.taskManager.UNKNOWN_NAME,icon:o[this.get("icon")]||this.get("icon")||n.enums.TASK_DEFAULT_ICON_PATH_APP,forceRestart:i.indexOf(this.get("message"))>=0,blockAction:s.indexOf(this.get("message"))>=0},{silent:!0})},deleteTaskAsync:function(t){var r=$.Deferred();return e.requestAsync({url:n.actions.TASK_DELETE_TASK,data:{job:this.get("id"),clear:Number(t)},success:function(e){e.state_code===200?(console.log("TaskModel - Delete task success."),r.resolve(e)):(console.error("TaskModel - Delete task failed. Error info: "+e.state_line),r.reject(e))}}),r.promise()},stopTaskAsync:function(){var t=$.Deferred();return e.requestAsync({url:n.actions.TASK_STOP_TASK,data:{job:this.get("id")},success:function(e){e.state_code===200?(console.log("TaskModel - Stop task success."),t.resolve(e)):(console.error("TaskModel - Stop task failed. Error info: "+e.state_line),t.reject(e))}}),t.promise()},startTaskAsync:function(){var t=$.Deferred();return e.requestAsync({url:n.actions.TASK_START_TASK,data:{job:this.get("id")},success:function(e){e.state_code===200?(console.log("TaskModel - Start task success."),t.resolve(e)):(console.error("TaskModel - Start task failed. Error info: "+e.state_line),t.reject(e))}}),t.promise()},restartAsync:function(t){var r=$.Deferred(),i={job:this.get("id")};if(t){var s;for(s in t)t.hasOwnProperty(s)&&(i[s]=t[s])}return e.requestAsync({url:n.actions.TASK_START_TASK,data:i,success:function(e){e.state_code===200?(console.log("TaskModel - Force restart task success."),r.resolve(e)):(console.error("TaskModel - Force restart task failed. Error info: "+e.state_line),r.reject(e))}}),r.promise()},openFolderAsync:function(){var t=$.Deferred();return e.requestAsync({url:n.actions.TASK_OPEN_FOLDER,data:{job:this.get("id")},success:function(e){e.state_code===200?(console.log("TaskModel - Open folder success."),t.resolve(e)):(console.error("TaskModel - Open folder failed. Error info: "+e.state_line),t.reject(e))}}),t.promise()},openOnDeviceAsync:function(){var t=$.Deferred();return e.requestAsync({url:n.actions.DEVICE_OPEN_SD_CARD,data:{category:this.get("category")},success:function(e){e.state_code===200?(console.log("TaskModel - Open folder on device success."),t.resolve(e)):(console.error("TaskModel - Open folder on device failed. Error info: "+e.state_line),t.reject(e))}}),t.promise()},setAsWallpaperAsync:function(t){var r=$.Deferred();return e.requestAsync({url:n.actions.PHOTO_SET_WALLPAPER,data:{photo_id:t},success:function(e){e.state_code===200?(console.log("TaskModel - Set as wallpaper success."),r.resolve(e)):(console.error("TaskModel - Set as wallpaper failed. Error info: "+e.state_line),r.reject(e))}}),r.promise()}});return u})}(this),function(e,t){define("task/TaskService",["IOBackendDevice","Configuration","Device","task/models/TaskModel"],function(e,t,n,r){console.log("TaskService - File loaded.");var i=_.extend(function(){},Backbone.Events);return i.BLOCK_LIST=["NO_MORE_SDCARD","NO_MORE_MEMORY","INSTALL_PARSE_FAILED_INCONSISTENT_CERTIFICATES","VIDEO_NEED_SUPPORT","INSTALL_FAILED_MALICIOUS_APK","DEVICE_NOT_FOUND"],Object.freeze(i.BLOCK_LIST),i.batchDownloadAsync=function(n,r,i){var s=$.Deferred();return e.requestAsync({type:"post",url:t.actions.APP_BATCH_DOWNLOAD+"?source="+r+"&force="+(i===!0?1:0),data:{downloadApps:n},success:function(e){e.state_code===200?s.resolve(e):s.reject(e)}}),s.promise()},i.downloadAsync=function(n){var r=$.Deferred(),i;switch(n.get("modelType")){case t.enums.MODEL_TYPE_APPLICATION:i=t.actions.APP_DOWNLOAD;break;case t.enums.MODEL_TYPE_APPLICATION_DATA:i=t.actions.APP_DOWNLOAD_DATA;break;case t.enums.MODEL_TYPE_MUSIC:i=t.actions.MUSIC_DOWNLOAD;break;case t.enums.MODEL_TYPE_PHOTO:i=t.actions.PHOTO_DOWNLOAD;break;case t.enums.MODEL_TYPE_VIDEO:i=t.actions.VIDEO_DOWNLOAD;break;case t.enums.MODEL_TYPE_BOOK:i=t.actions.BOOK_DOWNLOAD;break;default:console.log("TaskService - Model type not defined. "),i=t.actions.APP_DOWNLOAD}return e.requestAsync({url:i,data:{url:n.get("downloadUrl"),name:n.get("title"),icon:n.get("iconPath"),source:n.get("source")||"unknown",force:n.get("force")===!0?1:0,format:n.get("format")||"",ext_id:n.get("source")||"unknown",packageName:n.get("packageName")||""},success:function(e){e.state_code===200?(console.log('TaskService - Download "'+n.get("title")+'" start. '),r.resolve(e)):(console.error('TaskService - Download "'+n.get("title")+'" faild to start. Error info: '+e.state_line),r.reject(e))}}),r.promise()},i.installAsync=function(n){var r=$.Deferred();return e.requestAsync({url:t.actions.APP_INSTALL,data:{file:n.get("source_path"),name:n.get("title"),icon:n.get("iconPath"),should_delete:n.get("should_delete"),source:"local_import"},success:function(e){e.state_code===200?(console.log('TaskService - Install local application  "'+n.get("name")+'" start.'),r.resolve(e)):(console.error('TaskManager - Fail to start install local application "'+n.get("title")+'". Error info: '+e.state_line),r.reject(e))}}),r.promise()},i.addTask=function(e,n,i){switch(e){case t.enums.TASK_TYPE_INSTALL:switch(n){case t.enums.MODEL_TYPE_APPLICATION:i.set({modelType:t.enums.MODEL_TYPE_APPLICATION});break;case t.enums.MODEL_TYPE_APPLICATION_DATA:i.set({modelType:t.enums.MODEL_TYPE_APPLICATION_DATA});break;case t.enums.MODEL_TYPE_MUSIC:i.set({modelType:t.enums.MODEL_TYPE_MUSIC});break;case t.enums.MODEL_TYPE_PHOTO:i.set({modelType:t.enums.MODEL_TYPE_PHOTO});break;case t.enums.MODEL_TYPE_VIDEO:i.set({modelType:t.enums.MODEL_TYPE_VIDEO});break;case t.enums.MODEL_TYPE_BOOK:i.set({modelType:t.enums.MODEL_TYPE_BOOK})}this.downloadAsync(new r(i.toJSON()));break;case t.enums.TASK_TYPE_LOCAL_INSTALL:switch(n){case t.enums.MODEL_TYPE_APPLICATION:}this.installAsync(new r(i.toJSON()))}},i})}(this),function(e,t){define("app/models/AppBaseModel",["backbone"],function(e){console.log("AppBaseModel - File loaded.");var t=e.Model.extend({defaults:{web_info:{categories:[],likeCount:0,dislikeCount:0,likeRate:0}}});return t})}(this),function(e,t){define("app/models/AppModel",["backbone","jquery","underscore","IO","Internationalization","Configuration","Environment","utilities/StringUtil","Device","app/models/AppBaseModel"],function(e,n,r,i,s,o,u,a,f,l){console.log("AppModel - File loaded. ");var c=l.extend({defaults:{installed:!0,isUpdating:!1,progress:0,isWeb:!1,loaded:!1},parse:function(e){delete e.base_info.requested_permission,delete e.base_info.pinyin;var n=e.base_info;n.version_name||(n.version_name=n.version_code.toString(),delete n.version_code),n.icon?/http:\/\//.test(n.icon)||(n.icon="file:///"+n.icon):n.icon=o.enums.TASK_DEFAULT_ICON_PATH_APP,e.is_blocked?e.update=4:e.isWeb?e.update=0:e.update=!e.is_blocked&&e.upgrade_info.packageName!==t&&a.isURL(e.upgrade_info.downloadUrl)?1:2;var i=r.sortBy(n.permission_info,function(e){return-e.protection_level}),u;return r.each(i.concat(),function(e){u=s.app[e.name],u?e.name=u:i.splice(i.indexOf(e),1)}),n.permission_info=i,e.base_info=n,e},initialize:function(){c.__super__.initialize.apply(this,arguments),Object.defineProperties(this,{isSystem:{get:function(){return this.get("base_info").is_system===!0}},isCritical:{get:function(){return this.get("base_info").is_critical_app}},updateInfo:{get:function(){return new e.Model(this.get("upgrade_info"))}},isUpdatable:{get:function(){return!this.isIgnoredUpdate&&this.get("upgrade_info").packageName!==t&&a.isURL(this.get("upgrade_info").downloadUrl)}},isIgnoredUpdate:{get:function(){return this.get("is_blocked")===!0}},isMovable:{get:function(){var e,t=!this.isSystem&&this.get("base_info").installed_location===o.enums.INSTALL_LOCATION_DEVICE&&f.get("SDKVersion")>=8;return f.get("isWifi")||f.get("isInternet")?e=t&&this.get("base_info").is_moveable===!0:e=t,e}},isMovableToDevice:{get:function(){return!this.isSystem&&this.get("base_info").installed_location===o.enums.INSTALL_LOCATION_EXTENTION&&f.get("SDKVersion")>=8}},isSuggestMove:{get:function(){return this.isMovable&&this.get("base_info").suggest_move===!0}}})},markEnjoyStateAsync:function(e){var t=n.Deferred(),r=this.get("base_info").package_name;return i.requestAsync({url:o.actions.APP_ENJOY,data:{package_name:r,version_code:this.get("base_info").version_code,enjoy:e},success:function(e){e.state_code===200?(console.log('AppModel - Mark "'+r+'" enjoy state success.'),t.resolve(e)):(console.error('AppModel - Mark "'+r+'" enjoy state failed. Error info: '+e.state_line),t.reject(e))}}),t.promise()},uninstallAsync:function(){var e=n.Deferred(),t=this.get("base_info");return this.set("running",!0),i.requestAsync({url:o.actions.APP_UNINSTALL,data:{package_name:t.package_name},success:function(n){if(n.state_code===200){console.log('AppModel - "'+t.name+'" uninstall success.');if(this.collection){var r=this.collection;r.remove(this),r.trigger("refresh",r)}e.resolve(n)}else this.set("running",!1),console.error('AppModel - "'+t.name+'" uninstall failed. Error info: '+n.state_line),e.reject(n)}.bind(this)}),e.promise()},ignoreUpdateAsync:function(){var e=n.Deferred();if(!this.get("is_blocked")){this.set("running",!0);var t=this.get("base_info").package_name;i.requestAsync({url:o.actions.APP_IGNORE_UPDATE,data:{package_name:t},success:function(n){this.set("running",!1),n.state_code===200?(console.log('AppModel - Ignore "'+t+'" success.'),this.set({is_blocked:!0,update:4}),e.resolve(n)):(console.error('AppModel - Ignore "'+t+'" failed. Error info: '+n.state_line),e.reject(n))}.bind(this)})}else e.resolve();return e.promise()},hideWebAppAsync:function(){var e=n.Deferred();if(!this.get("is_blocked")){this.set("running",!0);var t=this.get("base_info").package_name;i.requestAsync({url:o.actions.APP_HIDE_WEB_APPS,data:{package_name:t},success:function(n){this.set("running",!1);if(n.state_code===200){console.log('AppModel - Hide "'+t+'" success.');if(this.collection){var r=this.collection;r.isWeb&&r.remove(this),r.trigger("refresh",r)}e.resolve(n)}else console.error('AppModel - Hide "'+t+'" failed. Error info: '+n.state_line),e.reject(n)}.bind(this)})}else e.resolve();return e.promise()},unignoreUpdateAsync:function(){var e=n.Deferred();if(this.get("is_blocked")){this.set("running",!0);var t=this.get("base_info").package_name;i.requestAsync({url:o.actions.APP_UNIGNORE_UPDATE,data:{package_name:t},success:function(n){this.set("running",!1),n.state_code===200?(console.log('AppModel - Unignore "'+t+'" success.'),this.set({is_blocked:!1,update:this.isUpdatable?1:0,running:!1}),e.resolve(n)):(console.error('AppModel - Unignore "'+t+'" failed. Error info: '+n.state_line),e.reject(n))}.bind(this)})}else e.resolve();return e.promise()},getCommentaryAsync:function(){var e=n.Deferred();return i.requestAsync({url:o.actions.APP_GET_COMMENT,data:{package_name:this.get("base_info").package_name,version_code:this.get("base_info").version_code},success:function(t){t.state_code===200?(console.log("AppModel - Get comment success."),e.resolve(t)):(console.error("AppModel - Get comment faild. Error info: "+t.state_line),e.reject(t))}}),e.promise()},queryAppInfoAsync:function(){var e=n.Deferred();return this.get("loaded")?e.resolve(this.toJSON()):i.requestAsync({url:o.actions.APP_QUERY_INFO,data:{pns:this.get("base_info").package_name,from:"client.dora.app.list",opt_fields:["title","icons.px48","categories","likesCount","likesRate","apks.downloadUrl.url","apks.bytes","apks.versionName","apks.versionCode"].join(",")},success:function(t){t=t[0],this.set({base_info:r.extend(this.get("base_info"),{name:t.title,downloadUrl:t.apks[0].downloadUrl,icon:t.icons.px48,version_name:t.apks[0].versionName,apk_size:t.apks[0].bytes}),upgrade_info:{},loaded:!0}),e.resolve(t)}.bind(this),error:function(t){e.reject(t)}}),e.promise()}});return c})}(this),function(e,t){define("app/collections/AppsCollection",["backbone","jquery","underscore","IOBackendDevice","Environment","Device","Configuration","FunctionSwitch","app/models/AppModel","main/collections/PIMCollection"],function(e,n,r,i,s,o,u,a,f,l){console.log("AppsCollection - File loaded. ");var c=function(){this.collection!==t&&this.collection.trigger("refresh",this.collection)},h=e.Collection.extend({model:f,url:u.actions.APP_SHOW,data:{upgrade_info:1},parse:function(e){return e.state_code===202&&o.get("isConnected")&&(console.log("AppsCollection - App is syncing. "),this.syncing=!0,this.trigger("syncStart")),this.loadingUpdateInfo=e.state_code===251||e.state_code===202,r.each(e.body.app,function(e){e.id=e.base_info.package_name}),e.body.app},syncAsync:function(){var e=n.Deferred();return this.syncing=!0,this.trigger("syncStart"),i.requestAsync({url:u.actions.APP_SYNC,success:function(t){t.state_code===200||t.state_code===251?(console.log("AppsCollection - App sync success. "),e.resolve(t)):(console.error("AppsCollection - App sync failed. Error info: "+t.state_line),this.syncing=!1,this.trigger("syncEnd"),e.reject(t))}.bind(this)}),e.promise()},initialize:function(){var e=!1,n=!1,r=!1;Object.defineProperties(this,{loading:{set:function(t){e=t},get:function(){return e}},loadingUpdateInfo:{set:function(e){n=e},get:function(){return n}},syncing:{set:function(e){r=e},get:function(){return r}}}),this.on("update",function(){e||(e=!0,this.fetch({success:function(t){console.log("AppsCollection - Collection fetched. "),e=!1,t.trigger("refresh",t)}}))},this),i.Backend.Device.onmessage({"data.channel":u.events.APP_LIST_UPDATED},function(t){r&&(r=!1,this.trigger("syncEnd")),t?this.trigger("update"):e=!1},this),i.Backend.Device.onmessage({"data.channel":u.events.APP_INSTALLED},function(e){var n=this.get(e.package_name);n!==t&&n.isUpdatable&&Number(n.updateInfo.get("versionCode"))===Number(e.version_code)&&n.set({upgrade_info:{},update:2})},this),this.listenTo(a,"change",function(){this.trigger("refresh",this)}),this.on("add",function(e){e.on("change:update",c,e),e.once("remove",function(){this.off()},e)})},getUpdatableApps:function(){return a.ENABLE_APP_UPGRADE?this.filter(function(e){return e.isUpdatable}):[]},getSuggestMoveApps:function(){return this.filter(function(e){return e.isSuggestMove})},getNormalApps:function(){return this.filter(function(e){return!e.isSystem})},getSystemApps:function(){return this.filter(function(e){return e.isSystem})},getIgnoredApps:function(){return this.where({is_blocked:!0})},uninstallAppsAsync:function(e,s){var o=n.Deferred(),a=r.intersection(e,this.pluck("id"));return a.length===1&&this.get(a[0]).set("running",!0),i.requestAsync({url:u.actions.APP_BATCH_UNINSTALL,data:{package_name:a.join(","),session:s},success:function(n){if(a.length===1){var r=this.get(a[1]);r!==t&&r.set("running",!1)}n.state_code===200?(console.log("AppsCollection - Application uninstall success. "),e.length===1&&n.body.success&&n.body.success.length===1?this.remove(e[0]):this.remove(n.body.success,{silent:!0}),this.trigger("refresh",this),o.resolve(n)):n.state_code===402?(console.log("AppsCollection - Application uninstall canceled. "),this.trigger("update"),o.reject(n)):(console.error("AppsCollection - Application uninstall failed. Error info: "+n.state_line),o.reject(n))}.bind(this)}),o.promise()},moveAppsAsync:function(e,s,o){var a=n.Deferred(),f=r.compact(r.map(e,function(e){var n=this.get(e);if(n!==t)return n.get("base_info").package_name},this));return i.requestAsync({url:u.actions.APP_MOVE,data:{package_name:f.join(","),session:s||"",location:o},success:function(e){if(f.length===1){var n=this.get(f[1]);n!==t&&n.set("running",!1)}e.state_code===200?(console.log("AppsCollection - Move apps success. "),this.trigger("update"),a.resolve(e)):e.state_code===402?(console.log("AppsCollection - Move apps canceled. "),this.trigger("update"),a.reject(e)):(console.error("AppsCollection - Move apps failed. Error info: "+e.state_line),a.reject(e))}.bind(this)}),a.promise()},ableMoveToDevice:function(e){var n=[];return r.each(e,function(e){var r=this.get(e);r!==t&&r.isMovableToDevice&&n.push(e)},this),n},ableMoveToSD:function(e){var n=[];return r.each(e,function(e){var r=this.get(e);r!==t&&r.isMovable&&n.push(e)},this),n},ableToUpdate:function(e){var n=[];return r.each(e,function(e){var r=this.get(e);r!==t&&r.isUpdatable&&n.push(e)},this),n},ableToUpdateIncludeIgnored:function(e){var n=[];return r.each(e,function(e){var r=this.get(e);r!==t&&r.get("is_blocked")&&n.push(e)},this),n},isSystemApp:function(e){var n=[];return r.each(e,function(e){var r=this.get(e);r!==t&&r.isSystem&&n.push(e)},this),n},isInstalled:function(e){return this.find(function(t){return t.get("base_info").package_name===e})!==t}}),p,d=r.extend(function(){},{getInstance:function(){if(!p){p=new h,p.trigger("update");var e=l.getInstance();p.on("refresh",function(t){e.get(12).set({count:t.getNormalApps().length}),e.get(13).set({count:t.getSystemApps().length});var n=t.getUpdatableApps().length;e.get(3).set({count:n}),e.get(14).set({count:n})})}return p},getClass:function(){return h}});return d})}(this),function(e,t){define("browser/views/AppDependencyView",["backbone","underscore","doT","jquery","ui/TemplateFactory","utilities/StringUtil","IO","Log","Configuration","Internationalization","task/TaskService","app/collections/AppsCollection"],function(t,n,r,i,s,o,u,a,f,l,c,h){console.log("AppDependencyView - File loaded.");var p,d=t.View.extend({template:r.template(s.get("doraemon","app-dependency")),className:"w-browser-app-dependency",initialize:function(){p=p||h.getInstance(),this.listenTo(this.model,"change:extension",function(e,t){t.android_apps&&t.android_apps.length>0&&t.android_apps[0].package_name&&this.loadAppInfoAsync().done(function(e){this.renderContent(e[0])}.bind(this))})},renderContent:function(n){this.appModel=new t.Model(n),this.$el.html(this.template(this.appModel.toJSON())).slideDown("fast");var r=this.appModel.get("icons").px48,s=new e.Image,o=i(s),u=function(){this.$("img").attr({src:s.src}),o.off("load"),o.off("error")}.bind(this),a=function(){o.off("load"),o.off("error")};o.on("load",u),o.on("error",a),o.attr({src:r}),this.listenTo(p,"refresh",function(e){e.isInstalled(this.model.get("extension").android_apps[0].package_name)&&this.slideUp("fast")})},loadAppInfoAsync:function(){var e=i.Deferred(),t=function(){p.isInstalled(this.model.get("extension").android_apps[0].package_name)?e.reject():u.requestAsync({url:f.actions.APP_QUERY_INFO,data:{pns:this.model.get("extension").android_apps[0].package_name,from:"client.dora.app.dependency",opt_fields:["title","downloadCount","apks.bytes","icons.px48","apks.downloadUrl.url"].join(",")},success:function(t){e.resolve(t)},error:function(t){e.reject(t)}})};if(p.loading||p.syncing){var n=function(e){t.call(this),e.off("refresh",n)};p.on("refresh",n,this)}else t.call(this);return e.promise()},render:function(){return this.model.get("extension")&&this.model.get("extension").android_apps>0&&this.model.get("extension").android_apps[0].package_name&&this.loadAppInfoAsync().done(function(e){this.renderContent(e[0])}.bind(this)),this},clickButtonClose:function(){this.$el.slideUp("fast"),a({event:"ui.click.dora.app.dependency.install",id:this.model.id})},clickButtonInstall:function(){c.addTask(f.enums.TASK_TYPE_INSTALL,f.enums.MODEL_TYPE_APPLICATION,new t.Model({downloadUrl:this.appModel.get("apks")[0].downloadUrl.url,title:this.appModel.get("title"),iconPath:this.appModel.get("icons").px48,source:"app-dependency",packageName:this.model.get("extension").android_apps[0].package_name})),this.$el.slideUp("fast"),a({event:"ui.click.dora.app.dependency.install",id:this.model.id})},events:{"click .button-close":"clickButtonClose","click .button-install":"clickButtonInstall"}}),v=n.extend({getInstance:function(e){return new d(e)}});return v})}(this),function(e,t){define("browser/views/BrowserView",["backbone","underscore","doT","jquery","Configuration","IOBackendDevice","Internationalization","FunctionSwitch","utilities/FlashDetector","ui/TemplateFactory","Log","browser/views/BrowserToolbarView","browser/views/InfoPanelView","browser/views/AppDependencyView","doraemon/collections/ExtensionsCollection"],function(n,r,i,s,o,u,a,f,l,c,h,p,d,v,m){console.log("BrowserView - File loaded. ");var g=e.setTimeout,y,b,w=function(e){var t=e.originalEvent.srcElement.readyState;switch(t){case"complete":this.model.get("extension")?this.progress=100:this.progress=80;if(this.$("iframe")[0].src==="http://apps.wandoujia.com/"){var n=(new Date).getTime();h({event:"debug.browser.wandoujia.loading.time",time:n-b})}break;case"interactive":this.progress+=20;break;case"loading":this.progress+=20;break;case"start":this.progress=20,this.$("iframe")[0].src==="http://apps.wandoujia.com/"&&(b=(new Date).getTime())}},E=function(e){var t=function(n){if(n.originalEvent.srcElement.readyState==="complete"){var r=s(e[0].contentDocument).find(".button-retry");r.one("click",function(){E.call(this,e)}.bind(this)),e.off("readystatechange",t)}}.bind(this);this.model.downloadAsync().done(function(){e.attr("src")||e.attr({src:this.model.get("web_url")||this.model.get("extension").app.launch.web_url,extension:this.model.id})}.bind(this)).fail(function(){e.attr({src:o.enums.EXTENTION_ERROR_PAGE_URL,extension:this.model.id})}.bind(this)).always(function(){this.progress+=20}.bind(this))},S=function(t){t.id===this.model.id&&this.id!==o.enums.IFRAME_PREFIX+"misc"&&(e.SnapPea.CurrentModule!=="browser"?this.remove():n.once("switchModule",this.remove,this))},x=function(e){this.$("iframe").attr("src")||this.$("iframe").attr({src:e.get("web_url")||e.get("extension").app.launch.web_url,extension:e.id})},T=n.View.extend({template:i.template(c.get("doraemon","browser")),className:"w-browser vbox",initialize:function(){var e,t=0,n;Object.defineProperties(this,{id:{set:function(t){e=t},get:function(){return e}},progress:{set:function(e){t=parseInt(e,10),t===100?r.debounce(function(){this.$(".progress").fadeOut("fast",function(){t=0})}.bind(this),800)():this.$(".progress").show(),this.$(".progress .value").css("width",t+"%")},get:function(){return t}},flashErrorHandler:{get:function(){return n}}});var i=this.options||{},s;for(s in i)i.hasOwnProperty(s)&&(this[s]=i[s]);y=y||m.getInstance(),this.listenTo(y,"remove",S),this.listenTo(this.model,"change",x),n=u.Backend.Device.onmessage({"data.channel":o.events.FLASH_ERROR},function(e){this.model.id===e.extension_id&&this.$(".flash-notifier").slideDown("fast")},this)},remove:function(){this.infoPanelView&&(this.infoPanelView.remove(),this.infoPanelView=t),this.browserToolbarView&&(this.browserToolbarView.remove(),this.browserToolbarView=t),this.appDependencyView&&(this.appDependencyView.remove(),this.appDependencyView=t),u.Backend.Device.offmessage(this.flashErrorHandler),T.__super__.remove.apply(this)},renderContent:function(){this.$(".w-ui-toolbar, .w-browser-info-panel").remove();var e=this.$("iframe");e.on("readystatechange",w.bind(this)),f.ENABLE_DORAEMON&&(this.model.get("extensionPreview")?(this.infoPanelView=d.getInstance({model:this.model}),this.$el.prepend(this.infoPanelView.render().$el)):y.get(this.model.id)&&(this.appDependencyView=v.getInstance({model:this.model}),this.$el.prepend(this.appDependencyView.render().$el))),this.browserToolbarView=p.getInstance({model:this.model,$iframe:e}),this.$el.prepend(this.browserToolbarView.render().$el),this.autoGotoURL&&this.gotoURL();var t=this.model.get("targetURL")||this.model.get("web_url");(!t||!this.model.get("extension"))&&g(function(){E.call(this,e)}.bind(this),0),this.model.get("extension")&&(this.progress+=20)},gotoURL:function(){var e=this.model.get("targetURL")||this.model.get("web_url"),t=this.$("iframe");e&&(t.attr({src:e,extension:this.model.id}),this.model.unset("targetURL"))},renderFlashNotifier:function(){l.getVersion()?this.$(".flash-notifier").remove():this.$(".flash-notifier").hide()},render:function(){return this.$el.html(this.template(this.model.toJSON())),this.$el.attr({id:this.id}),this.renderContent(),this.renderFlashNotifier(),this},clickButtonInstallFlash:function(){u.requestAsync({url:o.actions.OPEN_URL,data:{url:o.enums.FLASH_DOWNLOAD_URL}}),this.$(".flash-notifier").slideUp("fast")},clickButtonCloseFlashNotifier:function(){this.$(".flash-notifier").slideUp("fast")},events:{"click .button-install-flash":"clickButtonInstallFlash","click .button-close-flash-notifier":"clickButtonCloseFlashNotifier"}}),N=r.extend({getInstance:function(e){return new T(e)}});return N})}(this),function(e,t){define("browser/views/BrowserModuleView",["underscore","backbone","IOBackendDevice","Configuration","Environment","browser/views/BrowserView","doraemon/collections/ExtensionsCollection","doraemon/models/ExtensionModel"],function(e,n,r,i,s,o,u,a){console.log("BrowserModuleView - File loaded.");var f=i.enums.IFRAME_PREFIX,l,c=n.View.extend({className:"w-browser-module-main module-main",initialize:function(){var e=!1;Object.defineProperties(this,{rendered:{set:function(t){e=t},get:function(){return e}}})},render:function(){return this.rendered=!0,this},"goto":function(e,t){typeof t=="undefined"&&(t=!0),this.$(".w-browser").addClass("w-layout-hidden");var n=this.$("#"+f+e.id);n.length>0?n.removeClass("w-layout-hidden"):(n=o.getInstance({id:f+e.id,model:e,autoGotoURL:t}).render().$el,this.$el.prepend(n))},navigate:function(e,t){this.goto(e,!1),this.$("#"+f+e.id).find("iframe").attr({src:t})},navigateToThirdParty:function(e,r,i,s){var c=u.getInstance().get(e);if(c!==t)c.set({selected:!0}),i?this.navigate(c,i):this.goto(c);else{var h=u.getInstance().filter(function(e){return e.get("selected")})[0];h!==t&&h.set({selected:!1});var p=new a({id:e,name:r||"",preview:!0,targetURL:i,extensionPreview:s});this.$(".w-browser").addClass("w-layout-hidden"),l?(l.model=p,l.render()):(l=o.getInstance({id:f+"misc",model:p}),this.$el.prepend(l.render().$el)),l.$el.removeClass("w-layout-hidden"),n.trigger("switchModule",{module:"browser",tab:"misc"})}},navigateTo:function(e,t){if(t)this.navigateToThirdParty(i.enums.TEMP_EXTENTION_ID,"Debug Mode",e);else{var n;s.get("locale")===i.enums.LOCALE_DEFAULT||s.get("locale")===i.enums.LOCALE_ZH_CN?(n=u.getInstance().get(18),n?(n.set({selected:!0}),this.navigate(n,e)):this.navigateToThirdParty(18,"应用搜索",e)):(n=u.getInstance().get(138),n?(n.set({selected:!0}),this.navigate(n,e)):this.navigateToThirdParty(138,"Google Play",e))}}}),h,p=e.extend({getInstance:function(){return h||(h=new c),h},navigate:function(e,t){this.getInstance().navigateTo(e,t)},navigateToThirdParty:function(e,t,n){this.getInstance().navigateToThirdParty(e,t,n,!0)}});return r.Backend.Device.onmessage({"data.channel":i.events.SIDEBAR_PREVIEW},function(e){p.navigateToThirdParty(e.id||e,e.name,e.targetURL)}),p})}(this),function(e,t){define("music/Music",["video/views/ImportVideoView","video/VideoService","main/collections/PIMCollection","browser/views/BrowserModuleView"],function(t,n,r,i){var s={ImportVideoView:t,VideoService:n,PIMCollection:r,BrowserModuleView:i};return e.Music=s,s})}(this),function(e,t){define("sync/SyncService",["backbone","underscore","jquery","IO","Configuration"],function(e,t,n,r,i){console.log("SyncService - File loaded.");var s=t.extend(function(){},e.Events);return s.getIsPhotoSyncOnAsync=function(){var e=n.Deferred();return r.requestAsync({url:i.actions.IS_PHOTO_SYNC_ON,data:{data_id:i.enums.SYNC_DATA_TYPE_PHOTO},success:function(t){t.state_code===200?e.resolve(t):e.reject(t)}}),e.promise()},s.uploadPhotoAsync=function(){var e=n.Deferred();return r.requestAsync({url:i.actions.UPLOAD_PHOTO,data:{session:i.events.SYNC_PHOTO_COMPLETE,data_id:i.enums.SYNC_DATA_TYPE_PHOTO},success:function(t){t.state_code===200?e.resolve(t):e.reject(t)}}),e.promise()},s.setPhotoSyncSwitchAsync=function(e){var t=n.Deferred();return r.requestAsync({url:i.actions.SET_PHOTO_SYNC,data:{is_on:Number(e),data_id:i.enums.SYNC_DATA_TYPE_PHOTO},success:function(e){e.state_code===200?t.resolve(e):t.reject(e)}}),t.promise()},s.setRemoteAutoBackupSwitchAsync=function(e){var t=n.Deferred();return r.requestAsync({url:i.actions.SYNC_SET_SWITCH,data:{contact:Number(e),sms:Number(e),app:Number(e)},success:function(e){e.state_code===200?t.resolve(e):t.reject(e)}}),t.promise()},s})}(this),function(e,t){define("backuprestore/models/BackupContextModel",["underscore","backbone","Environment","Configuration"],function(e,t,n,r){console.log("BackupContextModel - File loaded.");var i=t.Model.extend({initialize:function(){Object.defineProperties(this,{IsLocal:{get:function(){return this.get("backupType")===0}},IsAppSelected:{get:function(){return this.get("dataIDList").indexOf(r.enums.BR_TYPE_APP)>=0}},IsAppDataSelected:{get:function(){return this.get("dataIDList").indexOf(r.enums.BR_TYPE_APP_DATA)>=0}},IsFileNameReady:{get:function(){return this.get("filePath").length>0&&this.get("fileName").length>0}},GetFullFilePath:{get:function(){var e=this.get("filePath");return e.length>0&&e[e.length-1]!=="\\"&&(e+="\\"),e+this.get("fileName")}},GetBRSpec:{get:function(){var t=this.get("dataNumList");return{item:e.map(this.get("dataIDList"),function(e){return{type:e,count:t[e]}}),type:1}}},GetServerTypes:{get:function(){var t=[];return e.each(this.get("dataIDList"),function(e){switch(e){case r.enums.BR_TYPE_CONTACT:t.push(1);break;case r.enums.BR_TYPE_SMS:t.push(2);break;case r.enums.BR_TYPE_APP:t.push(3);break;default:}}),t}}})},defaults:{backupType:0,dataIDList:[r.enums.BR_TYPE_CONTACT,r.enums.BR_TYPE_SMS,r.enums.BR_TYPE_APP],dataNumList:{},appType:0,filePath:"",fileName:"",appPath:"",smsErrorList:[],contactsErrorList:[],appErrorList:[],remoteErrorResult:[],remoteErrorCode:0,appDataErrorMessage:""},clearCache:function(){this.set("backupType",0),this.set("dataIDList",[r.enums.BR_TYPE_CONTACT,r.enums.BR_TYPE_SMS,r.enums.BR_TYPE_APP]),this.set("dataNumList",{}),this.set("appType",0),this.set("filePath",""),this.set("fileName",""),this.set("appPath",""),this.set("smsErrorList",[]),this.set("contactsErrorList",[]),this.set("appErrorList",[]),this.set("remoteErrorResult",[]),this.set("remoteErrorCode",0),this.set("appDataErrorMessage","")}}),s=new i;return s})}(this),function(e){define("main/views/BindingDeviceWindowView",["underscore","jquery","doT","ui/TemplateFactory","ui/Panel","Configuration","Log","IO","Device","Internationalization","Environment"],function(e,t,n,r,i,s,o,u,a,f,l){console.log("BindingDeviceWindowView - File loaded. ");var c=i.extend({initialize:function(){c.__super__.initialize.apply(this,arguments),this.once("show",function(){this.$(".w-ui-window-footer-monitor").append(t("<span>").html(f.misc.BINDING_WARNING).addClass("text-secondary")),o({event:"offline.window.show"})},this),this.once("remove",function(){this.trigger("closed")},this),this.once("button-unbind",this.clickButtonUnbinding,this),this.once("button-bind",this.clickButtonBinding,this)},clickButtonBinding:function(){u.requestAsync(s.actions.WINDOW_DEVICE_BIND),this.remove(),o({event:"offline.window.yes"})},clickButtonUnbinding:function(){u.requestAsync(s.actions.WINDOW_DEVICE_UNBIND),this.remove(),o({event:"offline.window.no"})},loadContentAndShow:function(){if(l.get("locale")!==s.enums.LOCALE_DEFAULT&&l.get("locale")!==s.enums.LOCALE_ZH_CN){this.$bodyContent=t(n.template(r.get("misc","binding-devie-i18n"))({})),this.show();return}u.requestAsync({url:"http://www.wandoujia.com/cloud/bind_auto.html",success:function(e){this.$bodyContent=t("<div>").html(e),this.show()}.bind(this),error:function(){this.$bodyContent=t(n.template(r.get("misc","binding-devie"))({})),this.show()}.bind(this)})},checkAsync:function(){var e=t.Deferred(),n=function(t){!t.get("isFastADB")&&t.get("isConnected")&&(u.requestAsync(s.actions.WINDOW_DEVICE_NEED_BIND).done(function(t){t.body.value?this.loadContentAndShow():this.trigger("closed"),e.resolve(t)}.bind(this)).fail(e.reject),t.off("change",n))};return l.get("deviceId")!=="Default"&&(!a.get("isFastADB")&&a.get("isConnected")?n.call(this,a):a.on("change",n,this)),e.promise()}}),h=e.extend({getInstance:function(e){return new c({title:f.misc.BINDING_DEVICE,buttons:[{$button:t("<button>").html(f.misc.BIND).addClass("primary"),eventName:"button-bind"},{$button:t("<button>").html(f.misc.UNBIND),eventName:"button-unbind"}],disableX:!0})}});return h})}(this),function(e,t){define("welcome/WelcomeService",["backbone","underscore","jquery","IOBackendDevice","Configuration","Environment","Internationalization","Log","utilities/StringUtil","ui/Notification","ui/AlertWindow","ui/BatchActionWindow"],function(e,t,n,r,i,s,o,u,a,f,l,c){console.log("WelcomeService - File loaded.");var h=t.extend(function(){},e.Events);return h.openAutobackupFileAsync=function(){var e=n.Deferred();return r.requestAsync({url:i.actions.OPEN_AUTO_BACKUP_FILE,success:function(t){t.state_code===200?e.resolve(t):e.reject(t)}}),e.promise()},h.getAutoBackupDateAsync=function(){var e=n.Deferred();return r.requestAsync({url:i.actions.GET_LATEST_AUTO_BACKUP,success:function(t){t.state_code===200?e.resolve(t):e.reject(t)}}),e.promise()},h.getSystemSettingAsync=function(e){var t=n.Deferred();return r.requestAsync({url:i.actions.GET_SYSTEM_SETTING,data:{setting_name:e},success:function(e){e.state_code===200?t.resolve(e):t.reject(e)}}),t.promise()},h.openNotifySettingWindowAsync=function(){var e=n.Deferred();return r.requestAsync({url:i.actions.OPEN_NOTIFY_SETTING,success:function(t){t.state_code===200?e.resolve(t):e.reject(t)}}),e.promise()},h.openNotifySettingWindowHelperAsync=function(){var e=n.Deferred();return r.requestAsync({url:i.actions.OPEN_NOTIFY_SETTING_HELPER,success:function(t){t.state_code===200?e.resolve(t):e.reject(t)}}),e.promise()},h})}(this),function(e,t){define("backuprestore/models/RestoreContextModel",["Environment","Configuration","Internationalization"],function(e,t,n){console.log("RestoreContextModel - File loaded.");var r=Backbone.Model.extend({initialize:function(){Object.defineProperties(this,{IsLocal:{get:function(){return this.get("backupType")===0}},FileList:{get:function(){return _.map(this.get("backupFileList"),function(e){var t=e.substr(e.lastIndexOf("\\")+1),n=t.lastIndexOf(".zip");return n>0&&(t=t.substr(0,n)),{file_name:e,short_file_name:t}})}},GetBRSpec:{get:function(){var e={};if(this.IsLocal){var n=this.get("fileName");e=this.get("backupFileInfoDict")[n]}else{var r=this.get("remoteVersion");e=this.get("snapshotInfoDict")[r]}var i=_.filter(this.get("dataIDList"),function(e){return e!==t.enums.BR_TYPE_APP&&e!==t.enums.BR_TYPE_APP_DATA});return{item:_.map(i,function(t){return{type:t,count:e[t]}}),type:2}}},SelectedFileIndex:{get:function(){var e=this.get("fileName");return this.get("backupFileList").indexOf(e)}},IsAppSelected:{get:function(){return this.get("dataIDList").indexOf(t.enums.BR_TYPE_APP)>=0}},IsAppDataSelected:{get:function(){return this.get("dataIDList").indexOf(t.enums.BR_TYPE_APP_DATA)>=0}},IsContactSelected:{get:function(){return this.get("dataIDList").indexOf(t.enums.BR_TYPE_CONTACT)>=0}},IsNoneAppSelected:{get:function(){return this.get("dataIDList").indexOf(t.enums.BR_TYPE_CONTACT)>=0||this.get("dataIDList").indexOf(t.enums.BR_TYPE_SMS)>=0||this.get("dataIDList").indexOf(t.enums.BR_TYPE_CALLLOG)>=0}},GetServerTypes:{get:function(){var e=[];return _.each(this.get("dataIDList"),function(n){switch(n){case t.enums.BR_TYPE_CONTACT:e.push(1);break;case t.enums.BR_TYPE_SMS:e.push(2);break;case t.enums.BR_TYPE_APP:e.push(3);break;default:console.error(type)}}),e}}})},defaults:{backupType:0,backupFileList:[],backupFileInfoDict:{},fileName:"",dataIDList:[],isAccountReady:!1,accountType:"",accountName:"",battery:-1,appPath:"",errorItemList:[],remoteVersion:"",udid:"",snapshotList:[],snapshotInfoDict:{},sanpshotListLoadFinish:!1},clearCache:function(){this.set("backupType",0),this.set("backupFileList",[]),this.set("backupFileInfoDict",{}),this.set("fileName",""),this.set("dataIDList",[]),this.set("isAccountReady",!1),this.set("accountType",""),this.set("accountName",""),this.set("battery",-1),this.set("appPath",""),this.set("errorItemList",[]),this.set("remoteVersion",""),this.set("udid",""),this.set("snapshotList",[]),this.set("snapshotInfoDict",{}),this.set("sanpshotListLoadFinish",!1)}}),i=new r;return i})}(this),function(e,t){define("backuprestore/views/BackupRestoreChooseTypeView",["backbone","underscore","doT","Device","Internationalization","ui/Panel","ui/UIHelper","ui/TemplateFactory","backuprestore/BackupRestoreService","backuprestore/models/BackupContextModel","backuprestore/models/RestoreContextModel"],function(e,t,n,r,i,s,o,u,a,f,l){console.log("BackupRestoreChooseTypeView - File loaded. ");var c=e.View.extend({className:"w-backup-choose-type",initialize:function(){},render:function(){return this.$el.html(this.template({})),this},nextStep:function(e){var t=this.options.isBackup?f:l;t.set({backupType:e}),this.trigger("next")},clickButtonLocal:function(){this.nextStep(0)},clickButtonRemote:function(){this.nextStep(1)},events:{"click .button-local":"clickButtonLocal","click .button-remote":"clickButtonRemote"}}),h,p=s.extend({initialize:function(){p.__super__.initialize.apply(this,arguments),this.on(o.EventsMapping.SHOW,function(){h=new c({isBackup:this.options.isBackup}),h.template=this.options.bodyViewTemplate,h.on("next",function(){this.trigger("_NEXT_STEP")},this),this.$bodyContent=h.render().$el,this.center()},this)}}),d,v,m=t.extend({getBackupInstance:function(){return d||(d=new p({title:i.backup_restore.BACKUP_TITLE,height:a.CONSTS.ViewHeight,width:a.CONSTS.ViewWidth,bodyViewTemplate:n.template(u.get("backup","choose-backup-type")),isBackup:!0})),d},getRestoreInstance:function(){return v||(v=new p({title:i.backup_restore.RESTORE_TITLE,height:a.CONSTS.ViewHeight,width:a.CONSTS.ViewWidth,bodyViewTemplate:n.template(u.get("restore","choose-restore-type")),isBackup:!1})),v}});return m})}(this),function(e,t){define("LOG",["Configuration"],function(t){console.log("Log - File loaded.");var n=function(n){var r=!0;if(r){n=n||{};var i=t.actions.SEND_LOG,s=[],o;for(o in n)n.hasOwnProperty(o)&&s.push(o+"="+e.encodeURIComponent(n[o]));i+="?"+s.join("&"),e.OneRingRequest("get",i,"",function(e){e=JSON.parse(e),e.state_code===200&&console.log("Log: ",i)})}};return e.log=n,n})}(this),function(e,t){define("backuprestore/views/BackupRestoreChooseDataView",["backbone","underscore","doT","jquery","Device","FunctionSwitch","Internationalization","utilities/StringUtil","Configuration","LOG","ui/Panel","ui/PopupPanel","ui/UIHelper","ui/TemplateFactory","ui/AlertWindow","backuprestore/BackupRestoreService","backuprestore/models/BackupContextModel","backuprestore/models/RestoreContextModel"],function(n,r,i,s,o,u,a,f,l,c,h,p,d,v,m,g,y,b){console.log("BackupRestoreChooseDataView - File loaded. ");var w,E=e.alert,S=n.View.extend({template:i.template(v.get("backup","choose-backup-restore-data")),className:"w-backup-restore-choose-data",initialize:function(){var e=[],t=!0;Object.defineProperties(this,{dataList:{set:function(t){t instanceof Array&&(e=t)},get:function(){return e}},loading:{set:function(e){t=Boolean(e).valueOf(),this.$(".loading").toggle(t)},get:function(){return t}}}),o.on("change:isUSB",this.setAppData,this)},render:function(){this.$el.html(this.template({loading:this.loading,list:this.dataList,isBackup:this.options.isBackup}));var e=new p({$content:s("<div>").width(200).html(a.backup_restore.BACKUP_APP_DATA_TIP),$host:this.$(".app-data-tip-ctn"),delay:!0});return this.$("ul li input").prop({checked:!1}),r.map(y.get("dataIDList"),function(e){var t=f.format('ul li input[value="{1}"]',e);this.$(t).prop({checked:!0})}),this.$("ul li input:disabled").prop({checked:!1}),u.ENABLE_CLOUD_BACKUP_RESTORE&&this.setAppData(),this.checkedChange(),this},prepareBackup:function(){this.loading=!0,g.prepareBackupAsync().done(function(e){this.dataList=e.body.item,y.IsLocal&&this.dataList.push({type:l.enums.BR_TYPE_APP_DATA,count:0});var n={};r.each(this.dataList,function(e){n[e.type]=e.count});var i=y.get("dataNumList")[l.enums.BR_TYPE_APP_DATA];i!==t&&(n[l.enums.BR_TYPE_APP_DATA]=i),y.set("dataNumList",n),this.loading=!1,this.render(),this.trigger("changed")}.bind(this)).fail(function(e){this.prepareBackupFailed()}.bind(this)).always(function(e){clearTimeout(w)})},prepareBackupFailed:function(){this.trigger("remove"),E(a.backup_restore.PERMISSION_TIP,function(){this.trigger("timeout")}.bind(this)),c({event:"debug.backup.progress.error",type:4})},refreshAppData:function(e){this.$("input[value=10]").prop({disabled:e})},setAppData:function(){if(!this.options.isBackup)return;if(!o.get("isUSB")){this.refreshAppData(!0),this.$(".count[data-value=10]").text(a.backup_restore.BACKUP_APP_DATA_NON_USB);return}var e=y.get("dataNumList")[l.enums.BR_TYPE_APP_DATA];if(e!==t){e>=0?(this.refreshAppData(!1),this.$(".count[data-value=10]").text(e)):(this.refreshAppData(!0),this.$(".count[data-value=10]").text(a.backup_restore.BACKUP_APP_DATA_UNSUPPORT));return}g.getAppDataCountAsync().done(function(e){this.refreshAppData(!1),this.$(".count[data-value=10]").text(e.body.value),y.get("dataNumList")[l.enums.BR_TYPE_APP_DATA]=parseInt(e.body.value,10)}.bind(this)).fail(function(e){this.refreshAppData(!0),this.$(".count[data-value=10]").text(a.backup_restore.BACKUP_APP_DATA_UNSUPPORT),y.get("dataNumList")[l.enums.BR_TYPE_APP_DATA]=-1}.bind(this))},fillInfoData:function(e){var t;for(t in e)e.hasOwnProperty(t)&&this.dataList.push({type:parseInt(t,10),count:e[t]});this.loading=!1,this.render(),this.trigger("changed")},isCsvFile:function(e){if(!e)return!1;var t=".csv",n=e.lastIndexOf(".csv");return n>0&&n+t.length===e.length},prepareRestoreLocal:function(){this.loading=!0;var e=b.get("fileName"),n=b.get("backupFileInfoDict")[e];if(n!==t){this.fillInfoData(n);return}g.readRestoreFileAsync(e).done(function(t){var n={};r.each(t.body.item,function(e){n[e.type]=e.count}),b.get("backupFileInfoDict")[e]=n,this.fillInfoData(n)}.bind(this)).fail(function(t){var n;this.isCsvFile(e)?n=a.backup_restore.RESTORE_INVLID_CONTACTS_FILE:n=g.getErrorMessage(t.state_code),E(n,function(){this.trigger("error")}.bind(this)),g.recordError("debug.restore.progress.error",t.state_code,5),g.logBackupContextModel(y,!1)}.bind(this))},prepareRestoreRemote:function(){this.loading=!0;var e=b.get("remoteVersion"),n=b.get("snapshotInfoDict")[e];if(n!==t){this.fillInfoData(n);return}g.remoteSnapshotInfoAllTypesAsync(e).done(function(t){var n={};r.each(JSON.parse(t.body.value),function(e){var t=g.getServerTypeFromBRType(e.type);n[t]=e.count}),b.get("snapshotInfoDict")[e]=n,this.fillInfoData(n)}.bind(this)).fail(function(e){var t=g.getErrorMessage(e.state_code);E(t,function(){this.trigger("error")}.bind(this)),g.recordError("debug.restore.progress.error",e,6),g.logBackupContextModel(y,!1)}.bind(this))},resetData:function(){this.loading=!0,this.dataList=[],this.render()},setData:function(e){var t=this.$('input[name="type"]:checked:enabled');e.set({dataIDList:r.map(t,function(e){return parseInt(e.value,10)})})},checkedChange:function(){this.trigger("changed")},appCheckedChange:function(e){e.originalEvent.srcElement.checked||this.$('input[value="10"]').prop({checked:!1}),this.trigger("changed")},appDataCheckedChange:function(e){e.originalEvent.srcElement.checked&&this.$('input[value="8"]').prop({checked:!0}),this.trigger("changed")},isCheckedNone:function(){var e=this.$('input[name="type"]:checked');return e.length===0},events:{'change input[name="type"]':"checkedChange",'change input[value="8"]':"appCheckedChange",'change input[value="10"]':"appDataCheckedChange"}}),x,T=h.extend({initialize:function(){T.__super__.initialize.apply(this,arguments),this.on(d.EventsMapping.SHOW,function(){x=new S({isBackup:this.options.isBackup}),this.$bodyContent=x.render().$el,this.setViewTitle(),this.center(),x.on("changed",function(){this.$(".button-next").prop({disabled:x.isCheckedNone()})},this),x.on("timeout",function(){this.trigger("_TIME_OUT")},this),x.on("remove",function(){this.remove()},this),x.on("error",function(){this.trigger("_LAST_STEP")},this);if(this.options.isBackup){var e=y.IsLocal?a.ui.NEXT:a.backup_restore.START_BACKUP;this.$(".button-next").html(e),x.prepareBackup()}else b.IsLocal?x.prepareRestoreLocal():x.prepareRestoreRemote()},this),this.on(d.EventsMapping.REMOVE,function(){x.resetData()});var e=this.options.isBackup?a.ui.NEXT:a.backup_restore.START_RESTORE;this.buttons=[{$button:s("<button>").html(e).addClass("button-next primary"),eventName:"button_next"},{$button:s("<button>").html(a.ui.CANCEL).addClass("button-cancel"),eventName:"button_cancel"}]},render:function(){r.extend(this.events,T.__super__.events),this.delegateEvents(),T.__super__.render.apply(this,arguments);if(u.ENABLE_CLOUD_BACKUP_RESTORE){var e=s("<button>").html(a.ui.PREV).addClass("button-last");this.$(".w-ui-window-footer-monitor").append(e)}return this.$(".button-next").prop({disabled:!0}),this},setViewTitle:function(e){this.options.isBackup?(this.title=y.IsLocal?a.backup_restore.BACKUP_TITLE_LOCAL:a.backup_restore.BACKUP_TITLE_REMOTE,this.$(".title").text(a.backup_restore.CHOOSE_BACKUP_DATA_TIP)):(this.title=b.IsLocal?a.backup_restore.RESTORE_TITLE_LOCAL:a.backup_restore.RESTORE_TITLE_REMOTE,this.$(".title").text(a.backup_restore.CHOOSE_RESTORE_DATA_TIP))},clickButtonLast:function(){x.setData(this.options.isBackup?y:b),this.trigger("_LAST_STEP")},clickButtonNext:function(){x.setData(this.options.isBackup?y:b),this.trigger("_NEXT_STEP")},clickButtonCancel:function(){clearTimeout(w)},events:{"click .button-last":"clickButtonLast","click .button-next":"clickButtonNext","click .button-cancel":"clickButtonCancel"}}),N,C,k,L=r.extend({getBackupInstance:function(){return N||(N=new T({title:a.backup_restore.BACKUP_TITLE,disableX:!0,height:g.CONSTS.ViewHeight,width:g.CONSTS.ViewWidth,isBackup:!0})),N},getRestoreLocalInstance:function(){return C||(C=new T({title:a.backup_restore.RESTORE_TITLE,disableX:!0,height:g.CONSTS.ViewHeight,width:g.CONSTS.ViewWidth,isBackup:!1})),C},getRestoreRemoteInstance:function(){return k||(k=new T({title:a.backup_restore.RESTORE_TITLE,disableX:!0,height:g.CONSTS.ViewHeight,width:g.CONSTS.ViewWidth,isBackup:!1})),k}});return L})}(this),function(e,t){define("backuprestore/views/BackupChooseAppTypeView",["backbone","underscore","doT","jquery","Device","Internationalization","ui/Panel","ui/UIHelper","ui/TemplateFactory","backuprestore/BackupRestoreService","backuprestore/models/BackupContextModel"],function(e,t,n,r,i,s,o,u,a,f,l){console.log("BackupChooseAppTypeView - File loaded. ");var c=e.View.extend({template:n.template(a.get("backup","choose-app-type")),className:"w-backup-choose-app-type",initialize:function(){i.on("change:isUSB",this.render,this)},render:function(){return this.$el.html(this.template({})),i.get("isUSB")||(this.$("input[value=0]").prop({disabled:!0}),this.$(".apk-desc").text(s.backup_restore.APP_TYPE_APK_CONTENT_WIFI),this.$(".apk-title").removeClass("desc-title").addClass("text-secondary")),this},setBackupAppType:function(){var e=this.$('input[name="app_type"]:checked');l.set({appType:parseInt(e.attr("value"),10)})}}),h,p=o.extend({initialize:function(){p.__super__.initialize.apply(this,arguments),this.on(u.EventsMapping.SHOW,function(){h=new c,this.$bodyContent=h.render().$el,this.center()},this),this.buttons=[{$button:r("<button>").html(s.ui.NEXT).addClass("button-next primary"),eventName:"button_next"},{$button:r("<button>").html(s.ui.CANCEL),eventName:"button_cancel"}]},clickButtonNext:function(){h.setBackupAppType(),this.trigger("_NEXT_STEP")},events:{"click .button-next":"clickButtonNext"}}),d,v=t.extend({getInstance:function(){return d||(d=new p({title:s.backup_restore.BACKUP_TITLE_LOCAL,disableX:!0,height:275,width:f.CONSTS.ViewWidthTip})),d}});return v})}(this),function(e,t){define("backuprestore/views/BackupChooseLocationView",["backbone","underscore","doT","jquery","Device","Internationalization","Log","ui/AlertWindow","ui/Panel","ui/UIHelper","ui/TemplateFactory","utilities/StringUtil","backuprestore/BackupRestoreService","backuprestore/models/BackupContextModel"],function(n,r,i,s,o,u,a,f,l,c,h,p,d,v){console.log("BackupChooseLocationView - File loaded. ");var m=e.alert,g=n.View.extend({template:i.template(h.get("backup","choose-backup-location")),className:"w-backup-choose-location",invalidPattern:'[/\\\\:?*"<>|]',initialize:function(){},render:function(){return this.$el.html(this.template({})),this.getFilePath(),this.getFileName(),this},showAndRecordError:function(e,t){m(e),a({event:"debug.backup.file_path.error",type:t})},getFilePath:function(){v.set("filePath",""),d.getSettingPathAsync().done(function(e){var t=e.body.value;v.set("filePath",t),this.$(".file-path").text(t),this.trigger("loaded")}.bind(this)).fail(function(){this.showAndRecordError(u.backup_restore.GET_FILE_PATH_FAILED,0)}.bind(this))},getFileName:function(){v.set("fileName",""),d.getDeviceTitleAsync().done(function(e){var n=e.body.value;n!==t&&n.length>0&&(n=n.replace(/ /g,"_").replace(new RegExp(this.invalidPattern,"g"),"_"));var r=p.formatDate("yyyy-MM-dd-HH-mm-",(new Date).valueOf());n=r+n,v.set("fileName",n),this.$(".file-name").val(n),this.trigger("loaded")}.bind(this)).fail(function(){this.showAndRecordError(u.backup_restore.GET_FILE_NAME_FAILED,1);var e=u.backup_restore.DEFAULT_FILE_NAME;v.set("fileName",e),this.$(".file-name").val(e),this.trigger("loaded")}.bind(this))},setFileName:function(){var e=this.$(".file-name").val().trim();v.set("fileName",e)},isFileNameLegal:function(){var e=this.$(".file-name").val().trim();return e&&e!==""&&!(new RegExp(this.invalidPattern)).test(e)},clickButtonSetLocation:function(){d.setSettingPathAsync(!1).done(function(e){if(e.state_code===402)return;var t=e.body.value;v.set("filePath",t),this.$(".file-path").text(t),this.trigger("loaded")}.bind(this)).fail(function(){this.showAndRecordError(u.backup_restore.SET_FILE_PATH_FAILED,2)}.bind(this))},events:{"click .button-set-location":"clickButtonSetLocation"}}),y,b=l.extend({initialize:function(){b.__super__.initialize.apply(this,arguments),this.on(c.EventsMapping.SHOW,function(){y=new g,this.$bodyContent=y.render().$el,this.center(),y.on("loaded",this.updateButtonEnableState.bind(this))},this),this.buttons=[{$button:s("<button>").html(u.backup_restore.START_BACKUP).addClass("button-next primary"),eventName:"button_next"},{$button:s("<button>").html(u.ui.CANCEL),eventName:"button_cancel"}]},render:function(){r.extend(this.events,b.__super__.events),this.delegateEvents(),b.__super__.render.apply(this,arguments);var e=s("<button>").html(u.ui.PREV);return e.addClass("button-last"),this.$(".w-ui-window-footer-monitor").append(e),this.$(".button-next").prop({disabled:!0}),this},updateButtonEnableState:function(){this.$(".button-next").prop({disabled:!v.IsFileNameReady})},clickButtonLast:function(){this.trigger("_LAST_STEP")},clickButtonNext:function(){if(!y.isFileNameLegal()){m(u.backup_restore.FILE_NAME_UNLEGAL);return}y.setFileName(),this.trigger("_NEXT_STEP")},events:{"click .button-last":"clickButtonLast","click .button-next":"clickButtonNext"}}),w,E=r.extend({getInstance:function(){return w||(w=new b({title:u.backup_restore.BACKUP_TITLE_LOCAL,disableX:!0,height:d.CONSTS.ViewHeight,width:d.CONSTS.ViewWidth})),w}});return E})}(this),function(e,t){define("backuprestore/views/BackupAppDataTipView",["backbone","underscore","doT","jquery","Device","Internationalization","ui/Panel","ui/UIHelper","ui/TemplateFactory","backuprestore/BackupRestoreService","backuprestore/models/BackupContextModel"],function(e,t,n,r,i,s,o,u,a,f,l){console.log("BackupAppDataTipView - File loaded. ");var c=e.View.extend({template:n.template(a.get("backup","backup-app-data-tip-view")),className:"w-backup-app-data-tip",initialize:function(){},render:function(){return this.$el.html(this.template({})),this}}),h,p=o.extend({initialize:function(){p.__super__.initialize.apply(this,arguments),this.on(u.EventsMapping.SHOW,function(){h=new c,this.$bodyContent=h.render().$el,this.center()},this),this.buttons=[{$button:r("<button>").html(s.common.OK).addClass("button-next"),eventName:"button_next"}]},clickButtonOK:function(){this.trigger("_OK"),this.remove()},events:{"click .button-next":"clickButtonOK"}}),d,v=t.extend({getInstance:function(){return d||(d=new p({title:s.backup_restore.BACKUP_TITLE_LOCAL,disableX:!0,width:f.CONSTS.ViewWidthTip})),d}});return v})}(this),function(e,t){define("backuprestore/views/BackupProgressView",["backbone","underscore","doT","jquery","Device","Internationalization","Configuration","ui/Panel","ui/UIHelper","ui/TemplateFactory","backuprestore/BackupRestoreService","backuprestore/models/BackupContextModel","backuprestore/views/BackupAppDataTipView"],function(e,n,r,i,s,o,u,a,f,l,c,h,p){console.log("BackupProgressView - File loaded. ");var d,v,m,g,y=e.View.extend({template:r.template(l.get("backup","backup-progress")),className:"w-backup-progress",initialize:function(){},render:function(){return this.$el.html(this.template({})),this.resetContent(),this},resetContent:function(){this.$(".privacy-tip").hide(),this.$(".title").text(o.backup_restore.BACKUPING),this.$(".progress-ctn").html(""),g=!1}}),b,w,E,S=a.extend({initialize:function(){S.__super__.initialize.apply(this,arguments),this.on(f.EventsMapping.SHOW,function(){m=!1,d=new y,this.$bodyContent=d.render().$el,this.startBackupSmsAndContact(),this.center()},this),this.buttons=[{$button:i("<button>").html(o.ui.FINISH).addClass("button-finish primary"),eventName:"button_finish"},{$button:i("<button>").html(o.ui.CANCEL).addClass("button-cancel"),eventName:"button_cancel"}]},render:function(){n.extend(this.events,S.__super__.events),this.delegateEvents(),S.__super__.render.apply(this,arguments);var e=i("<button>").html(o.backup_restore.OPEN_BACKUP_FILE).addClass("button-show-file");return this.$(".w-ui-window-footer-monitor").append(e),d!==t&&d.resetContent(),this.setButtnState(!0),this},setButtnState:function(e){this.$(".button-show-file, .button-finish").toggle(!e),this.$(".button-cancel").toggle(e)},initProgressItems:function(e){n.each(e.item,function(e){this.updateItem(e.type,c.CONSTS.BR_PI_STATUS.WAITING,0,e.count,"")},this)},updateNonAppItems:function(e){var t;for(t in e){var n=e[t];(t===0||n.status!==c.CONSTS.BR_PI_STATUS.READY)&&this.updateItem(n.type,n.status,n.finished_count,n.all_count)}},findOrCreateProgressItem:function(e){var t="progress-item-"+e,n=this.$("."+t);if(n.length===0){var s=r.template(l.get("backup","backup-progress-item"))({});n=i("<div>").html(s),n.addClass(t).addClass("item hbox"),n.find(".icon-ctn").addClass("icon-type-"+e),this.$(".progress-ctn").append(n)}return n},updateItem:function(e,t,n,r,i){var s=this.findOrCreateProgressItem(e);s.removeClass("error");if(e===u.enums.BR_TYPE_APP_DATA&&g&&t===c.CONSTS.BR_STATUS.RUNNING){s.find(".progress-desc").text(o.backup_restore.BACKUP_PROCESS_APP_DATA),s.find("progress").addClass("running").prop({max:100,value:100});return}s.find("progress").removeClass("running");var a;switch(t){case c.CONSTS.BR_PI_STATUS.WAITING:a=o.backup_restore.BACKUP_WAITING;break;case c.CONSTS.BR_PI_STATUS.FINISHED:a=o.backup_restore.BACKUP_FINISH;break;case c.CONSTS.BR_PI_STATUS.ERROR:s.addClass("error"),a=o.backup_restore.BACKUP_FAILED,a+=i||"";break;default:a=o.backup_restore.BACKUP_PROCESS}var f=StringUtil.format(a,o.backup_restore.BR_TYPE_WORD_ENUM[e]);s.find(".progress-desc").text(f);if(n>=0&&r>=0){var l=StringUtil.format("{1} / {2}",n,r);s.find(".progress-num").text(l),n===0&&r===0&&(n=r=1),s.find("progress").prop({max:r,value:n})}},startBackupSmsAndContact:function(){var e=n.uniqueId("backup.nonapps_");v=e;var t=h.GetFullFilePath,r=h.GetBRSpec;this.initProgressItems(r);var i=0;c.backupStartNonAppsAsync(t,e,r).done(function(e){h.set("appPath",e.body.value),i++,this.backupSmsAndContactFinish(i)}.bind(this)).fail(function(e){this.remove(),c.showAndRecordError("debug.backup.progress.error",e,0),c.logBackupContextModel(h,!1)}.bind(this)),b=IO.Backend.Device.onmessage({"data.channel":e},function(e){var t=e,n,r;switch(t.status){case c.CONSTS.BR_STATUS.RUNNING:this.updateNonAppItems(t.item);break;case c.CONSTS.BR_STATUS.FINISHED:this.updateNonAppItems(t.item),IO.Backend.Device.offmessage(b),i++,this.backupSmsAndContactFinish(i);break;case c.CONSTS.BR_STATUS.READY:case c.CONSTS.BR_STATUS.PAUSED:case c.CONSTS.BR_STATUS.STOPPED:break;case c.CONSTS.BR_STATUS.ABORT:this.remove(),alert(o.backup_restore.BACKUP_ABORT_TIP),c.logBackupContextModel(h,!1);break;default:this.remove(),alert(o.backup_restore.BACKUP_FAILED_TIP+t.status),c.logBackupContextModel(h,!1)}},this)},backupSmsAndContactFinish:function(e){if(e<2)return;h.IsAppSelected?this.startBackupApps():this.backupAllFinish()},startBackupApps:function(){if(h.get("dataNumList")[u.enums.BR_TYPE_APP]===0){this.updateItem(u.enums.BR_TYPE_APP,c.CONSTS.BR_PI_STATUS.FINISHED,0,0),h.IsAppDataSelected&&this.updateItem(u.enums.BR_TYPE_APP_DATA,c.CONSTS.BR_PI_STATUS.FINISHED,0,0),this.backupAllFinish();return}var e=h.get("appPath"),t=h.get("appType"),r=n.uniqueId("backup.apps_");v=r;var i=!1;c.backupStartAppsAsync(e,r,t).done(function(e){var t=e.body,n=t&&t.success&&t.success.length?t.success.length:0,r=t&&t.failed&&t.failed.length?t.failed.length:0;r>0?(this.updateItem(u.enums.BR_TYPE_APP,c.CONSTS.BR_PI_STATUS.ERROR,n,t.total),h.set("appErrorList",t.failed),this.trigger("_APP_ERROR_LIST")):(this.updateItem(u.enums.BR_TYPE_APP,c.CONSTS.BR_PI_STATUS.FINISHED,n,t.total),h.IsAppDataSelected?this.startBackupAppData():this.backupAllFinish())}.bind(this)).fail(function(e){this.remove(),c.showAndRecordError("debug.backup.progress.error",e,1),c.logBackupContextModel(h,!1)}.bind(this)).always(function(e){i=!0}.bind(this)),w=IO.Backend.Device.onmessage({"data.channel":r},function(e){if(i){IO.Backend.Device.offmessage(w);return}this.updateItem(u.enums.BR_TYPE_APP,c.CONSTS.BR_PI_STATUS.RUNNING,e.current,e.total)},this)},startBackupAppData:function(){if(m)return;var e=h.get("appPath"),t=n.uniqueId("backup.appdata_");v=t;var r=!1,i=p.getInstance();i.on("_OK",function(){var e=this.findOrCreateProgressItem(u.enums.BR_TYPE_APP_DATA);e.addClass("error"),e.find(".progress-desc").text(o.backup_restore.BACKUP_APP_DATA_WAITING)}.bind(this)),c.backupStartAppDataAsync(e,t).done(function(e){var t=e.body,n=t&&t.success&&t.success.length?t.success.length:0,r=t&&t.failed&&t.failed.length?t.failed.length:0;r>0?(this.updateItem(u.enums.BR_TYPE_APP_DATA,c.CONSTS.BR_PI_STATUS.ERROR,n,t.total),h.set("appDataErrorList",t.failed),this.trigger("_APP_DATA_ERROR_LIST")):(this.updateItem(u.enums.BR_TYPE_APP_DATA,c.CONSTS.BR_PI_STATUS.FINISHED,n,t.total),this.backupAllFinish())}.bind(this)).fail(function(e){if(m)return;var t=[735,736,739],n=h.get("dataNumList")[u.enums.BR_TYPE_APP];if(t.indexOf(e.state_code)>=0){var r=c.CONSTS.ErrorCodeToMessage[e.state_code];this.updateItem(u.enums.BR_TYPE_APP_DATA,c.CONSTS.BR_PI_STATUS.ERROR,0,n,r),this.backupAllFinish();return}var i=c.CONSTS.ErrorCodeToMessage[e.state_code]||"";this.updateItem(u.enums.BR_TYPE_APP_DATA,c.CONSTS.BR_PI_STATUS.ERROR,0,n,i),h.set("appDataErrorMessage",i),this.trigger("_APP_DATA_ERROR_ALL")}.bind(this)).always(function(e){i.remove(),r=!0}.bind(this)),E=IO.Backend.Device.onmessage({"data.channel":t},function(e){if(r||m){IO.Backend.Device.offmessage(E);return}if(e.message===u.enums.BACKUP_APP_DATA_MESSAGE_NEED_USER){i.show(),g=!0;return}i.remove(),this.updateItem(u.enums.BR_TYPE_APP_DATA,c.CONSTS.BR_PI_STATUS.RUNNING,e.current,e.total)},this)},backupAllFinish:function(){if(m)return;this.$(".title").text(o.backup_restore.BACKUP_COMPRESSING),c.backupFinishAsync(h.GetFullFilePath).done(function(e){this.$(".privacy-tip").show(),this.$(".title").text(o.backup_restore.BACKUP_FINISH_LABEL),this.setButtnState(!1),c.logBackupContextModel(h,!0)}.bind(this)).fail(function(e){this.remove(),c.showAndRecordError("debug.backup.progress.error",e,2),c.logBackupContextModel(h,!1)}.bind(this))},clickButtonShowFile:function(){c.showFileAsync(h.GetFullFilePath+".zip")},clickButtonCancel:function(){b&&IO.Backend.Device.offmessage(b),w&&IO.Backend.Device.offmessage(w),E&&IO.Backend.Device.offmessage(E),m=!0,c.backupCancelAsync(v),alert(o.backup_restore.CANCELED)},clickButtonFinish:function(){m=!0,this.trigger("_BACKUP_FINISH")},events:{"click .button-show-file":"clickButtonShowFile","click .button-cancel":"clickButtonCancel","click .button-finish":"clickButtonFinish"}}),x,T=n.extend({getInstance:function(){return x||(x=new S({title:o.backup_restore.BACKUP_TITLE_LOCAL,disableX:!0,height:c.CONSTS.ViewHeight,width:c.CONSTS.ViewWidth})),x}});return T})}(this),function(e,t){define("backuprestore/views/ErrorItemListView",["backbone","underscore","doT","jquery","Device","Internationalization","ui/Panel","ui/UIHelper","ui/TemplateFactory","utilities/StringUtil","Configuration","backuprestore/BackupRestoreService","backuprestore/models/BackupContextModel","backuprestore/models/RestoreContextModel"],function(e,n,r,i,s,o,u,a,f,l,c,h,p,d){console.log("ErrorItemListView - File loaded. ");var v=e.View.extend({template:r.template(f.get("backup","error-item-list")),className:"w-backup-error-item-list",title_str:"",initialize:function(){var e=[],t=!1;Object.defineProperties(this,{itemList:{set:function(t){t instanceof Array&&(e=t)},get:function(){return e}},loading:{set:function(e){t=Boolean(e),this.$(".loading").toggle(t)},get:function(){return t}}})},render:function(){return this.$el.html(this.template({loading:this.loading,list:this.itemList})),this.$(".title").text(this.title_str),this},resetContent:function(){this.$(".title").text(""),this.loading=!0,this.itemList=[],this.render()},fillItemListWithApps:function(){var e=p.get("appErrorList");this.title_str=l.format(o.backup_restore.APP_ERROR_LIST_TITLE,e.length),this.$(".title").text(this.title_str),this.loading=!0,h.loadAppListAsync(e).done(function(e){this.itemList=e.body.app||[],this.render(),this.loading=!1}.bind(this)).fail(function(e){this.$(".loading").text(o.common.LOAD_FAILD)}.bind(this))},fillItemListWithAppData:function(){var e=p.get("appDataErrorList");this.title_str=l.format(o.backup_restore.APP_DATA_ERROR_LIST_TITLE,e.length),this.$(".title").text(this.title_str),this.loading=!0,h.loadAppListAsync(e).done(function(e){this.itemList=e.body.app||[],this.render(),this.loading=!1}.bind(this)).fail(function(e){this.$(".loading").text(o.common.LOAD_FAILD)}.bind(this))}}),m=e.View.extend({template:r.template(f.get("backup","error-item-tip")),className:"w-backup-error-item-tip",typeName:"",errorNumber:0,isAllFailed:!1,initialize:function(){},render:function(){return this.$el.html(this.template({type_name:this.typeName,error_number:this.errorNumber})),this.$(".all-non-app-failed, .part-non-app-failed").hide(),this.isAllFailed?this.$(".all-non-app-failed").show():this.$(".part-non-app-failed").show(),this},resetContent:function(){},selectItemInfoByType:function(e,t){var n;for(n in e.item){var r=e.item[n];if(r.type===t)return r}return null},fillItemListWithContacts:function(){var e=this.selectItemInfoByType(d.GetBRSpec,c.enums.BR_TYPE_CONTACT),t=d.get("errorItemList");this.typeName=o.backup_restore.CONTACT,this.errorNumber=t.length,this.isAllFailed=e!==null&&e.count===t.length,this.render()},fillItemListWithSms:function(){var e=this.selectItemInfoByType(d.GetBRSpec,c.enums.BR_TYPE_SMS),t=d.get("errorItemList");this.typeName=o.backup_restore.SMS,this.errorNumber=t.length,this.isAllFailed=e!==null&&e.count===t.length,this.render()}}),g,y=u.extend({itemType:-1,initialize:function(){y.__super__.initialize.apply(this,arguments),this.on(a.EventsMapping.SHOW,function(){switch(this.itemType){case c.enums.BR_TYPE_CONTACT:g=new m,this.$bodyContent=g.render().$el,g.fillItemListWithContacts();break;case c.enums.BR_TYPE_SMS:g=new m,this.$bodyContent=g.render().$el,g.fillItemListWithSms();break;case c.enums.BR_TYPE_APP:g=new v,this.$bodyContent=g.render().$el,g.fillItemListWithApps();break;case c.enums.BR_TYPE_APP_DATA:g=new v,this.$bodyContent=g.render().$el,g.fillItemListWithAppData();break;default:}this.center()},this),this.buttons=[{$button:i("<button>").html(o.ui.RETRY).addClass("button-retry"),eventName:"button_retry"},{$button:i("<button>").html(o.ui.IGNORE).addClass("button-ignore primary"),eventName:"button_ignore"}]},render:function(){return n.extend(this.events,y.__super__.events),this.delegateEvents(),y.__super__.render.apply(this,arguments),g!==t&&g.resetContent(),this},setItemType:function(e){this.itemType=e},clickButtonRetry:function(){this.trigger("_RETYR")},clickButtonIgnore:function(){this.trigger("_IGNORE")},events:{"click .button-retry":"clickButtonRetry","click .button-ignore":"clickButtonIgnore"}}),b=n.extend({getInstance:function(){var e=new y({title:o.backup_restore.BACKUP_TITLE,disableX:!0,height:275,width:h.CONSTS.ViewWidthTip});return e}});return b})}(this),function(e,t){define("backuprestore/views/ErrorRetryView",["backbone","underscore","doT","jquery","Device","Internationalization","ui/Panel","ui/UIHelper","ui/TemplateFactory","backuprestore/BackupRestoreService","backuprestore/models/BackupContextModel","backuprestore/models/RestoreContextModel"],function(e,n,r,i,s,o,u,a,f,l,c,h){console.log("ErrorRetryView - File loaded. ");var p=e.View.extend({template:r.template(f.get("backup","error-retry")),className:"w-backup-error-retry",initialize:function(){},render:function(){return this.$el.html(this.template({})),this},setContent:function(e){this.$(".content").html(e)}}),d,v=u.extend({content:"",initialize:function(){v.__super__.initialize.apply(this,arguments),this.on(a.EventsMapping.SHOW,function(){d=new p,this.$bodyContent=d.render().$el,d.setContent(this.content),this.center(),this.once("remove",d.remove,d)},this),this.buttons=[{$button:i("<button>").html(o.ui.RETRY).addClass("button-retry"),eventName:"button_retry"},{$button:i("<button>").html(o.ui.IGNORE).addClass("button-ignore primary"),eventName:"button_ignore"}]},render:function(){return n.extend(this.events,v.__super__.events),this.delegateEvents(),v.__super__.render.apply(this,arguments),d!==t&&d.setContent(this.content),this},setContent:function(e){this.content=e},clickButtonRetry:function(){this.trigger("_RETYR")},clickButtonIgnore:function(){this.trigger("_IGNORE")},events:{"click .button-retry":"clickButtonRetry","click .button-ignore":"clickButtonIgnore"}}),m,g,y=n.extend({getBackupInstance:function(){return m||(m=new v({title:o.backup_restore.BACKUP_TITLE,disableX:!0,width:l.CONSTS.ViewWidthTip})),m},getRestoreInstance:function(){return g||(g=new v({title:o.backup_restore.RESTORE_TITLE,disableX:!0,width:l.CONSTS.ViewWidthTip})),g}});return y})}(this),function(e,t){define("backuprestore/views/BackupRemoteProgressView",["backbone","underscore","doT","jquery","Device","Internationalization","Configuration","Log","IOBackendDevice","ui/Panel","ui/UIHelper","ui/TemplateFactory","utilities/StringUtil","backuprestore/BackupRestoreService","backuprestore/models/BackupContextModel"],function(e,n,r,i,s,o,u,a,f,l,c,h,p,d,v){console.log("BackupRemoteProgressView - File loaded. ");var m=e.View.extend({template:r.template(h.get("backup","backup-remote-progress")),className:"w-backup-remote-progress",initialize:function(){},render:function(){return this.$el.html(this.template({})),this.resetContent(),this},resetContent:function(){this.$(".title").text(o.backup_restore.BACKUPING),this.$(".progress-ctn").html(""),this.$(".mobile-tip").hide()}}),g,y,b=l.extend({initialize:function(){b.__super__.initialize.apply(this,arguments),this.on(c.EventsMapping.SHOW,function(){g=new m,this.$bodyContent=g.render().$el,this.startBackupRemote(),this.center()},this),this.buttons=[{$button:i("<button>").html(o.ui.FINISH).addClass("button-finish primary"),eventName:"button_finish"},{$button:i("<button>").html(o.ui.CANCEL).addClass("button-cancel"),eventName:"button_cancel"}]},render:function(){return n.extend(this.events,b.__super__.events),this.delegateEvents(),b.__super__.render.apply(this,arguments),g!==t&&g.resetContent(),this.setButtnState(!0),this},setButtnState:function(e){this.$(".button-finish").toggle(!e),this.$(".button-cancel").toggle(e)},startBackupRemote:function(){this.$(".progress-ctn").html("");var e=v.GetServerTypes,t=n.uniqueId("backup.nonapps_");a({event:"debug.backup.remote.start"}),this.initProgressItems(v.GetBRSpec),d.remoteManualBackupAsync(e,t).done(function(e){this.backupAllFinish(),a({event:"debug.backup.remote.success"})}.bind(this)).fail(function(e){v.set("remoteErrorResult",e.body.result),v.set("remoteErrorCode",e.state_code),this.trigger("_ERROR")}.bind(this)).always(function(e){y&&f.Backend.Device.offmessage(y)}.bind(this)),y=f.Backend.Device.onmessage({"data.channel":t},function(e){var t=d.GetBRTypeBy30x0x(e.data_type),n=e.total>=0?e.progress:d.CONSTS.SYNC_PROGRESS.FAILED;this.updateItem(t,n,!0)},this)},initProgressItems:function(e){n.each(e.item,function(e){this.updateItem(e.type,d.CONSTS.BR_PI_STATUS.WAITING,!1)},this)},updateItem:function(e,t,n){if(!o.backup_restore.BR_TYPE_WORD_ENUM[e]){console.error("backup remote progess, unknown"+e);return}var s="progress-item-"+e,u=this.$("."+s);if(u.length===0){var a=r.template(h.get("backup","backup-progress-item"))({});u=i("<div>").html(a),u.addClass(s).addClass("item hbox"),u.find(".icon-ctn").addClass("icon-type-"+e),this.$(".progress-ctn").append(u)}u.removeClass("error"),u.find("progress").removeClass("running").prop({max:1,value:n?1:0});var f;switch(t){case d.CONSTS.BR_PI_STATUS.WAITING:f=o.backup_restore.BACKUP_WAITING;break;case d.CONSTS.SYNC_PROGRESS.FAILED:u.addClass("error"),f=o.backup_restore.BACKUP_FAILED;break;case d.CONSTS.SYNC_PROGRESS.START:case d.CONSTS.SYNC_PROGRESS.RUNNING:u.find("progress").addClass("running"),f=o.backup_restore.BACKUP_PROCESS;break;case d.CONSTS.SYNC_PROGRESS.COMPLETED:f=o.backup_restore.BACKUP_FINISH;break;default:console.log(e+", "+t)}var l=p.format(f,o.backup_restore.BR_TYPE_WORD_ENUM[e]);u.find(".progress-desc").text(l)},backupAllFinish:function(){n.each(v.get("dataIDList"),function(e){this.updateItem(e,d.CONSTS.SYNC_PROGRESS.COMPLETED,!0)},this),this.$(".title").text(o.backup_restore.BACKUP_FINISH_LABEL),this.setButtnState(!1),this.$(".mobile-tip").show(),d.logBackupContextModel(v,!0)},clickButtonCancel:function(){y&&f.Backend.Device.offmessage(y),d.stopRemoteSyncAsync()},clickButtonFinish:function(){this.trigger("_BACKUP_FINISH")},events:{"click .button-cancel":"clickButtonCancel","click .button-finish":"clickButtonFinish"}}),w,E=n.extend({getInstance:function(){return w||(w=new b({title:o.backup_restore.BACKUP_TITLE_REMOTE,disableX:!0,height:d.CONSTS.ViewHeight,width:d.CONSTS.ViewWidth})),w}});return E})}(this),function(e,t){define("backuprestore/views/BackupAutoTipView",["backbone","underscore","doT","jquery","Device","Internationalization","Log","ui/Panel","ui/UIHelper","ui/TemplateFactory","welcome/WelcomeService","backuprestore/BackupRestoreService","backuprestore/models/BackupContextModel"],function(e,t,n,r,i,s,o,u,a,f,l,c,h){console.log("BackupAutoTipView - File loaded. ");var p=e.View.extend({template:n.template(f.get("backup","backup-local-auto-tip")),className:"w-backup-auto-tip hbox",initialize:function(){},render:function(){return this.$el.html(this.template({})),this}}),d=e.View.extend({template:n.template(f.get("backup","backup-remote-auto-tip")),className:"w-backup-auto-tip hbox",initialize:function(){},render:function(){return this.$el.html(this.template({})),this}}),v,m=u.extend({initialize:function(){m.__super__.initialize.apply(this,arguments),this.on(a.EventsMapping.SHOW,function(){v=this.options.isLocal?new p:new d,this.$bodyContent=v.render().$el,this.center(),o({event:"debug.autobackup.tip.show",is_local:this.options.isLocal})},this);var e=this.options.isLocal?s.backup_restore.AUTO_BACKUP_YES:s.backup_restore.AUTO_BACKUP_REMOTE_YES;this.buttons=[{$button:r("<button>").html(e).addClass("button-next primary"),eventName:"button_next"},{$button:r("<button>").html(s.backup_restore.AUTO_BACKUP_NO),eventName:"button_cancel"}]},clickButtonNext:function(){this.trigger("_NEXT_STEP"),o({event:"ui.click.autobackup.tip.yes",is_local:this.options.isLocal})},events:{"click .button-next":"clickButtonNext"}}),g,y,b=t.extend({getLocalInstance:function(){return g||(g=new m({title:s.backup_restore.BACKUP_TITLE_LOCAL,disableX:!0,width:c.CONSTS.ViewWidth,height:c.CONSTS.ViewHeight,isLocal:!0})),g},getRemoteInstance:function(){return y||(y=new m({title:s.backup_restore.BACKUP_TITLE_REMOTE,disableX:!0,width:c.CONSTS.ViewWidth,height:c.CONSTS.ViewHeight,isLocal:!1})),y}});return b})}(this),function(e,t){define("backuprestore/views/BackupRemoteErrorView",["backbone","underscore","doT","jquery","Device","Internationalization","ui/Panel","ui/UIHelper","ui/TemplateFactory","utilities/StringUtil","Log","backuprestore/BackupRestoreService","backuprestore/models/BackupContextModel"],function(e,t,n,r,i,s,o,u,a,f,l,c,h){console.log("BackupRemoteErrorView - File loaded. ");var p=e.View.extend({template:n.template(a.get("backup","backup-remote-error-view")),className:"w-backup-remote-error-view",initialize:function(){},render:function(){return this.$el.html(this.template({})),this},setData:function(){var e=h.get("remoteErrorResult"),t=h.get("remoteErrorCode"),n=c.getErrorMessage(t);this.$(".content").text(n);var i;for(i in e){var o=e[i],u=o.total-o.success;if(u>0){var a=c.GetBRTypeBy30x0x(o.data_type),l=f.format(s.backup_restore.BACKUP_TO_CLOUD_FAILED_DETAIL,u,s.backup_restore.BR_TYPE_WORD_ENUM[a]),p=r("<div>").html(l).addClass("text-secondary detail");this.$(".content").append(p)}}}}),d,v=o.extend({initialize:function(){v.__super__.initialize.apply(this,arguments),this.on(u.EventsMapping.SHOW,function(){d=new p,this.$bodyContent=d.render().$el,d.setData(),this.center()},this),this.buttons=[{$button:r("<button>").html(s.ui.RETRY).addClass("button-retry primary"),eventName:"button_retry"},{$button:r("<button>").html(s.ui.CANCEL).addClass("button-cancel"),eventName:"button_cancel"}]},clickButtonRetry:function(){this.trigger("_RETRY")},clickButtonCancel:function(){this.trigger("_CANCEL"),c.logBackupContextModel(h,!1),l({event:"debug.backup.remote.failed"})},events:{"click .button-retry":"clickButtonRetry","click .button-cancel":"clickButtonCancel"}}),m,g=t.extend({getInstance:function(){return m||(m=new v({title:s.backup_restore.BACKUP_TITLE_REMOTE,disableX:!0,width:c.CONSTS.ViewWidthTip})),m}});return g})}(this),function(e,t){define("backuprestore/BackupController",["backbone","Account","Device","Internationalization","FunctionSwitch","Configuration","main/views/BindingDeviceWindowView","welcome/WelcomeService","ui/AlertWindow","IOBackendDevice","backuprestore/BackupRestoreService","backuprestore/models/BackupContextModel","backuprestore/views/BackupRestoreChooseTypeView","backuprestore/views/BackupRestoreChooseDataView","backuprestore/views/BackupChooseAppTypeView","backuprestore/views/BackupChooseLocationView","backuprestore/views/BackupProgressView","backuprestore/views/ErrorItemListView","backuprestore/views/ErrorRetryView","backuprestore/views/BackupRemoteProgressView","backuprestore/views/BackupAutoTipView","backuprestore/views/BackupRemoteErrorView"],function(n,r,i,s,o,u,a,f,l,c,h,p,d,v,m,g,y,b,w,E,S,x){console.log("BackupController - File loaded. ");var T=e.alert,N=e.confirm,C,k,L,A,O,M,_,D,P,H,B,j,F,I=n.View.extend({initialize:function(){C=d.getBackupInstance(),k=v.getBackupInstance(),L=m.getInstance(),A=g.getInstance(),O=y.getInstance(),M=b.getInstance(),_=b.getInstance(),D=w.getBackupInstance(),P=E.getInstance(),H=S.getLocalInstance(),B=S.getRemoteInstance(),j=x.getInstance(),this.buildEvents()},buildEvents:function(){C.off("_NEXT_STEP"),k.off("_LAST_STEP"),k.off("_NEXT_STEP"),L.off("_NEXT_STEP"),A.off("_NEXT_STEP"),M.off("_NEXT_STEP"),_.off("_NEXT_STEP"),D.off("_NEXT_STEP"),P.off("_NEXT_STEP"),H.off("_NEXT_STEP"),B.off("_NEXT_STEP"),C.on("_NEXT_STEP",function(){h.recordCurrentBackupAsync(),p.IsLocal||r.get("isLogin")?this.showNextAndRemoveCurrent(C,k):(r.loginAsync("","backup-restore"),F=c.Backend.Device.onmessage({"data.channel":u.events.ACCOUNT_STATE_CHANGE},function(e){e.auth?this.showNextAndRemoveCurrent(C,k):T(s.backup_restore.LOGIN_FAILED_TIP),c.Backend.Device.offmessage(F),F=t},this))},this),C.on("button_cancel",function(){F&&c.Backend.Device.offmessage(F)}),k.on("_LAST_STEP",function(){this.showNextAndRemoveCurrent(k,C)},this),k.on("_NEXT_STEP",function(){p.IsLocal?this.startBackupLocal():this.startBackupRemote()},this),k.on("_TIME_OUT",function(){C.show()},this),L.on("_NEXT_STEP",function(){L.remove(),this.showNextAndRemoveCurrent(k,A)},this),A.on("_LAST_STEP",function(){this.showNextAndRemoveCurrent(A,k)},this),A.on("_NEXT_STEP",function(){if(!i.get("isConnected")){T(s.backup_restore.CONNECT_LOST);return}if(!p.IsFileNameReady){T(s.backup_restore.FILE_PATH_INVALID);return}h.checkFileAsync(p.GetFullFilePath).done(function(e){var t=parseInt(e.body.value,10);if(t===1){N(s.backup_restore.OVERWIRTE_EXISTS_FILE_TIP,this.startBackupSmsAndContact,this);return}this.startBackupSmsAndContact()}.bind(this)).fail(function(){T(s.backup_restore.FILE_PATH_INVALID)})},this),O.on("_APP_ERROR_LIST",function(){M.setItemType(u.enums.BR_TYPE_APP),M.show()},this),O.on("_APP_DATA_ERROR_LIST",function(){_.setItemType(u.enums.BR_TYPE_APP_DATA),_.show()},this),O.on("_APP_DATA_ERROR_ALL",function(){D.setContent(p.get("appDataErrorMessage")),D.show()},this),O.on("_NEED_USER_CONFIRM",function(){},this),O.on("_BACKUP_FINISH",function(){O.remove(),i.get("isAutoBackup")||o.ENABLE_AUTOBACKUP_POPUP&&H.show()},this),H.on("_NEXT_STEP",function(){H.remove(),a.getInstance().loadContentAndShow()},this),P.on("_BACKUP_FINISH",function(){P.remove(),h.getRemoteAutoBackupSwitchAsync().done(function(e){e.body.value||B.show()})},this),P.on("_ERROR",function(){j.show()},this),j.on("_RETRY",function(){P.startBackupRemote(),j.remove()},this),j.on("_CANCEL",function(){j.remove(),P.remove()},this),B.on("_NEXT_STEP",function(){B.remove(),h.setRemoteAutoBackupSwitchAsync()},this),M.on("_RETYR",function(){O.startBackupApps(),M.remove()},this),M.on("_IGNORE",function(){p.IsAppDataSelected?O.startBackupAppData():O.backupAllFinish(),M.remove()},this),_.on("_RETYR",function(){O.startBackupAppData(),_.remove()},this),_.on("_IGNORE",function(){O.backupAllFinish(),_.remove()},this),D.on("_RETYR",function(){O.startBackupAppData(),D.remove()},this),D.on("_IGNORE",function(){O.backupAllFinish(),D.remove()},this)},startBackupLocal:function(){p.IsAppSelected&&p.get("dataNumList")[u.enums.BR_TYPE_APP]>0&&o.ENABLE_CLOUD_BACKUP_RESTORE?L.show():this.showNextAndRemoveCurrent(k,A)},startBackupRemote:function(){this.showNextAndRemoveCurrent(k,P)},startBackupSmsAndContact:function(){this.showNextAndRemoveCurrent(A,O)},showNextAndRemoveCurrent:function(e,t){var n=function(){e.remove(),t.off("show",n)};t.on("show",n,this),t.show()},start:function(e){F=t,p.clearCache();if(e){p.set("backupType",1),k.show();return}o.ENABLE_CLOUD_BACKUP_RESTORE?C.show():(p.set({backupType:0}),k.show())}}),q=new I;return q})}(this),function(e,t){define("backuprestore/views/RestoreChooseFileView",["backbone","underscore","doT","jquery","Internationalization","Configuration","ui/Panel","ui/PopupPanel","ui/UIHelper","ui/TemplateFactory","backuprestore/BackupRestoreService","backuprestore/models/RestoreContextModel"],function(e,n,r,i,s,o,u,a,f,l,c,h){console.log("RestoreChooseFileView - File loaded. ");var p=e.View.extend({template:r.template(l.get("restore","choose-restore-file")),className:"w-restore-choose-file",initialize:function(){},render:function(){this.$el.html(this.template({list:h.FileList}));var e=Math.max(h.SelectedFileIndex,0),t=this.$('input[name="file"]');t.length>0&&(t[e].checked=!0);var n=new a({$content:r.template(l.get("restore","old-version-tip")),$host:this.$(".old-version-tip"),delay:!0});return this},setBackupFile:function(){var e=this.$('input[name="file"]:checked');h.set({fileName:e.attr("value")})},readSinlgeFileInfo:function(e,t){c.readRestoreFileAsync(e).done(function(r){var i={};n.each(r.body.item,function(e){i[e.type]=e.count}),h.get("backupFileInfoDict")[e]=i,this.fillItemInfo(i,t)}.bind(this))},readRestoreFileInfo:function(){var e;for(e in h.FileList){var n=h.FileList[e].file_name,r=h.get("backupFileInfoDict")[n];r===t?this.readSinlgeFileInfo(n,e):this.fillItemInfo(r,e)}},fillItemInfo:function(e,t){var n=StringUtil.format("li:nth-child({1})",parseInt(t,10)+1),r=this.$(n);r.find(".contact-number").html(e[o.enums.BR_TYPE_CONTACT]||"0"),r.find(".sms-number").html(e[o.enums.BR_TYPE_SMS]||"0"),r.find(".app-number").html(e[o.enums.BR_TYPE_APP]||"0")}}),d,v=u.extend({initialize:function(){v.__super__.initialize.apply(this,arguments),this.on(f.EventsMapping.SHOW,function(){d=new p,this.$bodyContent=d.render().$el,d.readRestoreFileInfo(),this.center()},this),this.buttons=[{$button:i("<button>").html(s.ui.NEXT).addClass("button-next primary"),eventName:"button_next"},{$button:i("<button>").html(s.ui.CANCEL),eventName:"button_cancel"}]},render:function(){return n.extend(this.events,v.__super__.events),this.delegateEvents(),v.__super__.render.apply(this,arguments),FunctionSwitch.ENABLE_CLOUD_BACKUP_RESTORE&&($buttonLast=i("<button>").html(s.ui.PREV).addClass("button-last"),this.$(".w-ui-window-footer-monitor").append($buttonLast)),this},clickButtonLast:function(){this.trigger("_LAST_STEP")},clickButtonNext:function(){d.setBackupFile(),this.trigger("_NEXT_STEP")},clickButtonSelectFile:function(){var e=this.$(".button-select-file").prop("disabled",!0);setTimeout(function(){e.prop("disabled",!1)},2e3),c.selectRestoreFileAsync().done(function(e){if(e.state_code===402)return;h.set("fileName",e.body.value),this.trigger("_SELECT_FILE")}.bind(this)).fail(function(){alert(s.backup_restore.SET_RESTORE_FILE_FAILED)})},events:{"click .button-select-file":"clickButtonSelectFile","click .button-last":"clickButtonLast","click .button-next":"clickButtonNext"}}),m,g=n.extend({getInstance:function(){return m||(m=new v({title:s.backup_restore.RESTORE_TITLE_LOCAL,disableX:!0,height:c.CONSTS.ViewHeight,width:c.CONSTS.ViewWidth})),m}});return g})}(this),function(e,t){define("backuprestore/views/RestoreSelectFileFolderView",["backbone","underscore","doT","jquery","Device","Internationalization","ui/Panel","ui/AlertWindow","ui/UIHelper","ui/TemplateFactory","backuprestore/models/RestoreContextModel","backuprestore/BackupRestoreService"],function(t,n,r,i,s,o,u,a,f,l,c,h){console.log("RestoreSelectFileFolderView - File loaded. ");var p=e.alert,d=t.View.extend({template:r.template(l.get("restore","select-file-folder")),className:"w-restore-select-file-folder",initialize:function(){},render:function(){return this.$el.html(this.template({})),this}}),v,m=u.extend({initialize:function(){m.__super__.initialize.apply(this,arguments),this.on(f.EventsMapping.SHOW,function(){v=new d,this.$bodyContent=v.render().$el,this.center()},this),this.buttons=[{$button:i("<button>").html(o.backup_restore.SELECT_BACKUP_FILE_FOLDER).addClass("button-select-folder"),eventName:"button_select_folder"},{$button:i("<button>").html(o.backup_restore.SELECT_BACKUP_FILE).addClass("button-select-file primary"),eventName:"button_select_file"},{$button:i("<button>").html(o.ui.CANCEL),eventName:"button_cancel"}]},clickButtonSelectFolder:function(){h.setSettingPathAsync(!0).done(function(e){if(e.state_code===402)return;this.trigger("_SELECT_FOLDER")}.bind(this)).fail(function(){p(o.backup_restore.SET_FILE_PATH_FAILED)})},clickButtonSelectFile:function(){h.selectRestoreFileAsync().done(function(e){if(e.state_code===402)return;c.set("fileName",e.body.value),this.trigger("_SELECT_FILE")}.bind(this)).fail(function(){p(o.backup_restore.SET_RESTORE_FILE_FAILED)}),this.trigger("_NEXT_STEP")},events:{"click .button-select-folder":"clickButtonSelectFolder","click .button-select-file":"clickButtonSelectFile"}}),g,y=n.extend({getInstance:function(){return g||(g=new m({title:o.backup_restore.RESTORE_TITLE_LOCAL,disableX:!0,width:h.CONSTS.ViewWidth})),g}});return y})}(this),function(e,t){define("backuprestore/views/RestoreChooseAccountView",["backbone","underscore","doT","jquery","Device","Internationalization","ui/Panel","ui/UIHelper","ui/TemplateFactory","contact/collections/AccountCollection","contact/collections/ContactsCollection","contact/views/AccountSelectorView","backuprestore/models/RestoreContextModel","backuprestore/BackupRestoreService"],function(e,t,n,r,i,s,o,u,a,f,l,c,h,p){console.log("RestoreChooseAccountView - File loaded. ");var d,v=e.View.extend({template:n.template(a.get("restore","choose-account")),className:"w-restore-choose-account",initialize:function(){d=c.getInstance({disableAllLabel:!0,displayReadOnly:!1})},render:function(){return this.$el.html(this.template({})),this.$(".account-ctn").append(d.render().$el),this},setAccountInfo:function(){var e=f.getInstance().get(d.accountId);h.set({accountType:e.get("type"),accountName:e.get("name")})}}),m,g=o.extend({initialize:function(){g.__super__.initialize.apply(this,arguments),this.on(u.EventsMapping.SHOW,function(){m=new v,this.$bodyContent=m.render().$el,this.setViewTitle(),this.center()},this),this.buttons=[{$button:r("<button>").html(s.ui.CONTINUE).addClass("button-next primary"),eventName:"button_next"},{$button:r("<button>").html(s.ui.CANCEL),eventName:"button_cancel"}]},setViewTitle:function(){this.title=h.IsLocal?s.backup_restore.RESTORE_TITLE_LOCAL:s.backup_restore.RESTORE_TITLE_REMOTE},clickButtonNext:function(){m.setAccountInfo(),this.trigger("_NEXT_STEP")},events:{"click .button-next":"clickButtonNext"}}),y,b=t.extend({getInstance:function(){return y||(y=new g({title:s.backup_restore.RESTORE_TITLE,disableX:!0})),y}});return b})}(this),function(e,t){define("backuprestore/views/RestoreProgressView",["backbone","underscore","doT","jquery","Device","Internationalization","Configuration","Log","ui/Panel","ui/UIHelper","ui/TemplateFactory","contact/collections/ContactsCollection","message/collections/ConversationsCollection","backuprestore/BackupRestoreService","backuprestore/models/RestoreContextModel"],function(e,n,r,i,s,o,u,a,f,l,c,h,p,d,v){console.log("RestoreProgressView - File loaded. ");var m=e.View.extend({template:r.template(c.get("restore","resotre-progress")),className:"w-restore-progress",initialize:function(){},render:function(){return this.$el.html(this.template({})),this.resetContent(),this},resetContent:function(){this.$(".title").text(o.backup_restore.RESTORING_TIP),this.$(".progress-ctn").html("")}}),g,y="",b,w={1:"contact",3:"sms",5:"call_log"},E=f.extend({initialize:function(){E.__super__.initialize.apply(this,arguments),this.on(l.EventsMapping.SHOW,function(){g=new m,this.$bodyContent=g.render().$el,this.setViewTitle(),this.center(),v.IsLocal?this.startRestoreSmsAndContact():this.startDownloadFilesRemote()},this),this.buttons=[{$button:i("<button>").html(o.ui.CONTINUE).addClass("button-next primary"),eventName:"button_cancel"},{$button:i("<button>").html(o.ui.CANCEL).addClass("button-cancel"),eventName:"button_cancel"}]},render:function(){return n.extend(this.events,E.__super__.events),this.delegateEvents(),E.__super__.render.apply(this,arguments),g!==t&&g.resetContent(),this.setButtnState(!0),this},setViewTitle:function(){this.title=v.IsLocal?o.backup_restore.RESTORE_TITLE_LOCAL:o.backup_restore.RESTORE_TITLE_REMOTE},setButtnState:function(e){this.$(".button-next").toggle(!e),this.$(".button-cancel").toggle(e)},startDownloadFilesRemote:function(){this.$(".title").text(o.backup_restore.RESTORE_DOWNLOAD_PROGRESSING);var e=n.uniqueId("restore.download_file_"),t=v.get("remoteVersion"),r=v.get("udid"),i=v.GetServerTypes;a({event:"debug.restore.remote.download.start"}),d.remoteSnapshotFileAsync(t,r,i,e).done(function(e){v.set("fileName",e.body.value),v.IsNoneAppSelected?this.startRestoreSmsAndContact():(this.startRestoreApps(),this.trigger("_NEXT_STEP")),a({event:"debug.restore.remote.download.success"}),d.logRestoreContextModel(v,!0)}.bind(this)).fail(function(e){this.remove(),a({event:"debug.restore.remote.download.failed"}),d.showAndRecordError("debug.restore.progress.error",e,0),d.logRestoreContextModel(v,!1)}.bind(this))},startRestoreSmsAndContact:function(){if(!v.IsNoneAppSelected){this.startRestoreApps(),this.restoreAllFinish();return}y=n.uniqueId("restore.nonapps_");var e=v.get("fileName"),t=v.get("accountType"),r=v.get("accountName"),i=v.GetBRSpec;this.initProgressItems(i),d.restoreStartNonAppsAsync(e,y,t,r,i).done(function(e){v.set("appPath",e.body.value)}.bind(this)).fail(function(e){this.remove(),d.showAndRecordError("debug.restore.progress.error",e,1),d.logRestoreContextModel(v,!1)}.bind(this)),b=IO.Backend.Device.onmessage({"data.channel":y},function(e){this.handleProgress(e)},this)},handleProgress:function(e){switch(e.status){case d.CONSTS.BR_STATUS.RUNNING:case d.CONSTS.BR_STATUS.PAUSED:this.updateNonAppItems(e.item);break;case d.CONSTS.BR_STATUS.FINISHED:this.updateNonAppItems(e.item),IO.Backend.Device.offmessage(b),this.startRestoreApps(),this.restoreAllFinish(),h.getInstance().syncAsync(),p.getInstance().trigger("update"),v.IsNoneAppSelected||this.trigger("_NEXT_STEP");break;case d.CONSTS.BR_STATUS.ERROR:this.updateNonAppItems(e.item),this.showErrorItem(e);break;case d.CONSTS.BR_STATUS.READY:case d.CONSTS.BR_STATUS.STOPPED:break;case d.CONSTS.BR_STATUS.ABORT:this.remove(),alert(o.backup_restore.RESTORE_ABORT_TIP),d.logRestoreContextModel(v,!1);break;default:this.remove(),alert(o.backup_restore.RESTORE_FAILED_TIP+e.status),d.logRestoreContextModel(v,!1)}},showErrorItem:function(e){if(!e.error_item||e.error_item.length===0){this.remove(),alert(o.backup_restore.RESTORE_FAILED_TIP+e.status),d.logRestoreContextModel(v,!1);return}var t=e.error_item[0],n=t[w[t.type]];v.set("errorItemList",n);switch(t.type){case u.enums.BR_TYPE_CONTACT:this.trigger("_CONTACT_ERROR_LIST");break;case u.enums.BR_TYPE_SMS:this.trigger("_SMS_ERROR_LIST");break;default:this.remove(),alert(o.backup_restore.RESTORE_FAILED_TIP+e.status),d.logRestoreContextModel(v,!1)}},retryRestore:function(){d.restoreRetryAsync(y).done(function(e){var t=e.body;t.status===d.CONSTS.BR_STATUS.PAUSED?this.resumeRestore():this.handleProgress(t)}.bind(this)).fail(function(e){console.log(e),this.remove(),d.showAndRecordError("debug.restore.progress.error",e,3),d.logRestoreContextModel(v,!1)}.bind(this))},resumeRestore:function(){d.restoreResumeAsync(y).done(function(e){}.bind(this)).fail(function(e){console.log(e),this.remove(),d.showAndRecordError("debug.restore.progress.error",e,4),d.logRestoreContextModel(v,!1)}.bind(this))},updateNonAppItems:function(e){var t;for(t in e)item=e[t],(t===0||item.status!==d.CONSTS.BR_PI_STATUS.READY)&&this.updateItem(item.type,item.status,item.finished_count,item.all_count)},initProgressItems:function(e){n.each(e.item,function(e){this.updateItem(e.type,d.CONSTS.BR_PI_STATUS.WAITING,0,e.count,"")},this)},findOrCreateProgressItem:function(e){var t="progress-item-"+e,n=this.$("."+t);if(n.length===0){var s=r.template(c.get("backup","backup-progress-item"))({});n=i("<div>").html(s),n.addClass(t).addClass("item hbox"),n.find(".icon-ctn").addClass("icon-type-"+e),this.$(".progress-ctn").append(n)}return n},updateItem:function(e,t,n,r){var i=this.findOrCreateProgressItem(e),s;switch(t){case d.CONSTS.BR_PI_STATUS.WAITING:s=o.backup_restore.RESTORE_WAITING;break;case d.CONSTS.BR_PI_STATUS.FINISHED:s=o.backup_restore.RESTORE_FINISH;break;case d.CONSTS.BR_PI_STATUS.ERROR:i.addClass("error"),s=o.backup_restore.RESTORE_FAILED;break;default:s=o.backup_restore.RESTORE_PROCESS}var u=StringUtil.format(s,o.backup_restore.BR_TYPE_WORD_ENUM[e]);i.find(".progress-desc").text(u);var a=StringUtil.format("{1} / {2}",n,r);i.find(".progress-num").text(a),i.find("progress").prop({max:r,value:n})},startRestoreApps:function(){if(!v.IsAppSelected&&!v.IsAppDataSelected)return;var e=v.get("fileName");d.restoreStartAppsAsync(e,v.IsAppDataSelected).fail(function(e){d.showAndRecordError("debug.restore.progress.error",e,7),d.logRestoreContextModel(v,!1)})},restoreAllFinish:function(){var e=v.get("fileName");d.restoreFinishAsync(v.get("fileName")).done(function(e){this.$(".title").text(o.backup_restore.RESTORE_FINISH_LABEL),this.setButtnState(!1),d.logRestoreContextModel(v,!0)}.bind(this)).fail(function(e){console.log(e),this.remove(),d.showAndRecordError("debug.restore.progress.error",e,2),d.logRestoreContextModel(v,!1)}.bind(this))},clickButtonNext:function(){this.trigger("_NEXT_STEP")},clickButtonCancel:function(){b&&IO.Backend.Device.offmessage(b),d.restoreCancelAsync(y),alert(o.backup_restore.CANCELED)},events:{"click .button-next":"clickButtonNext","click .button-cancel":"clickButtonCancel"}}),S,x=n.extend({getInstance:function(){return S||(S=new E({title:o.backup_restore.RESTORE_TITLE,disableX:!0,height:d.CONSTS.ViewHeight,width:d.CONSTS.ViewWidth})),S}});return x})}(this),function(e,t){define("backuprestore/views/RestoreDeleteDataView",["backbone","underscore","doT","jquery","Device","Internationalization","ui/Panel","ui/UIHelper","ui/TemplateFactory","contact/collections/AccountCollection","contact/collections/ContactsCollection","contact/views/AccountSelectorView","backuprestore/models/RestoreContextModel","backuprestore/BackupRestoreService"],function(e,t,n,r,i,s,o,u,a,f,l,c,h,p){console.log("RestoreDeleteDataView - File loaded. ");var d=e.View.extend({template:n.template(a.get("restore","restore-delete-data")),className:"w-restore-delete-data",initialize:function(){},render:function(){return this.$el.html(this.template({})),this}}),v,m=o.extend({initialize:function(){m.__super__.initialize.apply(this,arguments),this.on(u.EventsMapping.SHOW,function(){v=new d,this.$bodyContent=v.render().$el,this.setViewTitle(),this.center()},this),this.buttons=[{$button:r("<button>").html(s.ui.CONFIRM).addClass("button-next primary"),eventName:"button_next"}]},setViewTitle:function(){this.title=h.IsLocal?s.backup_restore.RESTORE_TITLE_LOCAL:s.backup_restore.RESTORE_TITLE_REMOTE},clickButtonNext:function(){var e=this.$('input[name="delete_data"]:checked'),t=parseInt(e[0].value,10)===1;t&&p.restoreClearDataAsync(),this.trigger("_NEXT_STEP")},events:{"click .button-next":"clickButtonNext"}}),g,y=t.extend({getInstance:function(){return g||(g=new m({title:s.backup_restore.RESTORE_TITLE,disableX:!0,width:p.CONSTS.ViewWidth})),g}});return y})}(this),function(e,t){define("backuprestore/views/RestoreAppTipView",["backbone","underscore","doT","jquery","Device","Internationalization","ui/Panel","ui/UIHelper","ui/TemplateFactory","contact/collections/AccountCollection","contact/collections/ContactsCollection","contact/views/AccountSelectorView","backuprestore/models/RestoreContextModel","backuprestore/BackupRestoreService"],function(e,t,n,r,i,s,o,u,a,f,l,c,h,p){console.log("RestoreAppTipView - File loaded. ");var d=e.View.extend({template:n.template(a.get("restore","restore-app-tip")),className:"w-restore-app-tip",render:function(){return this.$el.html(this.template({})),this}}),v,m=o.extend({initialize:function(){m.__super__.initialize.apply(this,arguments),this.on(u.EventsMapping.SHOW,function(){v=new d,this.$bodyContent=v.render().$el,this.setViewTitle(),this.center()},this),this.buttons=[{$button:r("<button>").html(s.ui.FINISH).addClass("button-next primary"),eventName:"button_next"}]},setViewTitle:function(){this.title=h.IsLocal?s.backup_restore.RESTORE_TITLE_LOCAL:s.backup_restore.RESTORE_TITLE_REMOTE},clickButtonNext:function(){this.trigger("_NEXT_STEP")},events:{"click .button-next":"clickButtonNext"}}),g,y=t.extend({getInstance:function(){return g||(g=new m({title:s.backup_restore.RESTORE_TITLE,disableX:!0,width:p.CONSTS.ViewWidth})),g}});return y})}(this),function(e,t){define("backuprestore/views/RestoreRemoteListSnapshotView",["backbone","underscore","doT","jquery","Device","Internationalization","Configuration","ui/Panel","ui/PopupPanel","ui/UIHelper","ui/TemplateFactory","backuprestore/BackupRestoreService","backuprestore/models/RestoreContextModel"],function(e,n,r,i,s,o,u,a,f,l,c,h,p){console.log("RestoreRemoteListSnapshotView - File loaded. ");var d=e.View.extend({template:r.template(c.get("restore","choose-restore-date")),className:"w-restore-choose-date",initialize:function(){},render:function(){this.$el.html(this.template({})),this.$(".load-more-ctn").hide();var e=p.get("snapshotList");return e.length===0?(this.$(".loading").show(),this.listSnapshot()):(this.$(".loading").hide(),this.appendItemList(e),this.trigger("loaded")),this},createFragmentByDataList:function(e){var t=document.createDocumentFragment();return n.each(e,function(e){var n=i(t.appendChild(document.createElement("li"))),s=r.template(c.get("restore","choose-restore-date-item"))({item:e});n.html(s),t.appendChild(n[0])}),t},listSnapshot:function(){var e=p.get("snapshotList"),t=e[e.length-1];h.remoteSnapshotListAutoAsync(t).done(function(t){var n=JSON.parse(t.body.value),r=e.concat(n);p.set("snapshotList",r),n.length<h.CONSTS.DefaultSnapshot.Size&&p.set("sanpshotListLoadFinish",!0),this.appendItemList(n),this.listLoaded()}.bind(this)).fail(function(e){this.remove(),alert(o.backup_restore.RESTORE_LIST_SNAPHOST_FAILED,function(){this.trigger("loadFailed")}.bind(this)),h.logRestoreContextModel(p,!1)}.bind(this))},appendItemList:function(e){var n=h.FormatRestoreSnapshotList(e),r=this.createFragmentByDataList(n);this.$(".load-more-ctn").before(r),this.readSnapshotInfo(n);var i=p.get("remoteVersion")||"0",s=this.$(StringUtil.format('input[value="{1}"]',i));if(s.length>0)s[0].checked=!0;else{var u=this.$("input")[0];u!==t&&(u.checked=!0)}this.$(".load-more-ctn").toggle(!p.get("sanpshotListLoadFinish")),this.$(".button-load-more").text(o.common.LOAD_MORE).addClass("link")},listLoaded:function(){if(p.get("snapshotList").length===0){this.trigger("empty");return}this.$(".loading").hide(),this.trigger("loaded")},readSinlgeFileInfo:function(e,t){h.remoteSnapshotInfoAllTypesAsync(e,t).done(function(t){var r={};n.each(JSON.parse(t.body.value),function(e){var t=h.getServerTypeFromBRType(e.type);r[t]=e.count}),p.get("snapshotInfoDict")[e]=r,this.fillItemInfo(e,r)}.bind(this))},readSnapshotInfo:function(e){n.each(e,function(e){var n=e.version,r=e.udid,i=p.get("snapshotInfoDict")[n];i===t?this.readSinlgeFileInfo(n,e.udid):this.fillItemInfo(n,i)}.bind(this))},fillItemInfo:function(e,t){var n=StringUtil.format("label[data-version={1}]",e),r=this.$(n);r.find(".contact-number").html(t[u.enums.BR_TYPE_CONTACT]||"0"),r.find(".sms-number").html(t[u.enums.BR_TYPE_SMS]||"0"),r.find(".app-number").html(t[u.enums.BR_TYPE_APP]||"0")},setBackupDate:function(){var e=this.$('input[name="date"]:checked');p.set({remoteVersion:e.attr("value"),udid:e.data("udid")})},clickButtonLoadMore:function(){this.$(".button-load-more").text(o.common.LOADING).removeClass("link"),this.setBackupDate(),this.listSnapshot()},events:{"click .button-load-more":"clickButtonLoadMore"}}),v,m=a.extend({initialize:function(){m.__super__.initialize.apply(this,arguments),this.on(l.EventsMapping.SHOW,function(){v=new d,v.on("loaded",function(){this.$(".button-next").prop({disabled:!1})},this),v.on("empty",function(){this.trigger("_EMPTY_LIST")},this),v.on("loadFailed",function(){this.trigger("_LAST_STEP")},this),this.$bodyContent=v.render().$el,this.center()},this),this.buttons=[{$button:i("<button>").html(o.ui.NEXT).addClass("button-next primary"),eventName:"button_next"},{$button:i("<button>").html(o.ui.CANCEL),eventName:"button_cancel"}]},render:function(){n.extend(this.events,m.__super__.events),this.delegateEvents(),m.__super__.render.apply(this,arguments);if(FunctionSwitch.ENABLE_CLOUD_BACKUP_RESTORE){var e=i("<button>").html(o.ui.PREV).addClass("button-last");this.$(".w-ui-window-footer-monitor").append(e)}return this.$(".button-next").prop({disabled:!0}),this},clickButtonLast:function(){v.setBackupDate(),this.trigger("_LAST_STEP")},clickButtonNext:function(){v.setBackupDate(),this.trigger("_NEXT_STEP")},events:{"click .button-last":"clickButtonLast","click .button-next":"clickButtonNext"}}),g,y=n.extend({getInstance:function(){return g||(g=new m({title:o.backup_restore.RESTORE_TITLE_REMOTE,disableX:!0,height:h.CONSTS.ViewHeight,width:h.CONSTS.ViewWidth})),g}});return y})}(this),function(e,t){define("backuprestore/RestoreController",["backbone","Account","Device","underscore","IOBackendDevice","Configuration","ui/AlertWindow","Internationalization","FunctionSwitch","backuprestore/BackupRestoreService","backuprestore/models/RestoreContextModel","backuprestore/views/BackupRestoreChooseTypeView","backuprestore/views/RestoreChooseFileView","backuprestore/views/RestoreSelectFileFolderView","backuprestore/views/BackupRestoreChooseDataView","backuprestore/views/RestoreChooseAccountView","backuprestore/views/RestoreProgressView","backuprestore/views/ErrorItemListView","backuprestore/views/RestoreDeleteDataView","backuprestore/views/RestoreAppTipView","backuprestore/views/RestoreRemoteListSnapshotView"],function(n,r,i,s,o,u,a,f,l,c,h,p,d,v,m,g,y,b,w,E,S){console.log("BackupController - File loaded. ");var x=e.confirm,T=e.alert,N,C,k,L,A,O,M,_,D,P,H,B,j=n.View.extend({initialize:function(){N=p.getRestoreInstance(),C=d.getInstance(),k=v.getInstance(),L=m.getRestoreLocalInstance(),A=g.getInstance(),O=y.getInstance(),M=b.getInstance(),_=w.getInstance(),D=E.getInstance(),P=S.getInstance(),H=m.getRestoreRemoteInstance(),this.buildEvents()},buildEvents:function(){N.off("_NEXT_STEP"),C.off("_LAST_STEP"),C.off("_NEXT_STEP"),k.off("_NEXT_STEP"),L.off("_LAST_STEP"),L.off("_NEXT_STEP"),A.off("_NEXT_STEP"),O.off("_NEXT_STEP"),D.off("_NEXT_STEP"),_.off("_NEXT_STEP"),M.off("_NEXT_STEP"),P.off("_LAST_STEP"),P.off("_NEXT_STEP"),H.off("_LAST_STEP"),H.off("_NEXT_STEP"),N.on("_NEXT_STEP",function(){if(h.IsLocal){this.startRestoreLocal(N);return}r.get("isLogin")?this.startRestoreRemote():(r.loginAsync("","backup-restore"),B=o.Backend.Device.onmessage({"data.channel":u.events.ACCOUNT_STATE_CHANGE},function(e){e.auth?this.startRestoreRemote():T(f.backup_restore.LOGIN_FAILED_TIP),o.Backend.Device.offmessage(B)},this))},this),N.on("button_cancel",function(){o.Backend.Device.offmessage(B)}),C.on("_LAST_STEP",function(){this.showNextAndRemoveCurrent(C,N)},this),C.on("_NEXT_STEP",function(){this.showNextAndRemoveCurrent(C,L)},this),C.on("_SELECT_FILE",function(){this.showNextAndRemoveCurrent(C,L)},this),k.on("_SELECT_FOLDER",function(){h.set("backupFileList",[]),c.listRestoreFileAsync().done(function(e){h.set("backupFileList",e.body.back_file||[]),this.startRestoreLocal(k)}.bind(this))},this),k.on("_SELECT_FILE",function(){this.showNextAndRemoveCurrent(k,L)},this),L.on("_LAST_STEP",function(){this.startRestoreLocal(L)},this),L.on("_NEXT_STEP",function(){var e=h.get("battery");e>0&&e<20?x(f.backup_restore.RESTORE_BATTERY_TIP,this.tryToStartRestore,this):this.tryToStartRestore()},this),A.on("_NEXT_STEP",function(){A.remove(),h.IsLocal?this.startRestoreSmsAndContact():this.startDownloadRemoteFile()},this),O.on("_NEXT_STEP",function(){h.IsNoneAppSelected?this.showNextAndRemoveCurrent(O,_):this.showNextAndRemoveCurrent(O,D)},this),O.on("_CONTACT_ERROR_LIST",function(){M.setItemType(u.enums.BR_TYPE_CONTACT),M.show()},this),O.on("_SMS_ERROR_LIST",function(){M.setItemType(u.enums.BR_TYPE_SMS),M.show()},this),M.on("_RETYR",function(){O.retryRestore(),M.remove()},this),M.on("_IGNORE",function(){O.resumeRestore(),M.remove()},this),_.on("_NEXT_STEP",function(){h.IsAppSelected?this.showNextAndRemoveCurrent(_,D):_.remove()},this),D.on("_NEXT_STEP",function(){D.remove()},this),P.on("_LAST_STEP",function(){this.showNextAndRemoveCurrent(P,N)},this),P.on("_EMPTY_LIST",function(){P.remove(),h.set("backupType",0),T(f.backup_restore.RESTORE_REMOTE_EMPTY_LIST,function(){N.show()},this)},this),P.on("_NEXT_STEP",function(){this.showNextAndRemoveCurrent(P,H)},this),H.on("_LAST_STEP",function(){this.showNextAndRemoveCurrent(H,P)},this),H.on("_NEXT_STEP",function(){h.IsContactSelected&&!h.get("isAccountReady")?A.show():this.startDownloadRemoteFile()},this)},startRestoreLocal:function(e){var t=h.get("backupFileList").length===0,n=t?k:C;this.showNextAndRemoveCurrent(e,n)},tryToStartRestore:function(){h.IsContactSelected&&!h.get("isAccountReady")?A.show():this.startRestoreSmsAndContact()},startRestoreRemote:function(){this.showNextAndRemoveCurrent(N,P)},startDownloadRemoteFile:function(){this.showNextAndRemoveCurrent(H,O)},startRestoreSmsAndContact:function(){h.IsNoneAppSelected?this.showNextAndRemoveCurrent(L,O):(O.startRestoreSmsAndContact(),this.showNextAndRemoveCurrent(L,D))},showNextAndRemoveCurrent:function(e,n){if(e===n)return;var r=function(){e!==t&&e.remove(),n.off("show",r)};n.on("show",r,this),n.show()},listRestoreFile:function(e){h.set("backupFileList",[]),c.listRestoreFileAsync().done(function(t){h.set("backupFileList",t.body.back_file||[]),e&&e()}.bind(this))},syncContactAccounts:function(){c.syncContactAccountsAsync().done(function(e){var t=e.body&&e.body.account?e.body.account:[],n=s.filter(t,function(e){return!e.read_only});if(n.length>1)return;h.set("isAccountReady",!0),h.set("accountType",n[0].type||""),h.set("accountName",n[0].name||"")})},queryBatteryInfo:function(){i.getBatteryInfoAsync().done(function(e){var t=parseInt(e.body.level,10);h.set("battery",t)})},start:function(){h.clearCache(),this.syncContactAccounts(),this.queryBatteryInfo(),l.ENABLE_CLOUD_BACKUP_RESTORE?(N.show(),this.listRestoreFile()):(h.set({backupType:0}),this.listRestoreFile(function(){var e=h.get("backupFileList").length===0,t=e?k:C;t.show()}))}}),F=new j;return F})}(this),function(e,t){define("backuprestore/BackupRestore",["backuprestore/models/BackupContextModel","backuprestore/BackupController","backuprestore/RestoreController","backuprestore/BackupRestoreService","IOBackendDevice"],function(e,t,n,r,i){var s={BackupContextModel:e,BackupController:t,RestoreController:n,BackupRestoreService:r};return i.Backend.Device.onmessage({"data.channel":"backup.guide.start"},function(e){t.start()},this),s})}(this),function(e,t,n){define("main/views/PIMMenuView",["backbone","underscore","doT","jquery","ui/TemplateFactory","utilities/StringUtil","ui/PopupTip","Log","IO","Configuration","FunctionSwitch","Internationalization","main/collections/PIMCollection","app/collections/AppsCollection"],function(t,n,r,i,s,o,u,a,f,l,c,h,p,d){console.log("PIMMenuView - File loaded.");var v=e.setTimeout,m=p.getInstance(),g=t.View.extend({tagName:"li",className:"root",template:r.template(s.get("misc","menu-item")),initialize:function(){var e=[];Object.defineProperties(this,{children:{set:function(t){t instanceof Array&&(e=t)},get:function(){return e}}}),this.model.on("change:selected",function(e,n){this.$el.toggleClass("selected",n);if(n){m.each(function(t){t.id!==e.id&&t.set({selected:!1})});var r;e.id===3?d.getInstance().getUpdatableApps().length>0?r="update":r="normal":r=e.get("tab"),t.trigger("switchModule",{module:e.get("module"),tab:r})}},this),this.model.on("change:hide",function(e,t){this.$el.toggle(!t)},this),this.model.on("change:count",function(e,t){this.$(".title .count").html(t);var n=this.$(".title .count");this.model.id===3&&(n.toggle(t>0),n.data("title",o.format(h.app.UPDATE_DES,t)))},this)},render:function(){this.$el.html(this.template(this.model.toJSON())),this.model.get("hide")&&this.$el.hide();if(this.model.id===3){var e=this.$(".title .count");e.addClass("highlight"),this.model.get("count")>0?e.show():e.hide()}var t=new u({$host:this.$("[data-title]")});return this},clickRootItem:function(e){this.model.get("selected")?t.trigger("switchModule",{module:this.model.get("module"),tab:this.model.get("tab")}):(this.model.set({selected:!0}),c.PRIVACY.RECORD_BROWSE_HISTORY&&a({event:"ui.click.nav",id:this.model.id,label:this.model.get("label")}))},clickTitleCount:function(e){this.model.id===3&&(e.stopPropagation(),this.model.set({selected:!0}),t.trigger("switchModule",{module:"app",tab:"update"}))},events:{"click .title":"clickRootItem","click .title .count":"clickTitleCount"}}),y=t.View.extend({template:r.template(s.get("misc","pim-menu")),className:"w-menu-pim",render:function(){this.$el.html(this.template({}));var e=this.$(".w-sidebar-menu"),t=m.getRootItems();return n.each(t,function(t){var n=new g({model:t});e.append(n.render().$el)},this),this}}),b,w=n.extend({getInstance:function(){return b||(b=new y),b}});return w})}(this,this.document),function(e,t){define("Distributor",["Environment"],function(e){console.log("Distributor - File loaded. ");var t=parseInt(e.get("pcId").substring(e.get("pcId").length-2,e.get("pcId").length),16),n=function(e){return t/255<=e},r={PERFORMANCE_TRACK:.2},i={};return Object.defineProperties(i,{PERFORMANCE_TRACK:{get:function(){return n(r.PERFORMANCE_TRACK)}}}),i})}(this),function(e,t){define("doraemon/views/MenuItemView",["backbone","underscore","doT","jquery","Log","IOBackendDevice","Configuration","ui/TemplateFactory","ui/PopupTip","FunctionSwitch","doraemon/collections/ExtensionsCollection","browser/views/BrowserModuleView"],function(e,n,r,i,s,o,u,a,f,l,c,h){console.log("MenuItemView - File loaded.");var p,d=function(e){e.id===this.model.id&&this.remove()},v=function(n,r){this.$el.toggleClass("selected highlight",r);if(r){console.log('MenuItemView - "'+n.get("name")+'" was selected.');var i=p.find(function(e){return e.id!==n.id&&e.get("selected")});i!==t&&i.set({selected:!1,highlight:!1}),e.trigger("switchModule",{module:"browser",tab:n.id})}},m=e.View.extend({tagName:"li",className:"root",template:r.template(a.get("doraemon","menu-item")),initialize:function(){p=p||c.getInstance(),this.listenTo(this.model,"change:selected",v),this.listenTo(this.model,"change:name change:cate",this.render),this.listenTo(p,"remove",d)},render:function(){return this.$el.html(this.template(this.model.toJSON())),n.each(this.$el.find("[data-title]"),function(e){var t=new f({$host:i(e)})}),this},highlight:function(){var e=function(){this.$el.removeClass("highlight-anima")}.bind(this);this.$el.one("webkitAnimationEnd",e).addClass("highlight-anima")},clickItem:function(){this.model.id!==t&&!this.model.get("selected")?(this.model.set({selected:!0}),h.getInstance().goto(this.model),this.model.downloadAsync(),l.PRIVACY.RECORD_BROWSE_HISTORY&&s({event:"ui.click.dora.nav",id:this.model.id})):this.model.get("selected")&&e.trigger("switchModule",{module:"browser",tab:this.model.id})},events:{click:"clickItem"}}),g=n.extend({getInstance:function(e){return new m(e)}});return g})}(this),function(e,t){define("doraemon/views/ExtensionItemView",["doT","jquery","underscore","Internationalization","IO","Log","Configuration","ui/AlertWindow","ui/TemplateFactory","ui/BaseListItem","doraemon/collections/ExtensionsCollection"],function(t,n,r,i,s,o,u,a,f,l,c){console.log("PluginItemView - File loaded.");var h=e.alert,p=e.encodeURIComponent,d=l.extend({template:t.template(f.get("doraemon","extension-item")),className:"w-extension-list-item hbox",render:function(){this.$el.html(this.template(this.model.toJSON()));var t=this.model.get("icon");if(t){var r=new e.Image,i=n(r),s=function(){this.model.get("icon")===i.data("path")&&this.$(".icon img").attr({src:r.src}),i.off("load"),i.off("error")}.bind(this),o=function(){i.off("load"),i.off("error")};i.on("load",s),i.on("error",o),i.attr({src:t}).data("path",t)}return this},clickButtonZip:function(e){e.stopPropagation(),this.model.zipAsync().done(function(){s.requestAsync({url:u.actions.SHOW_FILE,data:{file_path:this.model.get("path")+".wdx"}})}.bind(this)),o({event:"ui.click.dora.dev.zip"})},clickButtonReload:function(e){e.stopPropagation(),this.model.downloadAsync().done(function(e){h(i.misc.RELOAD_SUCCESS);var t=JSON.parse(e.body.value);c.getInstance().get(t.id).set(t)}).fail(function(e){h(e.state_line)}),o({event:"ui.click.dora.dev.reload"})},clickButtonPublish:function(e){e.stopPropagation(),s.requestAsync({url:u.actions.OPEN_URL,data:{url:u.enums.URL_EXTENSION_PUBLISH}}),o({event:"ui.click.dora.dev.publish"})},events:{"click .button-zip":"clickButtonZip","click .button-reload":"clickButtonReload","click .button-publish":"clickButtonPublish"}}),v=r.extend({getInstance:function(e){return new d(e)},getClass:function(){return d}});return v})}(this),function(e,t){define("doraemon/views/DoraemonContextMenu",["ui/Menu","ui/behavior/ClickToHideMixin","ui/AlertWindow","utilities/StringUtil","Internationalization","Configuration","Account","Log","doraemon/collections/ExtensionsCollection"],function(e,t,n,r,i,s,o,u,a){console.log("DoraemonContextMenu - File loaded. ");var f,l=e.extend({initialize:function(){l.__super__.initialize.apply(this,arguments),t.mixin(this),f=a.getInstance(),this.addItems(),this.on("select",function(e){switch(e.value){case"up":this.moveUpExtension();break;case"down":this.moveDownExtension();break;case"delete":this.unstarExtension()}},this)},moveUpExtension:function(){f.get(this.options.selected[0]).setOrderAsync(-1),u({event:"ui.click.dora.up.button",source:"context-menu"})},moveDownExtension:function(){f.get(this.options.selected[0]).setOrderAsync(1),u({event:"ui.click.dora.down.button",source:"context-menu"})},unstarExtension:function(){var e=this.options.selected,t=new n({draggable:!0,disposableName:"batch-unstar-plugin",disposableChecked:!1,buttonSet:"yes_no",$bodyContent:$(r.format(i.misc.BATCH_UNSTAR_PLUGINS,e.length))});t.on("button_yes",function(){f.unstarredAsync(e).done(function(){f.remove(e)})},this),t.show(),u({event:"ui.click.dora.unstar.button",total:f.length,count:e.length,source:"context-menu"})},addItems:function(){var e=this.options.selected,t=f.getNormalPlugins();this.items=[{type:"normal",name:"up",value:"up",label:i.misc.MOVE_UP,disabled:e.length!==1||f.at(0).id===e[0]||!o.get("isLogin")||f.get(e[0]).get("dev_mode")===!0},{type:"normal",name:"down",value:"down",label:i.misc.MOVE_DOWN,disabled:e.length!==1||t.length>0&&t[t.length-1].id===e[0]||!o.get("isLogin")||f.get(e[0]).get("dev_mode")===!0},{type:"hr"},{type:"normal",name:"delete",value:"delete",label:i.misc.REMOVE_COLLECT,disabled:e.length===0||!o.get("isLogin")}]}}),c,h=_.extend({getInstance:function(e){return c?(c.options.selected=e.selected,c.addItems(),c.render()):c=new l(e),c}});return h})}(this),function(e,t){define("doraemon/views/ExtensionListView",["backbone","underscore","doT","Internationalization","ui/TemplateFactory","ui/SmartList","doraemon/collections/ExtensionsCollection","doraemon/views/ExtensionItemView","doraemon/views/DoraemonContextMenu"],function(e,t,n,r,i,s,o,u,a){console.log("ExtensionListView - File loaded.");var f,l,c=e.View.extend({template:n.template(i.get("doraemon","extension-list")),className:"w-extension-list-ctn vbox",initialize:function(){Object.defineProperties(this,{selected:{get:function(){return f&&f.selected||[]}}}),l=o.getInstance(),l.on("refresh",this.buildList,this),l.on("add",this.buildList,this),l.on("remove",this.buildList,this),l.on("itemUpdate",this.buildList,this)},buildList:function(){f?f.switchSet("default",l.getAll):(f=new s({itemView:u.getClass(),dataSet:[{name:"default",getter:l.getAll}],keepSelect:!1,$observer:this.options.$observer,itemHeight:45,enableContextMenu:!0,listenToCollection:l}),this.$el.append(f.render().$el),f.on("select:change",function(e){this.trigger("select:change",e)},this),f.on("switchSet",function(){f.currentModels.length===0?(f.emptyTip=r.misc.GALLERY_EMPTY_LIST,f.toggleEmptyTip(!0)):f.toggleEmptyTip(!1)}),f.on("contextMenu",this.showContextMenu,this))},showContextMenu:function(){var e=a.getInstance({selected:f.selected});e.show()},render:function(){return this.$el.html(this.template({})),this.buildList(),this}}),h,p=t.extend({getInstance:function(e){return h||(h=new c(e)),h}});return p})}(this),function(e,t){define("doraemon/views/DoraemonToolbarView",["underscore","doT","jquery","backbone","Internationalization","Account","FunctionSwitch","Log","Configuration","IO","Device","utilities/StringUtil","ui/AlertWindow","ui/TemplateFactory","ui/Toolbar","doraemon/views/ExtensionListView","doraemon/models/ExtensionModel","doraemon/collections/ExtensionsCollection"],function(t,n,r,i,s,o,u,a,f,l,c,h,p,d,v,m,g,y){console.log("DoramenonToolbarView - File loaded.");var b=e.alert,w=e.setTimeout,E,S,x=v.extend({template:n.template(d.get("doraemon","toolbar")),initialize:function(){S=y.getInstance(),this.listenTo(S,"refresh",this.setButtonState),this.listenTo(u,"change",function(e){this.$(".debug-wrap").toggle(e.PRIVACY.ENABLE_DEBUG)}),this.listenTo(o,"change:isLogin",this.setButtonState)},render:function(){return this.$el.html(this.template({})),E=m.getInstance({$observer:this.$(".check-select-all")}),E.on("select:change",this.setButtonState,this),w(function(){this.$(".debug-wrap").toggle(u.PRIVACY.ENABLE_DEBUG)}.bind(this)),this.setButtonState(),this},setButtonState:function(){var e=E.selected,t=e.length,n=S.getNormalPlugins();this.$(".button-gallery").prop({disabled:!o.get("isLogin")}),this.$(".button-up").prop({disabled:t!==1||S.at(0).id===e[0]||!o.get("isLogin")||S.get(e[0]).get("dev_mode")===!0}),this.$(".button-down").prop({disabled:t!==1||n.length>0&&n[n.length-1].id===e[0]||!o.get("isLogin")||S.get(e[0]).get("dev_mode")===!0}),this.$(".button-unstar").prop({disabled:t===0||!o.get("isLogin")})},clickButtonGallery:function(){i.trigger("switchModule",{module:"gallery"}),a({event:"ui.click.dora_more_button",source:"toolbar",connected:c.get("isConnected")})},clickButtonUp:function(){S.get(E.selected[0]).setOrderAsync(-1),a({event:"ui.click.dora.up.button",source:"toolbar"})},clickButtonDown:function(){S.get(E.selected[0]).setOrderAsync(1),a({event:"ui.click.dora.down.button",source:"toolbar"})},clickButtonUnstar:function(){var e=E.selected,t=new p({draggable:!0,disposableName:"batch-unstar-plugin",disposableChecked:!1,buttonSet:"yes_no",$bodyContent:r(h.format(s.misc.BATCH_UNSTAR_PLUGINS,e.length))});t.once("button_yes",function(){S.unstarredAsync(e)}),t.show(),a({event:"ui.click.dora.unstar.button",total:S.length,count:e.length,source:"toolbar"})},clickButtonLoadExtention:function(){l.requestAsync(f.actions.SELECT_FOLDER).done(function(e){e.state_code===200&&l.requestAsync({url:f.actions.PLUGIN_ADD,data:{dev_mode:1,path:e.body.value},success:function(e){if(e.state_code===200){console.log("GalleryToolbarView - Load locale extention success. ");var t=new g(JSON.parse(e.body.value));S.add(t),S.trigger("star",t)}else console.error("GalleryToolbarView - Load locale extention failed. Error info: "+e.state_line),b(e.state_line)}})}),a({event:"ui.click.dora.dev.load"})},events:{"click .button-gallery":"clickButtonGallery","click .button-up":"clickButtonUp","click .button-down":"clickButtonDown","click .button-unstar":"clickButtonUnstar","click .button-load-extention":"clickButtonLoadExtention"}}),T,N=t.extend({getInstance:function(){return T||(T=new x),T}});return N})}(this),function(e,t){define("doraemon/views/DoraemonModuleView",["underscore","backbone","doraemon/views/DoraemonToolbarView","doraemon/views/ExtensionListView"],function(e,t,n,r){console.log("ManagementView - File loaded.");var i,s=t.View.extend({className:"w-doraemon-module-main module-main vbox",initialize:function(){var e=!1;Object.defineProperties(this,{rendered:{set:function(t){e=Boolean(t)},get:function(){return e}}})},render:function(){return this.$el.append(n.getInstance().render().$el),this.$el.append(r.getInstance().render().$el),this.rendered=!0,this}}),o,u=e.extend({getInstance:function(){return o||(o=new s),o}});return u})}(this),function(e,t){define("doraemon/views/GallerySwitchView",["backbone","underscore","doT","Device","Log","ui/TemplateFactory","Internationalization"],function(e,t,n,r,i,s,o){console.log("GallerySwitchView - File loaded.");var u=e.View.extend({tagName:"li",className:"root",template:n.template(s.get("doraemon","menu-item")),initialize:function(){e.on("switchModule",function(e){this.$el.toggleClass("selected highlight",e.module==="gallery")},this)},render:function(){return this.$el.html(this.template({name:o.misc.NAV_SHOW_GALLERY,cateid:"gallery",displayCategory:"gallery"})),this},clickItem:function(){e.trigger("switchModule",{module:"gallery"}),i({event:"ui.click.dora_more_button",source:"sidebar",connected:r.get("isConnected")})},events:{click:"clickItem"}}),a,f=t.extend({getInstance:function(e){return a||(a=new u),a}});return f})}(this),function(e,t,n){define("doraemon/views/DoraemonMenuView",["backbone","underscore","doT","Log","Internationalization","Account","FunctionSwitch","Configuration","IOBackendDevice","Distributor","ui/TemplateFactory","ui/PopupTip","doraemon/collections/ExtensionsCollection","doraemon/models/ExtensionModel","doraemon/views/MenuItemView","doraemon/views/DoraemonModuleView","doraemon/views/GallerySwitchView","social/SocialService"],function(e,n,r,i,s,o,u,a,f,l,c,h,p,d,v,m,g,y){console.log("DoraemonMenuView - File loaded.");var b=e.View.extend({template:r.template(c.get("doraemon","nav-title")),className:"menu-title hbox",render:function(){this.$el.html(this.template({})),this.$(".button-ctn").toggle(u.ENABLE_DORAEMON);var e=new h({$host:this.$(".button-management")});return this},clickButtonManagement:function(t){o.get("isLogin")?e.trigger("switchModule",{module:"doraemon"}):o.loginAsync(s.misc.LOGIN_TO_MANAGE,"gallery-manage"),i({event:"ui.click.dora.button_manage",isLogin:o.get("isLogin")})},events:{"click .button-management":"clickButtonManagement"}}),w,E=e.View.extend({className:"w-menu-doraemon",template:r.template(c.get("doraemon","menu")),initialize:function(){w=p.getInstance(),w.on("refresh",this.buildList,this),w.on("star",function(e){var t=v.getInstance({model:e});g.getInstance().$el.before(t.render().$el),t.$el[0].scrollIntoView(),t.highlight()})},buildList:function(e){u.ENABLE_DORAEMON&&g.getInstance().$el.detach();var n=this.$(".w-sidebar-menu").empty(),r=t.createDocumentFragment();e.each(function(e){var t=v.getInstance({model:e});r.appendChild(t.render().$el[0])}),u.ENABLE_DORAEMON&&r.appendChild(g.getInstance().render().$el[0]),n.append(r)},render:function(){this.$el.html(this.template({})),u.ENABLE_DORAEMON&&this.$(".w-sidebar-menu").append(g.getInstance().render().$el);var e=(new b).render();return this.$el.prepend(e.$el),e.on("showModule",function(){this.trigger("showModule")},this),this}}),S,x=n.extend({getInstance:function(){return S||(S=new E),S}});return x})}(this,this.document),function(e,t,n){define("main/views/NavView",["backbone","underscore","jquery","utilities/QueryString","ui/TemplateFactory","Log","Internationalization","Environment","Configuration","main/views/PIMMenuView","main/collections/PIMCollection","doraemon/views/DoraemonMenuView","doraemon/collections/ExtensionsCollection","browser/views/BrowserModuleView"],function(t,r,i,s,o,u,a,f,l,c,h,p,d,v){console.log("NavView - File loaded.");var m=e.setInterval,g=e.setTimeout,y,b,w,E,S=s.get("redirect_page"),x=s.get("ext_id"),T;S&&(T=parseInt(S,10));var N=function(){g(function(){var e=this.$el[0],t=i(".w-menu-shadow"),n=e.offsetHeight,r=e.scrollHeight,s=e.scrollTop;r!==n?s+n===r?t.addClass("w-layout-hide"):t.removeClass("w-layout-hide"):t.addClass("w-layout-hide")}.bind(this),0)},C=t.View.extend({className:"w-menu",initialize:function(){y=c.getInstance(),b=p.getInstance(),w=h.getInstance(),E=d.getInstance(),t.on("switchModule",function(e){e.module==="browser"&&e.tab==="misc"?this.deselectAll():e.module==="gallery"&&this.deselectAll()},this),w.on("itemSelected",function(){E.deselectAll()}),E.on("itemSelected",function(){w.deselectAll()}),E.on("add remove refresh",r.throttle(N.bind(this),50)),i(e).on("resize",r.throttle(N.bind(this),50)),this.$el.on("scroll",r.throttle(N.bind(this),50))},render:function(){return this.$el.prepend(b.render().$el),this.$el.prepend(y.render().$el),g(function(){var t=function(t){var r=function(r){if(e.SnapPea.CurrentModule===n){var i;t===n?(i=r.at(0),i!==n&&i.set({selected:!0})):(i=r.get(t),i!==n?i.set({selected:!0}):v.navigateToThirdParty(t,""))}},i=function(e){e.length!==0&&(r(e),e.off("refresh",i))};E.loading?E.on("refresh",i):E.length===0?E.on("refresh",i):r(E)};x?t(x):f.get("deviceId")==="Default"?w.get(0).set({selected:!0}):T!==n?w.get(T).set({selected:!0}):w.get(0).set({selected:!0}),N.call(this)}.bind(this),0),this},deselectAll:function(){w.deselectAll(),E.deselectAll()}}),k,L=r.extend({getInstance:function(){return k||(k=new C),k}});return L})}(this,this.document),function(e,t){define("app/collections/WebAppsCollection",["backbone","jquery","underscore","IOBackendDevice","Environment","Configuration","Account","utilities/StringUtil","app/models/AppModel","app/collections/AppsCollection"],function(e,t,n,r,i,s,o,u,a,f){console.log("WebAppsCollection - File loaded.");var l,c=e.Collection.extend({model:a,url:s.actions.APP_SHOW_WEB_APPS,isWeb:!0,initialize:function(){var e=!1,t=!1;Object.defineProperties(this,{loading:{set:function(t){e=t},get:function(){return e}},syncing:{set:function(e){t=e},get:function(){return t}}}),l=l||f.getInstance(),this.on("update",function(){e||(e=!0,this.fetch({success:function(t){console.log("WebAppsCollection - Collection fetched."),e=!1,t.trigger("refresh",t)}}))},this),r.Backend.Device.onmessage({"data.channel":s.events.WEB_APP_LIST_UPDATED},function(e){t&&(t=!1,this.trigger("syncEnd")),e?this.trigger("update"):this.trigger("refresh",this)},this),this.listenTo(o,"change:isLogin",function(e,t){t?this.trigger("update"):(this.set([]),this.trigger("refresh",this))}),this.listenTo(l,"add remove",n.debounce(function(){this.trigger("update")})),this.on("sort",function(){this.models=this.models.sort(function(e,t){var n;return e.get("update")===t.get("update")?n=e.get("base_info").name.localeCompare(t.get("base_info").name):n=e.get("update")-t.get("update"),n})},this)},comparator:function(e,t){var n;return e.get("update")===t.get("update")?n=e.get("base_info").name.localeCompare(t.get("base_info").name):n=e.get("update")-t.get("update"),n},parse:function(e){if(e.state_code!==200&&e.state_code!==202)return[];e.state_code===202&&(console.log("WebAppsCollection - App is syncing."),this.syncing=!0,this.trigger("syncStart"));var t=[];return n.each(e.body.app,function(e){t.push(this.convertAppToWebApp(e))},this),t},convertAppToWebApp:function(e){var t=l.get(e.packageName);if(t)return t.set({isWeb:!1});var r={id:e.packageName,detail_page_info:e.detailUrl,upgrade_info:{},downloadInfo:{downloadUrl:e.downloadUrl,iconPath:e.iconPath,title:e.title,packageName:e.packageName},base_info:{package_name:e.packageName,name:e.title,version_name:e.versionName.replace(/^v|V/,""),icon:e.iconPath,apk_size:e.size},running:!1};return n.extend(r,{installed:!1,isWeb:!0}),r},syncAsync:function(){var e=t.Deferred();return this.syncing=!0,this.trigger("syncStart"),r.requestAsync({url:s.actions.APP_SYNC_WEB_APPS,success:function(t){t.state_code===200?(console.log("WebAppsCollection - App sync success."),e.resolve(t)):(console.error("WebAppsCollection - App sync failed. Error info: "+t.state_line),e.reject(t))}}),e.promise()},getAll:function(){return this.models}}),h,p=n.extend({getInstance:function(){return h||(h=new c,h.trigger("update")),h}});return p})}(this),function(e,t){define("task/collections/TasksCollection",["underscore","jquery","backbone","IOBackendDevice","Configuration","Internationalization","utilities/StringUtil","task/models/TaskModel","app/collections/AppsCollection","app/collections/WebAppsCollection"],function(n,r,i,s,o,u,a,f,l,c){console.log("TasksCollection - File loaded.");var h=e.encodeURIComponent,p,d,v=function(){this.pretreatment();var e=this.get("detail"),n=p.get(e),r=d.get(e),i=this.get("state");i!==o.enums.TASK_STATE_SUCCESS&&i!==o.enums.TASK_STATE_FAILD?(n!==t&&n.set({isUpdating:!0,progress:this.get("processing")}),r!==t&&r.set({isUpdating:!0,progress:this.get("processing")})):(n!==t&&n.set({isUpdating:!1,progress:0}),r!==t&&r.set({isUpdating:!1,progress:0}))},m=function(e){var n=e.get(this.get("detail"));if(n!==t){var r=this.get("state");r!==o.enums.TASK_STATE_SUCCESS&&r!==o.enums.TASK_STATE_FAILD?n.set({isUpdating:!0,progress:this.get("processing")}):n.set({isUpdating:!1,progress:0})}},g=function(){var e=this.get("detail"),n=p.get(e),r=d.get(e);n!==t&&n.set({isUpdating:!1,progress:0}),r!==t&&r.set({isUpdating:!1,progress:0}),this.off(),this.stopListening()},y=i.Collection.extend({url:o.actions.TASK_SHOW_PROGRESS,model:f,parse:function(e){var t=e.body;return this.activeCount=t.active_job_number,this.errorCount=t.error_job_number,this.running=t.is_running,this.progress=t.progress,this.speed=t.speed,e.body.status},comparator:function(e,t){return e.get("state")===o.enums.TASK_STATE_SUCCESS==(t.get("state")===o.enums.TASK_STATE_SUCCESS)?t.get("added_time").localeCompare(e.get("added_time")):Number(e.get("state")===o.enums.TASK_STATE_SUCCESS)-Number(t.get("state")===o.enums.TASK_STATE_SUCCESS)},initialize:function(){var e=!1,t=0,n=0,r=!1,i=0,u=0;Object.defineProperties(this,{loading:{set:function(t){e=Boolean(t)},get:function(){return e}},activeCount:{set:function(e){t=parseInt(e,10)},get:function(){return t}},errorCount:{set:function(e){n=parseInt(e,10)},get:function(){return n}},running:{set:function(e){r=Boolean(e)},get:function(){return r}},progress:{set:function(e){i=parseInt(e,10)},get:function(){return i}},speed:{set:function(e){u=parseInt(e,10)},get:function(){return u}}}),p=p||l.getInstance(),d=d||c.getInstance(),this.on("add",function(e){e.on("change",v,e),e.once("remove",g,e),e.listenTo(p,"refresh",m)}),this.on("update",function(){this.loading=!0,this.fetch({success:function(e){console.log("TasksCollection - Collection updated."),e.loading=!1,e.trigger("refresh",e)}})},this),s.Backend.Device.onmessage({"data.channel":o.events.TASK_CHANGE},function(e){this.set({body:e},{parse:!0}),this.trigger("refresh",this)},this)},getRunningTasks:function(){return this.filter(function(e){return e.isRunning})},removeAllFinishAsync:function(){s.requestAsync({url:o.actions.TASK_REMOVE_FINISHI,success:function(e){e.state_code===200?(console.log("TasksCollection - Remove all finished task success."),this.trigger("update")):console.error("TasksCollection - Remove all finished task failed. Error info: "+e.state_line)}.bind(this)})},getInQueueTasks:function(){return this.filter(function(e){return e.isInQueue})},getTaskByPackageName:function(e){return this.find(function(t){return t.get("detail")===e})},deleteTasksAsync:function(e,t){var i=r.Deferred();return s.requestAsync({url:o.actions.TASK_DELETE_TASK,data:{job:e.join(","),clear:Number(t)},success:function(t){t.state_code===200?(console.log("TasksCollection - Delete tasks success."),n.each(e,function(e){this.remove(e)},this),this.trigger("refresh",this),i.resolve(t)):(console.error("TasksCollection - Delete tasks failed. Error info: "+t.state_line),i.reject(t))}.bind(this)}),i.promise()},startTasksAsync:function(e){var t=r.Deferred(),i=[];return n.each(e,function(e){var t=this.get(e);t.isStoped&&i.push(t.id)},this),s.requestAsync({url:o.actions.TASK_START_TASK,data:{job:i.join(",")},success:function(e){e.state_code===200?(console.log("TasksCollection - Start tasks success."),t.resolve(e)):(console.error("TasksCollection - Start tasks failed. Error info: "+e.state_line),t.reject(e))}.bind(this)}),t.promise()},pauseTasksAsync:function(e){var t=r.Deferred(),i=[];return n.each(e,function(e){var t=this.get(e);t.isRunning&&t.get("type")===o.enums.TASK_TYPE_DOWNLOAD&&i.push(t.id)},this),s.requestAsync({url:o.actions.TASK_STOP_TASK,data:{job:i.join(",")},success:function(e){e.state_code===200?(console.log("TasksCollection - Stop tasks success."),t.resolve(e)):(console.error("TasksCollection - Stop tasks failed. Error info: "+e.state_line),t.reject(e))}.bind(this)}),t.promise()},getAll:function(){return this.models},getFailedTasks:function(){return this.filter(function(e){var t=e.get("state");return t===o.enums.TASK_STATE_FAILD&&e.get("type")===o.enums.TASK_TYPE_DOWNLOAD})},getWaitingPushTasks:function(){return this.filter(function(e){var t=e.get("state");return e.get("type")===o.enums.TASK_TYPE_PUSH&&t!==o.enums.TASK_STATE_PROCESSING&&t!==o.enums.TASK_STATE_SUCCESS&&t!==o.enums.TASK_STATE_FAILD})},hasPausable:function(e){return this.find(function(t){return e.indexOf(t.id)>=0&&t.get("type")===o.enums.TASK_TYPE_DOWNLOAD})!==t}}),b,w=n.extend(function(){},{getInstance:function(){return b||(b=new y,b.trigger("update")),b}});return w})}(this),function(e,t){define("task/views/TaskDashboardView",["backbone","underscore","doT","ui/TemplateFactory","ui/PopupPanel","utilities/StringUtil","task/collections/TasksCollection"],function(e,t,n,r,i,s,o){console.log("TaskDashboardView - File loaded.");var u,a=e.View.extend({template:n.template(r.get("taskManager","task-dashboard")),tagName:"ul",className:"w-task-dashboard",initialize:function(){u=o.getInstance(),u.on("refresh",this.render,this)},render:function(){return this.$el.html(this.template({speed:u.speed,active:u.activeCount,complete:u.length-u.activeCount-u.errorCount,error:u.errorCount})),this}}),f=i.extend({className:"w-ui-popup-tip w-layout-hide",initialize:function(){f.__super__.initialize.apply(this,arguments),this.$content=(new a).render().$el,this.alignToHost=!1,this.blurDelay=100,u=o.getInstance(),u.on("refresh",function(e){e.activeCount===0?this.destoryBlurToHideMixin():this.initBlurToHideMixin()},this),u.activeCount===0&&this.initBlurToHideMixin()}}),l,c=t.extend({getInstance:function(e){return l||(l=new f(e)),l}});return c})}(this),function(e,t){define("task/views/TaskNotifierPanelView",["ui/TemplateFactory","ui/PopupPanel","IO","Configuration","Device","Log"],function(e,t,n,r,i,s){console.log("TaskNotifierPanelView - File loaded. ");var o=function(e,t){t&&this.destory()},u=function(e){e.get("isConnected")&&e.get("isUSB")&&this.destory()},a=t.extend({initialize:function(){a.__super__.initialize.apply(this,arguments),this.destoryBlurToHideMixin(),this.options.listenToConnect&&this.listenTo(i,"change:isConnected",o),this.options.listenToWifi&&this.listenTo(i,"change",u),this.options.hasOwnProperty("delay")&&this.once("show",function(){setTimeout(this.destory.bind(this),this.options.delay)},this)},render:function(){a.__super__.render.apply(this,arguments),this.delegateEvents()},clickButtonConnect:function(){n.requestAsync(r.actions.CONNET_PHONE),this.destory()},clickButtonClose:function(){this.destory()},clickButtonChangeDisk:function(){n.requestAsync(r.actions.SAVE_SCREENSHOT),s({event:"ui.click.taskManger_out_of_space_notifi_button_change_disk"}),this.destory()},destory:function(){this.hide(),this.stopListening()},events:{"click .button-connect":"clickButtonConnect","click .button-close":"clickButtonClose","click .button-change-disk":"clickButtonChangeDisk"}}),f=_.extend({getInstance:function(e){return new a(e)}});return f})}(this),function(e,t){define("task/views/DeleteConfirmWindowView",["backbone","underscore","doT","ui/Panel","ui/TemplateFactory","Internationalization"],function(e,t,n,r,i,s){console.log("DeleteConfirmWindowView - File loaded. ");var o,u=e.View.extend({template:n.template(i.get("taskManager","delete-monitor")),tagName:"label",className:"w-task-delete-footer",render:function(){return this.$el.html(this.template({})),this}}),a=r.extend({initialize:function(){a.__super__.initialize.apply(this,arguments),Object.defineProperties(this,{deleteFile:{get:function(){return this.$(".check-delete-apk")[0].checked}}}),this.on("show",function(){o=new u,this.$(".w-ui-window-footer-monitor").append(o.render().$el),this.once("remove",o.remove,o)},this)}}),f=t.extend({getInstance:function(e){return new a(t.extend({$bodyContent:s.taskManager.CONFIRM_DELETE,buttonSet:"yes_no",title:s.taskManager.DELETE_TITLE},e))}});return f})}(),function(e,t){define("task/views/TaskActionView",["backbone","underscore","doT","Internationalization","Configuration","IO","Settings","Environment","Device","Log","ui/TemplateFactory","utilities/StringUtil","task/collections/TasksCollection","task/views/DeleteConfirmWindowView","main/collections/PIMCollection"],function(e,t,n,r,i,s,o,u,a,f,l,c,h,p,d){console.log("TaskActionView - File loaded.");var v=e.View.extend({template:n.template(l.get("taskManager","task-action")),className:"action",render:function(){return this.$el.html(this.template(this.model.toJSON())),this},clickButtonStart:function(e){e.stopPropagation(),this.model.startTaskAsync()},clickButtonPause:function(e){e.stopPropagation(),this.model.stopTaskAsync(),f({event:"ui.click.task.pause.item",connected:a.get("isConnected"),type:this.model.get("category"),title:this.model.get("title"),url:this.model.get("detail"),size:this.model.get("size"),processing:this.model.get("processing")})},clickButtonChangePath:function(e){e.stopPropagation(),s.requestAsync(i.actions.SAVE_SCREENSHOT).done(function(e){var n=h.getInstance(),r=t.pluck(t.find(n.getFailedTasks(),function(e){return e.get("message")==="NO_SPACE"}),"id");n.startTasksAsync(r)}.bind(this))},clickButtonRetry:function(e){e.stopPropagation(),this.model.startTaskAsync()},clickButtonForceRestart:function(e){e.stopPropagation(),this.model.restartAsync({reinstall:1})},clickButtonOpenOnDevice:function(e){e.stopPropagation(),this.model.openOnDeviceAsync()},clickButtonSetAsWallpaper:function(e){e.stopPropagation(),this.model.setAsWallpaperAsync()},clickButtonChangeLocation:function(e){e.stopPropagation(),s.requestAsync(i.actions.SAVE_APP_SETTING)},clickButtonManageApp:function(e){e.stopPropagation(),d.getInstance().get(3).set({selected:!1},{silent:!0}).set({selected:!0})},clickButtonDelete:function(e){e.stopPropagation();var t=new p.getInstance({$bodyContent:r.taskManager.CONFIRM_DELETE_BATCH});t.show(),t.once("button_yes",function(){this.model.deleteTaskAsync(t.deleteFile)},this)},clickButtonManageSD:function(e){e.stopPropagation(),s.requestAsync(i.actions.DEVICE_OPEN_SD_CARD)},clickButtonInstallToDevice:function(e){e.stopPropagation(),this.model.restartAsync({location:i.enums.INSTALL_LOCATION_DEVICE})},clickButtonContinueInstall:function(e){e.stopPropagation(),this.model.restartAsync({no_scan_virus:1})},clickButtonHowToConnect:function(){s.requestAsync({url:i.actions.OPEN_URL,data:{url:r.taskManager.HOW_TO_CONNECT_URL}})},clickButtonDontAskAgainDevice:function(){o.set("task-manager-device-not-found",!0,u.get("deviceId")),h.getInstance().trigger("update")},clickButtonConnect:function(e){e.stopPropagation(),s.requestAsync(i.actions.CONNET_PHONE)},events:{"click .button-start":"clickButtonStart","click .button-pause":"clickButtonPause","click .button-retry":"clickButtonRetry","click .button-force-restart":"clickButtonForceRestart","click .button-open-on-device":"clickButtonOpenOnDevice","click .button-set-as-wallpaper":"clickButtonSetAsWallpaper","click .button-change-location":"clickButtonChangeLocation","click .button-manage-app":"clickButtonManageApp","click .button-delete":"clickButtonDelete","click .button-manage-sd":"clickButtonManageSD","click .button-install-to-device":"clickButtonInstallToDevice","click .button-continue-install":"clickButtonContinueInstall","click .button-how-to-connect":"clickButtonHowToConnect","click .button-dont-ask-again-device":"clickButtonDontAskAgainDevice","click .button-connect":"clickButtonConnect","click .button-change-path":"clickButtonChangePath"}}),m=t.extend({getInstance:function(e){return new v(e)}});return m})}(this),function(e,t){define("task/views/TaskListItemView",["underscore","doT","Internationalization","ui/TemplateFactory","ui/BaseListItem","utilities/StringUtil","task/views/TaskActionView"],function(e,n,r,i,s,o,u){console.log("TaskListItemView - File loaded.");var a=s.extend({template:n.template(i.get("taskManager","list-item")),className:"w-task-manager-list-item hbox",render:function(){return this.taskActionView!==t?(this.taskActionView.$el.detach(),this.taskActionView.model=this.model,this.taskActionView.render()):this.taskActionView=u.getInstance({model:this.model}).render(),this.$el.html(this.template(this.model.toJSON())),this.$el.append(this.taskActionView.$el),this},uninstall:function(){this.taskActionView.remove()},remove:function(){this.taskActionView.remove(),a.__super__.remove.apply(this,arguments)}}),f=e.extend({getInstance:function(){return new a},getClass:function(){return a}});return f})}(this),function(e,t){define("task/views/TaskContextMenu",["ui/Menu","ui/behavior/ClickToHideMixin","ui/AlertWindow","Internationalization","Device","task/collections/TasksCollection","task/views/DeleteConfirmWindowView"],function(e,t,n,r,i,s,o){console.log("TaskContextMenu - File loaded. ");var u,a=e.extend({initialize:function(){a.__super__.initialize.apply(this,arguments),t.mixin(this),u=s.getInstance(),this.addItems(),this.on("select",function(e){switch(e.value){case"pause":this.pauseTasks();break;case"delete":this.deleteTasks();break;case"resume":this.resumeTasks()}},this)},pauseTasks:function(){u.pauseTasksAsync(this.options.selected)},deleteTasks:function(){var e=new o.getInstance({$bodyContent:r.taskManager.CONFIRM_DELETE_BATCH});e.show(),e.on("button_yes",function(){u.deleteTasksAsync(this.options.selected,e.deleteFile)},this)},resumeTasks:function(){u.startTasksAsync(this.options.selected)},addItems:function(){var e=this.options.selected,t=function(){var t=!1,n,r=e.length;for(n=0;n<r;n++){t=u.get(e[n]).isRunning;if(t)break}return t}(),n=function(){var t=!1,n,r=e.length;for(n=0;n<r;n++){t=u.get(e[n]).isStoped;if(t)break}return t}();this.items=[{type:"normal",name:"pause",value:"pause",label:r.misc.PAUSE,disabled:!t||!u.hasPausable(e)},{type:"normal",name:"resume",value:"resume",label:r.misc.RESUME,disabled:!n},{type:"normal",name:"delete",value:"delete",label:r.misc.DELETE,disabled:!1}]}}),f,l=_.extend({getInstance:function(e){return f?(f.options.selected=e.selected,f.addItems(),f.render()):f=new a(e),f}});return l})}(this),function(e,t){define("task/views/TaskListView",["backbone","doT","underscore","ui/TemplateFactory","ui/SmartList","task/collections/TasksCollection","task/views/TaskListItemView","task/views/TaskContextMenu","Internationalization"],function(e,t,n,r,i,s,o,u,a){console.log("TaskListView- File loaded.");var f,l,c=e.View.extend({template:t.template(r.get("taskManager","task-list")),className:"w-task-list-ctn vbox",initialize:function(){Object.defineProperties(this,{selected:{get:function(){return f?f.selected:[]}}}),l=s.getInstance()},buildList:function(){f=new i({itemView:o.getClass(),dataSet:[{name:"default",getter:l.getAll}],keepSelect:!1,$observer:this.options.$observer,itemHeight:45,enableContextMenu:!0,listenToCollection:l,emptyTip:a.taskManager.EMPTY_LIST}),f.listenTo(l,"refresh",function(e){this.switchSet("default",e.getAll)}),f.listenTo(l,"update",function(){this.loading=!0,l.once("refresh",function(){this.loading=!1},this)}),this.$el.append(f.render().$el),this.listenTo(f,"select:change",this.selectChangeHandler),this.listenTo(f,"contextMenu",this.showContextMenu)},selectChangeHandler:function(e){this.trigger("select:change",e)},showContextMenu:function(){u.getInstance({selected:f.selected}).show()},render:function(){return this.$el.html(this.template({})),this.buildList(),this},remove:function(){f.remove(),c.__super__.remove.call(this)}}),h,p=n.extend({getInstance:function(e){return h||(h=new c(e)),h}});return p})}(this),function(e,t){define("task/views/TaskModuleToolbarView",["doT","underscore","Internationalization","Configuration","Log","IOBackendDevice","ui/Toolbar","ui/TemplateFactory","ui/UIHelper","task/collections/TasksCollection","task/views/TaskListView","task/views/DeleteConfirmWindowView"],function(e,n,r,i,s,o,u,a,f,l,c,h){console.log("TaskModuleToolbarView - File loaded.");var p=f.EventsMapping,d,v,m=u.extend({template:e.template(a.get("taskManager","toolbar")),render:function(){return this.$el.html(this.template({})),d=c.getInstance({$observer:this.$(".check-select-all")}),v=l.getInstance(),v.on("refresh",this.setButtonState,this),d.on("select:change",this.setButtonState,this),this.setButtonState(),this},setButtonState:function(){var e=d.selected,n=e.length,r=function(r){var i=!1,s,o;for(s=0;s<n;s++){o=r.get(e[s]),o!==t&&(i=o.isRunning);if(i)break}return i}(v),i=function(r){var i=!1,s,o;for(s=0;s<n;s++){o=r.get(e[s]),o!==t&&(i=o.isStoped);if(i)break}return i}(v);this.$(".button-pause").prop({disabled:n===0||!r||!v.hasPausable(e)}),this.$(".button-continue").prop({disabled:n===0||!i}),this.$(".button-delete").prop({disabled:n===0})},clickButtonPause:function(){v.pauseTasksAsync(d.selected)},clickButtonContinue:function(){v.startTasksAsync(d.selected)},clickButtonDelete:function(){var e=new h.getInstance({$bodyContent:r.taskManager.CONFIRM_DELETE_BATCH});e.show(),e.on("button_yes",function(){v.deleteTasksAsync(d.selected,e.deleteFile)})},clickButtonOpenFolder:function(){s({event:"ui.click.task.open.download.folder"}),o.requestAsync({url:i.actions.TASK_OPEN_DOWNLOAD_DIRECTORY,success:function(e){e.state_code===200?console.log("TaskModuleToolbarView - Open download directory success."):console.error("TaskModuleToolbarView - Open download directory failed. Error info: "+e.state_line)}})},events:{"click .button-pause":"clickButtonPause","click .button-continue":"clickButtonContinue","click .button-delete":"clickButtonDelete","click .button-open-folder":"clickButtonOpenFolder"}}),g,y=n.extend({getInstance:function(){return g||(g=new m),g}});return y})}(this),function(e,t,n){define("task/views/TaskModuleView",["backbone","doT","jquery","underscore","ui/TemplateFactory","Configuration","IOBackendDevice","task/views/TaskModuleToolbarView","task/views/TaskListView","task/collections/TasksCollection"],function(e,t,n,r,i,s,o,u,a,f){console.log("TaskModuleView - File loaded.");var l,c,h=e.View.extend({className:"w-task-module-main module-main vbox",template:t.template(i.get("taskManager","main")),initialize:function(){var t=!1,n=!1;Object.defineProperties(this,{rendered:{set:function(e){t=e},get:function(){return t}},show:{set:function(e){n=e},get:function(){return n}}}),c=f.getInstance(),e.on("switchModule",function(e){e.module!=="task"&&this.slideOut()}.bind(this)),o.Backend.Device.onmessage({"data.channel":s.events.WEB_NAVIGATE},function(e){this.slideOut()},this)},render:function(){return this.$el.html(this.template({})),this.$(".ctn").append(u.getInstance().render().$el),l=a.getInstance(),this.$(".ctn").append(l.render().$el),this.rendered=!0,this},slideIn:function(){if(!this.show&&!this.$el.hasClass("w-task-module-fade-in")){var e=function(){this.$el.removeClass("w-task-module-fade-in"),this.show=!0}.bind(this);this.$(".w-task-mask").css("background-color","rgba(0, 0, 0, .4)"),this.$el.one("webkitAnimationEnd",e).css("visibility","visible").addClass("w-task-module-fade-in")}},slideOut:function(){if(this.show&&!this.$el.hasClass("w-task-module-fade-out")){var e=function(){this.show=!1,this.$el.css({visibility:"hidden"}).removeClass("w-task-module-fade-out")}.bind(this);this.$(".w-task-mask").css("background-color","rgba(0, 0, 0, 0)"),this.$el.one("webkitAnimationEnd",e).addClass("w-task-module-fade-out")}},clickButtonClose:function(){this.slideOut()},events:{"click .button-close":"clickButtonClose"}}),p,d=r.extend({getInstance:function(){return p||(p=new h),p},preload:function(){f.getInstance()}});return d})}(this,this.document),function(e,t){define("task/EventProcessor",["Log","IOBackendDevice","Settings","FunctionSwitch","Configuration","Device"],function(e,n,r,i,s,o){console.log("EventProcessor - File loaded.");var u={START_DOWNLOAD:"START_DOWNLOAD"},a=[],f=function(){n.Backend.Device.onmessage({"data.channel":s.events.TASK_STATUS_CHANGE},function(e){var t=a.length,n=_.filter(e.status,function(e){return/^OFFLINE--/.test(e.source)});n.length>0&&a.push({id:_.uniqueId("task-event-"),message:"OFFLINE_TASK",data:n.length}),t===0&&a.length===1&&this.trigger("message",a[0])},this),n.Backend.Device.onmessage({"data.channel":s.events.TASK_ADD},function(e){var t=a.length;e>0&&(a.push({id:_.uniqueId("task-event-"),message:"NEW_TASK",data:e}),t===0&&a.length===1&&this.trigger("message",a[0]))},this),n.Backend.Device.onmessage({"data.channel":s.events.TASK_STOP},function(e){var t=a.length;e>0&&(a.push({id:_.uniqueId("task-event-"),message:"TASK_FINISH",data:e}),t===0&&a.length===1&&this.trigger("message",a[0]))},this)};f.prototype.remove=function(e){var n,r,i,s;for(r=a.length;r--;t){s=a[r];if(s.id===e){i=a[r],a.splice(r,1),this.trigger("remove",i),a.length>0&&(n=a[0]);break}}n?this.trigger("message",n):a.length===0&&this.trigger("empty")};var l=_.extend(new f,Backbone.Events);return l})}(this),function(e,t){define("task/views/TaskMonitorView",["backbone","doT","jquery","underscore","Log","ui/TemplateFactory","Internationalization","Configuration","Device","IOBackendDevice","utilities/StringUtil","task/collections/TasksCollection","main/views/NavView","task/views/TaskDashboardView","task/views/TaskNotifierPanelView","task/views/TaskModuleView","task/EventProcessor","task/TaskService","main/collections/PIMCollection"],function(e,n,r,i,s,o,u,a,f,l,c,h,p,d,v,m,g,y,b){console.log("TaskMonitorView - File loaded. ");var w,E,S=e.View.extend({className:"w-task-monitor-item item",template:n.template(o.get("taskManager","monitor-item")),render:function(){var e,t;switch(this.model.get("message")){case"NEW_TASK":e="add",t=c.format(u.taskManager.ADD_TASK_TIP,this.model.get("data"));break;case"TASK_FINISH":e="finish",t=c.format(u.taskManager.FINISH_TASK_TIP,this.model.get("data"))}return this.$el.html(this.template({icon:e,desc:t})),setTimeout(function(){this.$el.slideDown(function(){setTimeout(function(){this.$el.slideUp(function(){this.remove(),g.remove(this.model.id)}.bind(this))}.bind(this),2e3)}.bind(this))}.bind(this),0),this}}),x=e.View.extend({className:"w-task-manager-ctn vbox",template:n.template(o.get("taskManager","task-ctn")),initialize:function(){w=h.getInstance(),E=m.getInstance(),w.on("refresh",this.showMessage,this);var u=function(e){e.message==="NEW_TASK"&&(l.requestAsync(a.actions.WINDOW_DISK_FREE_SPACE).done(function(e){if(Number(e.body.value)<524288e3){var t=v.getInstance({$host:this.$el,$content:r(n.template(o.get("taskManager","out-of-space"))()),alignToHost:!1,popIn:!0});t.show(),s({event:"debug.taskManager.out_of_space_notifi_show"})}}.bind(this)),this.stopListening(g,"message",u))};this.listenTo(g,"message",u),g.on("message",function(t){switch(t.message){case"NEW_TASK":case"TASK_FINISH":this.$el.prepend((new S({model:new e.Model(t)})).render().$el)}if(t.message==="NEW_TASK")this.addNewTaskAnima();else if(t.message==="OFFLINE_TASK"){var i=v.getInstance({$host:this.$el,$content:r(n.template(o.get("taskManager","offline-task-added"))({count:t.data})),alignToHost:!1,popIn:!0,delay:5e3});i.show()}w.off("refresh",this.showMessage)},this),g.on("empty",function(){w.on("refresh",this.showMessage,this),w.trigger("refresh",w)},this);var c=l.Backend.Device.onmessage({"data.channel":a.events.TASK_ADD},function(e){if(e>0&&!f.get("isConnected")){var s=v.getInstance({$host:this.$el,$content:r(n.template(o.get("taskManager","disconnect-tip"))({})),alignToHost:!1,popIn:!0,listenToConnect:!0});s.show();var u=function(){var e=i.find(w.getFailedTasks(),function(e){return e.get("message")==="NO_SPACE"});e!==t&&s.remove()};s.listenTo(w,"refresh",u),l.Backend.Device.offmessage(c)}},this),p=l.Backend.Device.onmessage({"data.channel":a.events.TASK_STATUS_CHANGE},function(e){var s=i.find(e.status,function(e){return e.message==="CONFIRM_ON_DEVICE"||e.message==="NEED_USER_INSTALL"}),u;if(s!==t)u=v.getInstance({$host:this.$el,$content:r(n.template(o.get("taskManager","confirm-tip"))({})),alignToHost:!1,popIn:!0,listenToWifi:!0}),u.show(),l.Backend.Device.offmessage(p);else{var a=i.find(e.status,function(e){return e.message==="NEED_USER_INSTALL_MIUI_V5"});a&&(u=v.getInstance({$host:this.$el,$content:r(n.template(o.get("taskManager","confirm-miui-v5-tip"))({})),alignToHost:!1,popIn:!0,listenToWifi:!0}),u.show(),l.Backend.Device.offmessage(p))}},this),d=function(e,t){if(!t&&w.activeCount>0){var i=v.getInstance({$host:this.$el,$content:r(n.template(o.get("taskManager","disconnect-running-tip"))({})),alignToHost:!1,popIn:!0,listenToConnect:!0});i.show(),this.stopListening(e,"change:isConnected",d)}};this.listenTo(f,"change:isConnected",d);var y=function(){var e=i.find(w.getFailedTasks(),function(e){return e.get("message")==="NO_SPACE"});if(e!==t){var u=v.getInstance({$host:this.$el,$content:r(n.template(o.get("taskManager","not-enough-space"))({})),alignToHost:!1,popIn:!0});u.show(),this.stopListening(w,"refresh",y),s({event:"debug.taskManager.not_enough_space_notifi_show"})}};this.listenTo(w,"refresh",y)},addNewTaskAnima:i.throttle(function(){var e=r("<div>").addClass("w-task-anima start-download-anima");e.one("webkitAnimationEnd",function(){e.toggleClass("start-download-anima",!1),e.remove()}),r("body").append(e)},1e4),showMessage:function(e){this.$(".item").hide(),e.activeCount>0?(this.$(".item.active .desc").html(c.format(u.taskManager.RUNNING_COUNT,e.activeCount)),this.$(".item.active").show()):e.errorCount>0?(this.$(".item.error .desc").html(c.format(u.taskManager.FAILED_COUNT,e.errorCount)),this.$(".item.error").show()):e.getWaitingPushTasks().length?(this.$(".item.push .desc").html(c.format(u.taskManager.WATING_PUSH_COUNT,e.getWaitingPushTasks().length)),this.$(".item.push").show()):(this.showCacheSize(),this.$(".item.cache").show())},showCacheSize:i.debounce(function(){l.requestAsync({url:a.actions.TASK_CACHE_SIZE,success:function(e){var t=parseInt(e.body.value,10);t?this.$(".item.cache .desc").html(c.format(u.taskManager.CACHE_SIZE,c.readableSize(t))):this.$(".item.cache .desc").html(u.taskManager.NO_TASK_RUNNING)}.bind(this)})},100),render:function(){return this.$el.html(this.template({})),d.getInstance({$host:this.$el}),this.showMessage(w),this.addAnimation(),this},addAnimation:function(){var e=r("<div>").addClass("anima");e.on("webkitAnimationEnd",function(){e.toggleClass("start-download-anima",!1),e.toggleClass("start-install-anima",!1),e.detach()}),l.Backend.Device.onmessage({"data.channel":a.events.TASK_STATUS_CHANGE},function(t){switch(t.message){case"START_DOWNLOAD":!e.hasClass("start-download-anima")&&!e.hasClass("start-install-anima")&&(this.$el.prepend(e),e.toggleClass("start-download-anima",!0));break;case"START_INSTALL":!e.hasClass("start-download-anima")&&!e.hasClass("start-install-anima")&&(this.$el.prepend(e),e.toggleClass("start-install-anima",!0))}},this)},clickView:function(e){E.show?(E.slideOut(),s({event:"ui.click.task.toggle.close"})):(E.rendered?r(".w-main .module-ctn").children().last()[0].contains(E.$el[0])||r(".w-main .module-ctn").append(E.$el):r(".w-main .module-ctn").append(E.render().$el),E.slideIn(),s({event:"ui.click.task.toggle.open"}))},events:{click:"clickView"}}),T,N=i.extend({getInstance:function(){return T||(T=new x),T}});return N})}(this),function(e){define("main/views/FastUSBNotificationView",["underscore","backbone","doT","ui/TemplateFactory","Device","Configuration","Internationalization","IOBackendDevice"],function(t,n,r,i,s,o,u,a){console.log("FastUSBNotificationView - File loaded. ");var f=n.View.extend({template:r.template(i.get("misc","adb-notif")),className:"w-device-usb-detect",initialize:function(){a.Backend.Device.onmessage({"data.channel":o.events.DEVICE_USB_DETECT},this.stateHandler,this),this.listenTo(s,"change:isFastADB",function(e,t){t?this.$el.slideDown():this.$el.slideUp()}),this.listenTo(n,"switchModule",function(e){e.module==="doraemon"||e.module==="browser"||e.module==="gallery"?this.$el.css({visibility:"hidden"}):this.$el.css({visibility:"visible"})})},render:function(){return this.$el.html(this.template({})),setTimeout(function(){var t=e.SnapPea.CurrentModule;(t==="doraemon"||t==="browser"||t==="gallery")&&this.$el.css({visibility:"hidden"}),s.get("isFastADB")&&this.$el.slideDown()}.bind(this),0),a.requestAsync(o.actions.DEVICE_GET_USB_DETECT_STATE).done(function(e){e.state_code===200&&this.stateHandler(e.body.value)}.bind(this)),this},stateHandler:function(e){var t={17:u.misc.USB_APK_INSTALLING,18:u.misc.USB_APK_UPDATING,"-19":u.misc.USB_INSTALL_FAILED,"-20":u.misc.USB_INSTALL_APK_INVALID,"-21":u.misc.USB_UPDATE_FAILED,"-26":u.misc.USB_ROM_TOO_OLD,"-27":u.misc.USB_INSTALL_FAILED_NO_MORE_SPACE,"-31":u.misc.USB_INSTALL_FAILED_INTERNAL_ERROR},n=t[e];n?this.$(".tip").html(n):e>0?this.$(".tip").html(u.misc.USB_LOADING_INFO):this.$(".tip").html(u.misc.USB_LOADING_INFO_FAILED),this.$el.toggleClass("loading",e>0),this.$el.toggleClass("error",e<0)},clickButtonRetry:function(){a.requestAsync(o.actions.DEVICE_USB_REDETECT)},events:{"click .button-retry":"clickButtonRetry"}}),l,c=t.extend({getInstance:function(){return l||(l=new f),l}});return c})}(this),function(e,t,n){define("main/views/MainView",["backbone","doT","jquery","underscore","ui/TemplateFactory","ui/AlertWindow","Configuration","IOBackendDevice","Internationalization","Device","Environment","main/views/NavView","main/collections/PIMCollection","task/views/TaskMonitorView","task/views/TaskModuleView","backuprestore/BackupController","doraemon/views/GallerySwitchView","main/views/FastUSBNotificationView"],function(n,r,i,s,o,u,a,f,l,c,h,p,d,v,m,g,y,b){console.log("Wandoujia 2.0 launched.");var w=e.alert,E=function(e){switch(e.type){case a.enums.NAVIGATE_TYPE_MARKET:this.getModule("browser").navigate(e.id);break;case a.enums.NAVIGATE_TYPE_APP:this.getModule("app").navigate(e);break;case a.enums.NAVIGATE_TYPE_CONTACT:this.getModule("contact").navigate(e);break;case a.enums.NAVIGATE_TYPE_SMS:this.getModule("message").navigate(e);break;case a.enums.NAVIGATE_TYPE_SEND_SMS:this.getModule("message").sendMessage(e.id);break;case a.enums.NAVIGATE_TYPE_PAGE:this.getModule("browser").navigate(e.id,!1);break;case a.enums.NAVIGATE_TYPE_CONTACT_CREATE:this.getModule("contact").createNew(e.id);break;case a.enums.NAVIGATE_TYPE_WEBAPP:this.getModule("app").showWebAppView();break;case a.enums.NAVIGATE_TYPE_PHOTO_CLOUD:n.trigger("switchModule",{module:"photo"});var t=f.Backend.Device.onmessage({"data.channel":a.events.CUSTOM_IFRAME_PHOTO_RENDERED},function(){f.sendCustomEventsAsync(a.events.CUSTOM_IFRAME_PHOTO_SELECT_TAB,{tab:"cloud"}),f.Backend.Device.offmessage(t)});break;case a.enums.NAVIGATE_TYPE_ILLEGAL_LOGOUT:w(l.misc.ILLEGAL_LOGOUT);break;case a.enums.NAVIGATE_TYPE_GALLERY:this.getModule("browser").navigateToThirdParty(e.id,e.keyword);break;case a.enums.NAVIGATE_TYPE_IMPORT_MUSIC:this.getModule("music").showImport(e.id);break;case a.enums.NAVIGATE_TYPE_IMPORT_IMAGE:this.getModule("photo").showImport(e.id);break;case a.enums.NAVIGATE_TYPE_IMPORT_VIDEO:this.getModule("video").showImport(e.id);break;case a.enums.NAVIGATE_TYPE_THEME:this.getModule("browser").navigateToThirdParty(218,"豌豆荚主题");break;case a.enums.NAVIGATE_TYPE_APP_WASH:this.getModule("app-wash").navigate();break;case a.enums.NAVIGATE_TYPE_BACKUP_CLOUD:c.get("isConnected")?g.start(!0):w(l.welcome.CONNECT_UR_PHONE);break;case a.enums.NAVIGATE_TYPE_TASK_MANAGER:m.getInstance().slideIn()}},S=n.View.extend({template:r.template(o.get("misc","main")),className:"w-main",initialize:function(){var t={},r,i;Object.defineProperties(this,{modules:{get:function(){return t}},currentModule:{set:function(t){r=t,e.SnapPea.CurrentModule=r},get:function(){return r}},currentTab:{set:function(t){i=t,e.SnapPea.CurrentTab=i},get:function(){return r}}}),n.on("switchModule",function(e){var t=e.module;h.get("deviceId")!=="Default"||t==="doraemon"||t==="browser"||t==="gallery"?this.showModule(t,e.tab):this.showModule("welcome"),t==="doraemon"&&p.getInstance().deselectAll()},this),f.Backend.Device.onmessage({"data.channel":a.events.WEB_NAVIGATE},E,this),f.Backend.onmessage({"data.channel":a.events.WEB_FORCE_NAVIGATE},E,this)},render:function(){this.$el.html(this.template({}));var e=t.createDocumentFragment();return e.appendChild(p.getInstance().render().$el[0]),e.appendChild(i(r.template(o.get("misc","shadow"))({}))[0]),e.appendChild(v.getInstance().render().$el[0]),this.$(".sidebar").append(e),this.$(".module-ctn").append(b.getInstance().render().$el),this},regModule:function(e,t){this.modules[e]=t,t.enablePreload&&t.preload()},getModule:function(e){return this.modules[e]},showModule:function(e,t){this.currentTab=t;if(e===this.currentModule)return;this.currentModule&&this.hideModule(this.currentModule);var n=this.modules[e].getInstance(t),r=this.$(".module-ctn");if(n.rendered)this.hideModule(e),n.$el.css({visibility:"visible",opacity:1});else{var i=r.children().last();n.$el.css({visibility:"visible",opacity:1}),i.length===0?r.append(n.render().$el):r.children().last().before(n.render().$el)}this.currentModule=e},hideModule:function(e){var t=this.modules[e].getInstance();t.rendered&&t.$el.css({visibility:"hidden",opacity:0})}}),x,T=s.extend({getInstance:function(){return x||(x=new S),x}});return T})}(this,this.document),function(e){define("main/views/SuggestionInstallWindowView",["jquery","underscore","ui/Panel","ui/EventsMapping","Environment","Settings","Configuration","IO","Log","Device","Internationalization","utilities/QueryString","app/collections/AppsCollection"],function(e,t,n,r,i,s,o,u,a,f,l,c,h){console.log("SuggestionInstallWindowView - File loaded. ");var p=n.extend({initialize:function(){p.__super__.initialize.apply(this,arguments);var e=function(){this.$("iframe")[0].contentWindow.aiInstall(),this.remove(),this.trigger("button_yes"),a({event:"ui.click.suggestion.install.all"})},t=function(){a({event:"ui.click.suggestion.install.close"})};this.listenTo(this,"button_install",e),this.listenTo(this,"button_yes",t),this.listenTo(this,r.DRAGSTART,function(){this.$(".mask").show()}),this.listenTo(this,r.DRAGEND,function(){this.$(".mask").hide()})},checkAppsAsync:function(){var t=e.Deferred(),n=h.getInstance(),r=function(e){!e.syncing&&!e.loading&&f.get("isConnected")&&(this.stopListening(e,"refresh",r),e.getNormalApps().length<=20&&t.resolve())};return this.listenTo(n,"refresh",r),n.trigger("update"),t.promise()},renderContentAsync:function(){var t=e.Deferred(),n=e("<iframe>").attr({src:"http://apps.wandoujia.com/appinterface"}).css({width:"750px",height:"395px"}),r=e("<div>").addClass("w-misc-suggestion-install").append(e("<div>").addClass("mask").hide()).append(n);this.$bodyContent=r;var i=function(e){var r=e.originalEvent.srcElement.readyState;r==="complete"&&(t.resolve(),n.off("readystatechange",i))}.bind(this);return n.on("readystatechange",i),t.promise()},check:function(){i.get("deviceId")!=="Default"&&this.checkAppsAsync().done(function(){this.render(),this.renderContentAsync().done(this.show.bind(this))}.bind(this))}}),d,v=t.extend({getInstance:function(){return d||(d=new p({title:l.misc.SUGGESTION_INSTALL,disposableName:"suggestion-install-window",disableX:!0,width:780,buttons:[{$button:e("<button>").html(l.app.INSTALL_ALL).addClass("primary"),eventName:"button_install"},{$button:e("<button>").html(l.common.CLOSE),eventName:"button_yes"}]})),d}});return v})}(this),function(e,t){define("doraemon/views/GalleryView",["backbone","underscore","doT","ui/TemplateFactory","Account","Configuration","IO","browser/views/BrowserView","doraemon/collections/ExtensionsCollection","doraemon/models/ExtensionModel"],function(e,t,n,r,i,s,o,u,a,f){console.log("GalleryView - File loaded.");var l,c=e.View.extend({className:"module-main vbox",initialize:function(){var e=!1;Object.defineProperties(this,{rendered:{set:function(t){e=Boolean(t)},get:function(){return e}}}),this.listenTo(i,"change:uid",function(){var e=this.$("iframe")[0];e.reload(e.src)}),l=l||a.getInstance(),this.listenTo(l,"add",function(e){this.sendMessage(s.events.CUSTOM_GALLERY_STAR,{id:e.id})}),this.listenTo(l,"remove",function(e){this.sendMessage(s.events.CUSTOM_GALLERY_UNSTAR,{id:e.id})}),this.$host=this.options.$host},render:function(){return this.$el.append(u.getInstance({id:"wdj-iframe-gallery",model:new f({id:305,name:"豌豆荚的百宝袋"})}).render().$el),this.rendered=!0,this},sendMessage:function(e,t){this.$("iframe")[0].contentWindow.postMessage(JSON.stringify({actions:e,id:t.id}),this.$("iframe")[0].contentWindow.location.href)}}),h,p=t.extend({enablePreload:!1,preload:function(){},getInstance:function(e){return h||(h=new c(e)),h}});return p})}(this),function(e,t){define("app/views/ChangeLogView",["doT","underscore","ui/TemplateFactory","ui/PopupPanel"],function(e,t,n,r){console.log("ChangeLogView - File loaded. ");var i=r.extend({className:r.prototype.className+" w-app-changelog vbox",initialize:function(){i.__super__.initialize.apply(this,arguments),this.$content=e.template(n.get("app","changelog"))(this.model.toJSON())}}),s=t.extend({getInstance:function(e){return new i(e)}});return s})}(this),function(e,t){define("app/views/AppItemView",["backbone","underscore","doT","jquery","ui/TemplateFactory","ui/AlertWindow","ui/BaseListItem","Configuration","Device","utilities/StringUtil","Log","Internationalization","FunctionSwitch","task/TaskService","app/views/ChangeLogView","task/collections/TasksCollection","app/collections/WebAppsCollection"],function(n,r,i,s,o,u,a,f,l,c,h,p,d,v,m,g,y){console.log("AppItemView - File loaded.");var b=e.confirm,w,E=a.extend({template:i.template(o.get("app","app-list-item")),className:"w-app-list-item hbox",initialize:function(){E.__super__.initialize.apply(this,arguments),w=w||g.getInstance(),this.listenTo(d,"change",this.render)},uninstall:function(){this.changeLogView&&(this.changeLogView.remove(),this.changeLogView=t)},remove:function(){this.uninstall(),E.__super__.remove.call(this)},render:function(){var e=this.$(".item-checker"),t=e.length>0?e[0].checked:!1;return this.$el.html(this.template(this.model.toJSON())),this.$(".item-checker").prop({checked:t}),this.renderUpdateColumn(),this.renderIcon(),this.model.get("running")&&this.$el.append(o.get("ui","loading-horizental")),this},renderUpdateColumn:function(){this.uninstall();if(!d.ENABLE_APP_UPGRADE)this.$(".update").remove();else if(c.isURL(this.model.get("upgrade_info").downloadUrl))if(!this.model.get("isUpdating")&&this.model.get("upgrade_info").changeLog)this.changeLogView=m.getInstance({$host:this.$(".button-update"),model:this.model});else{var e=w.getTaskByPackageName(this.model.id);e!==t&&(e.get("type")===f.enums.TASK_TYPE_PUSH?this.$("progress").addClass("running"):e.get("type")===f.enums.TASK_TYPE_INSTALL&&this.$("progress").addClass("running").attr({value:100}))}},renderIcon:function(){var t=this.model.get("base_info").icon;if(t&&!/^file:\/\/\//.test(t)){var n=s(new e.Image),r=this.$(".icon img"),i=function(){this.model.get("base_info").icon===n.data("path")&&r.attr({src:n[0].src}),n.remove()}.bind(this),o=function(){n.remove()};n.one("load",i).one("error",o).attr("src",t).data("path",t),r.attr("src",f.enums.TASK_DEFAULT_ICON_PATH_APP)}},clickButtonUpdate:function(e){e.stopPropagation();var t=this.model.updateInfo.set({source:"update-button-list"});v.addTask(f.enums.TASK_TYPE_INSTALL,f.enums.MODEL_TYPE_APPLICATION,t),this.model.set({isUpdating:!0}).unignoreUpdateAsync(),h({event:"ui.click.app.button.update",source:"list"})},clickButtonIgnore:function(e){e.stopPropagation();var t=new u({draggable:!0,disposableName:"app-ignore-update",disposableChecked:!0,buttonSet:"yes_no",$bodyContent:p.app.ALERT_TIP_IGNORED_UPDATE_CONFIRM,width:360});t.once("button_yes",function(){this.model.ignoreUpdateAsync()},this).show()},clickButtonUnignore:function(e){e.stopPropagation(),this.model.unignoreUpdateAsync()},clickButtonCancel:function(e){e.stopPropagation();var n=w.getTaskByPackageName(this.model.id);n!==t&&n.deleteTaskAsync()},clickButtonInstall:function(t){t.stopPropagation();var i=new n.Model(r.extend(this.model.get("downloadInfo"),{source:"app-list-web-app"}));v.addTask(f.enums.TASK_TYPE_INSTALL,f.enums.MODEL_TYPE_APPLICATION,i),this.model.set({isUpdating:!0}).unignoreUpdateAsync(),h({event:"ui.click.app.button.install",source:"list",tab:e.SnapPea.CurrentTab})},clickButtonHide:function(e){e.stopPropagation();var t=this.model;this.model.hideWebAppAsync().done(function(){if(!t.get("isWeb")&&l.get("isConnected")){var e=c.format(p.app.UNINSTALL_AFTER_HIDE,this.model.get("base_info").name);b(e,function(){t.uninstallAsync()},this)}var n=y.getInstance();n.remove(t),n.trigger("refresh",n)}.bind(this)).fail(function(){if(t.id===id){var e=this.$(".button-hide");e.html(p.app.WEB_APPS_HIDE_FAILED_TEXT).removeClass("link button-hide").addClass("text-warning failed-text"),setTimeout(function(){e.html(p.app.WEB_APPS_HIDE_TEXT).addClass("link button-hide").removeClass("text-warning failed-text")},3e3)}}.bind(this)),h({event:"ui.click.app_button_hide"})},events:{"click .button-update":"clickButtonUpdate","click .button-ignore":"clickButtonIgnore","click .button-unignore":"clickButtonUnignore","click .button-cancel":"clickButtonCancel","click .button-install":"clickButtonInstall","click .button-hide":"clickButtonHide"}}),S=r.extend({getInstance:function(e){return new E(e)},getClass:function(){return E}});return S})}(this),function(e,t,n){define("app/views/RetryWindowView",["backbone","doT","jquery","underscore","ui/TemplateFactory","ui/Panel","utilities/StringUtil","Internationalization","Device","app/collections/AppsCollection"],function(e,t,n,r,i,s,o,u,a,f){console.log("RetryWindowView - File loaded.");var l,c=e.View.extend({template:t.template(i.get("app","retry-window")),className:"w-app-retry-window-body",render:function(){return this.$el.html(this.template({tip:this.options.tip,failedApps:r.map(this.options.failedApps,function(e){return l.get(e.item).get("base_info").name})})),this}}),h=s.extend({initialize:function(){h.__super__.initialize.apply(this,arguments),l=l||f.getInstance(),this.title=u.ui.TIP,this.buttons=[{$button:n("<button>").html(u.ui.RETRY).addClass("primary").prop({disabled:this.options.needConnection?!a.get("isConnected"):!1}),eventName:"button_retry"},{$button:n("<button>").html(u.ui.CANCEL),eventName:"button_cancel"}],this.once("show",function(){var e=new c({tip:this.options.tip,failedApps:this.options.failedApps});this.$bodyContent=e.render().$el,this.once("remove",function(){e.remove(),this.off()},this)},this),this.once("button_retry",function(){this.close()}),this.options.needConnection&&this.listenTo(a,"change:isConnected",function(e,t){this.buttons[0].$button.prop({disabled:!t})})}}),p=r.extend({getInstance:function(e){return new h(e)}});return p})}(this,this.document),function(e,t){define("app/AppService",["backbone","underscore","doT","jquery","Internationalization","Configuration","IOBackendDevice","Device","Settings","ui/AlertWindow","ui/BatchActionWindow","ui/TemplateFactory","utilities/StringUtil","app/views/RetryWindowView","app/collections/AppsCollection"],function(n,r,i,s,o,u,a,f,l,c,h,p,d,v,m){console.log("AppService - File loaded. ");var g=e.alert,y=e.confirm,b=r.extend(function(){},n.Events),w;b.moveToSDCardAsync=function(e){var n=s.Deferred(),i=m.getInstance(),a=[],f=[];i.each(function(t){e.indexOf(t.id)>=0&&(f.push(t),t.isSuggestMove&&a.push(t))});var l=a.length!==f.length?o.app.APPS_TRANSFER_TIP_TEXT:d.format(o.app.MOVE_TO_SD_CARD,f.length);return y(l,function(){var s,a;e.length>1&&(s=r.uniqueId("app.move_to_sd_"),a=new h({session:s,progressText:o.app.APPS_TRANSFER_PROCESSING_TEXT,cancelUrl:u.actions.APP_CANCEL,total:e.length,successText:o.app.APPS_TRANSFER_SUCCESS_TEXT}),a.show()),e.length===1&&i.get(e[0]).set("running",!0),i.moveAppsAsync(e,s,u.enums.INSTALL_LOCATION_EXTENTION).done(function(e){var i=e.body||{},s=i.success||[],u=i.failed||[];s.length>0&&r.pluck(s,"error_code").indexOf(722)>=0&&g(o.app.ALERT_TIP_MOVE_NEED_CONFIRM),u.length>0&&a!==t&&a.remove(),n.resolve(e)}).fail(function(e){e.state_code!==402&&(g(o.app.MOVE_FAILED),a!==t&&a.remove()),n.reject(e)}).always(function(){e.length===1&&i.get(e[0]).set("running",!1)})}),n.promise()},b.batchMoveToSDCardAsync=function(e){var t=s.Deferred();if(f.get("productId")==="xiaomi-m1"&&f.get("SDKVersion")===10){g(o.app.XIAOMI_SD_DISABLE);return}var n=m.getInstance();if(f.get("isMounted")){var u=new c({draggable:!0,buttonSet:"retry_cancel",$bodyContent:i.template(p.get("app","mount-sd"))({})});u.on("button_retry",function(){f.get("isMounted")||(u.remove(),b.batchMoveToSDCardAsync(e))},this),u.once("button_cancel",t.reject),u.show()}var a=function(e){var n=e.body.failed;if(n&&n.length>0){var i=v.getInstance({failedApps:n,tip:o.app.APPS_TRANSFER_FAILED_TEXT,needConnection:!0});i.show(),i.once("button_retry",function(){b.moveToSDCardAsync(r.pluck(n,"item")).done(a)}),i.once("button_cancel",function(){t.reject()})}else t.resolve()};return b.moveToSDCardAsync(n.ableMoveToSD(e)).done(a),t.promise()},b.moveToDeviceAsync=function(e){var n=s.Deferred(),i=m.getInstance(),a=i.filter(function(t){return e.indexOf(t.id)>=0}),f=new c({draggable:!0,disposableName:"app-move-to-device",buttonSet:"yes_no",$bodyContent:d.format(o.app.MOVE_TO_DEVICE,a.length)});return f.once("button_yes",function(){var s,a;e.length>1&&(s=r.uniqueId("app.move_to_device_"),a=new h({session:s,progressText:o.app.APPS_TRANSFER_PROCESSING_TEXT,cancelUrl:u.actions.APP_CANCEL,total:e.length,successText:o.app.APPS_TRANSFER_SUCCESS_TEXT}),a.show()),e.length===1&&i.get(e[0]).set("running",!0),i.moveAppsAsync(e,s,u.enums.INSTALL_LOCATION_DEVICE).done(function(e){var i=e.body||{},s=i.success||[],u=i.failed||[];s.length>0&&r.pluck(s,"error_code").indexOf(722)>=0&&g(o.app.ALERT_TIP_MOVE_NEED_CONFIRM),u.length>0&&a!==t&&a.remove(),n.resolve(e)}).fail(function(e){e.state_code!==402&&(g(o.app.MOVE_FAILED),a!==t&&a.remove()),n.reject(e)}).always(function(){e.length===1&&i.get(e[0]).set("running",!1)})}),f.show(),n.promise()},b.batchMoveToDeviceAsync=function(e){var t=s.Deferred(),n=m.getInstance(),i=function(e){var n=e.body.failed;if(n&&n.length>0){var s=v.getInstance({failedApps:n,tip:o.app.APPS_TRANSFER_FAILED_TEXT,needConnection:!0});s.show(),s.once("button_retry",function(){b.moveToDeviceAsync(r.pluck(n,"item")).done(i)}),s.once("button_cancel",t.reject)}else t.resolve()};return b.moveToDeviceAsync(n.ableMoveToDevice(e)).done(i),t.promise()};var E=function(e,t,n){var r=s.Deferred(),i=m.getInstance();return e.length===1&&i.get(e[0]).set("running",!0),a.requestAsync({url:u.actions.APP_EXPORT,data:{package_list:e.join(","),session:t,source:"frontend_async",export_dir:n||"",default_path:l.get("app_export_default_path")},success:function(t){e.length===1&&i.get(e[0]).set("running",!1),t.state_code===200?(console.log("AppsCollection - Application export success. "),r.resolve(t)):t.state_code===402?(console.log("AppsCollection - Application export canceled. "),r.reject(t)):(console.error("AppsCollection - Application export failed. Error info: "+t.state_line),r.reject(t))}}),r.promise()};return b.batchExportAppsAsync=function(e){var n=s.Deferred(),i=function(e){var s=e.body.failed;if(s&&s.length>0){var u=v.getInstance({failedApps:s,tip:o.app.APPS_EXPORT_ERROR_TEXT,needConnection:!0});u.show(),u.once("button_retry",function(){b.exportAppsAsync(r.pluck(s,"item")).done(i).fail(n.reject)}),u.once("button_cancel",function(){w=t})}else n.resolve()};return b.exportAppsAsync(e).done(i).fail(n.reject),n.promise()},b.exportAppsAsync=function(e){var n=s.Deferred(),i=m.getInstance(),f=r.uniqueId("app.export_"),c,p;e.length>1&&(c=new h({session:f,progressText:o.app.APP_EXPORT_PROGRESS,cancelUrl:u.actions.APP_CANCEL,total:e.length,successText:o.app.APP_EXPORT_SUCCESS,delay:!0}));if(!w)var d=a.Backend.Device.onmessage({"data.channel":f},function(e){w||(w=e.info,a.Backend.Device.offmessage(d))});return E(e,f,w).done(function(e){l.set("app_export_default_path",w,!0);var r=e.body.failed;r&&r.length>0?c!==t&&c.remove():w=null,n.resolve(e)}).fail(function(e){e.state_code===402?w=null:(g(o.app.EXPORT_ERROR),c!==t&&c.remove()),n.reject(e)}),n.promise()},b.uninstallAppsAsync=function(e){var n=s.Deferred(),i=m.getInstance(),a=[],l=[],p=[];i.each(function(t){e.indexOf(t.id)>=0&&(a.push(t),t.isCritical&&l.push(t),t.isSystem&&p.push(t))});var v=function(){var s,a;e.length>1&&(s=r.uniqueId("app.batch.uninstall_"),a=new h({session:s,progressText:o.app.APP_DELETE_PROGRESS,cancelUrl:u.actions.APP_CANCEL,total:e.length,successText:o.app.APP_DELETE_SUCCESS}),a.show()),i.uninstallAppsAsync(e,s).done(function(e){if(f.get("isWifi")||f.get("isInternet"))g(o.app.CONFIRM_UNINSTALL_ON_DEVICE);else{var r=e.body.failed;r&&r.length>0&&a!==t&&a.remove()}n.resolve(e)}).fail(function(e){e.state_code!==402&&(g(o.app.UNINSTALL_ERROR),a!==t&&a.remove()),n.reject(e)})};if(l.length>0)g(d.format(o.app.ALERT_TIP_CRITICAL_APP,l[0].get("base_info").name));else if(p.length>0){var b=new c({draggable:!0,disposableName:"app-uninstall-system-app",buttonSet:"yes_no",$bodyContent:d.format(o.app.ALERT_TIP_DEL_SYS_APP_CONFIRM,p.length)});b.once("button_yes",v),b.show()}else y(e.length===1?o.app.CONFIRM_UNINSTALL:d.format(o.app.UNINSTALL_TIP,e.length),v,n.reject);return n.promise()},b.selectAppsDetailAsync=function(e){var t=s.Deferred();return a.requestAsync({url:u.actions.APP_GET_APP_DETAIL,data:{file:e},success:function(e){e.state_code===200?(console.log("AppService - Get selected APKs detail success."),t.resolve(e)):(console.error("AppService - Get selected APKs detail faild. Error info: "+e.state_line),t.reject(e))}}),t.promise()},b.selectAppsAsync=function(e){var t=s.Deferred();return a.requestAsync({url:u.actions.APP_GET_SELECTED_APK,data:{type:e},success:function(e){e.state_code===200?(console.log("AppService - Get selected APKs success."),t.resolve(e)):(console.error("AppService - Get selected APKs faild. Error info: "+e.state_line),t.reject(e))}}),t.promise()},b.hasAutoBackupAsync=function(){var e=s.Deferred();return a.requestAsync({url:u.actions.APP_HAS_BACKUP,success:function(t){t.state_code===200?e.resolve(t):e.reject(t)}}),e.promise()},b.loadAutoBackupAsync=function(){var e=s.Deferred();return a.requestAsync({url:u.actions.APP_LOAD_BACKUP,success:function(t){t.state_code===200?e.resolve(t):e.reject(t)}}),e.promise()},b.batchUninstallAsync=function(e){var t=s.Deferred(),n=m.getInstance(),i=function(e){var s=e.body.failed,u=e.body.success;if(s&&s.length>0){var a=v.getInstance({failedApps:s,tip:o.app.APPS_BATCH_UNINSTALL_FAILED,needConnection:!0});a.show(),a.once("button_retry",function(){b.uninstallAppsAsync(r.pluck(s,"item")).done(i).always(function(e){n.trigger("update")})}),a.once("button_cancel",t.reject)}else t.resolve(e)};return b.uninstallAppsAsync(e).done(i).always(function(e){n.trigger("update")}),t.promise()},b.scanMD5Async=function(e,t){var n=s.Deferred();return a.requestAsync({url:u.actions.APP_GET_MD5,data:{package_list:e.join(","),session:t},success:function(e){e.state_code===200?n.resolve(e):n.reject(e)}}),n.promise()},b})}(this),function(e,t){define("app/views/AppContextMenu",["underscore","jquery","ui/Menu","ui/behavior/ClickToHideMixin","ui/AlertWindow","utilities/StringUtil","Internationalization","Device","Configuration","Log","FunctionSwitch","app/collections/AppsCollection","app/AppService","task/TaskService"],function(t,n,r,i,s,o,u,a,f,l,c,h,p,d){console.log("AppContextMenu - File loaded. ");var v=e.confirm,m=e.alert,g,y=function(e){var t=g.get(e),n=t.updateInfo.clone().set({source:"update-button-list-context-menu"});d.addTask(f.enums.TASK_TYPE_INSTALL,f.enums.MODEL_TYPE_APPLICATION,n),t.set({isUpdating:!0}).unignoreUpdateAsync()},b=function(e){switch(e.value){case"update":this.updateApp();break;case"uninstall":this.uninstallApp();break;case"export":this.exportApp();break;case"move-to-sd":this.moveToSDCard();break;case"move-to-device":this.moveToDevice()}},w=r.extend({initialize:function(){w.__super__.initialize.apply(this,arguments),i.mixin(this),g=g||h.getInstance(),this.addItems(),this.on("select",b,this)},exportApp:function(){p.batchExportAppsAsync(this.options.selected),l({event:"ui.click.app.button.export",source:"context-menu"})},moveToSDCard:function(){p.batchMoveToSDCardAsync(this.options.selected),l({event:"ui.click.app.button.move.to.sd",source:"context-menu"})},moveToDevice:function(){p.batchMoveToDeviceAsync(this.options.selected),l({event:"ui.click.app.button.move.to.device",source:"context-menu"})},uninstallApp:function(){p.batchUninstallAsync(this.options.selected),l({event:"ui.click.app.button.uninstall",source:"context-menu"})},updateApp:function(){var n=this.options.selected,r=function(){var r=e.SnapPea.CurrentModule==="app"&&e.SnapPea.CurrentTab==="ignore"?g.ableToUpdateIncludeIgnored(n):g.ableToUpdate(n);t.each(r,y),l({event:"ui.app.click.button.update",source:"context-menu"})};v(o.format(u.app.UPGRADE_TIP_TEXT,n.length),r)},addItems:function(){var t=this.options.selected,n=e.SnapPea.CurrentModule==="app"&&e.SnapPea.CurrentTab==="web",r=[{type:"normal",name:"update",value:"update",label:u.app.UPDATE,disabled:t.length===0||g.ableToUpdate(t).length===0||n},{type:"normal",name:"uninstall",value:"uninstall",label:u.app.UNINSTALL,disabled:!a.get("isConnected")||t.length===0||(g.isSystemApp(t).length===0?!1:!a.get("isRoot"))||n},{type:"normal",name:"export",value:"export",label:u.misc.EXPORT,disabled:!a.get("isConnected")||n},{type:"hr"},{type:"normal",name:"move-to-sd",value:"move-to-sd",label:u.app.BUTTON_TRANSFER_LABEL,disabled:!a.get("isConnected")||a.get("isMounted")||!a.get("hasSDCard")||a.get("hasEmulatedSD")||g.ableMoveToSD(this.options.selected).length===0||n},{type:"normal",name:"move-to-device",value:"move-to-device",label:u.app.BUTTON_MOVE_TO_DEVICE_LABEL,disabled:!a.get("isConnected")||a.get("isMounted")||!a.get("hasSDCard")||a.get("hasEmulatedSD")||g.ableMoveToDevice(this.options.selected).length===0||n}];c.ENABLE_APP_UPGRADE||r.splice(0,1),this.items=r}}),E,S=t.extend({getInstance:function(e){return E?(E.options.selected=e.selected,E.addItems(),E.render()):E=new w(e),E}});return S})}(this),function(e,t){define("app/views/IgnoredAppsWindowView",["backbone","doT","jquery","underscore","Internationalization","ui/Panel","ui/UIHelper","ui/behavior/ButtonSetMixin","ui/TemplateFactory","ui/SmartList","utilities/StringUtil","Configuration","FunctionSwitch","app/collections/AppsCollection","app/views/AppItemView","task/TaskService","social/SocialService","Account","Settings"],function(e,t,n,r,i,s,o,u,a,f,l,c,h,p,d,v,m,g,y){console.log("IgnoredAppsWindowView - File loaded.");var b=o.EventsMapping,w,E,S=e.View.extend({template:t.template(a.get("app","one-key-update-body")),className:"w-app-ignored-apps vbox",initialize:function(){E=E||p.getInstance(),this.listenTo(E,"refresh",function(e){w.switchSet("default",e.getIgnoredApps)})},render:function(){return this.$el.html(this.template({})),w=new f({itemView:d.getClass(),dataSet:[{name:"default",getter:E.getIgnoredApps}],keepSelect:!1,$observer:this.$(".check-select-all"),$header:this.$("header"),itemHeight:45,listenToCollection:E}),this.listenTo(w,"select:change",this.refreshMonitor),this.$(".w-smart-list-header").after(w.render().$el),this.refreshMonitor(),w.selectAll(),this},refreshMonitor:function(){this.$(".w-smart-list-footer").html(l.format(i.misc.SELECTOR_DESCRIPTION_TEXT,w.selected.length,w.currentModels.length))},remove:function(){w.remove(),S.__super__.remove.call(this)}}),x=s.extend({initialize:function(){x.__super__.initialize.apply(this,arguments),Object.defineProperties(this,{selected:{get:function(){return w.selected}}}),this.on(b.SHOW,function(){var e=new S({});this.$bodyContent=e.render().$el,this.center(),this.once("remove",e.remove)},this),this.on(b.BUTTON_YES,this.ignoreAllApps,this)},ignoreAllApps:function(){var e=w.selected;r.each(e,function(e){E.get(e).unignoreUpdateAsync()})}}),T,N=r.extend({getInstance:function(){return T||(T=new x({buttons:[{$button:n("<button>").addClass("primary").html(i.app.APPS_CANCEL_IGNORE_TEXT),eventName:"button_yes"},{$button:n("<button>").html(i.ui.CANCEL),eventName:"button_cancel"}],title:i.app.IGNORED_TITLE,width:630,draggable:!0})),T}});return N})}(this),function(e,t){define("app/views/SortMenu",["backbone","underscore","ui/MenuButton","Environment","Configuration","Internationalization"],function(e,t,n,r,i,s){console.log("SortMenu - File loaded. ");var o=n.extend({initialize:function(){o.__super__.initialize.apply(this,arguments),Object.defineProperties(this,{selected:{get:function(){return t.find(this.items,function(e){return e.value===this.menu.$('input[type="radio"]:checked').val()},this)}}});var n=[{label:s.app.COL_NAME_LABEL,type:"radio",name:"app-list-sort",value:"base_info.name",checked:!0},{label:s.app.COL_SIZE_LABEL,type:"radio",name:"app-list-sort",value:"base_info.apk_size",checked:!1},{label:s.app.COL_INSTALL_POSITION,type:"radio",name:"app-list-sort",value:"base_info.installed_location",checked:!1},{label:s.app.COL_INSTALL_TIME,type:"radio",name:"app-list-sort",value:"base_info.last_update_time",checked:!1}];(r.get("locale")===i.enums.LOCALE_DEFAULT||r.get("locale")===i.enums.LOCALE_ZH_CN)&&n.push({label:s.app.BUTTON_UPGRADE_LABEL,type:"radio",name:"app-list-sort",value:"update",checked:!1}),this.items=n,this.label=s.ui.SORT,this.listenTo(e,"switchModule",function(e){e.module==="app"&&this.$el.prop({disabled:e.tab==="web"})})}}),u=t.extend({getInstance:function(){return new o}});return u})}(this),function(e,t,n){define("app/views/AppListView",["backbone","underscore","doT","jquery","ui/TemplateFactory","ui/SmartList","ui/MenuButton","ui/WindowState","utilities/StringUtil","Internationalization","Account","Configuration","Environment","Settings","FunctionSwitch","Device","Log","IO","welcome/WelcomeService","app/collections/AppsCollection","app/collections/WebAppsCollection","app/views/AppItemView","app/views/AppContextMenu","app/views/IgnoredAppsWindowView","app/views/SortMenu","main/collections/PIMCollection","browser/views/BrowserModuleView"],function(e,t,n,r,i,s,o,u,a,f,l,c,h,p,d,v,m,g,y,b,w,E,S,x,T,N,C){console.log("AppListView - File loaded.");var k,L,A,O,M,_=function(){this.loading=L.listenToCollection.loading||L.listenToCollection.syncing},D=e.View.extend({template:n.template(i.get("app","app-list")),className:"w-app-list vbox",initialize:function(){var n=!1,r=!1;Object.defineProperties(this,{selected:{get:function(){return L?L.selected:[]}},list:{get:function(){return L}},sdTipShowed:{get:function(){return n},set:function(e){n=Boolean(e)}},flashTipShowed:{get:function(){return r},set:function(e){r=Boolean(e)}}}),k=b.getInstance(),A=w.getInstance(),O=N.getInstance(),this.listenTo(A,"refresh",function(e){L&&L.currentSet.name==="web"&&L.switchSet("web",e.getAll),this.$('.tab li[data-tab="web"] .count').html(e.length),this.relocatePointer()}),this.listenTo(v,"change:isMounted",function(e,t){t?(!this.sdTipShowed&&k.length>0&&this.$(".sd-mount").slideDown("fast",function(){L.build(),n=!0}),this.flashTipShowed&&this.$(".flash").slideUp("fast",function(){L.build()})):(this.$(".sd-mount").slideUp("fast",function(){L.build()}),this.tryToShowFlashTip()),this.toggleEmptyTip()}),t.each(O.where({parent:3}),function(e){this.listenTo(e,"change:count",function(e){this.$('.tab li[data-tab="'+e.get("tab")+'"] .count').html(e.get("count")),this.relocatePointer()})},this),this.listenTo(e,"switchModule",this.switchModule),this.listenTo(l,"change:isLogin",this.toggleEmptyTip),this.listenTo(v,"change:isFastADB",function(e,t){L&&this.toggleEmptyTip()})},switchModule:function(e){var t=e.module,n=e.tab;t==="app"&&(this.toggleListeners(n),n==="web"?(L.enableMutilselect=!1,L.toggleObserver(!1),L.enableContextMenu=!1):(L.enableMutilselect=!0,L.toggleObserver(!0),L.enableContextMenu=!0),this.switchListDataSet(n),this.selectTab(n),this.$el.toggleClass("web",n==="web"),this.$el.toggleClass("update",n==="update"))},toggleListeners:function(e){var t,n;e==="web"?(t=A,n=k):(t=k,n=A),this.listenTo(t,"refresh",this.buildList),this.stopListening(n,"refresh",this.buildList),L.listenTo(t,"syncStart update syncEnd refresh",_),L.stopListening(n,"syncStart update syncEnd refresh",_),L.loading=t.loading||t.syncing,L.listenToCollection=t},buildList:function(){L?this.switchListDataSet(L.currentSet.name):(L=new s({itemView:E.getClass(),dataSet:[{name:"default",getter:k.getNormalApps}],enableContextMenu:!0,keepSelect:!1,$observer:this.options.$observer,itemHeight:45,listenToCollection:k,loading:k.loading||k.syncing}),this.$(".flash").after(L.render().$el),L.$el.data({"smart-list-sortby":"base_info.name","smart-list-sort-type":"string"}),this.listenTo(L,"switchSet",this.toggleEmptyTip),this.listenTo(L,"contextMenu",this.showContextMenu),this.listenTo(L,"select:change",function(e){this.trigger("select:change",e)}),this.toggleListeners("normal"))},switchListDataSet:function(e){this.$(".ignore-tip").toggle(k.getIgnoredApps().length!==0&&e==="update"),e!=="web"?(this.parseSortData(M.selected),L.$el.data("smart-list-sortby")==="base_info.last_update_time"?L.sortModels(!1):L.sortModels(!0)):(L.$el.data({"smart-list-sortby":"update","smart-list-sort-type":"number"}),L.sortModels(!0));switch(e){case"normal":case"default":L.switchSet("default",k.getNormalApps);break;case"sys":L.switchSet("sys",k.getSystemApps);break;case"update":this.$(".ignore-tip .count").html(a.format(f.app.IGNORED_APPS,k.getIgnoredApps().length)),L.switchSet("update",k.getUpdatableApps);break;case"web":L.switchSet("web",A.getAll)}},showContextMenu:function(e){var t=S.getInstance({selected:e});t.show()},toggleEmptyTip:function(){if(L.listenToCollection.loading||L.listenToCollection.syncing||v.get("isFastADB")){L.toggleEmptyTip(!1);return}if(L.currentModels.length===0){var e=L.currentSet.name;switch(e){case"default":v.get("isMounted")?L.emptyTip=r(n.template(i.get("app","sd-mount"))({})):L.emptyTip=f.app.NON_USER_APPS_TEXT;break;case"system":L.emptyTip=f.app.NON_SYSTEM_APPS_TEXT;break;case"update":d.ENABLE_APP_UPGRADE?L.emptyTip=k.loadingUpdateInfo?f.app.LOADING_UPDATE:f.app.NON_UPGRADE_APPS_TEXT:L.emptyTip=f.app.ENABLE_APP_UPGRADE_TIP;break;case"web":l.get("isLogin")?L.emptyTip=n.template(i.get("app","web-app-empty-tip"))({}):L.emptyTip=f.app.EMPTY_TIP_WEB_APP_NOT_LOGIN}L.toggleEmptyTip(!0)}else L.toggleEmptyTip(!1),v.get("isMounted")?(this.$(".sd-mount").css({display:"-webkit-box"}),this.sdTipShowed=!0):this.tryToShowFlashTip()},parseSortData:function(e){e.value==="base_info.name"?L.$el.data({"smart-list-sortby":e.value,"smart-list-sort-type":"string"}):L.$el.data({"smart-list-sortby":e.value,"smart-list-sort-type":"number"})},render:function(){return this.$el.html(this.template(function(){var e=O.filter(function(e){return e.get("parent")===3}),n={web:A.length};return t.each(e,function(e){n[e.get("tab")]=e.get("count")}),n}())),this.selectTab("normal"),this.buildList(),this.toggleEmptyTip(),M=T.getInstance(),M.on("select",function(e){this.parseSortData(e),L.$el.data("smart-list-sortby")==="base_info.last_update_time"?L.sortModels(!1):L.sortModels(!0),L.build()},this),this.$(".sort").append(M.render().$el),this.listenTo(u,"resize",this.relocatePointer),setTimeout(this.relocatePointer.bind(this),0),d.ENABLE_MY_APPS||this.$('.w-list-tab-header li[data-tab="web"]').remove(),h.get("locale")!==c.enums.LOCALE_DEFAULT&&h.get("locale")!==c.enums.LOCALE_ZH_CN&&this.$('.w-list-tab-header li[data-tab="update"]').remove(),this},highlight:function(e){L.deselectAll({slient:!0}),L.addSelect(e.id),L.scrollTo(e)},clickButtonCloseSD:function(){this.$(".sd-mount").slideUp("fast",function(){L.build()})},clickButtonCloseFlash:function(){this.$(".flash").slideUp("fast",function(){L.build()}),m({event:"ui.click.flash.app.tip.close"})},relocatePointer:function(){var e=this.$(".tab li.selected");if(e.length>0){var t=this.$(".pointer"),n=t.css("-webkit-transition");t.css({"-webkit-transition":"none"}),this.$(".pointer").css({left:e[0].offsetLeft,width:e[0].offsetWidth}),setTimeout(function(){t.css({"-webkit-transition":n})},0)}},selectTab:function(e){this.$(".tab li.selected").removeClass("selected");var t=this.$('.tab li[data-tab="'+e+'"]');t.addClass("selected"),this.$(".pointer").css({left:t[0].offsetLeft,width:t[0].offsetWidth}),m({event:"ui.click.app.tab",tab:e}),e==="web"&&m({event:"debug.app.webapp.list.show"})},tryToShowFlashTip:function(){if(!d.ENABLE_MY_APPS||!l.get("isLogin")||v.get("isMounted")||!v.get("isAutoBackup")||this.flashTipShowed||w.getInstance().models.length===0)return;v.get("isConnected")&&v.get("isFlashed")&&(this.$(".flash").slideDown("fast",function(){L.build(),this.flashTipShowed=!0}.bind(this)),m({event:"debug.flash.app.tip.show"}))},clickTab:function(t){e.trigger("switchModule",{module:"app",tab:r(t.currentTarget).data("tab")})},clickButtonFlash:function(){e.trigger("switchModule",{module:"app",tab:"web"}),this.$(".flash").slideUp("fast",function(){L.build()}),m({event:"ui.click.flash.app.tip.try"})},clickButtonOpenIgnore:function(){x.getInstance().show()},clickButtonLogin:function(){l.loginAsync("","web-app")},clickButtonFindApp:function(){C.navigateToThirdParty(18,f.app.APP_SEARCH),m({event:"ui.click.app.webapp.findapp"})},clickButtonOpenUpdate:function(){g.requestAsync(c.actions.WINDOW_OPEN_PRIVACY_SETTING)},events:{"click .button-close-sd":"clickButtonCloseSD","click .button-close-flash":"clickButtonCloseFlash","click .button-flash":"clickButtonFlash","click .tab li":"clickTab","click .button-open-ignore":"clickButtonOpenIgnore","click .button-login":"clickButtonLogin","click .button-find-app":"clickButtonFindApp","click .button-open-update":"clickButtonOpenUpdate"}}),P,H=t.extend({getInstance:function(e){return P||(P=new D(e)),P}});return H})}(this,this.document),function(e,t){define("app/models/RecommendAppModel",["jquery","IO","Configuration","app/models/AppBaseModel"],function(e,t,n,r){console.log("RecommendAppModel - File loaded.");var i=r.extend({parse:function(e){return delete e.app.ad,delete e.app.icons.px78,delete e.app.icons.px256,delete e.app.imprUrl,delete e.recReason.packageName,delete e.recReason.reasonType,e},dislikeAsync:function(r){var i=e.Deferred(),s=this.get("app").packageName;return t.requestAsync({url:n.actions.APP_UNLIKE,data:{package_name:s,pos:r||""},success:function(e){e.state_code===200?(console.log('RecommendAppModel - Unlike "'+s+'" success.'),i.resolve(e)):(console.error('RecommendAppModel - Unlike "'+s+'" failed. Error info: '+e.state_line),i.reject(e))}}),i.promise()}});return i})}(this),function(e,t){define("app/collections/RecommendAppsCollection",["backbone","underscore","IO","Configuration","app/models/RecommendAppModel"],function(e,t,n,r,i){console.log("RecommendAppsCollection - File loaded.");var s=e.Collection.extend({url:r.actions.APP_GET_RECOMMEND,model:i,data:{},initialize:function(){var e=!1;Object.defineProperties(this,{loading:{set:function(t){e=t},get:function(){return e}}}),this.on("update",function(){e||(e=!0,this.fetch({success:function(t){console.log("RecommendAppsCollection - Collection fetched."),e=!1,t.trigger("refresh",t)},error:function(){this.trigger("updateFailed")},remove:!1}))},this)},parse:function(e){var t=[];return e.body&&e.body.item&&(t=e.body.item),t},getCommonApps:function(){return this.filter(function(e){return!e.get("isCampaign")})},getCampaignApps:function(){return this.filter(function(e){return e.get("isCampaign")})}}),o=t.extend({getInstance:function(e,t){var n=new s;return t&&(n.data.package_name=t),n.data.pos=e,n.trigger("update"),n}});return o})}(this),function(e,t,n){define("app/views/RecommendView",["backbone","doT","jquery","underscore","Log","Internationalization","Configuration","ui/TemplateFactory","ui/PopupTip","utilities/StringUtil","app/collections/RecommendAppsCollection","task/TaskService","browser/views/BrowserModuleView"],function(r,i,s,o,u,a,f,l,c,h,p,d,v){console.log("RecommendView - File loaded.");var m=r.View.extend({template:i.template(l.get("app","app-recommend-item")),tagName:"li",className:"hbox",initialize:function(){this.listenTo(this.model,"remove",this.remove)},render:function(){this.$el.html(this.template(this.model.toJSON()));var t=s(new e.Image),n=function(){this.$(".icon img").attr({src:t[0].src}).hide().fadeIn("fast"),t.remove()}.bind(this),r=function(){t.remove()};t.one("load",n).one("error",r),t[0].src=this.model.get("app").icons.px48;var i=new c({$host:this.$("[data-title]")});return this},removeItem:function(){var e=function(){this.remove(),this.trigger("removed")}.bind(this);this.$el.css({"overflow-y":"hidden"}).animate({height:0,opacity:0},200,e),this.trigger("remove",this.model)},clickButtonInstall:function(){var e=new r.Model({source:"recommend",downloadUrl:this.model.get("app").apks[0].downloadUrls[0].url,title:this.model.get("app").title,iconPath:this.model.get("app").icons.px48});d.addTask(f.enums.TASK_TYPE_INSTALL,f.enums.MODEL_TYPE_APPLICATION,e),this.removeItem(),u({event:"ui.click.app.button_suggestion_install"})},clickButtonDislike:function(){this.model.dislikeAsync("app"),this.removeItem(),u({event:"ui.click.app.button_suggestion_x"})},clickButtonNavigateToDetail:function(e){e.stopPropagation(),v.getInstance().navigateTo(h.format(f.enums.URL_WANDOUJIA_APP_DETAIL_PAGE,this.model.get("app").packageName,this.model.get("app").detailParam))},clickButtonNavigateToRefPage:function(){v.getInstance().navigateTo(h.format(f.enums.URL_WANDOUJIA_APP_DETAIL_PAGE,this.model.get("recReason").packageName,this.model.get("recReason").detailParam))},events:{"click .button-install":"clickButtonInstall","click .button-dislike":"clickButtonDislike","click .button-navigate-to-detail":"clickButtonNavigateToDetail","click .button-navigate-to-ref-page":"clickButtonNavigateToRefPage"}}),g=function(e){var t=this.modelsPool,n=t.length,r=o.map(t,function(e){return e.get("packageName")});this.modelsPool=t=t.concat(this.collection.filter(function(e){return r.indexOf(e.get("packageName"))<0})),n===0&&t.length>0&&this.buildList()},y=function(){this.$(".tip").html(a.app.GET_RECOMMEND_ERROR)},b,w=function(){if(this.modelsPool.length>0){var e=b.call(this);this.$(".list").append(e)}},E=function(e){this.modelsPool.length<=10&&this.collection.trigger("update"),this.items.splice(this.items.indexOf(e),1),w.call(this)},S=function(){this.$("li").length===0&&this.$(".tip").html(a.app.RECOMMEND_LIST_EMPTY).show()};b=function(){var e=new m({model:this.modelsPool.shift().set({isDefaultPanel:this.model===n},{silent:!0})});return e.once("remove",E,this),e.once("removed",S,this),this.items.push(e),e.render().$el};var x=function(e){var t=this.$(".tip");e.length===0?t.html(a.app.RECOMMEND_LIST_EMPTY):t.hide()},T=function(){var e=this.$(".tip");this.collection.loading?(e.html(a.app.GETTING_RECOMMEND).show(),this.collection.once("refresh",x,this)):this.collection.length===0?e.html(a.app.RECOMMEND_LIST_EMPTY).show():this.buildList()},N=r.View.extend({template:i.template(l.get("app","app-recommend-list")),className:"w-app-recommend-list",initialize:function(){var e=[],t=[];Object.defineProperties(this,{modelsPool:{set:function(t){t instanceof Array&&(e=t)},get:function(){return e}},items:{set:function(e){t=e},get:function(){return t}}}),this.model?this.collection=p.getInstance("app",this.model.get("base_info").package_name):this.collection=p.getInstance("app"),this.listenTo(this.collection,"refresh",g),this.listenTo(this.collection,"updateFailed",y,this)},render:function(){this.$el.html(this.template({}));var e=this.$("h3");return this.model?e.html(a.app.RECOMMENDATION):e.html(a.app.RECOMMENDATION_DEFAULT),setTimeout(T.bind(this),0),this},buildList:function(){var e=this.modelsPool,n=this.$(".list").empty(),r=t.createDocumentFragment(),i;for(i=0;i<8;i++){if(!(e.length>0))break;r.appendChild(b.call(this)[0])}n.append(r)},remove:function(){o.each(this.items,function(e){e.model.trigger("remove"),e.model.clear({silent:!0})}),this.items=[],this.modelsPool.length=0,this.collection.reset([],{silent:!0}),N.__super__.remove.call(this)}}),C=o.extend({getInstance:function(e){return new N(e)}});return C})}(this,this.document),function(e,t){define("app/views/OneKeyUpdateWindowView",["backbone","doT","jquery","underscore","Internationalization","ui/Panel","ui/UIHelper","ui/behavior/ButtonSetMixin","ui/TemplateFactory","ui/SmartList","utilities/StringUtil","Configuration","FunctionSwitch","app/collections/AppsCollection","app/views/AppItemView","task/TaskService","social/SocialService","Account","Settings"],function(e,n,r,i,s,o,u,a,f,l,c,h,p,d,v,m,g,y,b){console.log("OneKeyUpdateWindowView - File loaded.");var w=u.EventsMapping,E,S,x=e.View.extend({template:n.template(f.get("app","one-key-update-body")),className:"w-app-one-key-update vbox",initialize:function(){S=S||d.getInstance(),this.listenTo(S,"refresh",function(e){E!==t&&E.switchSet("default",e.getUpdatableApps)})},render:function(){return this.$el.html(this.template({})),E=new l({itemView:v.getClass(),dataSet:[{name:"default",getter:S.getUpdatableApps}],keepSelect:!1,$observer:this.$(".check-select-all"),$header:this.$("header"),itemHeight:45,listenToCollection:S}),this.listenTo(E,"select:change",this.refreshMonitor),this.$(".w-smart-list-header").after(E.render().$el),this.refreshMonitor(),E.selectAll(),this},refreshMonitor:function(){this.$(".w-smart-list-footer").html(c.format(s.misc.SELECTOR_DESCRIPTION_TEXT,E.selected.length,E.currentModels.length))},remove:function(){E.remove(),x.__super__.remove.call(this)}}),T=o.extend({initialize:function(){T.__super__.initialize.apply(this,arguments),Object.defineProperties(this,{selected:{get:function(){return E.selected}}}),this.on(w.SHOW,function(){var e=new x;this.$bodyContent=e.render().$el,this.center(),this.once("remove",e.remove,e)},this),this.on(w.BUTTON_YES,this.updateAllApps,this)},render:function(){i.extend(this.events,T.__super__.events),this.delegateEvents(),T.__super__.render.call(this),p.ENABLE_SHARE_ONE_KEY_UPDATE&&(this.$(".w-ui-window-footer-monitor").prepend('<label><input class="check-share" type="checkbox"/>'+s.common.SHARE_ONE_KEY_UPDATE_SYNC+"</label>"),y.get("isLogin")&&this.$(".check-share").prop("checked",b.get("social.share_one_key_update.sync")==="on"))},updateAllApps:function(){var e=[],t=i.map(E.selected,function(t){var n=S.get(t);n.set({isUpdating:!0}),n.unignoreUpdateAsync(),e.push(n.get("base_info").package_name);var r=n.updateInfo.clone();return{downloadUrl:r.get("downloadUrl"),title:r.get("title"),iconSrc:r.get("iconPath"),versionName:r.get("versionName"),versionCode:r.get("versionCode"),size:r.get("size"),packageName:r.get("packageName")}},this);m.batchDownloadAsync(t,"one-key-update");if(e.length>0&&this.$(".check-share").prop("checked")){var n={textUrl:c.format(h.enums.SOCIAL_TEXT_PREVIEW_POST_URL,h.enums.SOCIAL_ONE_KEY_UPDATE),textData:{content:e.join()},hasPreview:!1,shareData:{need_shell:0,rotation:0},extraData:{apps:e},type:h.enums.SOCIAL_ONE_KEY_UPDATE};g.setContent(n),g.show()}},clickCheckShare:function(e){y.get("isLogin")?r(e.target).prop("checked")?b.set("social.share_one_key_update.sync","on"):b.set("social.share_one_key_update.sync","off"):(e.preventDefault(),y.loginAsync())},events:{"click .check-share":"clickCheckShare"}}),N,C=i.extend({getInstance:function(){return N||(N=new T({buttonSet:a.BUTTON_SET.YES_CANCEL,title:s.app.ONE_KEY_UPDATE_TITLE,width:630,draggable:!0})),N}});return C})}(this),function(e,t){define("app/views/OneKeyMoveWindowView",["backbone","doT","underscore","Internationalization","ui/Panel","ui/UIHelper","ui/behavior/ButtonSetMixin","ui/TemplateFactory","ui/SmartList","utilities/StringUtil","Configuration","app/collections/AppsCollection","app/views/AppItemView","app/AppService"],function(e,n,r,i,s,o,u,a,f,l,c,h,p,d){console.log("OneKeyMoveWindowView - File loaded.");var v=o.EventsMapping,m,g,y=e.View.extend({template:n.template(a.get("app","one-key-move-body")),className:"w-app-one-key-move vbox",initialize:function(){g=g||h.getInstance(),this.listenTo(g,"refresh",function(e){m!==t&&m.switchSet("default",e.getSuggestMoveApps)})},render:function(){return this.$el.html(this.template({})),m=new f({itemView:p.getClass(),dataSet:[{name:"default",getter:g.getSuggestMoveApps}],keepSelect:!1,$observer:this.$(".check-select-all"),$header:this.$("header"),itemHeight:45,listenToCollection:g}),this.listenTo(m,"select:change",this.refreshMonitor),m.selectAll(),this.$(".w-smart-list-header").after(m.render().$el),this.refreshMonitor(),this},refreshMonitor:function(){this.$(".w-smart-list-footer").html(l.format(i.misc.SELECTOR_DESCRIPTION_TEXT,m.selected.length,m.currentModels.length))},remove:function(){m.remove(),y.__super__.remove.call(this)}}),b=s.extend({initialize:function(){b.__super__.initialize.apply(this,arguments),Object.defineProperties(this,{selected:{get:function(){return m.selected}}}),this.on(v.SHOW,function(){var e=new y;this.$bodyContent=e.render().$el,this.center(),this.once("remove",e.remove,e)},this),this.on(v.BUTTON_YES,this.moveAllApps,this)},moveAllApps:function(){m.selected.length>0&&d.batchMoveToSDCardAsync(m.selected)}}),w,E=r.extend({getInstance:function(){return w||(w=new b({buttonSet:u.BUTTON_SET.YES_CANCEL,title:i.app.ONE_KEY_TRANSFER_TITLE,width:630,draggable:!0})),w}});return E})}(this),function(e,t){define("app/views/DefaultPanelView",["backbone","doT","IO","underscore","Log","Internationalization","Device","Account","Configuration","FunctionSwitch","ui/TemplateFactory","ui/AlertWindow","utilities/StringUtil","app/collections/AppsCollection","app/views/RecommendView","app/views/OneKeyUpdateWindowView","app/views/OneKeyMoveWindowView"],function(t,n,r,i,s,o,u,a,f,l,c,h,p,d,v,m,g){console.log("DefaultPanelView - File loaded.");var y=e.setTimeout,b,w=t.View.extend({template:n.template(c.get("app","default-panel")),className:"w-app-default-panel",initialize:function(){b=d.getInstance(),b.on("refresh",this.renderButtons,this),l.on("change",this.renderButtons,this),u.on("change",this.setButtonState,this)},setButtonState:function(e){this.$(".button-transfer-all").prop({disabled:!e.get("hasSDCard")||e.get("isMounted")||e.get("hasEmulatedSD")||!e.get("isConnected")})},renderButtons:function(){var e=this.$(".update-all"),t=l.ENABLE_APP_UPGRADE?b.getUpdatableApps().length:0;t>0&&l.ENABLE_APP_UPGRADE?(e.find("button .label").html(p.format(o.app.ONE_KEY_UPDATE,t)),e.find(".des").html(p.format(o.app.ONE_KEY_UPDATE_DES,t)),e.show()):e.hide();var n=this.$(".transfer-all"),r=b.getSuggestMoveApps().length;r>0?(n.find("button").html(p.format(o.app.ONE_KEY_TRANSFER,r)),n.show()):n.hide(),l.ENABLE_APP_WASH||(r===0?this.$(".notifier-ctn").hide():this.$(".notifier-ctn").show())},render:function(){return this.$el.html(this.template({})),l.ENABLE_APP_RECOMMEND&&this.$el.append(v.getInstance().render().$el),l.ENABLE_APP_WASH||this.$(".wash").remove(),this.renderButtons(b),this.setButtonState(u),this},clickButtonTransferAll:function(){var e=g.getInstance();e.show();var t=function(){e.selected.length>0&&(this.$(".button-transfer-all").text(o.app.APPS_TRANSFER_PROCESSING_TEXT),y(function(){this.renderButtons(b)}.bind(this),3e3))};e.once("button_yes",t,this),s({event:"ui.click.app.move.all"})},clickButtonUpdateAll:function(){var e=m.getInstance();e.show();var t=function(){e.selected.length>0&&(this.$(".button-update-all .label").text(o.app.UPDATEING_ALL),y(function(){this.renderButtons(b)}.bind(this),3e3))};e.once("button_yes",t,this),s({event:"ui.click.app.update.all"})},clickButtonWash:function(){r.requestAsync({url:f.actions.PUBLISH_EVENT,data:{channel:f.events.WEB_NAVIGATE,value:JSON.stringify({type:f.enums.NAVIGATE_TYPE_APP_WASH})}})},events:{"click .button-transfer-all":"clickButtonTransferAll","click .button-update-all":"clickButtonUpdateAll","click .button-wash":"clickButtonWash"}}),E,S=i.extend({getInstance:function(){return E||(E=new w),E}});return S})}(this),function(e,t){define("app/views/CommentaryView",["backbone","doT","jquery","underscore","ui/UIHelper","ui/TemplateFactory","ui/PopupTip","utilities/StringUtil","Configuration","Internationalization","IO","Account","social/SocialService","social/views/SocialPlatformSelectorView"],function(t,n,r,i,s,o,u,a,f,l,c,h,p,d){console.log("CommentaryView - File loaded");var v=e.setTimeout,m=t.View.extend({className:"w-app-commentary",template:n.template(o.get("app","application-commentary")),initialize:function(){this.listenTo(h,"change:isLogin",this.initState),this.listenTo(this.model,"change:web_info",this.render)},render:function(){return this.$el.html(this.template(this.model.toJSON())),this.initState(h),i.each(this.$(".button-like, .button-dislike"),function(e){var t=new u({$host:r(e)})}),this.socialPlatformSelectorView&&this.socialPlatformSelectorView.remove(),this.socialPlatformSelectorView=d.getInstance(),this.$(".comment-actions").prepend(this.socialPlatformSelectorView.render().$el),this},remove:function(){this.socialPlatformSelectorView.remove(),m.__super__.remove.call(this)},initState:function(e){this.$(".input-content").prop({disabled:!e.get("isLogin")}),e.get("isLogin")?this.model.getCommentaryAsync().done(function(e){var t=e.body.authorFavorite;t==="YES"?this.$(".button-like").addClass("checked primary"):t==="NO"&&this.$(".button-dislike").addClass("checked primary");var n=e.body.content||"";n&&n.trim().length>0&&(this.$(".input-content").val(n),this.$(".button-send").html(l.app.MODIFY))}.bind(this)):(this.$(".input-content").val(""),this.$(".button-like").removeClass("checked primary"),this.$(".button-dislike").removeClass("checked primary"))},sendCommentaryAsync:function(e,t){var n=r.Deferred();return c.requestAsync({tyep:"POST",url:f.actions.APP_COMMENTARY,data:{package_name:this.model.get("base_info").package_name,content:e,title:this.model.get("base_info").name,share:this.socialPlatformSelectorView.getActivePlatformString(),version_code:this.model.get("base_info").version_code,verify_code:t||""},success:function(e){e.state_code===200?(console.log("CommentaryView - Send application commentary success."),n.resolve(e)):(console.error("CommentaryView - Send application commenrary faild. Error info: "+e.state_line),n.reject(e))}.bind(this)}),n.promise()},handleCommentaryAsync:function(){var e=r.Deferred(),t=this.$(".input-content"),n=t.val().trim();return n.length===0?t.focus():(this.$(".button-send").prop({disabled:!0}),t.prop({disabled:!0}),this.sendCommentaryAsync(n,this.$(".code-ctn .input-code").val()).done(function(){this.$(".monitor").html(l.app.SEND_SUCCESS),this.$(".button-send").html(l.app.MODIFY),this.$(".code-ctn").slideUp(),e.resolve()}.bind(this)).fail(function(e){e.state_code===744&&(this.getVerifyCodeAsync().done(function(e){this.$("img").attr({src:"data:image/png;base64,"+e})}.bind(this)),this.$(".code-ctn").slideDown()),this.$(".monitor").html(l.app.SEND_FAILED)}.bind(this)).always(function(){this.$(".button-send").prop({disabled:!1}),t.prop({disabled:!1}),this.socialPlatformSelectorView.$el.hide(),v(function(){this.$(".monitor").html(""),this.socialPlatformSelectorView.$el.show()}.bind(this),3e3),e.reject()}.bind(this))),e.promise()},getVerifyCodeAsync:function(){var e=r.Deferred();return r.ajax("http://apps.wandoujia.com/api/v1/comments/base64captcha").done(function(t){e.resolve(t)}).fail(function(){e.reject()}),e.promise()},clickButtonSend:function(){this.handleCommentaryAsync()},clickButtonLike:function(){if(!h.get("isLogin"))h.loginAsync("","app-commentary");else{var e=this.$(".button-like"),t=this.$(".like-count"),n=parseInt(t.html(),10);e.hasClass("checked")?(this.model.markEnjoyStateAsync("UNKNOW").done(),t.html(Math.max(--n,0)),e.removeClass("checked primary")):(this.model.markEnjoyStateAsync("YES").done(),e.addClass("checked primary"),t.html(++n),this.$(".button-dislike").removeClass("checked primary"))}},clickButtonDislike:function(){if(!h.get("isLogin"))h.loginAsync("","app-commentary");else{var e=this.$(".button-dislike");if(!e.hasClass("checked")){this.model.markEnjoyStateAsync("NO").done(),e.addClass("checked primary");var t=this.$(".button-like");if(t.hasClass("checked")){var n=this.$(".like-count"),r=parseInt(n.html(),10);n.html(Math.max(--r,0))}t.removeClass("checked primary")}else this.model.markEnjoyStateAsync("UNKNOW").done(),e.removeClass("checked primary")}},clickButtonLogin:function(){h.loginAsync("","app-commentary")},keydownInputContent:function(e){e.ctrlKey&&e.keyCode===s.KeyMapping.ENTER&&this.handleCommentaryAsync()},clickButtonShare:function(){var e=this.model.get("base_info"),t=p.getPreviewContentSize(),n=r("<img/>").attr("src",a.format(f.enums.SOCIAL_APP_BIO_URL,e.package_name)).css({"max-width":t.width}),i={textUrl:a.format(f.enums.SOCIAL_TEXT_PREVIEW_URL,f.enums.SOCIAL_APP,e.package_name),hasPreview:!0,previewContent:n,shareData:{need_shell:0,pic:a.format(f.enums.SOCIAL_APP_BIO_URL,e.package_name),rotation:0},extraData:{app_title:e.name,app_package_name:e.package_name},type:f.enums.SOCIAL_APP};p.setContent(i),p.show()},clickButtonComment:function(){h.get("isLogin")?(this.$(".input-ctn").slideToggle("fast"),this.$(".button-comment").toggleClass("active")):h.loginAsync("","app-commentary")},clickCode:function(){this.getVerifyCodeAsync().done(function(e){this.$("img").attr({src:"data:image/png;base64,"+e})}.bind(this))},events:{"click .button-comment":"clickButtonComment","click .button-send":"clickButtonSend","click .button-like":"clickButtonLike","click .button-dislike":"clickButtonDislike","click .button-login":"clickButtonLogin","click .button-share":"clickButtonShare","click .code":"clickCode","keydown .input-content":"keydownInputContent"}}),g=i.extend(function(){},{getInstance:function(e){return new m(e)},getClass:function(){return m}});return g})}(this),function(e,t){define("social/views/QuickShareView",["backbone","underscore","doT","jquery","ui/TemplateFactory","ui/ToastBox","utilities/StringUtil","Configuration","Internationalization","Log","IO","Settings","social/SocialService"],function(e,t,n,r,i,s,o,u,a,f,l,c,h){console.log("QuickShareView - File loaded. ");var p=e.View.extend({className:"w-quick-share-ctn hbox",template:n.template(i.get("social","uninstall-share")),render:function(){return this.$el.html(this.template({items:[{id:"uninstall-ads",name:a.misc.REVIEW_FOR_UNINSTALL_ADS},{id:"uninstall-traffic",name:a.misc.REVIEW_FOR_UNINSTALL_TRAFFIC},{id:"uninstall-memory",name:a.misc.REVIEW_FOR_UNINSTALL_MEMORY},{id:"uninstall-other",name:a.misc.REVIEW_FOR_UNINSTALL_OTHER}]})),this},clickItem:function(e){var t=r(e.target).data("id"),n=this.model.get("base_info").name,i=this.model.get("base_info").package_name,s={textUrl:o.format(u.enums.SOCIAL_TEXT_PREVIEW_POST_URL,u.enums.SOCIAL_UNINSTALL_APP),textData:{content:JSON.stringify({uninstall_reason:t,app_title:n,app_package_name:i})},hasPreview:!1,shareData:{need_shell:0,rotation:0},extraData:{uninstall_reason:t,app_title:n,app_package_name:i},type:u.enums.SOCIAL_UNINSTALL_APP};h.setContent(s),h.show()},events:{"click li":"clickItem"}}),d=s.extend({initialize:function(){d.__super__.initialize.apply(this,arguments),this.$content=(new p({model:this.model})).render().$el},show:function(){d.__super__.show.apply(this),f({event:"social.show_uninstall_app_toast"})}}),v=t.extend({getInstance:function(e){return new d(e)}});return v})}(this),function(e){define("app/views/DetailPanelView",["backbone","doT","jquery","underscore","Log","Device","Configuration","IOBackendDevice","ui/TemplateFactory","ui/AlertWindow","Internationalization","FunctionSwitch","utilities/StringUtil","task/TaskService","app/collections/AppsCollection","app/collections/WebAppsCollection","app/views/CommentaryView","app/views/RecommendView","social/views/QuickShareView","app/AppService","browser/views/BrowserModuleView","task/collections/TasksCollection"],function(t,n,r,i,s,o,u,a,f,l,c,h,p,d,v,m,g,y,b,w,E,S){console.log("DetailPanelView - File loaded.");var x=e.alert,T=e.setTimeout,N,C,k=t.View.extend({template:n.template(f.get("app","detail-panel")),className:"w-app-detail-panel",initialize:function(){var e=function(e,t){var n=e.get("isWeb")?this.$(".app-info .button-install"):this.$(".app-info .button-update");t?n.html(e.get("isWeb")?c.app.INSTALLING:c.app.UPDATING).prop({disabled:!0}):n.html(e.get("isWeb")?c.app.INSTALL:c.app.UPDATE).prop({disabled:!1})};Object.defineProperties(this,{updatingHandler:{get:function(){return e}}}),N=v.getInstance(),C=m.getInstance(),N.on("refresh",function(e){var t=e.get(this.model.id);t&&this.model.set("base_info",t.get("base_info"))},this),o.on("change",this.setButtonState,this),h.on("change",this.setButtonState,this),a.Backend.Device.onmessage({"data.channel":u.events.TASK_STATUS_CHANGE},function(e){if(e.message==="INSTALL_SUCCESS"){var t=S.getInstance().get(e.id).get("detail");this.model.get("base_info").package_name===t&&this.$(".button-update").hide()}},this)},setButtonState:function(){this.$(".button-update, .latest-version, .button-navigate-to-version").toggle(h.ENABLE_APP_UPGRADE),this.$(".button-uninstall").prop("disabled",!o.get("isConnected")),this.$(".button-move-to-device").toggle(!(!o.get("isConnected")||o.get("isMounted")||!o.get("hasSDCard")||o.get("hasEmulatedSD")||N.ableMoveToDevice([this.model.id]).length===0)),this.$(".button-move-to-sd-card").toggle(!(!o.get("isConnected")||o.get("isMounted")||!o.get("hasSDCard")||o.get("hasEmulatedSD")||N.ableMoveToSD([this.model.id]).length===0))},render:function(){var e=this.$el.parent();e[0]&&this.$el.detach(),this.$el.html(this.template(this.model.toJSON())),!this.model.isSystem&&h.ENABLE_APP_COMMENT&&this.model.get("detail_page_info")&&!this.model.get("isWeb")&&(this.commentaryView&&this.commentaryView.remove(),this.commentaryView=g.getInstance({model:this.model}),this.$el.append(this.commentaryView.render().$el));var t=this.$(".button-update");return((o.get("isWifi")||o.get("isInternet"))&&!this.model.isUpdatable||!h.ENABLE_APP_UPGRADE)&&t.hide(),this.model.get("isUpdating")&&t.html(this.model.get("isWeb")?c.app.INSTALLING:c.app.UPDATING).prop({disabled:!0}),h.ENABLE_APP_RECOMMEND&&(this.recommendView&&this.recommendView.remove(),this.recommendView=y.getInstance({model:this.model}),this.$el.append(this.recommendView.render().$el)),T(this.setButtonState.bind(this),0),this.renderIcon(),e[0]&&e.append(this.$el),this},renderIcon:function(){var t=this.model.get("base_info").icon;if(t&&!/^file:\/\/\//.test(t)){var n=r(new e.Image),i=function(){this.model.get("base_info").icon===n.data("path")&&this.$(".app-info .icon img").attr({src:n[0].src}),n.remove()}.bind(this),s=function(){n.remove()};n.one("load",i),n.one("error",s),n.attr({src:t}).data("path",t),this.$(".app-info .icon img").attr({src:u.enums.TASK_DEFAULT_ICON_PATH_APP})}},update:function(e){if(!this.model||e!==this.model.id){this.model&&(this.model.off("change:isUpdating",this.updatingHandler),this.model.off("change:base_info",this.render)),this.model=N.get(e)||C.get(e);if(this.model.get("isWeb")){var t=this.model.id;this.model.queryAppInfoAsync().done(function(){t===this.model.id&&this.render()}.bind(this))}else this.render();this.model.on("change:isUpdating",this.updatingHandler,this),this.model.on("change:base_info",this.render,this)}},clickButtonTogglePermisson:function(){var e=this.$(".permission-list.unimportant"),t=this.$(".button-toggle-permission .link"),n=this.$(".arrow");e.hasClass("expend")?(e.removeClass("expend").slideUp("fast"),t.text(c.app.MORE),n.css({"-webkit-transform":"rotate(90deg)"})):(e.addClass("expend").slideDown("fast"),t.text(c.app.COLLAPSE),n.css({"-webkit-transform":"rotate(-90deg)"}))},clickButtonUpdate:function(){var e=this.model.updateInfo.set({source:"update-button-detail-panel"},{silent:!0});d.addTask(u.enums.TASK_TYPE_INSTALL,u.enums.MODEL_TYPE_APPLICATION,e),this.model.unignoreUpdateAsync(),this.model.set({isUpdating:!0}),s({event:"ui.click.app.button.update",source:"detail"})},clickButtonUninstall:function(){var e=this.model,t=e.get("base_info");if(t.is_critical_app)x(p.format(c.app.ALERT_TIP_CRITICAL_APP,t.name));else{var n=new l({draggable:!0,disposableName:"app-uninstall-app-in-detail-panel",buttonSet:"yes_no",$bodyContent:e.isSystem?c.app.CONFIRM_UNINSTALL_SYSTEM_APP:c.app.CONFIRM_UNINSTALL});n.once("button_yes",function(){e.uninstallAsync().done(function(t){(o.get("isWifi")||o.get("isInternet"))&&!e.isSystem&&x(c.app.ALERT_TIP_UNINSTALL_WIFI_CONFIRM);var n=t.body.failed;n&&n.length>0?n[0].item===this.model.id&&x(e.isSystem?c.app.UNINSTALL_FAILED+c.app.UNINSTALL_FAILED_SYSTEM_APP:c.app.UNINSTALL_FAILED):(t.body.success[0].item===this.model.id&&this.trigger("hide"),h.ENABLE_SHARE_UNINSTALL&&b.getInstance({model:e}).show())}.bind(this)).fail(function(){x(e.isSystem?c.app.UNINSTALL_FAILED+c.app.UNINSTALL_FAILED_SYSTEM_APP:c.app.UNINSTALL_FAILED)}.bind(this)),this.$(".button-uninstall").prop({disabled:!0})},this),n.show()}s({event:"ui.click.app.button.uninstall",source:"detail"})},clickButtonNavigateToDetail:function(){E.getInstance().navigateTo(this.model.get("detail_page_info"))},clickButtonMoveToSDCard:function(){w.batchMoveToSDCardAsync([this.model.id])},clickButtonMoveToDevice:function(){w.batchMoveToDeviceAsync([this.model.id])},clickButtonNavigateToCategory:function(e){var t="http://apps.wandoujia.com/category/";E.getInstance().navigateTo(t+r(e.currentTarget).data("cate"))},clickButtonNavigateToVersion:function(){var e="http://apps.wandoujia.com/apps/{1}/versions?pos=client/detail-panel";E.getInstance().navigateTo(p.format(e,this.model.get("base_info").package_name))},clickButtonInstall:function(){var e=new t.Model(i.extend(this.model.get("downloadInfo"),{source:"detail-panel-web-app"}));d.addTask(u.enums.TASK_TYPE_INSTALL,u.enums.MODEL_TYPE_APPLICATION,e),this.model.set({isUpdating:!0}),this.model.unignoreUpdateAsync(),s({event:"ui.click.app.button.install",source:"detail-panel"})},events:{"click .button-toggle-permission":"clickButtonTogglePermisson","click .button-update":"clickButtonUpdate","click .button-uninstall":"clickButtonUninstall","click .button-install":"clickButtonInstall","click .button-navigate-to-detail":"clickButtonNavigateToDetail","click .button-move-to-sd-card":"clickButtonMoveToSDCard","click .button-move-to-device":"clickButtonMoveToDevice","click .button-navigate-to-category":"clickButtonNavigateToCategory","click .button-navigate-to-version":"clickButtonNavigateToVersion"}}),L,A=i.extend({getInstance:function(){return L||(L=new k),L}});return A})}(this),function(e,t){define("app/views/BatchAppsView",["backbone","doT","jquery","underscore","Internationalization","Device","Log","ui/TemplateFactory","ui/SmartList","utilities/StringUtil","app/collections/AppsCollection","app/collections/WebAppsCollection","app/views/AppItemView","app/views/AppListView","app/AppService"],function(e,t,n,r,i,s,o,u,a,f,l,c,h,p,d){console.log("BatchAppsView - File loaded.");var v={APP_LIST_CTN:".w-app-batch-list-ctn"},m,g,y,b=e.View.extend({className:"w-app-batch vbox",template:t.template(u.get("app","batch-apps")),initialize:function(){g=g||l.getInstance(),y=y||c.getInstance()},render:function(){return this.$el.html(this.template({})),this},update:function(e){this.$(".title .count").html(f.format(i.app.BATCH_APP_TITLE,e.length)),m?m.switchSet("default",function(){return r.map(e,function(e){return g.get(e)})}):(m=new a({itemView:h.getClass(),dataSet:[{name:"default",getter:function(){return r.map(e,function(e){return g.get(e)})}}],keepSelect:!1,itemHeight:45,selectable:!1,listenToCollection:g}),this.$(v.APP_LIST_CTN).append(m.render().$el))},clickButtonDeselect:function(){p.getInstance().list.deselectAll()},clickItemButtonClose:function(e){var t=n(e.currentTarget).data("id").toString();p.getInstance().list.removeSelect(t)},events:{"click .button-deselect":"clickButtonDeselect","click .w-app-list-item .button-close":"clickItemButtonClose"}}),w,E=r.extend({getInstance:function(){return w||(w=new b),w}});return E})}(this),function(e,t){define("app/views/AppPanelView",["backbone","underscore","ui/TemplateFactory","utilities/StringUtil","app/views/DefaultPanelView","app/views/DetailPanelView","app/views/BatchAppsView","app/views/AppListView"],function(e,t,n,r,i,s,o,u){console.log("AppPanelView - File loaded.");var a={DEFAULT_PANEL:".w-app-default-panel",DETAIL_PANEL:".w-app-detail-panel",BATCH_PANEL:".w-app-batch"},f,l,c,h=e.View.extend({className:"w-app-panel",initialize:function(){u.getInstance().on("select:change",function(e){e.length!==0?e.length>1?this.switchTo("batch",e):this.switchTo("detail",e[0]):this.switchTo("default")},this)},render:function(){return l=i.getInstance(),this.$el.append(l.render().$el),this},switchTo:function(e,t){this.$([a.DEFAULT_PANEL,a.DETAIL_PANEL,a.BATCH_PANEL].join(",")).hide();switch(e){case"default":this.$(a.DEFAULT_PANEL).show();break;case"detail":f?(f.update(t),this.$(a.DETAIL_PANEL).show()):(f=s.getInstance(),f.update(t),this.$el.append(f.$el),f.on("hide",function(){this.switchTo("default")},this));break;case"batch":c?(this.$(a.BATCH_PANEL).show(),c.update(t)):(c=o.getInstance(),this.$el.append(c.render().$el),c.update(t),c.on("hide",function(){this.switchTo("default")},this))}}}),p,d=t.extend({getInstance:function(){return p||(p=new h),p}});return d})}(this),function(e,t){define("app/views/LocalInstallWindowView",["backbone","doT","jquery","underscore","Log","ui/Panel","ui/TemplateFactory","ui/AlertWindow","ui/SmartList","utilities/StringUtil","IOBackendDevice","Configuration","FunctionSwitch","Internationalization","app/AppService","app/views/AppItemView","app/models/AppModel","task/TaskService"],function(n,r,i,s,o,u,a,f,l,c,h,p,d,v,m,g,y,b){console.log("LocalInstallWindowView - File loaded.");var w=e.alert,E,S,x=n.View.extend({template:r.template(a.get("app","local-install-monitor")),tagName:"label",className:"w-app-local-install-footer",render:function(){return this.$el.html(this.template({})),this}}),T,N=n.View.extend({template:r.template(a.get("app","local-install-body")),className:"w-app-local-install vbox",initialize:function(){this.collection=new n.Collection,T=T||new f({$bodyContent:v.app.ADDING_LOCAL_APK})},render:function(){return this.$el.html(this.template({})),E=new l({itemView:g.getClass(),dataSet:[{name:"default",getter:function(){return[]}}],keepSelect:!1,$observer:this.$(".check-select-all"),$header:this.$("header"),itemHeight:45,listenToCollection:this.collection,emptyTip:v.app.APP_SELECT_GRID_TIP,enableDragAndDrop:!0}),this.listenTo(E,"select:change",function(){S!==t&&this.$(".w-smart-list-footer").html(c.format(v.misc.SELECTOR_DESCRIPTION_TEXT,E.selected.length,E.currentModels.length))}),this.listenTo(E,"drop",function(t){var n=s.filter(e.client.drag_files,function(e){return/\.(wd)?apk$/.test(e)});n.length&&m.selectAppsDetailAsync(n.join("|")).done(this.parseApps.bind(this))}),this.$(".w-smart-list-header").after(E.render().$el),E.emptyTip=v.app.APP_SELECT_GRID_TIP,m.hasAutoBackupAsync().done(function(e){d.ENABLE_WDAPK&&e.body.value&&(E.emptyTip+=v.app.APP_SELECT_GRID_TIP_BACKUP)}),this.$(".w-smart-list-footer").html(c.format(v.misc.SELECTOR_DESCRIPTION_TEXT,0,0)),this},remove:function(){E.remove(),N.__super__.remove.call(this)},parseApps:function(e){var n=[],r=[];s.each(e.body.app,function(e){e.package_name?n.push(new y({base_info:e,upgrade_info:{},id:e.package_name+e.version_code})):r.push(" - "+e.name+"<br />")}),r.length>0&&w(v.app.APPS_INSTALL_FAILED+"<br />"+r.join(""));var i=[];s.each(n,function(e){var n=this.collection.get(e.id);n!==t?n.set(e.toJSON()):this.collection.add(e),i.push(e.id)},this),E.switchSet("default",function(){return this.collection.models}.bind(this)),E.addSelect(i)},selectApps:function(e){T.show(),m.selectAppsAsync(e).done(this.parseApps.bind(this)).always(function(){T.close()})},clickButtonAddFile:function(){this.selectApps(0)},clickButtonAddFolder:function(){this.selectApps(1)},clickButtonImportBackup:function(){T.show(),m.loadAutoBackupAsync().done(this.parseApps.bind(this)).fail(function(){E.emptyTip=E.emptyTip.replace(v.app.APP_SELECT_GRID_TIP_BACKUP,"")}).always(function(){setTimeout(function(){T.close()},0)}),o({event:"ui.click.app.button.auto.improt.backup"})},events:{"click .button-add-file":"clickButtonAddFile","click .button-add-folder":"clickButtonAddFolder","click .button-import-backup":"clickButtonImportBackup"}}),C,k=u.extend({initialize:function(){k.__super__.initialize.apply(this,arguments),this.buttons=[{$button:i("<button>").addClass("primary").html(v.app.BUTTON_INSTALL_LABEL),eventName:"button_install"},{$button:i("<button>").html(v.ui.CANCEL),eventName:"button_cancel"}],this.on("show",function(){C=new N,this.$bodyContent=C.render().$el,S=new x,this.$(".w-ui-window-footer-monitor").append(S.render().$el),this.once("remove",function(){C.remove(),S.remove()},this)},this),this.on("button_install",this.install,this)},install:function(){var e=this.$(".check-delete-when-finish")[0].checked;s.each(E.selected,function(t){var r=C.collection.get(t),i=r.get("base_info"),o=s.extend(i,{iconPath:i.icon,title:i.name,should_delete:e});b.addTask(p.enums.TASK_TYPE_LOCAL_INSTALL,p.enums.MODEL_TYPE_APPLICATION,new n.Model(o))}),this.close()}}),L,A=s.extend({getInstance:function(){return L||(L=new k({title:v.app.BUTTON_ADD_APP_LABEL,height:480,width:630})),L}});return A})}(this),function(e,t,n){define("app/views/AppModuleToolbarView",["backbone","underscore","doT","jquery","ui/TemplateFactory","ui/Toolbar","ui/AlertWindow","ui/MenuButton","utilities/StringUtil","Internationalization","FunctionSwitch","Configuration","Device","Settings","Log","Account","app/views/AppListView","app/views/AppPanelView","app/views/LocalInstallWindowView","social/views/QuickShareView","app/collections/AppsCollection","app/collections/WebAppsCollection","app/AppService","task/TaskService"],function(t,r,i,s,o,u,a,f,l,c,h,p,d,v,m,g,y,b,w,E,S,x,T,N){console.log("AppModuleToolbarView - File loaded.");var C=e.alert,k=e.confirm,L,A,O=u.extend({template:i.template(o.get("app","toolbar")),initialize:function(){d.on("change",this.setButtonState,this),h.on("change",function(e){this.$(".button-update").toggle(e.ENABLE_APP_UPGRADE)},this),A=S.getInstance(),A.on("refresh",this.setButtonState,this)},setButtonState:function(){var t=L.selected,n=L.list?L.list.currentSet.name:"";this.$(".button-uninstall").prop({disabled:!d.get("isConnected")||t.length===0||(A.isSystemApp(t).length===0?!1:!d.get("isRoot"))||n==="web"}),this.$(".button-update").prop({disabled:t.length===0||(e.SnapPea.CurrentModule==="app"&&e.SnapPea.CurrentTab==="ignore"?A.ableToUpdateIncludeIgnored(t).length===0:A.ableToUpdate(t).length===0)||n==="web"}),this.$(".button-export").prop({disabled:!d.get("isConnected")||t.length===0||n==="web"}),this.$(".button-move-to-device").prop({disabled:!d.get("isConnected")||d.get("isMounted")||!d.get("hasSDCard")||d.get("hasEmulatedSD")||t.length===0||A.ableMoveToDevice(t).length===0||n==="web"}),this.$(".button-move-to-sd-card").prop({disabled:!d.get("isConnected")||d.get("isMounted")||!d.get("hasSDCard")||d.get("hasEmulatedSD")||t.length===0||A.ableMoveToSD(t).length===0||n==="web"}),n==="web"?this.$(".button-refresh").prop({disabled:!1}):this.$(".button-refresh").prop({disabled:!d.get("isConnected")})},render:function(){return this.$el.html(this.template({})),L=y.getInstance({$observer:this.$(".check-select-all")}),L.on("select:change",this.setButtonState,this),this.setButtonState(),h.ENABLE_APP_UPGRADE||this.$(".button-update").hide(),this},clickButtonInstall:function(){w.getInstance().show(),m({event:"ui.click.app.button.local.install",source:"toolbar"})},clickButtonUninstall:function(){var e;L.selected.length===1&&(e=A.get(L.selected[0])),T.batchUninstallAsync(L.selected).done(function(t){var r=t.body.failed;e!==n&&!r&&h.ENABLE_SHARE_UNINSTALL&&E.getInstance({model:e}).show()}),m({event:"ui.click.app.button.uninstall",source:"toolbar"})},clickButtonUpdate:function(){var t=L.selected,n=function(){var n=e.SnapPea.CurrentModule==="app"&&e.SnapPea.CurrentTab==="ignore"?A.ableToUpdateIncludeIgnored(t):A.ableToUpdate(t),i=function(e){var t=A.get(e),n=t.updateInfo.set({source:"toolbar-update-button"});N.addTask(p.enums.TASK_TYPE_INSTALL,p.enums.MODEL_TYPE_APPLICATION,n),t.set({isUpdating:!0}),t.unignoreUpdateAsync()};r.each(n,i),m({event:"ui.app.click.button.update",source:"toolbar"})};k(l.format(c.app.UPGRADE_TIP_TEXT,t.length),n)},clickButtonExport:function(){T.batchExportAppsAsync(L.selected),m({event:"ui.click.app.button.export",source:"toolbar"})},clickButtonMoveToSDCard:function(){T.batchMoveToSDCardAsync(L.selected),m({event:"ui.click.app.button.move.to.sd",source:"toolbar"})},clickButtonMoveToDevice:function(){T.batchMoveToDeviceAsync(L.selected),m({event:"ui.click.app.button.move.to.device",source:"toolbar"})},clickButtonRefresh:function(){if(L.list.currentSet.name==="web"&&!g.get("isLogin")){g.loginAsync("","app-list-refresh");var e=function(t,n){n&&(x.getInstance().syncAsync().fail(function(){C(c.common.REFRESH_ERROR)}),t.off("change:isLogin",e))};g.on("change:isLogin",e,this);return}var t=L.list.currentSet.name==="web"?x.getInstance():A;t.syncAsync().fail(function(){C(c.common.REFRESH_ERROR)}),m({event:"ui.click.app.button.refresh"})},events:{"click .button-install":"clickButtonInstall","click .button-uninstall":"clickButtonUninstall","click .button-update":"clickButtonUpdate","click .button-export":"clickButtonExport","click .button-move-to-sd-card":"clickButtonMoveToSDCard","click .button-move-to-device":"clickButtonMoveToDevice","click .button-refresh":"clickButtonRefresh"}}),M,_=r.extend({getInstance:function(){return M||(M=new O),M}});return _})}(this,this.document),function(e,t){define("app/views/AppModuleView",["backbone","underscore","doT","Log","ui/TemplateFactory","utilities/StringUtil","app/views/AppModuleToolbarView","app/views/AppListView","app/views/AppPanelView","app/collections/AppsCollection","main/collections/PIMCollection"],function(n,r,i,s,o,u,a,f,l,c,h){console.log("AppModuleMainView - File loaded.");var p=e.setInterval,d=e.clearInterval,v,m,g=n.View.extend({template:i.template(o.get("app","app-main")),className:"w-app-module-main module-main vbox",initialize:function(){var e=!1;Object.defineProperties(this,{rendered:{set:function(t){e=Boolean(t)},get:function(){return e}}})},render:function(){return this.$el.html(this.template({})),this.$el.prepend(a.getInstance().render().$el),v=f.getInstance(),m=l.getInstance(),this.$(".w-app-ctn").append(v.render().$el).append(m.render().$el),this.rendered=!0,this}}),y,b=r.extend({enablePreload:!1,getInstance:function(e){return y||(y=new g,e!==t&&e!=="normal"&&setTimeout(function(){n.trigger("switchModule",{module:"app",tab:e})},0)),y},preload:function(){c.getInstance().trigger("update")},showWebAppView:function(){h.getInstance().get(3).set({selected:!0}),setTimeout(function(){n.trigger("switchModule",{module:"app",tab:"web"})},0)},navigate:function(e){h.getInstance().get(3).set({selected:!0});var t=c.getInstance(),r=function(){var r=function(){var r=t.get(e.id),i;r.isSystem?i={module:"app",tab:"sys"}:i={module:"app",tab:"normal"},setTimeout(function(){n.trigger("switchModule",i),v.highlight(r)},0)};if(!t.loading&&!t.syncing)r();else{var i=function(e){r()};t.once("refresh",i)}};if(v)r();else var i=p(function(){v&&(d(i),r())},10)}});return b})}(this),function(e,t){define("welcome/views/DeviceToolsView",["backbone","underscore","doT","jquery","ui/TemplateFactory","ui/MenuButton","ui/PopupTip","ui/Panel","Configuration","Device","IO","Internationalization","Settings","Log","social/SocialService"],function(n,r,i,s,o,u,a,f,l,c,h,p,d,v,m){console.log("DeviceToolsView - File loaded.");var g=e.setTimeout,y,b=d.get("screenShot-destination")!==t?d.get("screenShot-destination"):l.enums.SCREEN_SHOT_DESTINATION_FILE,w=d.get("screenShot-wrapWithShell")!==t?d.get("screenShot-wrapWithShell"):1,E=n.View.extend({template:i.template(o.get("welcome","device-tools")),className:"w-welcome-device-tools-ctn w-anima-fade-in",initialize:function(){y=new u({items:[{label:p.welcome.SCREEN_SHOT_SAVE_TO_FILE,type:"radio",name:"screenshotDes",value:"file",checked:b===l.enums.SCREEN_SHOT_DESTINATION_FILE},{label:p.welcome.SCREEN_SHOT_SAVE_TO_CLIPBOARD,type:"radio",name:"screenshotDes",value:"clipbord",checked:b!==l.enums.SCREEN_SHOT_DESTINATION_FILE},{type:"hr"},{label:p.welcome.SCEEN_SHOT_WITHOUT_WRAP,type:"radio",name:"screenshotType",value:!1,checked:w!==1},{label:p.welcome.SCREEN_SHOT_WITH_WRAP,type:"radio",name:"screenshotType",value:!0,checked:w===1},{type:"hr"},{label:p.welcome.SAVE_PATH_FOR_SCREENSHOT,type:"normal",name:"savePath",value:"savePath"}]}),y.on("select",function(e){switch(e.name){case"screenshotDes":e.value==="file"?b=l.enums.SCREEN_SHOT_DESTINATION_FILE:b=l.enums.SCREEN_SHOT_DESTINATION_CLIPBOARD,d.set("screenShot-destination",b,!0);break;case"screenshotType":e.value==="true"?w=1:w=0,d.set("screenShot-wrapWithShell",w,!0);break;case"savePath":h.requestAsync(l.actions.SAVE_SCREENSHOT),v({event:"ui.click.welcome.save_screenshot_dir"})}},this),this.listenTo(c,"change",this.toggleView)},toggleView:function(e){e.get("isConnected")?e.get("isUSB")?(this.$(".usb-tip").hide(),this.$(".btns").show()):e.get("isWifi")?e.canScreenshotAsync().done(function(e){this.$(".usb-tip").toggle(!e.body.value),this.$(".btns").toggle(e.body.value)}.bind(this)):(this.$(".usb-tip").show(),this.$(".btns").hide()):e.get("isFastADB")?(this.$(".usb-tip").hide(),this.$(".btns").show()):(this.$(".usb-tip").show(),this.$(".btns").hide())},render:function(){return this.$el.html(this.template({})),this.$(".screen-shot-setting").append(y.render().$el.addClass("min toggle")),r.each(this.$("button[data-title]"),function(e){var t=new a({$host:s(e)})}),this.toggleView(c),this},showSavePathAlert:function(e){if(d.get("save_screen_shot_path")!==!0){var t=new f({buttonSet:"yes_no",$bodyContent:p.welcome.SAVE_PATH_FOR_SCREENSHOT_TIP,width:360,title:p.ui.TIP});t.on("button_yes",function(){h.requestAsync({url:l.actions.SET_LAST_USED_DIR,data:{dir:e.slice(0,e.lastIndexOf("\\")+1)}}),d.set("save_screen_shot_path",!0,!0)}).on("button_no",function(){d.set("save_screen_shot_path",!0,!0)}),t.show()}},screenShotAsync:function(){var e=s.Deferred();return c.getScreenshotAsync().done(function(){c.screenShotAsync(b,w).done(function(t){e.resolve(t)}).fail(function(t){e.reject(t)}).always(function(e){this.screenShotCallback(e)}.bind(this))}.bind(this)).fail(function(t){e.reject(t)}),e.promise()},showScreenShotTip:function(e,t){var n=this.options.deviceView.$(".tip");n.find(".icon").toggleClass("success",t).toggleClass("fail",!t),n.find(".des").html(e),n.fadeIn("fast"),g(function(){n.fadeOut("fast"),this.options.deviceView.fade=!1}.bind(this),3e3)},screenShotCallback:function(e){if(e.state_code===200)if(b===l.enums.SCREEN_SHOT_DESTINATION_CLIPBOARD)this.showScreenShotTip(p.welcome.SCREEN_SHOT_CLIPBOARD_SUCCESS,!0);else{this.showScreenShotTip(p.welcome.SAVE_SCREEN_SHOT_SUCCESS,!0);if(!e.body.auto_save_screenshot_dir){var t=e.body.screenshot_save_pos;this.showSavePathAlert(t)}}else e.state_code===402?this.showScreenShotTip(p.welcome.SCREEN_SHOT_CANCELD,!1):this.showScreenShotTip(p.welcome.SCREEN_SHOT_FAILD,!1)},clickButtonFullscreen:function(){h.requestAsync(l.actions.FULL_SCREEN),v({event:"ui.click.welcome.fullscreen"})},clickButtonRefresh:function(){this.options.deviceView.showScreenshotAsync(),v({event:"ui.click.welcome.refresh"})},clickButtonPlay:function(){this.$(".button-play").removeClass("button-play").data("title",p.welcome.PAUSE_BTN_TEXT).addClass("button-pause").find("span").removeClass("play-black").addClass("pause-black"),this.options.deviceView.play(),v({event:"ui.click.welcome.play"})},clickButtonPause:function(){this.$(".button-pause").removeClass("button-pause").addClass("play-black").data("title",p.welcome.PLAY_BTN_TEXT).addClass("button-play").find("span").removeClass("pause-black").addClass("play-black"),this.options.deviceView.stop(),v({event:"ui.click.welcome.pause"})},clickButtonScreenShot:function(){this.options.deviceView.loading=!0,this.options.deviceView.fade=!0,this.screenShotAsync().always(function(){this.options.deviceView.loading=!1}.bind(this)),v({event:"ui.click.welcome.screen.shot",destination:b,wrapWithShell:w})},clickButtonShare:function(){var e=c.get("screenshot"),t,n=s("<div>").addClass("preview-device-wrap"),r=s("<img>").addClass("preview-device-img");r.attr("src","file:///"+e.path+"?date="+e.date),r.appendTo(n);var i=m.getPreviewContentSize();if(!w)n.css({background:"none","max-width":i.width,"max-height":i.height,margin:"0 auto"}),r.css({position:"static","max-width":i.width,"max-height":i.height}),t=c.get("screenshot").rotation||0;else{var o=i.width/c.get("shell").width,u=i.height/c.get("shell").height,a=Math.min(o,u);t=c.get("screenshot").rotation,n.css({width:parseInt(c.get("shell").width*a,10),height:parseInt(c.get("shell").height*a,10)-2,position:"relative","background-image":"url("+c.get("shell").path+")","background-size":"100%",margin:"auto"});var f=n.width(),h=n.height(),p=f/c.get("shell").width;r.css({position:"absolute",width:parseInt(c.get("shell").screenshot.width*p,10),height:parseInt(c.get("shell").screenshot.height*p,10),top:parseInt(c.get("shell").screenshot.top*p,10),left:parseInt(c.get("shell").screenshot.left*p,10)})}switch(t){case 3:case 90:n.addClass("turn-right"),t=3;break;case 2:case 180:n.addClass("turn-down"),t=2;break;case 1:case 270:n.addClass("turn-left"),t=1}var d={hasPreview:!0,previewContent:n,shareData:{need_shell:w,pic:e.path,rotation:t},type:l.enums.SOCIAL_SCREENSHOT};m.show(d),v({event:"ui.click.welcome.share"})},events:{"click .button-screen-shot":"clickButtonScreenShot","click .button-fullscreen":"clickButtonFullscreen","click .button-refresh":"clickButtonRefresh","click .button-play":"clickButtonPlay","click .button-pause":"clickButtonPause","click .button-share":"clickButtonShare"}}),S,x=r.extend({getInstance:function(e){return S||(S=new E(e)),S}});return x})}(this),function(e,t){define("music/views/MusicItemView",["underscore","doT","jquery","ui/TemplateFactory","ui/MenuButton","ui/Panel","ui/BaseListItem","utilities/StringUtil","Internationalization","Device","Configuration","music/MusicService","social/SocialService","FunctionSwitch"],function(e,n,r,i,s,o,u,a,f,l,c,h,p,d){console.log("MusicItemView - File loaded. ");var v=u.extend({template:n.template(i.get("music","music-item")),className:"w-music-list-item hbox",initialize:function(){v.__super__.initialize.apply(this,arguments),this.listenTo(l,"change:isConnected",function(){this.$(".play").toggleClass("disabled",!l.get("isConnected"))}),this.listenTo(this.model.collection,"refresh",this.render)},remove:function(){this.settingButton&&(this.settingButton.remove(),delete this.settingButton),v.__super__.remove.call(this)},render:function(){return this.$el.html(this.template(e.extend(this.model.toJSON(),{collection:this.model.collection}))),this.model.collection.settings&&this.renderRingSettingButton(),this.$(".play").toggleClass("disabled",!l.get("isConnected")),this},renderRingSettingButton:function(){this.settingButton&&(this.settingButton.remove(),delete this.settingButton);var e=this.model.collection,n=new s({label:f.music.SETTING_RING_TEXT,items:[{type:"checkbox",label:f.music.SETTING_ITEM_CALL_RING_TEXT,value:0,name:"ring-setting",checked:e.settings.ringtone===this.model.id},{type:"checkbox",label:f.music.SETTING_ITEM_NOTIFY_RING_TEXT,value:1,name:"ring-setting",checked:e.settings.notification===this.model.id},{type:"checkbox",label:f.music.SETTING_ALARM_RING_TEXT,value:2,name:"ring-setting",checked:e.settings.alarm===this.model.id}]});n.render().$el.addClass("w-icon-btn hbox min").prepend(r("<span>").addClass("icon ring")),n.on("select",function(n){var r=parseInt(n.value,10),i,s=this.model.collection;switch(r){case 0:this.model.id===e.settings.ringtone&&(i=e.resetRingAsync);break;case 1:this.model.id===e.settings.notification&&(i=this.model.collection.resetRingAsync);break;case 2:this.model.id===e.settings.alarm&&(i=this.model.collection.resetRingAsync)}i===t&&(i=this.model.setRingAsync,s=this.model),i.call(s,r).done(function(){if(i===this.model.setRingAsync&&d.ENABLE_SHARE_SET_RINGTONE){var t=new o({disposableName:"social.set_ringtone.not_hint",disposableChecked:!1,$bodyContent:f.music.SHARE_SET_RINGTONE,title:f.common.DIALOG_TIP,buttonSet:"yes_cancel",height:160}),n=parseInt(this.model.get("size"),10),r=n>=2097152?c.enums.SOCIAL_SET_MUSIC_AS_RINGTONE:c.enums.SOCIAL_SET_RINGTONE,s={textUrl:a.format(c.enums.SOCIAL_TEXT_PREVIEW_POST_URL,r),textData:{content:JSON.stringify({title:this.model.get("title"),artist:this.model.get("artist")})},hasPreview:!1,shareData:{need_shell:0,rotation:0},extraData:{ringtone_id:this.model.id,ringtone_title:this.model.get("title"),ringtone_artist:this.model.get("artist")},type:r};t.on("button_yes",function(){p.setContent(s),p.show()}).on("button_cancel",function(){t.saveSetting()}),t.getSetting()||t.show()}e.trigger("refresh",e)}.bind(this))},this),n.$el.prop({disabled:!l.get("isConnected")||!l.get("hasSDCard")||l.get("isMounted")}),n.listenTo(l,"change",function(){n.$el.prop({disabled:!l.get("isConnected")||!l.get("hasSDCard")||l.get("isMounted")})}),this.$(".type").prepend(n.$el),this.settingButton=n},clickButtonPlay:function(){h.stopAsync().done(function(){h.playAsync(this.model.id)}.bind(this))},clickButtonStop:function(){h.stopAsync()},dblclickItem:function(){l.get("isConnected")&&h.stopAsync().done(function(){h.playAsync(this.model.id)}.bind(this))},events:{"click .button-play":"clickButtonPlay","click .button-stop":"clickButtonStop",dblclick:"dblclickItem"}}),m=e.extend({getInstance:function(e){return new v(e)},getClass:function(){return v}});return m})}(this),function(e,t){define("music/views/ImportMusicView",["backbone","underscore","doT","ui/Panel","ui/TemplateFactory","ui/AlertWindow","ui/SmartList","ui/behavior/ButtonSetMixin","utilities/StringUtil","IOBackendDevice","Configuration","Internationalization","Device","music/MusicService","music/models/MusicModel","music/views/MusicItemView"],function(e,n,r,i,s,o,u,a,f,l,c,h,p,d,v,m){console.log("ImportMusicView - File loaded.");var g,y,b,w=e.View.extend({template:r.template(s.get("music","local-import-body")),className:"w-music-local-import vbox",initialize:function(){this.collection=new e.Collection,b=new o({$bodyContent:h.music.IMPORT_PROGRESS_TEXT}),p.on("change",this.setFooterContent,this),p.get("hasEmulatedSD")?p.getDeviceCapacityAsync():p.getSDCapacityAsync()},render:function(){return this.$el.html(this.template({})),g=new u({itemView:m.getClass(),dataSet:[{name:"default",getter:function(){return[]}}],keepSelect:!1,$observer:this.$(".check-select-all"),$header:this.$("header"),itemHeight:35,listenToCollection:this.collection}),g.on("switchSet",function(e){g.emptyTip=h.music.NO_SELECTED_MUSIC_TEXT,g.toggleEmptyTip(g.currentModels.length===0),this.setFooterContent()},this),g.on("select:change",function(){this.setFooterContent()},this),this.$(".w-smart-list-header").after(g.render().$el),g.emptyTip=h.music.NO_SELECTED_MUSIC_TEXT,g.toggleEmptyTip(!0),this},parseMusics:function(e){var t=[],r=[];n.each(e.body.audio,function(e){e.id=f.MD5(e.path),t.push(new v(e))});var i=[];n.each(t,function(e){var t=this.collection.get(e.id);t?t.set(e.toJSON()):this.collection.add(e),i.push(e.id)},this),g.switchSet("default",function(){return this.collection.models}.bind(this)),g.addSelect(i)},selectMusics:function(e){b.show(),d.selectMusicsAsync(e).done(this.parseMusics.bind(this)).always(function(){b.close()})},setFooterContent:function(){var e=0;n.each(g.selected,function(t){e+=parseInt(this.collection.get(t).get("size"),0)},this);var t=f.format(h.misc.SELECTOR_DESCRIPTION_TEXT,g.selected.length,g.currentModels.length);p.get("hasEmulatedSD")?t+=f.format(h.misc.DEVICE_CAPACITY_REMAIN,f.readableSize(Math.max(p.get("internalFreeCapacity")-e,0))):t+=f.format(h.misc.SD_CAPACITY_REMAIN,f.readableSize(Math.max(p.get("externalFreeCapacity")-e,0))),this.$("footer").html(t)},clickButtonAddFile:function(e){this.selectMusics(0)},clickButtonAddFolder:function(e){this.selectMusics(1)},events:{"click .button-add-file":"clickButtonAddFile","click .button-add-folder":"clickButtonAddFolder"}}),E,S=i.extend({initialize:function(){S.__super__.initialize.apply(this,arguments),this.on("show",function(){E=(new w).render(),this.resp&&(E.parseMusics(this.resp),delete this.resp),this.$bodyContent=E.$el,E.setFooterContent()},this),this.on("button_yes",this.import,this)},"import":function(){var e=[];n.each(g.selected,function(n){var r=E.collection.get(n);r!==t&&e.push(r.get("path"))}),e.length>0&&d.importMusicsAsync(e),this.close()}}),x,T=n.extend({getInstance:function(){return x||(x=new S({title:h.music.ADD_LOCAL_MUSIC_TEXT,height:480,width:630,buttonSet:a.BUTTON_SET.YES_CANCEL})),x}});return T})}(this),function(e,t){define("music/views/SetRingWindowView",["backbone","underscore","doT","jquery","ui/Panel","ui/TemplateFactory","ui/SmartList","Device","Internationalization","music/views/MusicItemView","music/views/ImportMusicView","music/collections/MusicsCollection","music/MusicService"],function(e,n,r,i,s,o,u,a,f,l,c,h,p){console.log("SetRingWindowView - File loaded. ");var d,v,m=e.View.extend({template:r.template(o.get("music","set-ring-list")),className:"w-music-set-ring-list vbox",initialize:function(){v=v||h.getInstance(),v.on("refresh",function(e){d?d.switchSet("default",e.getAll):this.buildList()},this),v.on("syncStart update",function(){d!==t&&(d.loading=!0)}),v.on("syncEnd refresh",function(){d!==t&&(d.loading=!1)}),a.on("change:hasSDCard",function(e,n){d!==t&&(n?d.emptyTip=f.music.MUSIC_EMPTY_TEXT:d.emptyTip=f.music.NO_SD_CARD_TIP_TEXT)})},buildList:function(){d=new u({itemView:l.getClass(),dataSet:[{name:"default",getter:v.getAll}],keepSelect:!1,$header:this.$("header"),itemHeight:35,listenToCollection:v}),this.$el.append(d.render().$el),d.loading=v.loading||v.syncing,a.get("hasSDCard")?d.emptyTip=f.music.MUSIC_EMPTY_TEXT:d.emptyTip=f.music.NO_SD_CARD_TIP_TEXT,d.on("switchSet",function(){d.toggleEmptyTip(d.currentModels.length===0)})},render:function(){return this.$el.html(this.template({})),this.buildList(),this}}),g,y=s.extend({initialize:function(){y.__super__.initialize.apply(this,arguments),this.on("show",function(){this.$(".w-ui-window-footer-monitor").html(i("<button>").html(f.music.ADD_LOCAL_MUSIC_TEXT).addClass("button-import")),g=new m,this.$bodyContent=g.render().$el},this),this.on("remove",function(){p.stopAsync()})},render:function(){n.extend(this.events,y.__super__.events),this.delegateEvents(),y.__super__.render.apply(this,arguments)},clickButtonImport:function(){c.getInstance().show()},events:{"click .button-import":"clickButtonImport"}}),b,w=n.extend({getInstance:function(){return b||(b=new y({height:440,width:375,title:f.welcome.EDIT_RING,buttonSet:"yes"})),b}});return w})}(this),function(e,t){define("welcome/views/DeviceView",["backbone","underscore","doT","jquery","ui/TemplateFactory","ui/MouseState","Device","IO","Configuration","Log","welcome/views/DeviceToolsView","music/views/SetRingWindowView"],function(t,n,r,i,s,o,u,a,f,l,c,h){console.log("DeviceView - File loaded.");var p=e.setTimeout,d=e.setInterval,v=e.clearInterval,m={top:60,left:12,width:197,height:310},g={scale:430},y=!1,b=function(){return this.$(".screen")[0].contains(o.currentElement)||this.$(".button-set-ring")[0].contains(o.currentElement)},w,E=t.View.extend({className:"w-welcome-device-ctn",template:r.template(s.get("welcome","device")),initialize:function(){var e=!1,t=!1;Object.defineProperties(this,{loading:{set:function(t){e=t;var n=this.$(".w-ui-loading");n.toggle(e)},get:function(){return e}},fade:{set:function(e){t=e,t?this.$(".screen img").css({opacity:".3"}):this.$(".screen img").css({opacity:"1"})},get:function(){return t}}}),this.listenTo(u,"change:isConnected change:isFastADB",n.debounce(function(e){(e.get("isConnected")||e.get("isFastADB"))&&e.getScreenshotAsync()})),this.listenTo(u,"change:shell",this.renderShell),this.listenTo(u,"change:screenshot",this.renderScreenshot)},render:function(){return this.$el.html(this.template({})),w=c.getInstance({deviceView:this}),this.renderShell(u,u.get("shell")),this.renderScreenshot(u,u.get("screenshot")),u.getScreenshotAsync(),u.getShellInfoAsync(),this},renderScreenshot:function(t,n){this.$(w.$el).length===0&&this.$(".stage-ctn").append(w.render().$el);var r=this.$(".screen"),s=r.find("img");s.toggle(!!n.path);if(n.path){var o=i(new e.Image),u=function(){r.find("img").attr("src",o.attr("src")),o.remove()}.bind(this),a=function(){o.remove()};o.one("load",u).one("error",a).attr("src","file:///"+n.path+"?date"+n.date)}this.adjustRotation()},adjustRotation:function(){var e=this.$el.hasClass("isPad"),t=u.get("screenshot").rotation;this.$el.toggleClass("turn-left",t===1).toggleClass("turn-right",t===3).toggleClass("turn-down",t===2),e||(t===1||t===3?this.$el.width(u.get("shell").height+50):this.$el.width(u.get("shell").width))},renderShell:function(e,t){var n=m,r=this.$(".screen"),i=r.find("img");if(t.path){var s=this.$(".screen-ctn"),o=!1;t.width=t.width||parseInt(this.$el.width(),10),t.height=t.height||parseInt(this.$el.height(),10),o=t.width===g.scale,this.$el.toggleClass("isPad",o),this.adjustRotation(),s.fadeOut("fast",function(){s.css({width:t.width,height:t.height,"background-image":"url("+t.path+")"}).fadeIn("fast"),n={left:t.screenshot.left,top:t.screenshot.top,width:t.screenshot.width,height:t.screenshot.height},r.css(n),i.css(n)}.bind(this))}else r.css(n),i.css(n)},showScreenshotAsync:function(){var e=i.Deferred();return u.getScreenshotAsync().done(e.resolve).fail(e.reject),e.promise()},mouseoverScreen:function(){u.get("isConnected")&&!y&&!this.loading&&p(function(){if(b.call(this)){this.$(".button-set-ring").fadeIn(),this.$(".screen img").css({opacity:".3"});var e=d(function(){b.call(this)||(this.$(".button-set-ring").fadeOut(),this.$(".screen img").css({opacity:1}),v(e))}.bind(this),50)}}.bind(this),1e3)},refreshScreen:function(){this.showScreenshotAsync().always(function(){y&&this.refreshScreen()}.bind(this))},play:function(){y=!0,this.refreshScreen()},stop:function(){y=!1},clickButtonSetRing:function(){h.getInstance().show()},dbclickScreen:function(){u.get("isConnected")&&u.get("isUSB")&&(a.requestAsync(f.actions.FULL_SCREEN),l({event:"ui.dbclick.welcome.screen"}))},events:{"mouseover .screen":"mouseoverScreen","click .button-set-ring":"clickButtonSetRing","dblclick .screen img":"dbclickScreen"}}),S,x=n.extend({getInstance:function(){return S||(S=new E),S}});return x})}(this),function(e,t){define("welcome/views/CapacityView",["backbone","underscore","doT","jquery","Device","utilities/StringUtil","ui/MouseState","ui/TemplateFactory","ui/PopupTip","ui/PopupPanel","app/collections/AppsCollection","app/views/OneKeyMoveWindowView"],function(t,n,r,i,s,o,u,a,f,l,c,h){console.log("CapacityView - File loaded.");var p=e.setTimeout,d=e.setInterval,v=e.clearInterval,m=t.View.extend({template:r.template(a.get("welcome","capacity")),className:"w-welcome-capacity hbox",initialize:function(){s.on("change",this.render,this),t.on("switchModule",function(e){e.module==="welcome"&&this.render()},this)},fillData:function(e){this.$el.html(this.template({internalCapacity:e.get("internalCapacity"),externalCapacity:e.get("externalCapacity"),internalFreeCapacity:e.get("internalFreeCapacity"),externalFreeCapacity:e.get("externalFreeCapacity")})),this.$(".phone-capacity").show(),this.$(".external-capacity").toggle((e.get("externalCapacity")!==0||e.get("externalFreeCapacity")!==0)&&e.get("hasSDCard")),n.each(this.$("[data-title]"),function(e){var t=new f({$host:i(e)})});var t;if(!(!e.get("hasSDCard")||e.get("isMounted")||e.get("hasEmulatedSD")||!e.get("isConnected")||c.getInstance().getSuggestMoveApps().length===0)){var s=this.$(".phone-capacity.outofspace");s.length>0&&(t=new l({$content:i(r.template(a.get("welcome","one-key-move-tip"))({})),$host:s}),t.on("show",function(){t.$el.on("click",".button-one-key-move",this.clickButtonOneKeyMove)},this))}var o=this.$(".external-capacity.outofspace");o.length>0&&(t=new l({$content:i(r.template(a.get("welcome","open-sd-tip"))({})),$host:o}),t.on("show",function(){t.$el.on("click",".button-open-sd-card",this.clickButtonOpenSDCard)},this))},render:function(){return s.get("isConnected")?(this.$el.css("display","-webkit-box"),s.getDeviceCapacityAsync().done(function(){this.fillData(s)}.bind(this)),s.getSDCapacityAsync().done(function(){this.fillData(s)}.bind(this))):this.$el.hide(),n.each(this.$("[data-title]"),function(e){var t=new f({$host:i(e)})}),this},showDeviceTip:function(){var e=function(){var e=this.$(".phone-capacity .w-ui-popup-panel").show(),t=this.$(".phone-capacity .alert"),n=d(function(){!e[0].contains(u.currentElement)&&!t[0].contains(u.currentElement)&&(e.hide(),v(n))},100)}.bind(this),t=c.getInstance();if(t.loading){var n=function(t){t.getSuggestMoveApps().length>0&&e(),t.off("refresh",n)};t.on("refresh",n,this)}else t.getSuggestMoveApps().length>0&&e()},showExternalTip:function(){var e=this.$(".external-capacity .w-ui-popup-panel").show(),t=this.$(".external-capacity .alert"),n=d(function(){!e[0].contains(u.currentElement)&&!t[0].contains(u.currentElement)&&(e.hide(),v(n))},100)},clickButtonOneKeyMove:function(e){var t=i(e.target);t.prop({disabled:!0}),p(function(){t.prop({disabled:!1})},2e3),h.getInstance().show()},clickButtonOpenSDCard:function(e){var t=i(e.target);t.prop({disabled:!0}),p(function(){t.prop({disabled:!1})},2e3),s.manageSDCardAsync()},events:{"mouseenter .phone-capacity .alert":"showDeviceTip","mouseenter .external-capacity .alert":"showExternalTip"}}),g,y=n.extend({getInstance:function(){return g||(g=new m),g}});return y})}(this),function(e,t){define("sync/views/AccountGuideView",["backbone","underscore","doT","jquery","Device","Internationalization","ui/Panel","ui/UIHelper","ui/TemplateFactory","social/views/SocialPlatformSelectorView","sync/SyncService"],function(e,n,r,i,s,o,u,a,f,l,c){console.log("AccountGuideView - File loaded. ");var h=["cloud-backup","cloud-photo","social-platform"],p=["account-guide-content-backup","account-guide-content-photo","account-guide-content-social"],d=[35,204,372],v=[c.setPhotoSyncSwitchAsync,c.setRemoteAutoBackupSwitchAsync],m=e.View.extend({template:r.template(f.get("sync","account-guide-body")),className:"w-sync-account-guide-body",currentPage:0,initialize:function(){},render:function(){this.$el.html(this.template({})),this.$(".guide-header").html(r.template(f.get("sync","account-guide-header"))),this.$(".guide-content").html(r.template(f.get("sync",p[this.currentPage]))),this.$(".icon").removeClass("step-on").addClass("step-off"),this.$(".icon-"+h[this.currentPage]).addClass("step-on").removeClass("step-off"),this.$(".guide-split .icon").css("margin-left",d[this.currentPage]);var e=this.$(".social-ctn");return e.length>0&&e.html(l.getInstance(!0).render().$el),this},resetPageIndex:function(){this.currentPage=0},isFirstPage:function(){return this.currentPage===0},isLastPage:function(){return this.currentPage===p.length-1},showNextPage:function(){if(this.isLastPage())return;this.currentPage++,this.render()},showLastPage:function(){if(this.isFirstPage())return;this.currentPage--,this.render()},saveCurrentOption:function(){var e=this.$('.guide-option input[type="checkbox"]').prop("checked"),n=v[this.currentPage];e!==t&&n!==t&&n(e)}}),g,y=u.extend({initialize:function(){y.__super__.initialize.apply(this,arguments),this.on(a.EventsMapping.SHOW,function(){g=new m,this.$bodyContent=g.render().$el,g.resetPageIndex(),this.refreshButtonState(),this.center()},this),this.buttons=[{$button:i("<button>").html(o.ui.NEXT).addClass("button-next primary"),eventName:"button_next"},{$button:i("<button>").html(o.ui.FINISH).addClass("button-finish primary"),eventName:"button_finish"}]},render:function(){return n.extend(this.events,y.__super__.events),this.delegateEvents(),y.__super__.render.apply(this,arguments),$buttonLast=i("<button>").html(o.ui.PREV).addClass("button-last"),this.$(".w-ui-window-footer-monitor").append($buttonLast),this},refreshButtonState:function(){g.isFirstPage()?(this.$(".button-next").show(),this.$(".button-last, .button-finish").hide()):g.isLastPage()?(this.$(".button-next").hide(),this.$(".button-finish, .button-last").show()):(this.$(".button-next, .button-last").show(),this.$(".button-finish").hide())},clickButtonNext:function(){g.saveCurrentOption(),g.showNextPage(),this.refreshButtonState()},clickButtonLast:function(){g.showLastPage(),this.refreshButtonState()},clickButtonFinish:function(){g.saveCurrentOption(),this.remove()},events:{"click .button-next":"clickButtonNext","click .button-last":"clickButtonLast","click .button-finish":"clickButtonFinish"}}),b,w=n.extend({getInstance:function(){return b||(b=new y({title:o.sync.ACCOUNT_GUIDE,width:549,height:400})),b}});return w})}(this),function(e,t,n){define("welcome/views/FileToolsView",["backbone","underscore","doT","jquery","Log","ui/TemplateFactory","ui/AlertWindow","ui/PopupTip","ui/PopupPanel","FunctionSwitch","Internationalization","utilities/StringUtil","Configuration","Device","IO","backuprestore/BackupController","backuprestore/RestoreController","welcome/WelcomeService","sync/views/AccountGuideView"],function(t,n,r,i,s,o,u,a,f,l,c,h,p,d,v,m,g,y,b){console.log("FileToolsView - File loaded.");var w=e.alert,E,S=!1,x=function(){d.get("isConnected")&&d.get("isFlashed")&&this.addFlashPanel()},T=t.View.extend({template:r.template(o.get("welcome","file-tools")),className:"w-welcome-filetools-ctn",initialize:function(){this.listenTo(d,"change",function(e){this.$el.toggle(e.get("isConnected")),this.$(".button-open-sd").prop({disabled:!e.get("hasSDCard")&&!e.get("hasEmulatedSD")}),e.get("isAutoBackup")||this.toggleAutoBackuoCtn(!1)}),this.listenTo(d,"change:isConnected change:isFlashed",n.debounce(x)),v.Backend.Device.onmessage({"data.channel":p.events.AUTO_BACKUP_START},function(e){d.isDeviceAutoBackupAsync().done(function(e){console.log("FileToolsView - Auto-backup start. ");var t=JSON.parse(e.body.value);t&&(this.toggleAutoBackuoCtn(!0),this.setAutoBackupStatusAsInProcess())}.bind(this))},this),v.Backend.Device.onmessage({"data.channel":p.events.AUTO_BACKUP_COMPLETE},function(e){d.isDeviceAutoBackupAsync().done(function(e){console.log("FileToolsView - Auto-backup finish. ");var t=JSON.parse(e.body.value);t&&(this.toggleAutoBackuoCtn(!0),this.setAutoBackupStatusAsComplete(),this.fillAutoBackupData())}.bind(this))},this)},render:function(){this.$el.html(this.template({})),setTimeout(function(){this.$el.toggle(d.get("isConnected")),this.toggleAutoBackuoCtn(d.get("isAutoBackup"))}.bind(this),0),this.toggleAutoBackuoCtn(!1),this.fillAutoBackupData();var e=new a({$host:this.$(".button-auto-backup")});return this.addFlashPanel(),this.$(".button-open-sd").prop({disabled:!d.get("hasSDCard")&&!d.get("hasEmulatedSD")}),this},addFlashPanel:function(){if(S||!d.get("isConnected")||!d.get("isFlashed")||d.get("isMounted")||!d.get("isAutoBackup")||e.SnapPea.CurrentModule!=="welcome")return;E=new f({$content:i(r.template(o.get("welcome","flash-tip"))({})),$host:this.$(".button-restore")}),E.once("show",function(){E.$content.one("click",".button-close",function(){S=!0,E.remove(),E.destoryBlurToHideMixin(),this.stopListening(d,"change:isConnected change:isFlashed")}.bind(this)),E.listenTo(t,"switchModule",function(e){E.$el.toggle(e.module==="welcome"&&!S)}),E.listenTo(d,"change:isConnected",function(e,t){t||(E.remove(),E.destoryBlurToHideMixin())})},this),setTimeout(function(){E.show()},0),s({event:"debug.flash.popup.show"})},fillAutoBackupData:function(){y.getAutoBackupDateAsync().done(function(e){var t=parseInt(e.body.value,10),n=h.formatDate("yyyy-MM-dd",t),r=h.format(c.welcome.AUTO_BACKUP_TIP_COMPLETE,n);this.$(".button-auto-backup").data({title:r}),this.toggleAutoBackuoCtn(!0)}.bind(this)).fail(function(){this.toggleAutoBackuoCtn(!1)}.bind(this))},toggleAutoBackuoCtn:function(e){this.$(".auto-backup-ctn").toggle(e),this.$(".button-backup").toggle(!e)},setAutoBackupStatusAsInProcess:function(){this.$(".icon").removeClass("open-folder-black").addClass("in-process"),this.$(".button-auto-backup").data({title:c.welcome.AUTO_BACKUP_TIP_IN_PROGRESS})},setAutoBackupStatusAsComplete:function(){this.$(".icon").addClass("open-folder-black").removeClass("in-process")},showTipForOpenAutoBackupFile:function(){var e=i("<div>").append(i("<p>").html(c.welcome.TIP_IN_OPEN_FILE1)).append(i("<p>").html(c.welcome.TIP_IN_OPEN_FILE2));w(e)},clickButtonOpenSD:function(){var e=this.$(".button-open-sd").prop("disabled",!0);setTimeout(function(){e.prop("disabled",!1)}.bind(this),2e3),d.manageSDCardAsync(),s({event:"ui.click.welcome.button.manage.sd"})},clickButtonBackup:function(){if(!l.ENABLE_CLOUD_BACKUP_RESTORE&&!d.get("isUSB")){w(c.backup_restore.TIP_IN_WIFI);return}m.start(),s({event:"ui.click.welcome.button.backup",isUSB:d.get("isUSB")})},clickButtonRestore:function(){if(!l.ENABLE_CLOUD_BACKUP_RESTORE&&!d.get("isUSB")){w(c.backup_restore.TIP_IN_WIFI);return}var e="";E&&(e="flashPanel",E.remove(),E.destoryBlurToHideMixin()),g.start(),s({event:"ui.click.welcome.button.restore",isUSB:d.get("isUSB"),from:e})},clickButtonAutoBackup:function(){if(!this.$(".button-auto-backup .icon").hasClass("in-process")){y.openAutobackupFileAsync().fail(function(){this.toggleAutoBackuoCtn(!1),this.showTipForOpenAutoBackupFile()}.bind(this));var e=this.$(".button-auto-backup").prop("disabled",!0);setTimeout(function(){e.prop("disabled",!1)},2e3),s({event:"ui.click.welcome.button.open.auto.backup"})}},events:{"click .button-open-sd":"clickButtonOpenSD","click .button-backup":"clickButtonBackup","click .button-group-backup":"clickButtonBackup","click .button-restore":"clickButtonRestore","click .button-auto-backup":"clickButtonAutoBackup"}}),N,C=n.extend({getInstance:function(e){return N||(N=new T(e)),N}});return C})}(this,this.document),function(e,t){define("welcome/views/BillboardView",["backbone","underscore","doT","ui/TemplateFactory","Configuration","Log","Environment","IOBackendDevice","browser/views/BrowserModuleView","task/TaskService"],function(e,t,n,r,i,s,o,u,a,f){console.log("BillboardView - File loaded. ");var l=function(e){var t=e.originalEvent.srcElement.readyState;switch(t){case"complete":this.loading=!1,this.$("iframe").removeClass("w-layout-hidden");break;case"start":this.loading=!0}},c,h=e.View.extend({template:n.template(r.get("welcome","billboard")),className:"w-welcome-billboard",initialize:function(){var t=!1;Object.defineProperties(this,{loading:{set:function(e){t=Boolean(e),t?this.$(".w-ui-loading").show():this.$(".w-ui-loading").hide()},get:function(){return t}}}),c=u.Backend.Device.onmessage({"data.channel":i.events.CUSTOM_WELCOME_BILLBOARD_NAVIGATE},function(t){switch(t.type){case"ext":parseInt(t.id,10)===18?a.navigate(t.url):a.navigateToThirdParty(t.id,"",t.url);break;case"download":f.addTask(i.enums.TASK_TYPE_INSTALL,"app",new e.Model({downloadUrl:t.url,title:t.name,iconPath:t.icon,source:"billboard",packageName:t.packageName}))}})},render:function(){var e;return o.get("locale")===i.enums.LOCALE_DEFAULT||o.get("locale")===i.enums.LOCALE_ZH_CN?e=i.enums.URL_WELCOME_BILLBOARD:e=i.enums.URL_WELCOME_BILLBOARD_EN,this.$el.html(this.template({url:e})),this.$("iframe").on("readystatechange",l.bind(this)),this},remove:function(){u.Backend.Device.offmessage(c),this.$("iframe").off("readystatechange"),h.__super__.call(this)}}),p=t.extend({getInstance:function(e){return new h(e)}});return p})}(this),function(e,t){define("welcome/views/WelcomeView",["backbone","underscore","doT","ui/TemplateFactory","Device","welcome/views/DeviceView","welcome/views/CapacityView","welcome/views/FileToolsView","welcome/views/BillboardView"],function(e,t,n,r,i,s,o,u,a){console.log("WelcomeView - File loaded.");var f=e.View.extend({template:n.template(r.get("welcome","welcome")),className:"w-welcome-ctn vbox",render:function(){return this.$el.html(this.template({})),this.$(".content").append(s.getInstance().render().$el).append(a.getInstance().render().$el),this.$("footer").append(o.getInstance().render().$el).append(u.getInstance().render().$el),this},remove:function(){}}),l,c=t.extend({getInstance:function(){return l||(l=new f),l}});return c})}(this),function(e){define("welcome/views/ConnectionGuideView",["underscore","backbone","doT","ui/TemplateFactory","IO","Configuration"],function(e,t,n,r,i,s){console.log("ConnectionGuideView - File loaded. ");var o=t.View.extend({template:n.template(r.get("welcome","connection-guide")),className:"w-welcome-connection-guide-ctn hbox",render:function(){return this.$el.html(this.template({})),this},clickButtonConnect:function(){i.requestAsync(s.actions.CONNET_PHONE)},events:{"click .button-connect":"clickButtonConnect"}}),u=e.extend({getInstance:function(){return new o}});return u})}(this),function(e){define("welcome/views/CloseAutoStartView",["underscore","backbone","doT","ui/TemplateFactory","Configuration","IO","Internationalization","Log"],function(e,t,n,r,i,s,o,u){console.log("CloseAutoStartView - File loaded. ");var a=t.View.extend({template:n.template(r.get("misc","close-auto-start")),className:"w-misc-device-close-auto-start hbox",render:function(){return this.$el.html(this.template({})),u({event:"debug.welcome.disabled_auto_start_panel_show"}),this},clickButtonSetup:function(){s.requestAsync(i.actions.WINDOW_OPEN_SETTING),u({event:"ui.click.welcome_disabled_auto_start_panel_setting"})},clickButtonClose:function(){this.$el.slideUp("fast",function(){this.remove()}.bind(this)),u({event:"ui.click.welcome_disabled_auto_start_panel_close"})},events:{"click .button-setup":"clickButtonSetup","click .button-close":"clickButtonClose"}}),f=e.extend({getInstance:function(){return new a}});return f})}(this),function(e){define("welcome/views/WelcomeModuleView",["backbone","underscore","welcome/views/WelcomeView","Environment","Settings","utilities/QueryString","welcome/views/ConnectionGuideView","welcome/views/CloseAutoStartView"],function(e,t,n,r,i,s,o,u){console.log("WelcomeModuleView - File loaded.");var a=e.View.extend({className:"w-welcome-module-main module-main",initialize:function(){var e=!0;Object.defineProperties(this,{set:function(t){e=t},get:function(){return e}})},render:function(){return r.get("deviceId")==="Default"?(this.contentView=o.getInstance(),r.once("change:deviceId",function(e,t){this.contentView.remove(),this.contentView=n.getInstance(),this.$el.append(this.contentView.render().$el)},this)):this.contentView=n.getInstance(),this.$el.append(this.contentView.render().$el),!i.get("close_auto_start_view_shown")&&s.get("start_source")==="helper"&&(this.$el.append(u.getInstance().render().$el),i.set("close_auto_start_view_shown",!0)),this.rendered=!0,this},remove:function(){this.contentView&&this.contentView.remove(),a.__super__.remove.call(this)}}),f,l=t.extend({getInstance:function(){return f||(f=new a),f},preload:function(){}});return l})}(this),function(e,t){define("music/iTunes/iTunesService",["backbone","underscore","jquery","IO","Configuration","Log"],function(e,t,n,r,i,s){console.log("iTunesService - File loaded. ");var o=t.extend(function(){},e.Events);return o.checkiTunesAsync=function(){var e=n.Deferred();return r.requestAsync({url:i.actions.ITUNES_IMPORT_CHECK,success:function(t){t.state_code===200?e.resolve(t):e.reject(t)}}),e.promise()},o})}(this),function(e,t){define("music/views/MusicContextMenu",["ui/Menu","ui/behavior/ClickToHideMixin","ui/AlertWindow","Internationalization","Device","Log","music/collections/MusicsCollection","music/MusicService"],function(e,t,n,r,i,s,o,u){console.log("MusicContextMenu - File loaded. ");var a,f=e.extend({initialize:function(){f.__super__.initialize.apply(this,arguments),t.mixin(this),a=o.getInstance(),this.addItems(),this.on("select",function(e){switch(e.value){case"delete":this.deleteMusics();break;case"export":this.exportMusics()}},this)},deleteMusics:function(){u.deleteMusicsAsync(this.options.selected),s({event:"ui.click.music.button.delete",count:this.options.selected.length,source:"context-menu"})},exportMusics:function(){u.exportMusicsAsync(this.options.selected),s({event:"ui.click.music.button.export",count:this.options.selected.length,source:"context-menu"})},addItems:function(){var e=this.options.selected;this.items=[{type:"normal",name:"delete",value:"delete",label:r.misc.DELETE,disabled:e.length===0||!i.get("isConnected")},{type:"hr"},{type:"normal",name:"export",value:"export",label:r.misc.EXPORT,disabled:!i.get("isConnected")||!i.get("hasSDCard")}]}}),l,c=_.extend({getInstance:function(e){return l?(l.options.selected=e.selected,l.addItems(),l.render()):l=new f(e),l}});return c})}(this),function(e,t){define("music/views/MusicsListView",["backbone","underscore","doT","ui/TemplateFactory","ui/SmartList","Device","Internationalization","music/collections/MusicsCollection","music/views/MusicItemView","music/views/MusicContextMenu"],function(e,t,n,r,i,s,o,u,a,f){console.log("MusicsListView - File loaded. ");var l,c,h=e.View.extend({template:n.template(r.get("music","music-list")),className:"w-music-list vbox",initialize:function(){var e=!1;Object.defineProperties(this,{selected:{get:function(){return c?c.selected:[]}}}),l=u.getInstance(),l.on("refresh",this.buildList,this),l.on("syncStart update syncEnd refresh",function(){c!==undefined&&(c.loading=l.loading||l.syncing)}),s.on("change:hasSDCard",function(e,t){c!==undefined&&(t?c.emptyTip=o.music.MUSIC_EMPTY_TEXT:c.emptyTip=o.common.NO_SD_CARD_TIP_TEXT)})},buildList:function(){c?c.switchSet("default",l.getMusics):(c=new i({itemView:a.getClass(),dataSet:[{name:"default",getter:l.getMusics}],keepSelect:!1,enableContextMenu:!0,$header:this.$("header"),$observer:this.options.$observer,itemHeight:35,listenToCollection:l,loading:l.loading||l.syncing}),this.$el.append(c.render().$el),c.on("select:change",function(e){this.trigger("select:change",e)},this),c.on("contextMenu",this.showContextMenu,this),s.get("hasSDCard")?c.emptyTip=o.music.MUSIC_EMPTY_TEXT:c.emptyTip=o.common.NO_SD_CARD_TIP_TEXT,this.listenTo(c,"switchSet",this.toggleEmptyTip),this.listenTo(s,"change:isFastADB",this.toggleEmptyTip))},toggleEmptyTip:function(){if(l.loading||l.syncing||s.get("isFastADB")){c.toggleEmptyTip(!1);return}c.toggleEmptyTip(c.currentModels.length===0)},showContextMenu:function(e){var t=f.getInstance({selected:e});t.show()},render:function(){return this.$el.html(this.template({})),this.buildList(),this}}),p,d=t.extend({getInstance:function(e){return p||(p=new h(e)),p}});return d})}(this),function(e,t){define("music/iTunes/iTunesData",["jquery","IO","Configuration","Log"],function(e,t,n,r){var i={begin:function(){var i=e.Deferred();return t.requestAsync({url:n.actions.ITUNES_IMPORT_BEGIN,success:function(e){e.state_code===200?i.resolve(e.body||{}):i.reject(e.body||{})}}),r({event:"debug.itunes.import.begin"}),i.promise()},parseSource:function(r){var i=e.Deferred();return t.requestAsync({url:n.actions.ITUNES_IMPORT_PARSE,data:r,success:function(e){e.state_code===200?i.resolve(e.body||{}):i.reject(e.body||{})}}),i.promise()},queryAudios:function(){var r=e.Deferred();return t.requestAsync({url:n.actions.ITUNES_IMPORT_QUERY,success:function(e){e.state_code===200?r.resolve(e.body||{}):r.reject(e.body||{})}}),r.promise()},importAudios:function(i){var s=(new Date).getTime(),o=e.Deferred();return t.requestAsync({url:n.actions.ITUNES_IMPORT_AUDIO,data:i,success:function(e){var t=(new Date).getTime();if(e.state_code===200)o.resolve(e.body||{}),r({event:"debug.itunes.importSuccess",success:e.body.success.length||0,time:t-s});else if(e.state_code===402){var n=0;e.body&&e.body.success&&(n=e.body.success.length),r({event:"debug.itunes.importCancel",success:e.body&&e.body.success.length||0,time:t-s})}else o.reject(e.body||{}),r({event:"debug.itunes.importFail",state_code:e.state_code,state_line:e.state_line||""})}}),o.promise()},createPlaylist:function(r,i,s){var o=e.Deferred();return t.requestAsync({url:n.actions.ITUNES_CREATE_PLAYLIST,data:r,success:function(e){e.state_code===200?o.resolve(e.body||{}):o.reject(e.body||{})}}),o.promise()},finish:function(){var r=e.Deferred();return t.requestAsync({url:n.actions.ITUNES_IMPORT_FINISH,success:function(e){e.state_code===200?r.resolve(e.body||{}):r.reject(e.body||{})}}),r.promise()},cancel:function(r){var i=e.Deferred();return t.requestAsync({url:n.actions.MUSIC_CANCEL,data:r,success:function(e){e.state_code===200?i.resolve(e.body||{}):i.reject(e.body||{})}}),i.promise()}};return i})}(this),function(e,t){define("music/iTunes/views/SelectLibraryView",["underscore","doT","jquery","ui/Panel","ui/TemplateFactory","utilities/FormatDate","Internationalization","music/iTunes/iTunesData"],function(e,t,n,r,i,s,o,u){console.log("selectLibraryView file loaded");var a=o.music,f=o.common,l=r.extend({className:r.prototype.className+" w-iTunes-select-library-panel",initialize:function(){l.__super__.initialize.call(this);var e=[{$button:n("<button/>").addClass("primary").html(f.NEXT_STEP),eventName:"NEXT_STEP"},{$button:n("<button/>").html(f.CANCEL),eventName:"CANCEL"}];this.title=a.ITUNES_IMPORT,this.width=430,this.height=270,this.draggable=!0,this.disableX=!0,this.buttons=e,this.off("NEXT_STEP"),this.off("CANCEL"),this.on("NEXT_STEP",function(){this.trigger("_NEXT_STEP",this.data[this.selectedIndex]),this.close()},this),this.on("CANCEL",function(){this.trigger("_CANCEL"),this.close()},this)},render:function(){e.extend(this.events,l.__super__.events),this.delegateEvents(),l.__super__.render.call(this)},show:function(e){l.__super__.show.call(this),this.data=e,this.recovery(),this.createContent(e)},recovery:function(){this.selectedIndex=0,n("input:first",this.$el).prop("checked","checked")},createContent:function(n){var r=t.template(i.get("iTunes","select-library-content"));e.each(n,function(e){e.time=s("yyyy-MM-dd",e.create_time)}),this.$bodyContent=r(n)},clickInput:function(e){this.selectedIndex=parseInt(e.target.value,10)},events:{"click input":"clickInput"}}),c,h=e.extend({getInstance:function(){return c||(c=new l),c}});return h})}(this),function(e,t){define("music/iTunes/views/SelectSourceView",["underscore","doT","jquery","ui/UIHelper","ui/Panel","ui/AlertWindow","Internationalization","ui/TemplateFactory","utilities/StringUtil","music/iTunes/iTunesData"],function(t,n,r,i,s,o,u,a,f,l){console.log("SelectSourceView - File loaded. ");var c=e.alert,h=0,p,d=s.extend({className:s.prototype.className+" w-iTunes-select-source-panel",initialize:function(){d.__super__.initialize.call(this);var e=[{$button:r("<button/>").addClass("primary next-step").html(u.common.NEXT_STEP),eventName:"NEXT_STEP"},{$button:r("<button/>").html(u.common.CANCEL),eventName:"CANCEL"}];this.sourceType=0,this.buttons=e,this.off("NEXT_STEP"),this.off("CANCEL"),this.on("NEXT_STEP",function(){this.playlistData.sourceType=this.sourceType,this.playlistData.songs=h,this.playlistData.capacity=p,this.trigger("_NEXT_STEP",this.playlistData),this.hide()},this),this.on("CANCEL",function(){this.trigger("_CANCEL"),this.close()},this)},render:function(){t.extend(this.events,d.__super__.events),this.delegateEvents(),d.__super__.render.call(this)},show:function(e){d.__super__.show.call(this);if(!!e){this.recovery(),this.createContent(),this.disableNextStep(!0),this.iTunesXMLdata=e;var t={path:this.iTunesXMLdata instanceof Array?this.iTunesXMLdata[0].path:this.iTunesXMLdata.path};l.parseSource(t).done(this.parseSourceSuccess.bind(this)).fail(this.parseSourceFail.bind(this))}},recovery:function(){r("input:first",this.$el).prop("checked","checked"),this.sourceType=0,this.$bodyContent=""},createContent:function(){var e=n.template(a.get("iTunes","select-source-content")),t=[{label:u.music.ALL_AUDIOS_AND_PLAYLIST},{label:u.music.SELECT_PLAYLIST},{label:u.music.SELECT_AUDIOS}];this.$bodyContent=e(t)},disableNextStep:function(e){this.$(".next-step").prop({disabled:e})},parseSourceSuccess:function(e){this.playlistData=e;if(!e||!e.play_lists||e.play_lists.length===0){this.trigger("CANCEL"),c(u.music.PARSE_EMPTY_LIST);return}var t=n.template(a.get("iTunes","iTunes-source-info")),r=e.songs;h=e.songs,p=e.total,this.disableNextStep(!1);var i={playlistCount:e.play_lists.length,audiosCount:r,capacitySize:f.readableSize(p)};this.$(".source-tip").html(t(i))},parseSourceFail:function(e){c(u.music.PARSE_ITUNES_SOURCE_FAIL),this.trigger("CANCEL")},events:{"change input":function(e){this.sourceType=e.target.value}}}),v,m=t.extend({getInstance:function(){return v||(v=new d({title:u.music.ITUNES_IMPORT,width:430,height:270,draggable:!0,disableX:!0})),v}});return m})}(this),function(e,t){define("music/iTunes/views/PlayListView",["underscore","doT","jquery","Configuration","ui/UIHelper","ui/Panel","Internationalization","utilities/FormatString","ui/TemplateFactory","ui/behavior/ButtonSetMixin","utilities/StringUtil","music/iTunes/iTunesData"],function(e,t,n,r,i,s,o,u,a,f,l,c){var h=o.music,p,d,v=0,m=s.extend({className:s.prototype.className+" w-iTunes-playlist-panel",initialize:function(){m.__super__.initialize.call(this);var i=[{$button:n("<button/>").html(o.common.PRE_STEP),eventName:"PRE_STEP"},{$button:n("<button/>").addClass("primary next-step").html(o.common.NEXT_STEP),eventName:"NEXT_STEP"},{$button:n("<button/>").html(o.common.CANCEL),eventName:"CANCEL"}];this.title=h.ITUNES_IMPORT,this.width=600,this.height=410,this.draggable=!0,this.disableX=!0,this.buttons=i,this.$bodyContent=t.template(a.get("iTunes","playlist"))({}),this.off("NEXT_STEP"),this.off("PRE_STEP"),this.off("CANCEL"),this.on("NEXT_STEP",function(){var t=[],n=[],i=p.getCheckedData(),s={iTunesIds:[],playlistIds:[],sourceType:r.enums.ITUNES_IMPORT_PLAYLIST,capacity:d};e.each(i,function(e){s.iTunesIds=s.iTunesIds.concat(e.tracks_id),s.playlistIds.push(e.id)}),this.trigger("_NEXT_STEP",s),this.close()},this),this.on("PRE_STEP",function(){this.trigger("_PRE_STEP"),this.hide()},this),this.on("CANCEL",function(){this.trigger("_CANCEL"),this.close()},this)},show:function(e){m.__super__.show.call(this),this.addContent(e.play_lists)},addContent:function(t){this.initPlaylist(),e.each(t,function(e){e.count=e.tracks_id.length}),p.setData(t)},initPlaylist:function(){this.disableNextStep(!1);var e=n(".playlist-content",this.$el);e.html(""),p=new wonder.ui.Grid({colModel:[{colLabel:h.PLAYLIST_NAME,index:"name",name:"name",width:310,resizable:!0,sortable:!0,sorttype:"text"},{colLabel:h.AUDIOS_COUNT,index:"count",name:"count",width:200,resizable:!0,sortable:!0,sorttype:"number"}],rowHeight:30,multiSelectable:!0,checkboxColWidth:25,isContentMultiSelected:!0}),p.render(e),p.bind(wonder.ui.Grid.Events.SELECT,this.showSelectCountText,this),p.bind(wonder.ui.Grid.Events.UNSELECT,this.showSelectCountText,this),p.bind(wonder.ui.Grid.Events.SELECT_ALL,this.showSelectCountText,this),p.bind(wonder.ui.Grid.Events.UNSELECT_ALL,this.showSelectCountText,this),this.showSelectCountText()},showSelectCountText:function(){var t=n(".select-count-wrap",this.$el);t.length||(t=n("<div/>").addClass("select-count-wrap"),t.appendTo(this.$(".w-ui-window-body")));var r=p.getCheckedData(),i=r.length,s=0;d=0,e.each(r,function(e){s+=e.tracks_id.length,d+=parseInt(e.size,10)});var a=u(o.music.SELECT_PLAYLIST_COUNT_TEXT,i,s,l.readableSize(d));t.html(a),r.length?this.disableNextStep(!1):this.disableNextStep(!0)},disableNextStep:function(e){n(".next-step",this.$el).prop("disabled",!!e)}}),g,y=e.extend({getInstance:function(){return g||(g=new m),g}});return y})}(this),function(e,t){define("music/iTunes/views/AudioListView",["underscore","doT","jquery","Configuration","Internationalization","ui/UIHelper","ui/Panel","ui/TemplateFactory","ui/behavior/ButtonSetMixin","utilities/StringUtil","utilities/FormatString","music/iTunes/iTunesData"],function(e,t,n,r,i,s,o,u,a,f,l,c){var h=i.music,p=7,d,v,m=o.extend({className:o.prototype.className+" w-iTunes-audio-list-panel",initialize:function(){m.__super__.initialize.call(this);var s=[{$button:n("<button/>").html(i.common.PRE_STEP),eventName:"PRE_STEP"},{$button:n("<button/>").addClass("primary next-step").html(i.common.NEXT_STEP),eventName:"NEXT_STEP"},{$button:n("<button/>").html(i.common.CANCEL),eventName:"CANCEL"}];this.title=h.ITUNES_IMPORT,this.width=600,this.height=410,this.draggable=!0,this.disableX=!0,this.buttons=s,this.$bodyContent=t.template(u.get("iTunes","audio-list"))({}),this.off("NEXT_STEP"),this.off("PRE_STEP"),this.off("CANCEL"),this.on("PRE_STEP",function(){this.trigger("_PRE_STEP"),this.close()},this),this.on("NEXT_STEP",function(){var t={iTunesIds:e.pluck(d.getCheckedData(),"id"),sourceType:r.enums.ITUNES_IMPORT_AUDIOS,capacity:v};this.trigger("_NEXT_STEP",t),this.close()},this),this.on("CANCEL",function(){this.trigger("_CANCEL"),this.close()},this)},show:function(e){m.__super__.show.call(this),this.initAudioList(),c.queryAudios().done(this.queryAudiosSuccess.bind(this)).fail(this.queryAudiosFail.bind(this))},initAudioList:function(){this.disableNextStep(!1);var e=this.$(".audio-list-content");e.addClass("loading"),e.html(""),d=new wonder.ui.Grid({colModel:[{colLabel:h.SING_NAME_TEXT,index:"title",name:"title",width:160,resizable:!0,sortable:!0,sorttype:"text"},{colLabel:h.ARTIST_TEXT,index:"artist",name:"artist",width:140,resizable:!0,sortable:!0,sorttype:"text"},{colLabel:h.ALBUM_TEXT,index:"album",name:"album",width:150,resizable:!0},{colLabel:h.SING_SIZE_TEXT,index:"size",name:"size",width:70,resizable:!1,sortable:!0,sorttype:"number",dataType:"size"}],rowHeight:30,multiSelectable:!0,checkboxColWidth:25,isContentMultiSelected:!0}),d.render(e),d.bind(wonder.ui.Grid.Events.SELECT,this.showSelectCountText,this),d.bind(wonder.ui.Grid.Events.UNSELECT,this.showSelectCountText,this),d.bind(wonder.ui.Grid.Events.SELECT_ALL,this.showSelectCountText,this),d.bind(wonder.ui.Grid.Events.UNSELECT_ALL,this.showSelectCountText,this),this.showSelectCountText()},showSelectCountText:function(){var t=n(".select-count-wrap",this.$el);t.length||(t=n("<div/>").addClass("select-count-wrap"),t.appendTo(this.$(".w-ui-window-body")));var r=d.getCheckedData(),s=r.length;v=0,e.each(r,function(e){v+=parseInt(e.size,10)});var o=l(i.music.SELECT_AUDIOS_COUNT_TEXT,s,f.readableSize(v));t.html(o),r.length?this.disableNextStep(!1):this.disableNextStep(!0)},queryAudiosSuccess:function(e){this.$(".audio-list-content").removeClass("loading"),d.setData(e.audio)},queryAudiosFail:function(){this.$(".audio-list-content").removeClass("loading")},disableNextStep:function(e){n(".next-step",this.$el).prop("disabled",!!e)}}),g,y=e.extend({getInstance:function(){return g||(g=new m),g}});return y})}(this),function(e,t){define("music/iTunes/views/ImportView",["underscore","doT","jquery","Log","IOBackendDevice","ui/Panel","ui/AlertWindow","Environment","WindowController","Device","Configuration","Internationalization","ui/TemplateFactory","ui/behavior/ButtonSetMixin","utilities/FormatString","music/iTunes/iTunesData"],function(t,n,r,i,s,o,u,a,f,l,c,h,p,d,v,m){console.log("iTunes ImportView - File Loaded");var g=e.alert,y=h.music,b="import-audios-progress",w="create-playlist-progress",E,S,x=o.extend({className:o.prototype.className+" w-iTunes-import-panel",initialize:function(){x.__super__.initialize.call(this);var e=[{$button:r("<button/>").addClass("import cancel").html(h.common.CANCEL),eventName:"import"}];this.title=y.ITUNES_IMPORT,this.width=430,this.height=270,this.draggable=!0,this.disableX=!0,this.buttons=e,this.$bodyContent=n.template(p.get("iTunes","iTunes-import"))({title:y.IMPORTING_TITLE})},render:function(){t.extend(this.events,x.__super__.events),this.delegateEvents(),x.__super__.render.call(this)},show:function(e){x.__super__.show.call(this),this.updatePanelTitleAndBtn(!1),this.$("."+b).remove(),this.$("."+w).remove(),this.data=e,this.importAudiosData={},this.createPlaylistData={};switch(parseInt(e.sourceType,10)){case c.enums.ITUNES_IMPORT_ALL:this.isCreatePlaylist=!0,this.importAudiosData={},this.createPlaylistData={},i({event:"debug.itunes.import",type:"all"});break;case c.enums.ITUNES_IMPORT_PLAYLIST:this.importAudiosData.itunes_id=e.iTunesIds.join(","),this.createPlaylistData.playlist_id=e.playlistIds.join(","),this.isCreatePlaylist=!0,i({event:"debug.itunes.import",type:"playlist"});break;case c.enums.ITUNES_IMPORT_AUDIOS:this.importAudiosData.itunes_id=e.iTunesIds.join(","),this.isCreatePlaylist=!1,i({event:"debug.itunes.import",type:"audios"})}this.startImportAudios()},updatePanelTitleAndBtn:function(e){e?(this.$("h3").html(y.IMPORT_COMPLETE),this.$(".import").removeClass("cancel").addClass("primary complete").html(h.common.OK)):(this.$("h3").html(y.IMPORTING_TITLE),this.$(".import").removeClass("complete").addClass("cancel").removeClass("primary").html(h.common.CANCEL))},renderProgress:function(e){var t=this.$("."+e.className);t.length&&t.remove();var r=n.template(p.get("iTunes","import-progress")),i=r(e);this.$(".progress-wrap").append(i)},startImportAudios:function(){var e=c.events.AUDIOS_IMPORT_MESSAGE;this.renderProgress({tip:h.music.IMPORTING_AUDIOS_TIP,className:b,current:0,isFaild:!1,total:this.data.songs||this.data.iTunesIds.length});var t=this.$("."+b+" .current"),n=this.$("."+b+" .total"),r=s.Backend.Device.onmessage({"data.channel":e},function(e){t.html(e.current),n.html(e.total),e.current===e.total&&s.Backend.Device.offmessage(r)},this);E=e,S=r,this.importAudiosData.session=e,f.blockWindowAsync(),m.importAudios(this.importAudiosData).done(this.importAudiosSuccess.bind(this)).fail(this.importAudiosFail.bind(this))},startCreatePlayList:function(){if(l.get("isMounted")){g(y.MOUNT_CANNOT_CREATE_PLAYLIST),this.createPlaylistFail({total:this.data.playlistIds&&this.data.playlistIds.length||0}),this.updatePanelTitleAndBtn(!0);return}var e=c.events.PLAYLIST_IMPORT_MESSAGE;this.renderProgress({tip:h.music.CREATING_PLAYLIST_TIP,className:w,current:0,isFaild:!1,total:this.data.play_lists&&this.data.play_lists.length||this.data.playlistIds&&this.data.playlistIds.length});var t=this.$("."+w+" .current"),n=this.$("."+w+" .total"),r=s.Backend.Device.onmessage({"data.channel":e},function(e){t.html(e.current),n.html(e.total),e.current===e.total&&s.Backend.Device.offmessage(r)},this);E=e,S=r,this.createPlaylistData.session=e,m.createPlaylist(this.createPlaylistData).done(this.createPlaylistSuccess.bind(this)).fail(this.createPlaylistFail.bind(this))},importAudiosSuccess:function(e){e.success&&e.success.length===e.total?(this.$("."+b+" .progress-tip").html(h.music.AUDIOS_IMPORT_COMPLETE),this.isCreatePlaylist?this.startCreatePlayList():this.updatePanelTitleAndBtn(!0)):this.importAudiosFail(e),f.releaseWindowAsync()},importAudiosFail:function(e){s.Backend.Device.offmessage(S);var t={tip:h.music.AUDIOS_IMPORT_FAILD,className:b,isFaild:!0,current:e.success&&e.success.length||0,total:e.total};this.renderProgress(t);var n=v(h.music.IMPORT_AUDIOS_FAILD_TIP,e.failed.length),i=[{$button:r("<button/>").addClass("primary retry").html(h.common.RETRY_TEXT),eventName:"RETRY"},{$button:r("<button/>").addClass("ignore").html(h.common.IGNORE),eventName:"IGNORE"},{$button:r("<button/>").html(h.common.CANCEL),eventName:"CANCEL"}],u=new o({title:h.common.DIALOG_TIP,width:360,disableX:!0,draggable:!0,buttons:i,$bodyContent:n});u.off("RETRY"),u.off("IGNORE"),u.off("CANCEL"),u.on("RETRY",function(){this.startImportAudios(),u.close()},this),u.on("IGNORE",function(){this.startCreatePlayList(),u.close()},this),u.on("CANCEL",function(){this.clickCancelImport(),u.close()},this),u.show(),s.Backend.Device.onmessage({"data.channel":c.events.DEVICE_STATE_CHANGE},function(e){r(".retry",this.$el).prop("disabled",!l.get("isConnected")||l.get("isWifi")||l.get("isInternet")),r(".ignore",this.$el).prop("disabled",!l.get("isConnected")||l.get("isWifi")||l.get("isInternet"))},u),f.releaseWindowAsync()},createPlaylistSuccess:function(e){this.updatePanelTitleAndBtn(!0),s.Backend.Device.offmessage(S);if(e.success&&e.success.length===e.total)this.$("."+w+" .progress-tip").html(h.music.CREATE_PLAYLIST_COMPLETE);else{this.createPlaylistFail(e);var t=v(h.music.CREATE_PLAYLIST_FAILD_TIP,e.failed.length),n=[{$button:r("<button/>").addClass("primary retry").html(h.common.RETRY_TEXT),eventName:"RETRY"},{$button:r("<button/>").html(h.common.CANCEL),eventName:"CANCEL"}],i=new o({title:h.common.DIALOG_TIP,width:360,disableX:!0,draggable:!0,buttons:n,$bodyContent:t});i.off("RETRY"),i.off("CANCEL"),i.on("RETRY",function(){m.createPlaylist(this.createPlaylistData).done(this.createPlaylistSuccess.bind(this)).fail(this.createPlaylistFail.bind(this)),i.close(),this.updatePanelTitleAndBtn(!1)},this),i.on("CANCEL",function(){i.close()},this),i.show(),s.Backend.Device.onmessage({"data.channel":c.events.DEVICE_STATE_CHANGE},function(e){r(".retry",this.$el).prop("disabled",!l.get("isConnected")||l.get("isWifi")||l.get("isInternet"))},i)}},createPlaylistFail:function(e){s.Backend.Device.offmessage(S);var t={tip:h.music.CREATE_PLAYLIST_FAILD,className:w,isFaild:!0,current:e.success&&e.success.length||0,total:e.total};this.renderProgress(t)},clickCancelImport:function(){var e={session:E};s.Backend.Device.offmessage(S),m.cancel(e),m.finish().always(this.closePanel.bind(this)),f.releaseWindowAsync()},clickCompleteImport:function(){m.finish().always(this.closePanel.bind(this))},closePanel:function(){this.close()},events:{"click .cancel":"clickCancelImport","click .complete":"clickCompleteImport"}}),T,N=t.extend({getInstance:function(){return T||(T=new x),T}});return N})}(this),function(e,t){define("music/iTunes/iTunesController",["ui/Panel","Configuration","Internationalization","utilities/StringUtil","utilities/FormatDate","music/iTunes/iTunesData","music/iTunes/views/SelectLibraryView","music/iTunes/views/SelectSourceView","music/iTunes/views/PlayListView","music/iTunes/views/AudioListView","music/iTunes/views/ImportView"],function(e,t,n,r,i,s,o,u,a,f,l){function c(){function v(e){i=o.getInstance(),c=u.getInstance(),h=a.getInstance(),p=f.getInstance(),d=l.getInstance();var t=e.info;t.length===1?c.show(t):t.length>1?i.show(t):this.startImportiTunesFail(),m()}function m(){i.off("_NEXT_STEP"),i.off("_CANCEL"),c.off("_NEXT_STEP"),c.off("_CANCEL"),h.off("_PRE_STEP"),h.off("_NEXT_STEP"),h.off("_CANCEL"),p.off("_PRE_STEP"),p.off("_CANCEL"),p.off("_NEXT_STEP"),i.on("_NEXT_STEP",function(e){c.show(e)},this),i.on("_CANCEL",function(){s.finish()},this),c.on("_NEXT_STEP",function(e){switch(parseInt(e.sourceType,10)){case t.enums.ITUNES_IMPORT_ALL:g(e,d.show,d),c.close();break;case t.enums.ITUNES_IMPORT_PLAYLIST:h.show(e);break;case t.enums.ITUNES_IMPORT_AUDIOS:p.show(e)}},this),c.on("_CANCEL",function(){s.finish()},this),h.on("_PRE_STEP",function(){c.show()},this),h.on("_NEXT_STEP",function(e){g(e,d.show,d),c.close()},this),h.on("_CANCEL",function(){s.finish(),c.close()},this),p.on("_PRE_STEP",function(){c.show()},this),p.on("_NEXT_STEP",function(e){g(e,d.show,d),c.close()},this),p.on("_CANCEL",function(){s.finish(),c.close()},this)}function g(t,i,o){if(t.capacity<=Math.pow(1024,3))i.call(o,t);else{var u,a=r.readableSize(t.capacity),f=parseFloat(a),l;f*1024%60?l=(f*1024/60/60).toFixed(1):l=f*1024/60/60,a.indexOf("GB")!==-1?u=r.format(n.common.HOUR,l):a.indexOf("TB")!==-1&&(u=r.format(n.common.HOUR,l*1024));var c=r.format(n.music.CONFIRM_IMPORT,a,u),h=[{$button:$("<button/>").addClass("primary").html(n.common.OK),eventName:"OK"},{$button:$("<button/>").html(n.common.CANCEL),eventName:"CANCEL"}],p=new e({title:n.common.DIALOG_TIP,width:360,disableX:!0,draggable:!0,buttons:h,$bodyContent:c});p.off("OK"),p.off("CANCEL"),p.on("OK",function(){i.call(o,t),p.close()},this),p.on("CANCEL",function(){s.finish(),p.close()},this),p.show()}}var i,c,h,p,d;return{start:function(){s.begin().done(v.bind(this)).fail(this.startImportiTunesFail.bind(this))},startImportiTunesFail:function(e){var t;switch(e.state_code){case 724:t=n.music.ALEADY_EXIT_ITUNES_TASK;break;case 725:t=n.music.NO_ITUNES_IMPORT_TASK;break;case 726:t=n.music.PARSE_ITUNES_SOURCE_FAILD;break;case 727:t=n.music.NO_ITUNES_FILE;break;default:t=n.music.START_IMPORT_ITUNES_FAIL}alert(t),s.finish()},finish:function(){s.finish()}}}console.log("iTunes file loaded"),_.extend(c.prototype,Backbone.Events);var h=new c;return h})}(this),function(e,t){define("music/views/MusicModuleToolbarView",["underscore","doT","jquery","ui/Toolbar","ui/TemplateFactory","ui/AlertWindow","Internationalization","Device","Log","music/collections/MusicsCollection","music/iTunes/iTunesService","music/views/MusicsListView","music/views/ImportMusicView","music/MusicService","music/iTunes/iTunesController"],function(t,n,r,i,s,o,u,a,f,l,c,h,p,d,v){console.log("MusicModuleToolbarView - File loaded. ");var m=e.alert,g,y,b,w=i.extend({template:n.template(s.get("music","toolbar")),className:i.prototype.className+" w-music-toolbar",initialize:function(){a.on("change",this.setButtonState,this),y=l.getInstance(),y.on("refresh",this.setButtonState,this)},setButtonState:function(){this.$(".button-add-music, .button-refresh").prop({disabled:!a.get("isConnected")||!a.get("hasSDCard")}),this.$(".button-itunes").prop({disabled:a.get("isMounted")||!a.get("isConnected")||!a.get("hasSDCard")||a.get("isWifi")||a.get("isInternet")}),this.$(".button-delete").prop({disabled:!a.get("isConnected")||!a.get("hasSDCard")||g.selected.length===0}),this.$(".button-export").prop({disabled:!a.get("isConnected")||!a.get("hasSDCard")||g.selected.length===0||y.models.length===0})},render:function(){return this.$el.html(this.template({})),c.checkiTunesAsync().done(function(e){e.body.value&&this.$(".button-itunes").show()}.bind(this)),g=h.getInstance({$observer:this.$(".check-select-all")}),g.on("select:change",this.setButtonState,this),this.setButtonState(),this},clickButtonAddMusic:function(){p.getInstance().show()},clickButtonDelete:function(){d.deleteMusicsAsync(g.selected),f({event:"ui.click.music.button.delete",count:g.selected.length,source:"toolbar"})},clickButtonRefresh:function(){y.syncAsync().fail(function(){m(u.common.REFRESH_ERROR)})},clickButtonExport:function(){d.exportMusicsAsync(g.selected),f({event:"ui.click.music.button.export",count:g.selected.length,source:"toolbar"})},clickButtonITunes:function(){v.start()},events:{"click .button-add-music":"clickButtonAddMusic","click .button-delete":"clickButtonDelete","click .button-refresh":"clickButtonRefresh","click .button-export":"clickButtonExport","click .button-itunes":"clickButtonITunes"}}),E,S=t.extend({getInstance:function(){return E||(E=new w),E}});return S})}(this),function(window,undefined){define("music/views/MusicModuleView",["underscore","backbone","music/collections/MusicsCollection","music/views/MusicModuleToolbarView","music/views/MusicsListView","music/views/ImportMusicView"],function(_,Backbone,MusicsCollection,MusicModuleToolbarView,MusicsListView,ImportMusicView){console.log("MusicModuleView - File loaded. ");var MusicModuleView=Backbone.View.extend({className:"w-music-module-main module-main vbox",initialize:function(){var e=!1;Object.defineProperties(this,{rendered:{set:function(t){e=t},get:function(){return e}}})},render:function(){return this.$el.append(MusicModuleToolbarView.getInstance().render().$el),this.$el.append(MusicsListView.getInstance().render().$el),this.rendered=!0,this}}),musicModuleView,factory=_.extend({getInstance:function(){return musicModuleView||(musicModuleView=new MusicModuleView),musicModuleView},showImport:function(param){var obj=eval("("+param+")"),resp={body:obj},inst=ImportMusicView.getInstance();inst.resp=resp,inst.show()},preload:function(){MusicsCollection.getInstance()}});return factory})}(this),function(e,t){define("contact/views/QuickAddPanelView",["backbone","doT","jquery","underscore","ui/TemplateFactory","Internationalization","Device","Log","contact/collections/AccountCollection","contact/collections/ContactsCollection","contact/views/AccountSelectorView"],function(e,t,n,r,i,s,o,u,a,f,l){console.log("QuickAddPanelView - File loaded. ");var c,h=e.View.extend({template:t.template(i.get("contact","quick-add")),className:"w-contact-quick-add-panel",initialize:function(){var e=!1;Object.defineProperties(this,{running:{set:function(t){e=t,this.$("input, button").prop({disabled:e}),this.$(".running").toggle(e)},get:function(){return e}}}),o.on("change:isConnected",function(e,t){this.$("button").prop({disabled:!t})},this)},validateForm:function(){var e=this.$("input"),t;if(!e[0].value.trim()&&!e[1].value.trim()&&!e[2].value.trim())return n(e[0]).focus(),!1;var r;for(r=0;r<e.length;r++){t=n(e[r]);if(!t[0].validity.valid)return t.focus(),!1}return!0},render:function(){return this.$el.html(this.template({})),this.$("button").prop({disabled:!o.get("isConnected")}),c=l.getInstance({disableAllLabel:!0,displayReadOnly:!1}),this.$(".account-ctn").append(c.render().$el),c.$el.attr({id:"w-contact-quick-add-account"}),this.$("#w-contact-quick-add-email")[0].addEventListener("invalid",function(e){e.preventDefault()},!0),this},generateData:function(){var e=a.getInstance().get(c.accountId),t={name:{value:this.$(".input-name").val().trim()},account_name:e.get("name"),account_type:e.get("type")},n=this.$(".input-phone").val().trim(),r=this.$(".input-email").val().trim();return n&&(t.phone=[{value:n,type:2}]),r&&(t.email=[{value:r,type:1}]),t},showHint:function(e){var t=this.$(".hint").html(e);setTimeout(function(){t.html("")},2e3)},clickButtonSave:function(e){this.validateForm()&&(this.running=!0,f.getInstance().addNewContactAsync(this.generateData()).done(function(){this.$(".new-contact")[0].reset(),this.showHint(s.contact.SAVE_SUCCESS)}.bind(this)).fail(function(){this.showHint(s.contact.SAVE_FAILED)}.bind(this)).always(function(){this.running=!1}.bind(this))),u({event:"ui.click.contact.save.button.quick.add",nameIsNull:this.$(".input-name").val().trim()?!0:!1,telIsNull:this.$(".input-phone").val().trim()?!0:!1,emailIsNull:this.$(".input-email").val().trim()?!0:!1})},events:{"click .button-save":"clickButtonSave"}}),p,d=r.extend({getInstance:function(){return p||(p=new h),p}});return d})}(this),function(e,t,n){define("contact/views/ContactPanelView",["underscore","backbone","jquery","ui/TemplateFactory","utilities/StringUtil","contact/views/QuickAddPanelView","contact/views/BatchContactsView","contact/views/ContactsListView","contact/views/DetailPanelView","contact/collections/ContactsCollection","contact/ContactService"],function(e,t,n,r,i,s,o,u,a,f,l){console.log("ContactPanelView - File loaded.");var c={QUICK_ADD_PANEL:".w-contact-quick-add-panel",BATCH_CONTACT_PANEL:".w-contact-batch-contacts",DETAIL_PANEL:".w-contact-detail-panel"},h,p,d,v,m=t.View.extend({className:"w-contact-panel",initialize:function(){h=u.getInstance(),h.on("select:change",this.handelSwitch,this),t.on("contactContextMenuMerge",this.mergeContacts,this)},render:function(){return p=s.getInstance(),this.$el.append(p.render().$el),this},renderDetailPanelView:function(){v=a.getInstance(),this.$el.append(v.$el),v.on("cancel",function(){this.handelSwitch(h.selected)},this),v.on("save",function(e){h.highlight({id:e})},this)},handelSwitch:function(e){e.length!==0?e.length>1?this.switchTo("batch",e):this.switchTo("detail",e[0]):this.switchTo("quick-add")},createNew:function(e){e=e||f.getInstance().generateNewContact(),e.set({isNew:!0}),this.$([c.QUICK_ADD_PANEL,c.BATCH_CONTACT_PANEL].join(",")).addClass("w-layout-hidden"),v?(this.$(c.DETAIL_PANEL).removeClass("w-layout-hidden"),v.createNewContact(e)):(this.renderDetailPanelView(),v.createNewContact(e))},mergeContacts:function(e){l.mergeContactAsync(e).done(function(e){this.createNew(e)}.bind(this))},switchTo:function(e,t){this.$([c.QUICK_ADD_PANEL,c.BATCH_CONTACT_PANEL,c.DETAIL_PANEL].join(",")).addClass("w-layout-hidden");switch(e){case"quick-add":this.$(c.QUICK_ADD_PANEL).removeClass("w-layout-hidden");break;case"detail":v?(this.$(c.DETAIL_PANEL).removeClass("w-layout-hidden"),v.update(t)):(this.renderDetailPanelView(),v.update(t));break;case"batch":d?(this.$(c.BATCH_CONTACT_PANEL).removeClass("w-layout-hidden"),d.update(t)):(d=o.getInstance(),this.$el.append(d.render().$el),d.update(t))}}}),g,y=e.extend({getInstance:function(){return g||(g=new m),g}});return y})}(this,this.document),function(e,t){define("contact/views/ImportSelectFileView",["backbone","doT","jquery","underscore","Device","Internationalization","Configuration","ui/Panel","ui/UIHelper","ui/AlertWindow","ui/TemplateFactory","contact/ContactService","IO","contact/models/ImportContextModel"],function(t,n,r,i,s,o,u,a,f,l,c,h,p,d){console.log("ImportSelectFile - File loaded");var v=/\.(vcf|csv)$/i,m=/\.(csv)$/i,g="|",y=e.alert,b=r("<button>").html(o.misc.EXPLORE).addClass("button-browser").addClass("primary"),w=t.View.extend({template:n.template(c.get("contact","import-file-select")),className:"w-contact-import-selectfile-body-ctn",initialize:function(){w.__super__.initialize.apply(this,arguments),this.listenTo(s,"change:isConnected",function(e,t){b.prop("disabled",!t),this.$("input[name=file]").prop("disabled",t)})},render:function(){return this.$el.html(this.template({})),this.$(".browser").append(b),this},clickBrowserBtn:function(){p.requestAsync(u.actions.CONTACT_SELECT_CONTACT_FILE).done(function(e){if(e.state_code===200){var t=e.body.value,n=t.join(g);this.setFilePath(n),this.checkFile(n)}}.bind(this))},setFilePath:function(e){this.$("input[name=file]").val(e)},getFilePath:function(){return this.$("input[name=file]").val().trim()},checkFile:function(e){function f(e){p.requestAsync({url:u.actions.CHECK_FILE_PATH,data:{file_path:e}}).done(function(e){e.body.value!=="2"?(r.show(),this.trigger("__SET_NEXT_BUTTON",!0)):this.trigger("__SET_NEXT_BUTTON",!1)}.bind(this))}var t,n=e.split(g),r=this.$(".invalid"),i=0,s=n.length,a=function(){this.setFilePath(""),this.trigger("__SET_NEXT_BUTTON",!0),r.hide()};if(n.length>1)for(i,s;i<s;i++){t=n[i];if(m.test(t)){y(o.contact.ALERT_SELECT_MORE_CSV_FILE,a,this);break}if(!v.test(t)){this.trigger("__SET_NEXT_BUTTON",!0),r.show();break}f.call(this,t)}else v.test(e)?f.call(this,e):(e?r.show():r.hide(),this.trigger("__SET_NEXT_BUTTON",!0))},events:{"click .button-browser":"clickBrowserBtn"}}),E,S,x=r("<button>").html(o.contact.IMPORT_FROM_BACKUP).addClass("button-switch"),T=a.extend({initialize:function(){T.__super__.initialize.apply(this,arguments),this.on(f.EventsMapping.SHOW,function(){E=new w,E.on("__SET_NEXT_BUTTON",function(e){this.setNextBtnDisable(e)},this),this.$bodyContent=E.render().$el,this.center(),this.refreshSwitchBtn(),this.setNextBtnDisable(!0),this.once("remove",E.remove,E)}),s.on("change:isConnected",function(e,t){t?this.setNextBtnDisable(!E.getFilePath()):this.setNextBtnDisable(!0)},this),this.buttons=[{$button:r("<button>").html(o.ui.NEXT).addClass("button-next primary"),eventName:"button_next"},{$button:r("<button>").html(o.ui.CANCEL),eventName:"button_cancel"}]},render:function(){i.extend(this.events,T.__super__.events),this.delegateEvents(),T.__super__.render.apply(this,arguments),this.$(".w-ui-window-footer-monitor").append(x)},refreshSwitchBtn:function(){h.getContactHasBackupAsync().done(function(e){x.toggle(e.body.value)}.bind(this))},setNextBtnDisable:function(e){this.$(".button-next").prop("disabled",e)},clickSwitchBtn:function(){this.trigger("_SWITCH_BUTTON")},clickNextBtn:function(){d.set("files",E.getFilePath()),this.trigger("_NEXT_STEP")},events:{"click .button-switch":"clickSwitchBtn","click .button-next":"clickNextBtn"}}),N={getInstance:function(){return S||(S=new T({title:o.contact.WINDOW_IMPORT_TITLE,disableX:!0,height:260,width:450})),S}};return N})}(this),function(e,t){define("contact/views/ImportProgressView",["backbone","doT","jquery","underscore","Device","Internationalization","IO","Configuration","WindowController","contact/models/ImportContextModel","ui/Panel","ui/AlertWindow","contact/collections/ContactsCollection","contact/collections/AccountCollection","ui/TemplateFactory","ui/UIHelper","utilities/StringUtil"],function(t,n,r,i,s,o,u,a,f,l,c,h,p,d,v,m,g){console.log("ImportProcessView - File loaded");var y=e.alert,b=t.View.extend({template:n.template(v.get("contact","import-progress")),className:"w-contact-import-process-body",render:function(){return this.$el.html(this.template({})),this},setDuplicate:function(e){var t=e===null?"":g.format(o.contact.DUPLICATE,e);this.$(".duplicate").text(t)}}),w,E,S=p.getInstance(),x=d.getInstance(),T=c.extend({initialize:function(){T.__super__.initialize.apply(this,arguments),this.on(m.EventsMapping.SHOW,function(){E=new b,this.$bodyContent=E.render().$el,this.center(),this.once("remove",E.remove,E)},this),this.buttons=[{$button:r("<button>").html(o.contact.FINISH).addClass("button-finish primary").hide(),eventName:"button-finish"},{$button:r("<button>").html(o.contact.CANCEL).addClass("button-cancel"),eventName:"button-cancel"}]},setProgress:function(e,t){var n=e+" / "+t;this.$(".progress-num").text(n),e===t&&(this.$(".progress-desc").text(o.contact.IMPORT_CONTACT_FINISH),this.$(".running").removeClass("running")),this.$("progress").attr({max:t,value:e})},importContact:function(){var e=l.get("accountId"),t=x.get(e).toJSON(),n=l.get("files"),r=i.uniqueId("import_contact");this.lastSession=r;var s=u.Backend.Device.onmessage({"data.channel":r},function(e){if(e.info==="dup"){var t=parseInt(e.current,10);t>0&&E.setDuplicate(e.current)}else this.setProgress(e.current,e.total),e.current===e.total&&(S.syncAsync(),u.Backend.Device.offmessage(s),this.$(".button-finish").show(),this.$(".button-cancel").hide())},this),o=function(e){f.releaseWindowAsync(),this.trigger("_IMPORT_CONTACT",e)}.bind(this);f.blockWindowAsync(),S.importAsync(t.name,t.type,n,r).always(o)},clickButtonCancel:function(){u.requestAsync({url:a.actions.CONTACT_CANCEL,data:{session:this.lastSession}}).done(function(e){e.state_code===200&&(S.syncAsync(),y(o.common.CANCEL_IMPORT_TEXT))}.bind(this)).always(function(){f.releaseWindowAsync()})},clickButtonFinish:function(){this.remove()},events:{"click .button-cancel":"clickButtonCancel","click .button-finish":"clickButtonFinish"},initState:function(){this.$(".button-finish").hide(),this.$(".button-cancel").show()}}),N={getInstance:function(){return w||(w=new T({title:o.contact.WINDOW_IMPORT_TITLE,disableX:!0,width:450})),w}};return N})}(this),function(e,t){define("contact/ImportController",["backbone","doT","jquery","underscore","ui/AlertWindow","Internationalization","contact/views/ImportSelectFileView","contact/views/ImportAutoBackupView","contact/views/ImportSelectAccountView","contact/views/ImportProgressView","contact/collections/ContactsCollection"],function(t,n,r,i,s,o,u,a,f,l,c){console.log("ImportController - File loaded. ");var h=e.alert,p,d,v,m,g,y,b=t.View.extend({start:function(e){p=p||u.getInstance(),m=m||a.getInstance(),d=d||f.getInstance(),v=v||l.getInstance(),y=y||c.getInstance(),this.buildEvents(),e?m.show():p.show(),v.initState()},buildEvents:function(){p.off("_SWITCH_BUTTON"),p.off("_NEXT_STEP"),m.off("_SWITCH_BUTTON"),m.off("_NEXT_STEP"),d.off("_NEXT_STEP"),v.off("_IMPORT_CONTACT"),p.on("_SWITCH_BUTTON",function(){this.showNextAndRemoveCurrent(p,m)},this),p.on("_NEXT_STEP",function(){this.showNextAndRemoveCurrent(p,d)},this),m.on("_SWITCH_BUTTON",function(){this.showNextAndRemoveCurrent(m,p)},this),m.on("_NEXT_STEP",function(){this.showNextAndRemoveCurrent(m,d)},this),d.on("_NEXT_STEP",function(){this.showNextAndRemoveCurrent(d,v),v.importContact()},this),v.on("_IMPORT_CONTACT",function(e){if(e.state_code===200)e.body&&e.body.contact&&e.body.contact.length>0&&(p.refreshSwitchBtn(),this.showNextAndRemoveCurrent(v,d),h(e.body.contact.length+o.contact.IMPORT_PARTIAL_FAILED)),y.syncAsync();else{v.remove();switch(e.state_code){case 500:h(o.misc.CONNECTION_LOSE);break;case 406:h(o.cantact.IMPORT_FAIL_TYPE_FILE);break;case 704:h(o.misc.NOT_ENOUGH_ROOM_FOR_IMPORT);break;case 709:h(o.backup_restore.ERROR_WHEN_WRITE_ROM);break;case 402:break;default:h(o.contact.IMPORT_CONTACTS_FAIL)}}},this)},showNextAndRemoveCurrent:function(e,t){var n=function(){t.show(),e.off("hide",n)};e.on("hide",n,this),e.remove()}});return new b})}(this),function(e,t){define("contact/views/ContactModuleToolbarView",["doT","jquery","underscore","backbone","ui/TemplateFactory","ui/Toolbar","ui/Panel","ui/MenuButton","Device","Log","Internationalization","contact/ExportController","contact/models/ExportContextModel","contact/collections/ContactsCollection","contact/collections/AccountCollection","contact/views/ContactsListView","contact/views/AccountSelectorView","contact/views/GroupSelectorView","contact/views/ContactPanelView","contact/ContactService","main/collections/PIMCollection","contact/ImportController"],function(t,n,r,i,s,o,u,a,f,l,c,h,p,d,v,m,g,y,b,w,E,S){console.log("ContactModuleToolbarView - File loaded.");var x=e.document,T,N,C,k,L,A,O="all",M="all",_="all",D={all:c.misc.NAV_CONTACT_ALL,hasnumber:c.misc.NAV_CONTACT_HAS_PHONE,starred:c.misc.NAV_CONTACT_STARRED},P=function(){return[{label:c.misc.NAV_CONTACT_ALL+"("+N.get(7).get("count")+")",type:"radio",name:"contact-tab-selector",value:"all",checked:_==="all"},{label:c.misc.NAV_CONTACT_HAS_PHONE+"("+N.get(8).get("count")+")",type:"radio",name:"contact-tab-selector",value:"hasnumber",checked:_==="hasnumber"},{label:c.misc.NAV_CONTACT_STARRED+"("+N.get(9).get("count")+")",type:"radio",name:"contact-tab-selector",value:"starred",checked:_==="starred"}]},H=a.extend({initialize:function(){H.__super__.initialize.apply(this,arguments),N=N||E.getInstance(),this.items=P.call(),this.label=D[r.find(this.items,function(e){return e.checked}).value],this.on("select",function(e){this.label=D[e.value],i.trigger("switchModule",{module:"contact",tab:e.value})},this);var e=N.filter(function(e){return e.get("parent")===1});r.each(e,function(e){e.on("change:count",function(e){this.items=P.call()},this)},this)},reset:function(){this.items=P.call(),this.label=D[r.find(this.items,function(e){return e.checked}).value]}}),B,j=o.extend({template:t.template(s.get("contact","toolbar")),initialize:function(){f.on("change:isConnected",this.setButtonState,this),T=v.getInstance(),k=d.getInstance(),k.on("refresh",this.setButtonState,this),i.on("switchModule",function(e){e.module==="contact"&&(_=e.tab,this.refresh(),B.reset())},this)},refresh:function(){C.refresh(_,O,M)},setButtonState:function(){var e=C.selected;this.$(".button-new").prop({disabled:!f.get("isConnected")}),this.$(".button-delete").prop({disabled:!f.get("isConnected")||e.length===0}),this.$(".button-merge").prop({disabled:!f.get("isConnected")||e.length<=1||k.containsReadOnly(e)}),this.$(".button-import").prop({disabled:!f.get("isConnected")}),this.$(".button-export").prop({disabled:k.length===0}),this.$(".button-refresh").prop({disabled:!f.get("isConnected")})},restoreFilter:function(){L.selectByAccountId("all")},render:function(){return this.$el.html(this.template({})),B=new H,this.$(".selector-wrap").append(B.render().$el),C=m.getInstance({$observer:this.$(".check-select-all")}),C.on("select:change",this.setButtonState,this),L=g.getInstance(),this.$(".selector-wrap").append(L.render().$el),L.on("select",function(e){if(O!==e.value){O=e.value,M="all";if(O!=="all"&&T.get(O).isSimAccount){var r=new u({draggable:!0,disposableName:"contactSimTip",disposableChecked:!1,buttonSet:"yes",$bodyContent:n(t.template(s.get("contact","contact-sim-tip"))({})),title:c.ui.TIP,width:500});r.show()}}A.update(e.value,M),this.refresh()},this),A=y.getInstance({accountId:"all"}),A.on("select",function(e){M=e.value;if(M!=="all"){var t=new RegExp(/ungroup\[\w+\]/);t.test(M)?M.replace(/(\[)(\w+)(\])/,function(e,t,n){O=n}):O=T.getAccountByGroupId(M).get("id"),L.selectByGroupId(M)}this.refresh()},this),this.$(".selector-wrap").append(A.render().$el),this.setButtonState(),this},clickButtonNew:function(){b.getInstance().createNew(),l({event:"ui.click.contact.button.new.toolbar"})},clickButtonDelete:function(){w.deleteContactsAsync(C.selected),l({event:"ui.click.contact.delete.button.toolbar",count:C.selected.length})},clickButtonExport:function(){p.set({fileType:0,dataType:0,selectedIdList:C.selected,hasPhoneIdList:r.map(k.getContactsHasPhoneNumber(),function(e){return e.get("id")}),selectNumber:C.selected.length,allNumber:k.length,hasPhoneNumber:k.getContactsHasPhoneNumber().length}),h.start()},clickButtonRefresh:function(){d.getInstance().syncAsync(),l({event:"ui.click.contact.refresh.button.toolbar"})},clickButtonMerge:function(){b.getInstance().mergeContacts(C.selected),l({event:"ui.click.contact.merge.button.toolbar",count:C.selected.length})},clickButtonImport:function(){w.getContactHasBackupAsync().done(function(e){S.start(e.body.value)})},events:{"click .button-new":"clickButtonNew","click .button-delete":"clickButtonDelete","click .button-export":"clickButtonExport","click .button-refresh":"clickButtonRefresh","click .button-merge":"clickButtonMerge","click .button-import":"clickButtonImport"}}),F,I=r.extend({getInstance:function(){return F||(F=new j),F}});return I})}(this),function(e,t){define("contact/views/ContactModuleView",["backbone","doT","underscore","ui/TemplateFactory","contact/models/ContactModel","contact/collections/ContactsCollection","contact/collections/AccountCollection","contact/views/ContactModuleToolbarView","contact/views/ContactsListView","contact/views/ContactPanelView","main/collections/PIMCollection"],function(t,n,r,i,s,o,u,a,f,l,c){console.log("ContactModuleView - File loaded. ");var h=e.setInterval,p=e.clearInterval,d,v,m,g,y=t.View.extend({template:n.template(i.get("contact","contact-main")),className:"w-contact-module-main module-main vbox",initialize:function(){var e=!1;Object.defineProperties(this,{rendered:{set:function(t){e=t},get:function(){return e}}}),m=a.getInstance(),v=o.getInstance()},render:function(){return this.$el.html(this.template({})),this.$el.prepend(m.render().$el),d=f.getInstance(),g=l.getInstance(),this.$(".w-contact-ctn").append(d.render().$el).append(g.render().$el),this.rendered=!0,this}}),b,w=r.extend({enablePreload:!1,getInstance:function(){return b||(b=new y),b},preload:function(){o.getInstance(),u.getInstance()},navigate:function(e){c.getInstance().get(1).set({selected:!0});var t=function(){var t=function(){m.restoreFilter(),d.highlight(e)};!v.loading&&!v.syncing?t():v.on("refresh",function(e){t(),e.off("refresh",arguments.callee)})};if(d)t();else var n=h(function(){d&&(p(n),t())},10)},createNew:function(e){e=new s(e),c.getInstance().get(1).set({selected:!0});if(b)g.createNew(e);else var t=h(function(){d&&(p(t),g.createNew(e))},10)}});return w})}(this),function(e,t){define("photo/PhotoService",["underscore","backbone","jquery","ui/BatchActionWindow","ui/AlertWindow","utilities/StringUtil","Internationalization","IOBackendDevice","Configuration","Settings","Device","main/views/BatchErrorView"],function(n,r,i,s,o,u,a,f,l,c,h,p){console.log("PhotoService - File loaded.");var d=e.alert,v=n.extend(function(){},r.Events),m,g=function(e,t,n,r){var s=i.Deferred();return f.requestAsync({url:l.actions.PHOTO_EXPORT,data:{photo_id_list:e.join(","),session:t,export_dir:n||"",default_path:c.get("photo_export_default_path"),is_cloud:r?1:0},success:function(e){e.state_code===200?s.resolve(e):s.reject(e)}}),s.promise()};v.exportPhotosAsync=function(e,o){var u=i.Deferred(),h=n.uniqueId("photo.export_"),y=new s({session:h,progressText:a.photo.EXPORT_PROGRESS_TEXT,cancelUrl:l.actions.PHOTO_CANCEL,total:e.length,successText:a.photo.EXPORT_SUCCESS_TEXT,delay:!0});if(!m)var b=f.Backend.Device.onmessage({"data.channel":h},function(e){m||(m=e.info,f.Backend.Device.offmessage(b))});return g(e,h,m,o[0].is_cloud).done(function(e){c.set("photo_export_default_path",m,!0);var i=n.map(e.body.failed,function(e){return e.item});if(i.length>0){y.remove();var s=new r.Collection(o),f=p.getInstance({tip:a.photo.PHOTO_EXPORT_ERROR_TEXT,items:n.map(i,function(e){return s.get(e).get("display_name")}),errorInfo:n.find(e.body.failed,function(e){return e.error_message})});s.set([]),s=t,f.once("button_retry",function(){v.exportPhotosAsync(i).done(u.resolve).fail(u.reject),f.remove()},this),f.once("button_cancel",function(){m=null,u.reject()}),f.show()}else m=null,u.resolve(e)}).fail(function(e){e.state_code===402?m=null:(d(a.photo.EXPORT_FAILED_TEXT),y.remove()),u.reject(e)}),u.promise()};var y=function(e,t){var r=i.Deferred();return f.requestAsync({url:l.actions.PHOTO_IMPORT,data:{file_path_list:JSON.stringify({image:n.map(e,function(e){return{path:e}})}),session:t},success:function(e){e.state_code===200?(console.log("PhotoService - Import success. "),r.resolve(e)):e.state_code===402?r.reject(e):(console.error("PhotoService - Import failed. Error info: "+e.state_line),r.reject(e))}}),r.promise()};v.importPhotosAsync=function(e){var r=i.Deferred(),o=n.uniqueId("photo.import_"),u=new s({session:o,progressText:a.photo.IMPORT_PROGRESS_TEXT,cancelUrl:l.actions.PHOTO_CANCEL,total:e.length,successText:a.photo.IMPORT_SUCCESS_TEXT,delay:!0});return y(e,o).done(function(e){var i=n.map(e.body.failed,function(e){return e.item});if(i.length>0){u!==t&&u.remove();var s=p.getInstance({needConnection:!0,tip:a.photo.PHOTO_IMPORT_ERROR_TEXT,items:n.map(i,function(e){return e.replace(/^\w*[\\\/]?=[^\\\/]+$/,"")}),errorInfo:n.find(e.body.failed,function(e){return e.error_message})});s.on("button_retry",function(){h.get("isConnected")&&(h.get("hasSDCard")||h.get("hasEmulatedSD"))&&(v.importPhotosAsync(i).done(r.resolve).fail(r.reject),s.remove())},this),s.once("button_cancel",function(){r.reject()}),s.show()}else r.resolve(e)}).fail(function(e){e.state_code!==402&&(d(a.photo.WALLPAPER_SETTING_FAILED_TEXT),u!==t&&u.remove()),r.reject(e)}),r.promise()};var b=function(e,t,n){var r=i.Deferred();return f.requestAsync({url:l.actions.PHOTO_DELETE,data:{photo_id_list:e.join(","),session:t||"",is_cloud:n?1:0},success:function(e){e.state_code===200?r.resolve(e):r.reject(e)}}),r.promise()};return v.deletePhototsAsync=function(e,t){var r=i.Deferred(),c=new o({draggable:!0,disposableName:"photo-delete",buttonSet:"yes_no",$bodyContent:u.format(a.photo.DELETE_TIP,e.length)});return c.once("button_yes",function(){var i;if(e.length>1){i=n.uniqueId("sms.batch.delete_");var o=new s({session:i,progressText:a.photo.DELETE_PROGRESS_TEXT,cancelUrl:l.actions.PHOTO_CANCEL,total:e.length,successText:a.photo.DELETE_SUCCESS_TEXT});o.show()}b(e,i,t).done(function(e){f.sendCustomEventsAsync(l.events.CUSTOM_IFRAME_PHOTO_DELETED,{data:n.pluck(e.body.success,"item")}),r.resolve(e)}).fail(function(e){f.requestAsync(l.actions.PHOTO_SYNC),r.reject(e)})},this),c.once("button_cancel button_no",function(){f.sendCustomEventsAsync(l.events.CUSTOM_IFRAME_PHOTO_DELETED,{data:[]}),r.reject()}),c.show(),r.promise()},v.selectPhotosAsync=function(e){var t=i.Deferred();return f.requestAsync({url:l.actions.PHOTO_SELECT_PHOTO,data:{type:e},success:function(e){e.state_code===200?(console.log("PhotoService - Get selected photos success."),t.resolve(e)):(console.error("PhotoService - Get selected photos faild. Error info: "+e.state_line),t.reject(e))}}),t.promise()},v})}(this),function(e,t){define("photo/views/PhotoListItemView",["underscore","doT","ui/TemplateFactory","ui/BaseListItem"],function(e,t,n,r){console.log("PhotoListItemView - File loaded. ");var i=r.extend({template:t.template(n.get("photo","photo-list-item")),className:"w-photo-list-item hbox",render:function(){return this.$el.html(this.template(this.model.toJSON())),this}}),s=e.extend({getInstance:function(e){return new i(e)},getClass:function(){return i}});return s})}(this),function(e,t){define("photo/views/ImportPhotoView",["backbone","doT","underscore","ui/Panel","ui/TemplateFactory","ui/AlertWindow","ui/SmartList","ui/behavior/ButtonSetMixin","utilities/StringUtil","IOBackendDevice","Configuration","Internationalization","Device","photo/PhotoService","photo/models/PhotoModel","photo/views/PhotoListItemView"],function(e,n,r,i,s,o,u,a,f,l,c,h,p,d,v,m){console.log("ImportPhotoView - File loaded.");var g,y,b=e.View.extend({initialize:function(){p.get("hasEmulatedSD")?p.getDeviceCapacityAsync():p.getSDCapacityAsync(),this.listenTo(p,"change",this.setContent)},render:function(){var e=f.format(h.misc.SELECTOR_DESCRIPTION_TEXT,g.photoList.selected.length,g.photoList.currentModels.length);return p.get("hasEmulatedSD")?(e+=f.format(h.misc.DEVICE_CAPACITY_REMAIN,f.readableSize(p.get("internalFreeCapacity"))),p.getDeviceCapacityAsync().done(this.setContent.bind(this))):(e+=f.format(h.misc.SD_CAPACITY_REMAIN,f.readableSize(p.get("externalFreeCapacity"))),p.getSDCapacityAsync().done(this.setContent.bind(this))),this.$el.html(e),this},setContent:function(){var e=0;r.each(g.photoList.selected,function(t){e+=parseInt(g.collection.get(t).get("size"),0)});var t=f.format(h.misc.SELECTOR_DESCRIPTION_TEXT,g.photoList.selected.length,g.photoList.currentModels.length);p.get("hasEmulatedSD")?t+=f.format(h.misc.DEVICE_CAPACITY_REMAIN,f.readableSize(Math.max(p.get("internalFreeCapacity")-e,0))):t+=f.format(h.misc.SD_CAPACITY_REMAIN,f.readableSize(Math.max(p.get("externalFreeCapacity")-e,0))),this.$el.html(t)}}),w=e.View.extend({template:n.template(s.get("photo","local-import-body")),className:"w-photo-local-import vbox",initialize:function(){this.collection=new e.Collection},render:function(){return this.$el.html(this.template({})),this.photoList=new u({itemView:m.getClass(),dataSet:[{name:"default",getter:function(){return[]}}],keepSelect:!1,$observer:this.$(".check-select-all"),$header:this.$("header"),itemHeight:53,listenToCollection:this.collection}),this.listenTo(this.photoList,"switchSet",function(e){this.photoList.emptyTip=h.photo.PHOTO_ADDOR_GRID_TIP,this.photoList.toggleEmptyTip(this.photoList.currentModels.length===0),y&&y.setContent()}),this.listenTo(this.photoList,"select:change",function(){y&&y.setContent()}),this.$(".w-photo-local-import-list").append(this.photoList.render().$el),this.photoList.emptyTip=h.photo.PHOTO_ADDOR_GRID_TIP,this.photoList.toggleEmptyTip(!0),this},parsePhotos:function(e){var n=[],i=[];r.each(e.body.image,function(e){e.id=f.MD5(e.path),n.push(new v(e))});var s=[];r.each(n,function(e){var n=this.collection.get(e.id);n!==t?n.set(e.toJSON()):this.collection.add(e),s.push(e.id)},this),this.photoList.switchSet("default",function(){return this.collection.models}.bind(this)),this.photoList.addSelect(s)},remove:function(){this.photoList.remove(),this.collection.set([]),delete this.photoList,delete this.collection,w.__super__.remove.call(this)},selectPhotos:function(e){var t=new o({$bodyContent:h.photo.IMPORT_PROGRESS_TEXT});t.show(),d.selectPhotosAsync(e).done(this.parsePhotos.bind(this)).always(function(){t.close()})},clickButtonAddFile:function(){this.selectPhotos(0)},clickButtonAddFolder:function(){this.selectPhotos(1)},events:{"click .button-add-file":"clickButtonAddFile","click .button-add-folder":"clickButtonAddFolder"}}),E=i.extend({initialize:function(){E.__super__.initialize.apply(this,arguments),this.on("show",function(){g=(new w).render(),this.$bodyContent=g.$el,y=new b,this.$(".w-ui-window-footer-monitor").append(y.render().$el),this.once("remove",function(){g.remove(),y.remove(),g=t,y=t},this)},this),this.on("button_yes",this.importPhoto,this)},importPhoto:function(){var e=[];r.each(g.photoList.selected,function(n){var r=g.collection.get(n);r!==t&&e.push(r.get("path"))}),e.length>0&&d.importPhotosAsync(e),this.close()}}),S,x=r.extend({getInstance:function(){return S||(S=new E({title:h.photo.ADD_LAOCEL_PHOTO_LABEL,height:480,width:630,buttonSet:a.BUTTON_SET.YES_CANCEL})),S}});return x})}(this),function(e,t){define("sync/views/PhotoSyncAlertView",["underscore","jquery","IO","Account","Internationalization","Configuration","Log","ui/Panel","utilities/StringUtil"],function(e,t,n,r,i,s,o,u,a){console.log("PhotoSyncAlertView - File loaded. ");var f=u.extend({className:u.prototype.className+" photo-sync-alert",initialize:function(){f.__super__.initialize.apply(this,arguments),this.width=360,this.height=200,this.title=i.ui.TIP,this.disableX=!0,this.buttons=[{$button:t("<button>").addClass("primary").html(i.common.RECOMMEND_YES),eventName:"YES"},{$button:t("<button>").html(i.ui.NO),eventName:"NO"}],this.once("show",function(){this.$bodyContent=a.format(i.photo.PHOTO_SYNC,a.format(s.enums.PHOTO_SYNC_LINK,r.get("auth"))),o({event:"ui.show.alert.photo.sync"})},this)}}),l=e.extend({getInstance:function(){return new f}});return l})}(this),function(e){define("photo/IframeMessageListener",["underscore","backbone","Configuration","IOBackendDevice","Account","Log","photo/views/ImportPhotoView","photo/PhotoService","social/SocialService","sync/views/PhotoSyncAlertView"],function(t,n,r,i,s,o,u,a,f,l){console.log("IframeMessageListener - File loaded. ");var c=e.alert,h=t.extend({},n.Events),p=[];return h.init=function(){p.push(i.Backend.Device.onmessage({"data.channel":r.events.PHOTO_SHOW_IMPORTOR},function(){u.getInstance().show()})),p.push(i.Backend.Device.onmessage({"data.channel":r.events.CUSTOM_IFRAME_PHOTO_SHARE},function(e){e=e.data,f.sharePhotoAsync(e.path,e.orientation,e.type,e.size)})),p.push(i.Backend.Device.onmessage({"data.channel":r.events.CUSTOM_IFRAME_PHOTO_DELETE},function(e){var t=e.data.models[0].is_cloud;a.deletePhototsAsync(e.data.ids,t)})),p.push(i.Backend.Device.onmessage({"data.channel":r.events.CUSTOM_IFRAME_PHOTO_EXPORT},function(e){a.exportPhotosAsync(e.data.ids,e.data.models)})),p.push(i.Backend.Device.onmessage({"data.channel":r.events.CUSTOM_IFRAME_PHOTO_SYNC_ALERT},function(e){var t=l.getInstance();t.show(),t.once("YES",function(){if(s.get("isLogin"))i.sendCustomEventsAsync(e.data.listenerId,{action:"yes"});else{s.loginAsync("","photo-sync");var t=i.Backend.Device.onmessage({"data.channel":r.events.ACCOUNT_STATE_CHANGE},function(n){n.auth&&(i.sendCustomEventsAsync(e.data.listenerId,{action:"yes"}),i.Backend.Device.offmessage(t))})}this.close(),o({event:"ui.click.sync.syncphoto.yes"})},t),t.once("NO",function(){i.sendCustomEventsAsync(e.data.listenerId,{action:"no"}),this.close(),o({event:"ui.click.sync.syncphoto.no"})},t)}))},h.destory=function(){t.each(p,function(e){i.Backend.Device.offmessage(e)})},h})}(this),function(window,undefined){define("photo/views/PhotoModuleView",["underscore","backbone","Configuration","Environment","photo/views/ImportPhotoView","photo/IframeMessageListener"],function(_,Backbone,CONFIG,Environment,ImportPhotoView,IframeMessageListener){console.log("PhotoModuleView - File loaded. ");var PhotoModuleView=Backbone.View.extend({className:"module-main",tagName:"iframe",initialize:function(){var e=!1;Object.defineProperties(this,{rendered:{set:function(t){e=Boolean(t)},get:function(){return e}}})},render:function(){this.$el.attr({src:CONFIG.BASE_PATH+"modules/photo/photo.html"+Environment.get("search")});var e=function(t){t.module!=="photo"&&(this.stopListening(Backbone,"switchModule",e),this.$el.attr({src:""}),IframeMessageListener.destory(),this.rendered=!1)};return IframeMessageListener.init(),this.listenTo(Backbone,"switchModule",e),this.rendered=!0,this}}),photoModuleView,factory=_.extend({getInstance:function(){return photoModuleView||(photoModuleView=new PhotoModuleView),photoModuleView},showImport:function(param){var obj=eval("("+param+")"),resp={body:obj},inst=ImportPhotoView.getInstance();inst.resp=resp,inst.show()},preload:function(){}});return factory})}(this),function(window,undefined){define("video/views/VideoModuleView",["video/views/ImportVideoView"],function(ImportVideoView){console.log("VideoModuleView - File loaded. ");var VideoModuleView=Backbone.View.extend({className:"w-video-module-main module-main vbox",initialize:function(){var e=!1;Object.defineProperties(this,{rendered:{set:function(t){e=t},get:function(){return e}}})},render:function(){return window.wonder.PM.getPage("video_page").render(),this.$el.append(window.wonder.PM.getPage("video_page")._element),this.rendered=!0,this}}),videoModuleView,factory=_.extend({getInstance:function(){return videoModuleView||(videoModuleView=new VideoModuleView),videoModuleView},showImport:function(param){console.log("show import video");var obj=eval("("+param+")"),resp={body:obj},inst=ImportVideoView.getInstance();inst.resp=resp,inst.show()},preload:function(){}});return factory})}(this),function(e,t){define("optimize/OptimizeService",["IO"],function(e){console.log("OptimizeService - File loaded.");var t={};return t.scanAsync=function(t){var n=$.Deferred();return e.requestAsync({url:CONFIG.actions.OPTIMIZE_SCAN,data:{session:t||""},success:function(e){e.state_code===200?n.resolve(e):n.reject(e)}}),n.promise()},t.checkAsync=function(){var t=$.Deferred();return e.requestAsync({url:CONFIG.actions.OPTIMIZE_CHECK,success:function(e){e.state_code===200?t.resolve(e):t.reject(e)}}),t.promise()},t.installAsync=function(){var t=$.Deferred();return e.requestAsync({url:CONFIG.actions.OPTIMIZE_INSTALL,success:function(e){e.state_code===200?t.resolve(e):t.reject(e)}}),t.promise()},t.optimizeCacheAsync=function(){var t=$.Deferred();return e.requestAsync({url:CONFIG.actions.OPTIMIZE_CACHE,success:function(e){e.state_code===200?t.resolve(e):t.reject(e)}}),t.promise()},t.optimizeRamAsync=function(t){var n=$.Deferred();return e.requestAsync({url:CONFIG.actions.OPTIMIZE_RAM,data:{tasks:t.join(",")},success:function(e){e.state_code===200?n.resolve(e):n.reject(e)}}),n.promise()},t.cancelAsync=function(){var t=$.Deferred();return e.requestAsync({url:CONFIG.actions.OPTIMIZE_CANCEL,success:function(e){e.state_code===200?t.resolve(e):t.reject(e)}}),t.promise()},t.enums={CHECK_STATE_INVALID:0,CHECK_STATE_NO_APL:1,CHECK_STATE_OLD_VERSION:2,CHECK_STATE_READY:3,OPTIMIZE_TYPE_VIRUS:0,OPTIMIZE_TYPE_CACHE:1,OPTIMIZE_TYPE_RAM:2},t})}(this),function(e,t){define("optimize/views/InstallProgressView",["backbone","underscore","doT","ui/TemplateFactory","ui/AlertWindow","Configuration","Internationalization","task/collections/TasksCollection"],function(t,n,r,i,s,o,u,a){console.log("InstallProgressView - File loaded.");var f=e.alert,l,c=t.View.extend({template:r.template(i.get("optimize","install")),className:"progress hbox",initialize:function(){l=l||a.getInstance();var e=!1;l.on("refresh",function(t){var n=t.get(this.options.taskId);if(n){e=!0;if(n.get("type")===o.enums.TASK_TYPE_DOWNLOAD)this.$el.html(this.template({progress:n.get("processing")}));else if(n.get("type")===o.enums.TASK_TYPE_PUSH||n.get("type")===o.enums.TASK_TYPE_INSTALL)this.$el.html(this.template({progress:100})),this.$("progress").addClass("running");n.get("type")===o.enums.TASK_TYPE_INSTALL&&n.get("state")===o.enums.TASK_STATE_SUCCESS?(t.off("refresh",arguments.callee),this.trigger("remove")):n.get("state")===o.enums.TASK_STATE_FAILD?(t.off("refresh",arguments.callee),f(u.optimize.INSTALL_ERROR),this.trigger("remove")):n.get("state")===o.enums.TASK_STATE_STOPPED&&(t.off("refresh",arguments.callee),this.trigger("remove"))}else e&&this.trigger("remove")},this),this.$el.remove()},render:function(){return this.$el.html(this.template({progress:0})),this},buttonClickCancel:function(e){e.stopPropagation(),this.$(".button-cancel").prop({disabled:!0}),l.get(this.options.taskId).deleteTaskAsync().done(function(){f(u.optimize.INSTALL_CANCEL),this.trigger("remove")}.bind(this))},events:{"click .button-cancel":"buttonClickCancel"}}),h=n.extend({getInstance:function(e){return new c(e)}});return h})}(this),function(e,t){define("optimize/views/ScanView",["backbone","underscore","doT","jquery","ui/TemplateFactory","ui/AlertWindow","utilities/StringUtil","Log","Internationalization","Configuration","Settings","IOBackendDevice","Device","optimize/OptimizeService","optimize/views/InstallProgressView","app/collections/AppsCollection","app/AppService","app/views/OneKeyUpdateWindowView"],function(n,r,i,s,o,u,a,f,l,c,h,p,d,v,m,g,y,b){console.log("ScanView - File loaded.");var w=e.confirm,E=e.alert,S=e.setInterval,x=e.clearInterval,T=e.setTimeout,N=0,C=[],k=0,L=[],A=0,O=[],M=function(){C.length=0,k=0,L.length=0,A=0,O.length=0},_=n.View.extend({template:i.template(o.get("optimize","scan-progress")),className:"w-optimize-scan-progress hbox",initialize:function(){d.on("change:isConnected change:isUSB",function(e){this.$(".button-optimize-all, .button-optimize-virus, .button-optimize-cache, .button-optimize-ram").prop({disabled:!e.get("isConnected")||!e.get("isUSB")})},this)},render:function(){return this.$el.html(this.template({})),this},setProgress:function(e){this.$(".tip").html(a.format(l.optimize.SCAN_TIP,N,e.package_name)),N++},finishScan:function(){C.length+L.length+O.length!==0?(this.$(".scanning").removeClass("scanning").addClass("warn"),this.$(".title").html(l.optimize.OPTIMIZE_TIP),this.$(".tip").html(l.optimize.FINISH_TIP+l.optimize.ACTION_TIP),this.$(".progress-ctn").remove(),this.$("button").removeClass("button-cancel").addClass("button-optimize-all").html("").show().prop({disabled:!d.get("isConnected")||!d.get("isUSB")})):this.setToFinishi()},setToOptimizing:function(){this.$(".warn, .finish").removeClass("warn finish").addClass("scanning"),this.$(".title").html(l.optimize.OPTIMIZING),this.$(".tip").hide(),this.$(".progress-ctn").remove(),this.$("button").hide()},setToFinishi:function(){this.$(".scanning, .warn").removeClass("scanning warn").addClass("finish"),this.$(".title").html(l.optimize.OPTIMIZE_FINISH),this.$(".progress-ctn").remove(),this.$(".tip").html(l.optimize.ACTION_TIP).show(),this.$("button").hide()},cancel:function(){this.$(".scanning, .finish").removeClass("scanning finish").addClass("warn"),this.$(".title").html(l.optimize.CANCEL_TIP),this.$(".tip").html(l.optimize.ACTION_TIP),this.$("button, .progress-ctn").remove()}}),D,P=n.View.extend({template:i.template(o.get("optimize","scan-monitor")),className:"w-optimize-scan-monitor",initialize:function(){g.getInstance().on("refresh",function(e){var t=e.getUpdatableApps();this.$(".update").toggle(t.length!==0).find(".tip").html(a.format(l.optimize.UPDATE_TIP,t.length)),this.$(".suggestion-title").html(a.format(l.optimize.SUGGESTION_TITLE,this.$(".suggestion li:visible").length)).toggle(this.$(".suggestion li:visible").length!==0)},this)},render:function(){this.$el.html(this.template({}));var e=g.getInstance().getUpdatableApps();return T(function(){this.$(".update").toggle(e.length!==0).find(".tip").html(a.format(l.optimize.UPDATE_TIP,e.length)),this.$(".suggestion-title").html(a.format(l.optimize.SUGGESTION_TITLE,this.$(".suggestion li:visible").length)).toggle(this.$(".suggestion li:visible").length!==0),this.$(".finish-title").hide(),this.$(".optimize-title").hide()}.bind(this),0),this.$(".button-optimize-virus, .button-optimize-cache, .button-optimize-ram").prop({disabled:!d.get("isConnected")||!d.get("isUSB")}),this},setProgress:function(e){switch(e.type){case v.enums.OPTIMIZE_TYPE_VIRUS:if(e.virus_type===2||e.virus_type===3)O.push(e),this.$(".optimize .virus").css({display:"-webkit-box"}).find(".tip").html(a.format(l.optimize.VIRUS_TIP,O.length));break;case v.enums.OPTIMIZE_TYPE_RAM:C.push(e),k+=parseInt(e.ram_size,0),this.$(".optimize .ram").css({display:"-webkit-box"}).find(".tip").html(a.format(l.optimize.RAM_TIP,C.length,a.readableSize(k)));break;case v.enums.OPTIMIZE_TYPE_CACHE:L.push(e),A+=parseInt(e.cache_size,0),this.$(".optimize .cache").css({display:"-webkit-box"}).find(".tip").html(a.format(l.optimize.CACHE_TIP,L.length,a.readableSize(A)))}this.$(".optimize-title").show().html(a.format(l.optimize.OPTIMIZE_TITLE,this.$(".optimize li:visible").length)).toggle(this.$(".optimize li:visible").length!==0)},setRunning:function(e){var t;switch(e){case v.enums.OPTIMIZE_TYPE_VIRUS:t=this.$(".virus .icon"),this.$(".virus .link").prop({disabled:!0});break;case v.enums.OPTIMIZE_TYPE_RAM:t=this.$(".ram .icon"),this.$(".ram .link").prop({disabled:!0});break;case v.enums.OPTIMIZE_TYPE_CACHE:t=this.$(".cache .icon"),this.$(".cache .link").prop({disabled:!0})}t.removeClass("icon-warn").addClass("icon-running")},setFinishi:function(e){switch(e){case v.enums.OPTIMIZE_TYPE_VIRUS:this.$(".finish .virus").css({display:"-webkit-box"}).find(".tip").html(this.$(".optimize .virus .tip").html()),this.$(".optimize .virus").remove(),O.length=0;break;case v.enums.OPTIMIZE_TYPE_RAM:this.$(".finish .ram").css({display:"-webkit-box"}).find(".tip").html(a.format(l.optimize.RAM_FINISH,a.readableSize(k))),this.$(".optimize .ram").remove(),C.length=0,k=0;break;case v.enums.OPTIMIZE_TYPE_CACHE:this.$(".finish .cache").css({display:"-webkit-box"}).find(".tip").html(a.format(l.optimize.CACHE_FINISH,a.readableSize(A))),this.$(".optimize .cache").remove(),L.length=0,A=0}this.$(".finish-title").toggle(!0).html(a.format(l.optimize.FINISH_TITLE,this.$(".finish li:visible").length)),this.$(".optimize-title").html(a.format(l.optimize.OPTIMIZE_TITLE,this.$(".optimize li:visible").length)).toggle(this.$(".optimize li:visible").length!==0),O.length+C.length+L.length===0&&D.setToFinishi()}}),H,B,j=[],F=function(){p.Backend.offmessage(B);var e=function(){x(H),H=t,N=0};if(j.length===0)e();else var n=S(function(){j.length===0&&(x(n),e())},50)},I,q=function(){E(l.optimize.OPTIMIZE_ERROR),this.render()},R=function(){var e=s.Deferred();return D.$(".button-optimize-all").prop({disabled:!0}),y.uninstallAppsAsync(O).done(function(t){I.setFinishi(v.enums.OPTIMIZE_TYPE_VIRUS),e.resolve(t),f({event:"debug.optimize.optimize.finish",cate:"virus"})}).fail(e.reject).always(function(){D.$(".button-optimize-all").prop({disabled:!1})}),e.promise()},U=function(){var e=s.Deferred();return D.$(".button-optimize-all").prop({disabled:!0}),I.setRunning(v.enums.OPTIMIZE_TYPE_RAM),v.optimizeRamAsync(r.pluck(C,"package_name")).done(function(t){I.setFinishi(v.enums.OPTIMIZE_TYPE_RAM),e.resolve(t),f({event:"debug.optimize.optimize.finish",cate:"ram"})}).fail(function(t){q.call(this),e.reject(t)}.bind(this)).always(function(){D.$(".button-optimize-all").prop({disabled:!1})}),e.promise()},z=function(){var e=s.Deferred();return D.$(".button-optimize-all").prop({disabled:!0}),I.setRunning(v.enums.OPTIMIZE_TYPE_CACHE),v.optimizeCacheAsync().done(function(t){I.setFinishi(v.enums.OPTIMIZE_TYPE_CACHE),e.resolve(t),f({event:"debug.optimize.optimize.finish",cate:"cache"})}).fail(function(t){q.call(this),e.reject(t)}.bind(this)).always(function(){D.$(".button-optimize-all").prop({disabled:!1})}),e.promise()},W=n.View.extend({className:"w-optimize-scan vbox",template:i.template(o.get("optimize","scan")),initialize:function(){d.on("change:isConnected change:isUSB",function(e){var t=!e.get("isConnected")||!e.get("isUSB");this.$(".button-scan").prop({disabled:t}),this.$(".wifi-tip").toggle(t)},this)},checkState:function(){v.checkAsync().done(function(e){var t=e.body.value;switch(t){case 1:w(l.optimize.INSTALL_DES,function(){this.installAPK(),f({event:"ui.click.install.confirm",type:"install",actions:"yes"})},function(){f({event:"ui.click.install.confirm",type:"install",actions:"cancel"})},this);break;case 2:w(l.optimize.UPDATE_DES,function(){this.installAPK(),f({event:"ui.click.install.confirm",type:"update",actions:"yes"})},function(){f({event:"ui.click.install.confirm",type:"update",actions:"cancel"})},this);break;case 3:this.startScan()}f({event:"debug.optimize.check.result",value:t})}.bind(this))},installAPK:function(){this.$(".button-scan").prop({disabled:!0}),v.installAsync().done(function(e){var t=m.getInstance({taskId:e.body.value});this.$(".progress").replaceWith(t.render().$el);var n=function(){this.startScan(),this.$(".button-scan").prop({disabled:!1}),f({event:"debug.optimize.install.finish"}),t.off("finish",n)};t.on("finish",n,this);var r=function(){this.render(),t.off("remove",r)};t.on("remove",r,this)}.bind(this)),f({event:"debug.optimize.installStart"})},finishScan:function(){h.set("tx-last-time",(new Date).getTime(),!0)},startScan:function(){M.call();var e=r.uniqueId("optimize.scan_");D=new _,I=new P,this.$(".progress").html(D.render().$el),this.$(".monitor").html(I.render().$el),B=p.Backend.onmessage({"data.channel":e},this.setScanProgress,this),v.scanAsync(e).done(function(){this.finishScan();var e=S(function(){j.length===0&&(D.finishScan(),x(e))},25);f({event:"debug.optimize.scan.finish"})}.bind(this)).fail(function(e){j.length=0,e.state_code===402?D.cancel():(E(l.optimize.SCAN_FAILED),M.call(this),this.render())}.bind(this)).always(F),f({event:"debug.optimize.scanStart"})},setScanProgress:function(e){j=j.concat(e.item),D.$(".progress-inside").addClass("wrap").css({width:e.progress+"%"}),H||(H=S(function(){var e=j.shift();e&&(D.setProgress(e),I.setProgress(e))},50))},render:function(){this.$el.html(this.template({}));var e=h.get("tx-last-time"),t=(new Date).getTime()-parseInt(e,10);return t=Math.round(t/1e3/3600*100)/100,this.$(".tip").html(e?a.format(l.optimize.LAST_TIME_TIP,t):l.optimize.NEVER_TIP),this.$(".button-scan").prop({disabled:!d.get("isConnected")||!d.get("isUSB")}),T(function(){this.$(".wifi-tip").toggle(!d.get("isConnected")||!d.get("isUSB"))}.bind(this),0),this},clickButtonScan:function(){this.checkState()},clickButtonCancel:function(){this.$(".button-cancel").prop({disabled:!0}),v.cancelAsync(),f({event:"debug.optimize.scan.cancel"})},clickButtonOptimizeAll:function(){var e=[];O.length>0&&e.push(R),C.length>0&&e.push(U),L.length>0&&e.push(z),e.length>0?(D.setToOptimizing(),e[0].call(this).always(function(){e[1]?e[1].call(this).always(function(){e[2]?e[2].call(this).always(function(){D.setToFinishi()}):(D.setToFinishi(),f({event:"debug.optimize.optimize.all.finish"}))}):(D.setToFinishi(),f({event:"debug.optimize.optimize.all.finish"}))})):D.setToFinishi(),f({event:"ui.click.optimize.button.optimize.all"})},clickButtonOptimizeVirus:function(){R.call(this),f({event:"ui.click.optimize.button.optimize",cate:"virus"})},clickButtonOptimizeCache:function(){z.call(this),f({event:"ui.click.optimize.button.optimize",cate:"cache"})},clickButtonOptimizeRam:function(){U.call(this),f({event:"ui.click.optimize.button.optimize",cate:"ram"})},clickButtonUpdateAll:function(){b.getInstance().show()},clickButtonRestart:function(){this.checkState(),f({event:"ui.click.optimize.button.restart"})},clickButtonBackward:function(){this.render(),f({event:"ui.click.optimize.button.backward"})},events:{"click .button-optimize-all":"clickButtonOptimizeAll","click .button-scan":"clickButtonScan","click .button-cancel":"clickButtonCancel","click .button-optimize-virus":"clickButtonOptimizeVirus","click .button-optimize-cache":"clickButtonOptimizeCache","click .button-optimize-ram":"clickButtonOptimizeRam","click .button-update-all":"clickButtonUpdateAll","click .button-restart":"clickButtonRestart","click .button-backward":"clickButtonBackward"}}),X,V=r.extend({getInstance:function(){return X||(X=new W),X}});return V})}(this),function(e,t){define("optimize/views/OptimizeModuleView",["optimize/views/ScanView"],function(e){console.log("OptimizeModuleView - File loaded.");var t=Backbone.View.extend({className:"w-optimize-module-main module-main vbox",initilize:function(){var e=!1;Object.defineProperties(this,{rendered:{set:function(t){e=t},get:function(){return e}}})},render:function(){return this.$el.append(e.getInstance().render().$el),this.rendered=!0,this}}),n,r=_.extend({getInstance:function(){return n||(n=new t),n}});return r})}(this),function(e,t){define("app/wash/views/FeedbackWindowView",["backbone","underscore","doT","jquery","ui/Panel","ui/TemplateFactory","ui/SmartList","ui/BaseListItem","utilities/StringUtil","Device","Internationalization","Configuration","app/collections/AppsCollection"],function(e,n,r,i,s,o,u,a,f,l,c,h,p){console.log("FeedbackWindowView - File loaded. ");var d=e.View.extend({template:r.template(o.get("wash","wash-feedback")),className:"w-wash-feedback",render:function(){return this.$el.html(this.template({})),this},getReason:function(){return this.$('input[type="radio"]:checked').val()},getFeedbackType:function(){return parseInt(this.$('input[type="radio"]:checked').val(),10)},keyupInputReason:function(e){this.$('input[type="radio"]:last').val(e.originalEvent.srcElement.value)},clickLastRadio:function(){this.$(".input-reason").prop({disabled:!1}).focus()},clickNoneLastRadio:function(){this.$(".input-reason").prop({disabled:!0})},events:{'click input[type="radio"]:last':"clickLastRadio",'click input[type="radio"]:not(:last)':"clickNoneLastRadio","keyup .input-reason":"keyupInputReason"}}),v=a.extend({template:r.template(o.get("wash","wash-feedback-item")),className:"w-wash-feedback-app-list-item",render:function(){return this.$el.html(this.template(this.model.toJSON())),this}}),m=e.View.extend({className:"w-wash-feedback-app-list vbox",render:function(){return this.$el.empty(),this.listView=new u({itemView:v,dataSet:[{name:"default",getter:this.options.type===1&&this.options.ids.length>0?function(){return p.getInstance().filter(function(e){return this.options.ids.indexOf(e.id)>=0},this)}.bind(this):p.getInstance().getNormalApps}],keepSelect:!1,itemHeight:43,listenToCollection:p.getInstance()}),this.$el.append(this.listView.render().$el),this},getSelectedAppPackageName:function(){return this.$('input[type="radio"]:checked').val()},remove:function(){this.listView.remove(),m.__super__.remove.call(this)}}),g=[],y=e.View.extend({className:"w-wash-feedback",template:r.template(o.get("wash","wash-feedback-reason")),getTextAsync:function(){var e=i.Deferred();return g.length>0?e.resolve(g):i.ajax(h.actions.APP_WASH_GET_TEXT).done(function(t){g=t,e.resolve(t)}.bind(this)),e.promise()},render:function(){return this.getTextAsync().done(function(){this.$el.html(this.template({type:this.options.type,text:g}))}.bind(this)),this},getReason:function(){return this.$('input[type="radio"]:checked').val()},keyupInputReason:function(e){this.$('input[type="radio"]:last').val(e.originalEvent.srcElement.value)},clickLastRadio:function(){this.$(".input-reason").prop({disabled:!1}).focus()},clickNoneLastRadio:function(){this.$(".input-reason").prop({disabled:!0})},events:{'click input[type="radio"]:last':"clickLastRadio",'click input[type="radio"]:not(:last)':"clickNoneLastRadio","keyup .input-reason":"keyupInputReason"}}),b,w,E,S,x=s.extend({initialize:function(){x.__super__.initialize.apply(this,arguments),this.once("show",function(){b=new d,this.$bodyContent=b.render().$el;var e=this.buttons[0].$button.prop("disabled",!0);b.$('input[type="radio"]').on("click",function(t){b.getFeedbackType()!==1&&b.getFeedbackType()!==2?e.html("提交"):e.html("下一步"),e.prop("disabled",!1)}),S=1,this.once("remove",function(){b!==t&&b.remove(),w!==t&&w.remove(),E!==t&&E.remove(),b=t,w=t,E=t,this.off()})},this),this.on("next",function(){var e=this.buttons[0].$button.prop("disabled",!0);if(S===1)b.getFeedbackType()===1||b.getFeedbackType()===2?(w=new m({type:b.getFeedbackType(),ids:this.options.ids||[]}),this.$bodyContent=w.render().$el,setTimeout(function(){var t=function(){e.prop("disabled",!1),w.$el.undelegate('input[type="radio"]',"click",t)};w.$el.delegate('input[type="radio"]',"click",t)}.bind(this),0),this.title="选择有问题的应用",S=2):b.$(".input-reason").val().trim()!==""&&this.trigger("submit");else{E=new y({type:b.getFeedbackType()}),this.$bodyContent=E.render().$el,this.buttons=[{$button:i("<button>").html("提交").addClass("primary"),eventName:"submit"},{$button:i("<button>").html(c.ui.CANCEL),eventName:"button_cancel"}],e=this.buttons[0].$button.prop("disabled",!0);var t=function(){e.prop("disabled",!1),E.$el.undelegate('input[type="radio"]',"click",t)};E.$el.delegate('input[type="radio"]',"click",t),this.title=b.getFeedbackType()===1?"为什么洗错了":"为什么洗漏了",S=3}},this),this.once("submit",function(){var e=b.getFeedbackType()||0,t=w?w.getSelectedAppPackageName()||"":"",n=E?E.getReason():b.getReason(),r=t&&p.getInstance().get(t);i.ajax({type:"POST",url:h.actions.APP_WASH_FEEDBACK,data:{udid:l.get("udid")||"",from:"windows","package":t,md5:t?r.get("fileMd5")||r.get("base_info").md5:"",type:e===1?"wrong":e===2?"missing":"other",reason:n}}),this.remove()},this)}}),T=n.extend({getInstance:function(e){return new x(n.extend({title:"发生什么问题了？",height:250,buttons:[{$button:i("<button>").html("下一步").addClass("primary"),eventName:"next"},{$button:i("<button>").html(c.ui.CANCEL),eventName:"button_cancel"}]},e))}});return T})}(),function(e,t){define("app/wash/views/IntroView",["backbone","underscore","doT","Device","ui/TemplateFactory","Log","Settings","Environment","app/wash/views/FeedbackWindowView"],function(e,t,n,r,i,s,o,u,a){console.log("IntroView - File loaded.");var f=e.View.extend({className:"w-app-wash-intro",template:n.template(i.get("wash","wash-intro")),initialize:function(){this.listenTo(r,"change",this.toggleState)},toggleState:function(e){this.$(".button-start").prop({disabled:!e.get("isConnected")||!e.get("isUSB")}),!e.get("isConnected")||!e.get("isUSB")?this.$(".connect-tip").show():this.$(".connect-tip").hide()},render:function(){return this.$el.html(this.template({})),this.toggleState(r),this},clickButtonStart:function(){this.trigger("next"),o.set("has-used-wash",!0,u.get("deviceId")),o.set("last-used-wash-time",(new Date).getTime(),u.get("deviceId")),this.remove(),s({event:"ui.click.wash.button_start"})},clickButtonFeedback:function(){a.getInstance().show(),s({event:"ui.click.wash.button_feedback_intro_view"})},events:{"click .button-feedback":"clickButtonFeedback","click .button-start":"clickButtonStart"}}),l=t.extend({getInstance:function(){return new f}});return l})}(this),function(e,t){define("app/wash/collections/AppsQueryResultCollection",["jquery","underscore","backbone"],function(e,t,n){console.log("AppsQueryResultCollection - File loaded. ");var r=n.Collection.extend({initialize:function(){var e={pirate:0,ads:0};Object.defineProperties(this,{original:{set:function(t){e=t},get:function(){return e}}})},comparator:function(e){return e.get("function").type==="PIRATE"},getPirateApps:function(){return this.filter(function(e){return e.get("function").type==="PIRATE"})},getUpdatableAdsApps:function(){return this.filter(function(e){return e.get("function").type==="AD"&&e.get("candidateApks")})},getUninstallableAdsApps:function(){return this.filter(function(e){return e.get("function").type==="AD"&&!e.get("candidateApks")})}}),i=t.extend({getInstance:function(e){e=t.filter(e,function(e){return e["function"].type==="AD"||e["function"].type==="PIRATE"});var n=new r(e);return n.original={pirate:n.getPirateApps().length,ads:n.getUpdatableAdsApps().length+n.getUninstallableAdsApps().length},n}});return i})}(this),function(e,t){define("app/wash/views/ScanningView",["backbone","underscore","doT","utilities/StringUtil","IOBackendDevice","Configuration","Device","Environment","Internationalization","ui/TemplateFactory","app/collections/AppsCollection","app/wash/collections/AppsQueryResultCollection","app/AppService"],function(e,t,n,r,i,s,o,u,a,f,l,c,h){console.log("ScanningView - File loaded.");var p,d=!1,v=e.View.extend({className:"w-app-wash-scanning",template:n.template(f.get("wash","wash-scanning")),initialize:function(){p=l.getInstance()},setProgress:function(e){this.$el.append(this.$("progress").detach().attr({value:e,max:100}))},queryAppInfo:function(e){this.$(".title").html(a.app.QUERYING),this.$(".desc").html(a.app.QUERYING_TIP);var n=[];t.each(e,function(e){var i=p.get(e.item);if(i&&!i.get("base_info").ignore_wash){var s=i.get("base_info").signature;s&&(s=s.split(","),s=t.map(s,function(e){return r.MD5(e.toUpperCase())}),n.push({packageName:e.item,md5:e.value,signature:s.join(","),title:i.get("base_info").name,isSysApp:i.isSystem}),i.set({fileMd5:e.value,signatures:s.join(",")},{silent:!0}))}});var f=JSON.stringify({sdkVersion:o.get("SDKVersion"),isRoot:o.get("isRoot"),apks:n});i.requestAsync({type:"post",url:s.actions.APP_WASH_SCAN,data:{id:"wandoujia_windows",udid:o.get("udid")||"",version:u.get("backendVersion"),token:r.MD5("wandoujia_windows"+s.enums.APP_WASH_AUTH_KEY+f),data:f},dataType:"json",success:function(e){d||(this.trigger("next",c.getInstance(e)),this.remove())}.bind(this),error:function(){this.trigger("error"),this.remove()}.bind(this)})},startQueryMD5:function(){d=!1;if(p.loading||p.syncing){var e=function(){!p.loading&&!p.syncing&&(this.startQueryMD5(),p.off("refresh",e))};p.on("refresh",e,this)}else{var n=p.getNormalApps();if(n.length===0)this.trigger("next",c.getInstance([])),this.remove();else{var r=t.uniqueId("app_wash_md5_");h.scanMD5Async(t.map(n,function(e){return e.get("base_info").package_name}),r).done(function(e){d||this.queryAppInfo(e.body.success)}.bind(this)).fail(function(){this.trigger("error"),this.remove()}.bind(this));var s=i.Backend.Device.onmessage({"data.channel":r},function(e){this.setProgress(e.current/e.total*90),(e.current>=e.total||d)&&i.Backend.Device.offmessage(s)},this)}}},render:function(){return this.$el.html(this.template({})),this},cancel:function(){d=!0,this.remove()}}),m=t.extend({getInstance:function(){return new v}});return m})}(this),function(e){define("app/wash/views/FeedbackCardView",["underscore","backbone","doT","jquery","Device","IO","Configuration","ui/TemplateFactory"],function(e,t,n,r,i,s,o,u){console.log("FeedbackCardView - File loaded. ");var a=[],f=t.View.extend({template:n.template(u.get("wash","feedback-card")),className:"back feedback vbox",initialize:function(){var e=!1;Object.defineProperties(this,{loading:{get:function(){return e},set:function(t){e=Boolean(t)}}})},getTextAsync:function(){var e=r.Deferred();return a.length>0?e.resolve(a):r.ajax(o.actions.APP_WASH_GET_TEXT).done(function(t){a=t,e.resolve(t)}.bind(this)),e.promise()},render:function(){return this.loading=!0,this.getTextAsync().done(function(t){this.$el.html(this.template(e.extend(this.model.toJSON(),{text:t}))),this.$(".button-send").prop("disabled",!0)}.bind(this)),this},clickLastRadio:function(){this.$(".button-send").prop("disabled",!1),this.$(".input-reason").prop({disabled:!1}).focus()},clickNoneLastRadio:function(){this.$(".button-send").prop("disabled",!1),this.$(".input-reason").prop({disabled:!0})},clickButtonSend:function(){var e=this.$('input[type="radio"]:checked').val().trim();if(e){this.model.collection.remove(this.model);var t=this.model.get("suggestion").action==="UNINSTALL"||this.model.get("suggestion").action==="REPLACE";r.ajax({type:"POST",url:o.actions.APP_WASH_FEEDBACK,data:{udid:i.get("udid")||"",from:"windows","package":this.model.get("sourceApk").packageName,md5:this.model.get("sourceApk").md5,type:t?this.model.get("suggestion").action:"ignore",reason:e}}),s.requestAsync({url:o.actions.APP_IGNORE_WASH,data:{package_name:this.model.get("sourceApk").packageName}})}else this.$(".input-reason").focus()},keyupInputReason:function(e){this.$('input[type="radio"]:last').val(e.originalEvent.srcElement.value)},events:{'click input[type="radio"]:last':"clickLastRadio",'click input[type="radio"]:not(:last)':"clickNoneLastRadio","click .button-send":"clickButtonSend","keyup .input-reason":"keyupInputReason"}}),l=e.extend({getInstance:function(e){return new f(e)}});return l})}(this),function(e,t){define("app/wash/views/ResultItemView",["backbone","underscore","jquery","doT","Log","Device","Internationalization","Configuration","ui/PopupTip","ui/PopupPanel","ui/TemplateFactory","ui/Panel","IOBackendDevice","task/TaskService","app/collections/AppsCollection","app/wash/views/FeedbackCardView"],function(n,r,i,s,o,u,a,f,l,c,h,p,d,v,m,g){console.log("ResultItemView - File loaded. ");var y=e.alert,b,w=function(e){var n=e.get(this.model.get("sourceApk").packageName);n!==t&&this.$(".icon img").attr({src:n.get("base_info").icon})},E=function(e,t){this.$(".button-uninstall").prop({disabled:!t})},S=c.extend({initialize:function(){S.__super__.initialize.apply(this,arguments),this.$content=s.template(h.get("wash","result-info"))(this.model.toJSON())}}),x=n.View.extend({className:"result-item vbox",tagName:"li",template:s.template(h.get("wash","result-item")),popups:[],initialize:function(){b=b||m.getInstance(),this.model.get("function").type==="AD"&&!this.model.get("candidateApks")&&(this.$el.addClass("uninstall"),this.listenTo(u,"change:isConnected",E)),this.listenTo(b,"refresh",w),this.listenToOnce(this.model,"remove",this.remove)},render:function(){var e=b.get(this.model.get("sourceApk").packageName);return this.$el.html(this.template({origin:e.toJSON(),result:this.model.toJSON()})),r.each(this.$("[data-title]"),function(e){this.popups.push(new l({$host:i(e)}))},this),this.$(".info").length>0&&this.popups.push(new S({$host:this.$(".info"),model:this.model})),this.$(".front").before(g.getInstance({model:this.model}).render().$el),this},clickButtonReplace:function(){var e=b.get(this.model.get("sourceApk").packageName),r=this.model.get("candidateApks")[0].apk,i=new n.Model({downloadUrl:r.downloadUrl,title:r.title,iconPath:e.get("base_info").icon,source:"app-wash",force:!0,packageName:r.packageName});v.addTask(f.enums.TASK_TYPE_INSTALL,f.enums.MODEL_TYPE_APPLICATION,i),e.set({isUpdating:!0}),this.model.collection.remove(this.model);var s=r.packageName,u=this.model.get("sourceApk").packageName;if(s!==u)var a=d.Backend.Device.onmessage({"data.channel":f.events.APP_INSTALLED},function(e){if(e.package_name===s){var n=u,r=b.get(n);r!==t&&r.uninstallAsync().done(function(){r=b.get(n),r!==t&&(b.remove(r,{silent:!0}),b.trigger("refresh",b))}),d.Backend.Device.offmessage(a)}},this);o({event:"ui.click.wash.button.item.replace",type:this.model.get("function").type,packageName:this.model.get("sourceApk").packageName,signature:e.get("signatures"),md5:e.get("fileMd5")})},clickButtonUninstall:function(){var e=b.get(this.model.get("sourceApk").packageName);e.uninstallAsync().done(function(t){(u.get("isWifi")||u.get("isInternet"))&&!e.isSystem&&y(a.app.ALERT_TIP_UNINSTALL_WIFI_CONFIRM);var n=t.body.failed;n&&n.length>0&&n[0].item===this.originalApp.id&&y(e.isSystem?a.app.UNINSTALL_FAILED+a.app.UNINSTALL_FAILED_SYSTEM_APP:a.app.UNINSTALL_FAILED)}.bind(this)).fail(function(){y(e.isSystem?a.app.UNINSTALL_FAILED+a.app.UNINSTALL_FAILED_SYSTEM_APP:a.app.UNINSTALL_FAILED)}.bind(this)),this.$(".button-uninstall").prop({disabled:!0}),this.model.collection.remove(this.model),o({event:"ui.click.wash.button.item.uninstall",packageName:this.model.get("sourceApk").packageName,signature:e.get("signatures"),md5:e.get("fileMd5")})},remove:function(){this.$el.fadeOut("slow",function(){r.each(this.popups,function(e){e.remove()}),delete this.popups,n.View.prototype.remove.call(this)}.bind(this))},clickButtonIgnore:function(){this.$el.addClass("flip");var e=b.get(this.model.get("sourceApk").packageName);o({event:"ui.click.wash.button.ignore",packageName:this.model.get("sourceApk").packageName,signature:e.get("signatures"),md5:e.get("fileMd5")})},clickButtonCancel:function(){var e=b.get(this.model.get("sourceApk").packageName);o({event:"ui.click.wash.button.cancel",from:this.$el.hasClass("replace")?"confirm":"ignore",packageName:this.model.get("sourceApk").packageName,signature:e.get("signatures"),md5:e.get("fileMd5")}),this.$el.removeClass("flip replace")},clickButtonConfirm:function(){this.$el.addClass("flip replace");var e=b.get(this.model.get("sourceApk").packageName);o({event:"ui.click.wash_button_confirm",packageName:this.model.get("sourceApk").packageName,signature:e.get("signatures"),md5:e.get("fileMd5")})},clickBUttonCloseAds:function(){var t=new e.AndroidIntent("android.settings.APPLICATION_DETAILS_SETTINGS","","package:"+this.model.get("sourceApk").packageName,"","","");t.startActivity();var n=new p({title:"关闭通知栏广告",height:550,width:715,$bodyContent:i(s.template(h.get("wash","close-notification"))({title:b.get(this.model.get("sourceApk").packageName).get("base_info").name})),buttonSet:"yes"});n.show(),n.once("remove",function(){this.$(".content").html("已经关闭了「显示通知」？"),this.$(".button-close-ads").html("关了").removeClass("button-close-ads").addClass("button-ignore-app"),this.$(".button-ignore").html("没有").removeClass("button-ignore").addClass("button-reset")},this);var r=b.get(this.model.get("sourceApk").packageName);o({event:"ui.click.wash_button_close_popup",packageName:this.model.get("sourceApk").packageName,signature:r.get("signatures"),md5:r.get("fileMd5")})},clickButtonIgnoreApp:function(){d.requestAsync({url:f.actions.APP_IGNORE_WASH,data:{package_name:this.model.get("sourceApk").packageName}}),this.model.collection.remove(this.model);var e=b.get(this.model.get("sourceApk").packageName);o({event:"ui.click.wash_button_ignore_app",packageName:this.model.get("sourceApk").packageName,signature:e.get("signatures"),md5:e.get("fileMd5")})},events:{"click .button-replace":"clickButtonReplace","click .button-uninstall":"clickButtonUninstall","click .button-ignore":"clickButtonIgnore","click .button-cancel":"clickButtonCancel","click .button-confirm":"clickButtonConfirm","click .button-close-ads":"clickBUttonCloseAds","click .button-reset":"render","click .button-ignore-app":"clickButtonIgnoreApp"}}),T=r.extend({getInstance:function(e){return new x(e)}});return T})}(this),function(e,t){define("app/wash/views/ScanResultView",["backbone","underscore","doT","jquery","ui/TemplateFactory","utilities/StringUtil","Device","Log","Internationalization","app/AppService","app/wash/views/FeedbackWindowView","app/wash/views/ResultItemView"],function(e,n,r,i,s,o,u,a,f,l,c,h){console.log("ScanResultView - File loaded. ");var p=e.View.extend({template:r.template(s.get("wash","wash-scan-result")),className:"w-app-wash-result",directToPopAdsView:function(){this.$(".summary h1").html(f.app.DIRECT_ADS_TITLE),this.$(".summary .desc").html(o.format(f.app.DIRECT_ADS_DESC,this.collection.getUninstallableAdsApps().length))},switchToPopAdsView:function(){var e=this.collection.getUninstallableAdsApps();this.$(".summary").remove();var t=i(r.template(s.get("wash","summary-pop-ads"))({}));t.find(".desc").html(o.format(f.app.RESULT_SUMMARY_POP_ADS_TIP,e.length)),t.find(".button-uninstall-all").prop({disabled:!u.get("isConnected")}),this.listenTo(u,"change:isConnected",function(e,n){t.find(".button-uninstall-all").prop({disabled:!n})}),this.$el.append(t)},remove:function(){p.__super__.remove.call(this),this.collection&&(this.collection.remove(this.collection.models),delete this.collection)},updateCount:function(e,t,n){var r=this.$(".summary");e.length>0?r.find(".ads .count").html(e.length):r.find(".ads").remove(),t.length>0?r.find(".pirate .count").html(t.length):r.find(".pirate").remove(),n.length>0?r.find(".ads-uninstall .count").html(n.length):r.find(".ads-uninstall").remove()},renderItems:function(e){this.render(),this.collection=e,this.listenTo(this.collection,"remove",function(e){var t=this.collection.getUninstallableAdsApps(),n=this.collection.getUpdatableAdsApps(),r=this.collection.getPirateApps();e.get("candidateApks")?n.length===0&&r.length===0&&t.length>0?this.switchToPopAdsView():n.length===0&&r.length===0&&t.length===0&&(this.trigger("next",this.collection.original),this.remove()):n.length===0&&r.length===0&&t.length===0&&(this.trigger("next",this.collection.original),this.remove()),this.updateCount(n,r,t)});var r=this.collection.getUninstallableAdsApps(),i=this.collection.getUpdatableAdsApps(),s=this.collection.getPirateApps();this.updateCount(i,s,r);var o=t.createDocumentFragment();n.each(s.concat(i).concat(this.collection.getUninstallableAdsApps()),function(e){var t=h.getInstance({model:e});o.appendChild(t.render().$el[0])},this),this.$(".result").append(o),this.collection.getUpdatableAdsApps().length===0&&this.collection.getPirateApps().length===0&&(this.switchToPopAdsView(),this.directToPopAdsView()),setTimeout(function(){this.$(".result").css("margin-top",this.$(".summary")[0].offsetHeight)}.bind(this))},render:function(){return this.delegateEvents(),this.$el.html(this.template({})),this},clickButtonUninstallAll:function(){var e=this.collection.filter(function(e){return!e.get("candidateApks")&&e.get("function").type==="AD"}),t=n.map(e,function(e){return this.collection.remove(e),e.get("sourceApk").packageName},this);l.batchUninstallAsync(t).done(this.remove),a({event:"ui.click.wash.button.uninstall.all",count:t.length})},clickButtonFeedback:function(){c.getInstance({ids:this.collection.map(function(e){return e.get("sourceApk").packageName})}).show(),a({event:"ui.click.wash.button_feedback_result_view"})},events:{"click .button-feedback":"clickButtonFeedback","click .button-uninstall-all":"clickButtonUninstallAll"}}),d=n.extend({getInstance:function(){return new p}});return d})}(this,this.document),function(e,t){define("app/wash/views/ScanFinishView",["backbone","underscore","doT","jquery","ui/TemplateFactory","utilities/StringUtil","Configuration","social/SocialService","Log","app/wash/views/FeedbackWindowView"],function(e,t,n,r,i,s,o,u,a,f){console.log("ScanFinishView - File loaded.");var l=e.View.extend({className:"w-app-wash-finish",initialize:function(){var e={pirate:0,ads:0};Object.defineProperties(this,{original:{set:function(t){e=t},get:function(){return e}}})},render:function(){return this.$el.html(this.template({})),this},switchToEmptyView:function(){this.template=n.template(i.get("wash","result-empty")),this.render()},switchToFinishView:function(e){this.original=e,this.template=n.template(i.get("wash","result-replace-finish")),this.render()},clickButtonShare:function(){var e={textUrl:s.format(o.enums.SOCIAL_TEXT_PREVIEW_URL,o.enums.SOCIAL_WASH,JSON.stringify({mockNum:this.original.pirate,adsNum:this.original.ads})),hasPreview:!1,shareData:{need_shell:0,rotation:0},extraData:{mockNum:this.original.pirate,adsNum:this.original.ads},type:o.enums.SOCIAL_WASH};u.setContent(e),u.show(),this.trigger("next"),a({event:"ui.click.wash.button_share_finish_view"})},clickButtonFeedback:function(){f.getInstance().show(),a({event:"ui.click.wash.button_feedback_finish_view"})},events:{"click .button-share":"clickButtonShare","click .button-feedback":"clickButtonFeedback"}}),c=t.extend({getInstance:function(){return new l}});return c})}(this),function(e,t){define("app/wash/views/ErrorView",["backbone","doT","underscore","Device","ui/TemplateFactory","Log"],function(e,t,n,r,i,s){console.log("ErrorView - File loaded.");var o=e.View.extend({className:"w-app-wash-error",template:t.template(i.get("wash","wash-error")),render:function(){return this.$el.html(this.template({})),this},clickButtonRetry:function(){this.trigger("next"),this.remove(),s({event:"ui.click.wash.button.retry"})},events:{"click .button-retry":"clickButtonRetry"}}),u,a=n.extend({getInstance:function(){return new o}});return a})}(this),function(e,t){define("app/wash/views/AppWashModuleView",["backbone","underscore","doT","jquery","ui/TemplateFactory","Log","app/wash/views/IntroView","app/wash/views/ScanningView","app/wash/views/ScanResultView","app/wash/views/ScanFinishView","app/wash/views/ErrorView","main/collections/PIMCollection"],function(e,t,n,r,i,s,o,u,a,f,l,c){console.log("AppWashModuleView - File loaded.");var h=e.View.extend({className:"w-app-wash-module-main module-main",initialize:function(){var e=!1;Object.defineProperties(this,{rendered:{set:function(t){e=t},get:function(){return e}}})},render:function(){return this.introView=o.getInstance(),this.listenTo(this.introView,"next",this.renderScanningView),this.$el.prepend(this.introView.render().$el),this.rendered=!0,this},renderScanningView:function(){this.introView&&(this.introView.remove(),this.stopListening(this.introView,"next"),delete this.introView),this.scanningView=u.getInstance(),this.listenTo(this.scanningView,"next",this.renderScanResultView),this.listenTo(this.scanningView,"error",this.renderErrorView),this.$el.prepend(this.scanningView.render().$el),this.scanningView.startQueryMD5()},renderErrorView:function(){this.scanningView&&(this.scanningView.remove(),this.stopListening(this.scanningView,"next error"),delete this.scanningView),this.errorView=l.getInstance().render(),this.listenTo(this.errorView,"next",this.reset),this.$el.prepend(this.errorView.$el)},renderScanResultView:function(e){this.scanningView&&(this.scanningView.remove(),this.stopListening(this.scanningView,"next error"),delete this.scanningView),e.length>0?(this.scanResultView=a.getInstance(),this.scanResultView.renderItems(e),this.listenTo(this.scanResultView,"next",this.renderScanFinishView),this.$el.prepend(this.scanResultView.$el)):this.renderScanFinishView()},renderScanFinishView:function(){this.scanResultView&&(this.scanResultView.remove(),this.stopListening(this.scanResultView,"next"),delete this.scanResultView),this.scanFinishView=f.getInstance(),this.scanFinishView.switchToEmptyView(),this.listenTo(this.scanFinishView,"next",this.reset),this.$el.prepend(this.scanFinishView.$el)},deleteAllSubView:function(){this.introView&&(this.introView.remove(),this.stopListening(this.introView,"next"),delete this.introView),this.scanningView&&(this.scanningView.remove(),this.stopListening(this.scanningView,"next error"),delete this.scanningView),this.scanResultView&&(this.scanResultView.remove(),this.stopListening(this.scanResultView,"next"),delete this.scanResultView),this.scanFinishView&&(this.scanFinishView.remove(),this.stopListening(this.scanFinishView,"next"),delete this.scanFinishView),this.errorView&&(this.errorView.remove(),this.stopListening(this.errorView,"next"),delete this.errorView)},remove:function(){this.deleteAllSubView(),h.__super__.remove.call(this)},reset:function(){this.deleteAllSubView(),this.render()},events:{"click .button-restart":"reset"}}),p,d=t.extend({enablePreload:!1,getInstance:function(){return p||(p=new h),p},navigate:function(){c.getInstance().get(19).set({selected:!0})}});return d})}(this,this.document),function(e,t){define("sync/SyncModule",["underscore","Configuration","Device","IOBackendDevice","FunctionSwitch","Environment","ui/Notification","welcome/WelcomeService"],function(e,t,n,r,i,s,o,u){console.log("SyncModule - File loaded. ");var a={},f=function(n){if(!i.ENABLE_AUTOBACKUP_POPUP)return;var r={};r[t.enums.SYNC_DATA_TYPE_CONTACTS]="联系人 ",r[t.enums.SYNC_DATA_TYPE_SMS]="短信 ",r[t.enums.SYNC_DATA_TYPE_PHOTO]="照片 ",r[t.enums.SYNC_DATA_TYPE_APP]="应用 ";var u="";e.each(n.result,function(e){if(e.total>0&&e.total===e.success){var t=r[e.data_type]||"";u.indexOf(t)<0&&(u+=t)}});if(u.length===0)return;u.substr(0,u.length-1);var a,f=new o({type:"html",url:t.BASE_PATH+"modules/sync/auto_backup_complete.html"+s.get("search")+"&content="+encodeURIComponent(u),title:"豌豆荚自动备份提醒",onclose:function(){clearTimeout(a)}});f.show(),a=setTimeout(function(){f.cancel()},15e3)},l=function(){var e=r.Backend.Device.onmessage({"data.channel":t.events.AUTO_BACKUP_COMPLETE},function(n){u.getSystemSettingAsync(t.enums.SETTING_AUTO_BACKUP_COMPLETE).done(function(e){e.body.value&&f(n)}),r.Backend.Device.offmessage(e)})};return n.get("isAutoBackup")?l.call(this):n.once("change:isAutoBackup",function(){l.call(this)}),a})}(this),function(e,t){define("ThemeManager",["backbone","underscore","jquery","utilities/QueryString","Configuration","IOBackendDevice"],function(e,t,n,r,i,s){console.log("ThemeManager - File loaded.");var o="wdj-theme-file",u=t.extend(function(){},e.Events),a;return Object.defineProperties(u,{themeFolder:{set:function(e){a=e,n("head").find("link."+o).remove();if(a){var t=n("<link>").addClass(o);t.attr({rel:"stylesheet",type:"text/css",href:"file:///"+a+"\\templates\\theme.css"}),n("head").append(t)}},get:function(){return a}}}),u.themeFolder=r.get("theme_folder"),s.Backend.Device.onmessage({"data.channel":i.events.THEME_CHANGED},function(e){u.themeFolder=e.value},!0),u})}(this),function(e,t){define("utilities/EventsHelper",["underscore"],function(t){console.log("EventsHelper - File loaded.");var n=e.document,r=t.extend({newEvent:function(e,t){var r=n.createEvent("HTMLEvents");return r.initEvent(e,!0,!0),r.data=t||{},r},trigger:function(e,t){t?t.dispatchEvent(e):n.dispatchEvent(e)}});return r})}(this),function(e,t){define("utilities/Util",["utilities/StringUtil","utilities/FormatDate","utilities/EventsHelper"],function(t,n,r){console.log("Util - File loaded.");var i={StringUtil:t,FormatDate:n,EventsHelper:r};return e.Util=i,i})}(this),function(e){define("IframeMessageListener",["underscore","backbone","Configuration","IOBackendDevice","ui/AlertWindow","ui/Panel"],function(t,n,r,i,s,o){console.log("IframeMessageListener - File loaded. ");var u=e.alert,a=e.confirm,f=t.extend({},n.Events);return i.Backend.Device.onmessage({"data.channel":r.events.CUSTOM_IFRAME_ALERT},function(e){u(e.data)}),i.Backend.Device.onmessage({"data.channel":r.events.CUSTOM_IFRAME_CONFIRM},function(e){a(e.data,function(){i.sendCustomEventsAsync(e.listenerId,{action:"yes"})},function(){i.sendCustomEventsAsync(e.listenerId,{action:"no"})})}),i.Backend.Device.onmessage({"data.channel":r.events.CUSTOM_IFRAME_DISPOSABLE},function(e){e=e.data;var t=new o(e);t.show()}),f})}(this),function(e){define("PerformanceTracker",["Distributor","Log"],function(t,n){var r={};return r.launch=function(){if(t.PERFORMANCE_TRACK){var r={event:"debug.fe.timing"},i;for(i in e.performance.timing)e.performance.timing.hasOwnProperty(i)&&(r[i]=e.performance.timing[i]);n(r)}var s=function(){var t={event:"debug.fe.memory"},r;for(r in e.performance.memory)e.performance.memory.hasOwnProperty(r)&&(t[r]=e.performance.memory[r]);n(t)};s.call(this),setInterval(s,12e4)},r})}(this),function(e){require(["jquery","main/views/MainView","main/views/SuggestionInstallWindowView","main/views/BindingDeviceWindowView","doraemon/views/DoraemonModuleView","doraemon/views/GalleryView","message/views/MessageModuleView","browser/views/BrowserModuleView","app/views/AppModuleView","welcome/views/WelcomeModuleView","music/views/MusicModuleView","contact/views/ContactModuleView","photo/views/PhotoModuleView","video/views/VideoModuleView","optimize/views/OptimizeModuleView","app/wash/views/AppWashModuleView","sync/SyncModule","ThemeManager","FunctionSwitch","social/SocialService","utilities/Util","Device","Settings","Environment","ui/Notification","ui/TemplateFactory","IOBackendDevice","Configuration","Log","IframeMessageListener","PerformanceTracker"],function(t,n,r,i,s,o,u,a,f,l,c,h,p,d,v,m,g,y,b,w,E,S,x,T,N,C,k,L,A,O,M){e.SnapPea=e.SnapPea||{};var _=n.getInstance();_.regModule("welcome",l),t("body").append(_.render().$el),_.regModule("doraemon",s),_.regModule("browser",a),_.regModule("message",u),_.regModule("app",f),_.regModule("music",c),_.regModule("photo",p),_.regModule("video",d),_.regModule("contact",h),_.regModule("optimize",v),_.regModule("app-wash",m),_.regModule("gallery",o);var D=function(){var e=function(t,n){n&&(r.getInstance().check(),t.off("change:isConnected",e))},t=i.getInstance();t.once("closed",function(){b.ENABLE_SUGGESTION_INSTALL&&(S.get("isConnected")?r.getInstance().check():S.on("change:isConnected",e))}),t.checkAsync();if(!x.get("has-used-wash")&&b.ENABLE_APP_WASH){var n=function(){setTimeout(function(){var e,t=new N({type:"html",url:L.BASE_PATH+"modules/app/xibaibai.html"+T.get("search"),title:"豌豆洗白白",onclose:function(){k.Backend.Device.offmessage(e)}});t.show(),e=k.Backend.Device.onmessage({"data.channel":L.events.WEB_NAVIGATE},function(e){e.type===L.enums.NAVIGATE_TYPE_APP_WASH&&t.cancel()}),x.set("has-used-wash",!0,T.get("deviceId")),x.set("wash-notification-show-time",(new Date).getTime(),T.get("deviceId")),A({event:"debug.wash.notification_show"})},6e4)};if(S.get("isConnected")&&S.get("isUSB"))n.call(this);else{var s=function(e){e.get("isConnected")&&e.get("isUSB")&&(n.call(this),e.off("change:isConnected change:isUSB",s))};S.on("change:isConnected change:isUSB",s)}}};T.get("deviceId")!=="Default"?D.call(this):T.once("change:deviceId",D,this),M.launch()})}(this),define("SnapPea",function(){}),require.config({baseUrl:"javascripts/",paths:{jquery:"../bower_components/jquery/jquery",doT:"../bower_components/dot/doT",underscore:"../bower_components/underscore/underscore",backbone:"../bower_components/backbone/backbone",text:"../bower_components/requirejs-text/text",i18n:"../bower_components/requirejs-i18n/i18n",optimize:"modules/optimize",main:"modules/main",nav:"modules/nav",doraemon:"modules/doraemon",task:"modules/taskmanager",message:"modules/message",browser:"modules/browser",app:"modules/app",welcome:"modules/welcome",music:"modules/music",contact:"modules/contact",photo:"modules/photo",video:"modules/video",backuprestore:"modules/backuprestore",social:"modules/social",sync:"modules/sync"},shim:{doT:{exports:"doT"},jquery:{exports:"$"},underscore:{exports:"_"},backbone:{deps:["underscore","jquery"],exports:"Backbone"}}}),window.OneRingRequest===undefined&&(window.OneRingRequest=function(){},window.OneRingStreaming=function(){}),require(["underscore","jquery","doT","ui/TemplateFactory","utilities/QueryString","utilities/BrowserSniffer"],function(e,t,n,r,i,s){if(s.is("wandoujia")&&i.get("debug")!=="true"){var o=window.console,u=function(){};window.console={debug:u,log:u,time:u,timeEnd:u,dir:u,error:u},window.whosYourDaddy=function(){window.console=o}}s.sysIs("WindowsXP")&&t("head").append(n.template(r.get("misc","font-style-xp"))({}))}),require(["Internationalization","contact/Contact","message/Message","music/Music","sync/SyncService","backuprestore/BackupRestore","SnapPea"],function(e,t,n,r,i,s,o){require(["../../../web/build/wonder-latest-dev"])}),define("SnapPeaLoader",function(){})})();