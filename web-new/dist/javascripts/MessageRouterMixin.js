(function(e){define(["underscore","utilities/FilterFunction","ParserFactory"],function(t,n,r){console.log("MessageRouterMixin - File loaded.");var i=1,s=function(t,r,s){return i++,this.callbackList.push({id:i,route:t,filter:n.generate(t),callback:r,context:s||e}),i},o=function(e){var t=this.callbackList,r=n.generate({id:e}),i,s=t.length;for(i=0;i<s;i++)if(r(t[i])){var o=t.splice(i,1);delete o.id,delete o.router,delete o.callback,delete o.context;break}},u=function(e){t.each(this.callbackList,function(t){t.filter(e)&&t.callback.call(t.context,JSON.parse(e.data.data))})};return{mixin:function(e){e.onmessage=s.bind(e),e.offmessage=o.bind(e),e.on("message",u,e),e.callbackList=[]}}})})(this);