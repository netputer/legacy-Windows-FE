(function(e,t){define(["jquery","underscore","backbone","Configuration","BackendSocket","MessageRouterMixin","ParserFactory"],function(t,n,r,i,s,o,u){console.log("IO - File loaded.");var a=n.extend(function(){},r.Events);o.mixin(a),a.Backend=n.extend(function(){},r.Events),o.mixin(a.Backend),a.Backend.socket=new s("wdjs://window/events"),a.Backend.socket.onmessage=function(e){a.Backend.trigger("message",e)},a.Backend.requestAsync=function(n,r){var i=t.Deferred();typeof n!="string"&&(r=n,n=r.url);var s=n;r=r||{},r.type=r.type||"get",r.data=r.data||{};var o=function(t){t=JSON.parse(t),t.state_line=t.state_line||t.state_code,console.log("IO - Callback message for '"+s+"'",t),typeof r.success=="function"&&r.success.call(e,t),i.resolve(t)};switch(r.type.toLowerCase()){case"get":var u=[],a;for(a in r.data)r.data.hasOwnProperty(a)&&u.push(a+"="+e.encodeURIComponent(r.data[a]));u.length>0&&(n=n+"?"+u.join("&")),e.OneRingRequest(r.type,n,null,o);break;case"post":e.OneRingRequest(r.type,n,e.encodeURIComponent(JSON.stringify(r.data)),o)}return console.log("IO - AJAX call: "+s,r),i.promise()},a.sendCustomEventsAsync=function(e,n){var r=t.Deferred();return a.requestAsync({url:i.actions.PUBLISH_EVENT,data:{channel:e,value:JSON.stringify(n||{})},success:function(e){e.state_code===200?r.resolve(e):r.reject(e)}}),r.promise()},a.Cloud=n.extend(function(){},r.Events),o.mixin(a.Cloud),a.Cloud.requestAsync=t.ajax,a.requestAsync=function(e){var t=typeof e=="string"?e:e.url;return/^wdj:/.test(t)?a.Backend.requestAsync.apply(a.Backend,arguments):a.Cloud.requestAsync.apply(a.Cloud,arguments)},a.Backend.on("message",function(e){a.trigger("message",n.extend(e,{source:"backend"}))}),a.Cloud.on("message",function(e){a.trigger("message",n.extend(e,{source:"cloud"}))});if(r&&r.sync){var f={create:"POST",update:"PUT",patch:"PATCH","delete":"DELETE",read:"GET"};r.sync=function(e,t,n){var r=t.url,i={url:t.url,type:f[e],contentType:"application/json",data:t.data||{},dataType:"json",processData:!1,success:n.success,error:n.error};a.requestAsync(r,i)}}return a})})(this);