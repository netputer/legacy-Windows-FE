(function(e,t){define(["underscore","backbone"],function(t,n){console.log("WorkerPoll - File loaded.");var r=e.setInterval,i=e.clearInterval,s=function(e){var t,n=this.runningTasks.length;for(t=0;t<n;t++)if(this.runningTasks[t]<e)return!0;return!1},o=function(t){this.waitingResponse.sort(function(e,t){return e.timestamp>t.timestamp});var n,r=this.waitingResponse.length,i;for(n=0;n<r;n++){i=this.waitingResponse[n];if(!!s.call(this,i.timestamp))break;i.callback.call(i.context||e,i.evt)}this.waitingResponse.splice(0,n+1)},u=function(t,n){this.size=n||this.size,this.url=t;var s=r(function(){this.workerQueue.length<10?this.workerQueue.push(new e.Worker(this.url)):i(s)}.bind(this),50)};return u.prototype=t.extend({size:3,taskQueue:[],workerQueue:[],runningTasks:[],waitingResponse:[],addTask:function(e,t,n){var r=(new Date).getTime();this.workerQueue.length>0?this.runTask(e,t,n,r):this.taskQueue.push({message:e,callback:t,context:n,timestamp:r})},runTask:function(t,n,r,i){var u=this.workerQueue.shift(),a=function(t){s.call(this,i)?this.waitingResponse.push({evt:t,callback:n,context:r,timestamp:i}):(n.call(r||e,t),o.call(this,i)),this.runningTasks.splice(this.runningTasks.indexOf(i),1),u.removeEventListener("message",a),this.workerQueue.push(u);if(this.taskQueue.length>0){var f=this.taskQueue.shift();this.runTask(f.message,f.callback,f.context,f.timestamp)}}.bind(this);this.runningTasks.push(i),u.addEventListener("message",a),u.postMessage(t)}},n.Events),u})})(this);