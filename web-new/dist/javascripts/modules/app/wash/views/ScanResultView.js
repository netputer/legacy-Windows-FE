(function(e,t){define(["backbone","underscore","doT","jquery","ui/TemplateFactory","utilities/StringUtil","Device","Log","Internationalization","app/AppService","app/wash/views/FeedbackWindowView","app/wash/views/ResultItemView"],function(e,n,r,i,s,o,u,a,f,l,c,h){console.log("ScanResultView - File loaded. ");var p=e.View.extend({template:r.template(s.get("wash","wash-scan-result")),className:"w-app-wash-result",directToPopAdsView:function(){this.$(".summary h1").html(f.app.DIRECT_ADS_TITLE),this.$(".summary .desc").html(o.format(f.app.DIRECT_ADS_DESC,this.collection.getUninstallableAdsApps().length))},switchToPopAdsView:function(){var e=this.collection.getUninstallableAdsApps();this.$(".summary").remove();var t=i(r.template(s.get("wash","summary-pop-ads"))({}));t.find(".desc").html(o.format(f.app.RESULT_SUMMARY_POP_ADS_TIP,e.length)),t.find(".button-uninstall-all").prop({disabled:!u.get("isConnected")}),this.listenTo(u,"change:isConnected",function(e,n){t.find(".button-uninstall-all").prop({disabled:!n})}),this.$el.append(t)},remove:function(){p.__super__.remove.call(this),this.collection&&(this.collection.remove(this.collection.models),delete this.collection)},updateCount:function(e,t,n){var r=this.$(".summary");e.length>0?r.find(".ads .count").html(e.length):r.find(".ads").remove(),t.length>0?r.find(".pirate .count").html(t.length):r.find(".pirate").remove(),n.length>0?r.find(".ads-uninstall .count").html(n.length):r.find(".ads-uninstall").remove()},renderItems:function(e){this.render(),this.collection=e,this.listenTo(this.collection,"remove",function(e){var t=this.collection.getUninstallableAdsApps(),n=this.collection.getUpdatableAdsApps(),r=this.collection.getPirateApps();e.get("candidateApks")?n.length===0&&r.length===0&&t.length>0?this.switchToPopAdsView():n.length===0&&r.length===0&&t.length===0&&(this.trigger("next",this.collection.original),this.remove()):n.length===0&&r.length===0&&t.length===0&&(this.trigger("next",this.collection.original),this.remove()),this.updateCount(n,r,t)});var r=this.collection.getUninstallableAdsApps(),i=this.collection.getUpdatableAdsApps(),s=this.collection.getPirateApps();this.updateCount(i,s,r);var o=t.createDocumentFragment();n.each(s.concat(i).concat(this.collection.getUninstallableAdsApps()),function(e){var t=h.getInstance({model:e});o.appendChild(t.render().$el[0])},this),this.$(".result").append(o),this.collection.getUpdatableAdsApps().length===0&&this.collection.getPirateApps().length===0&&(this.switchToPopAdsView(),this.directToPopAdsView()),setTimeout(function(){this.$(".result").css("margin-top",this.$(".summary")[0].offsetHeight)}.bind(this))},render:function(){return this.delegateEvents(),this.$el.html(this.template({})),this},clickButtonUninstallAll:function(){var e=this.collection.filter(function(e){return!e.get("candidateApks")&&e.get("function").type==="AD"}),t=n.map(e,function(e){return this.collection.remove(e),e.get("sourceApk").packageName},this);l.batchUninstallAsync(t).done(this.remove),a({event:"ui.click.wash.button.uninstall.all",count:t.length})},clickButtonFeedback:function(){c.getInstance({ids:this.collection.map(function(e){return e.get("sourceApk").packageName})}).show(),a({event:"ui.click.wash.button_feedback_result_view"})},events:{"click .button-feedback":"clickButtonFeedback","click .button-uninstall-all":"clickButtonUninstallAll"}}),d=n.extend({getInstance:function(){return new p}});return d})})(this,this.document);