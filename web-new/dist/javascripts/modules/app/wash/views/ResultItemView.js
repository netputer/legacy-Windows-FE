(function(e,t){define(["backbone","underscore","jquery","doT","Log","Device","Internationalization","Configuration","ui/PopupTip","ui/PopupPanel","ui/TemplateFactory","ui/Panel","IOBackendDevice","task/TaskService","app/collections/AppsCollection","app/wash/views/FeedbackCardView"],function(n,r,i,s,o,u,a,f,l,c,h,p,d,v,m,g){console.log("ResultItemView - File loaded. ");var y=e.alert,b,w=function(e){var n=e.get(this.model.get("sourceApk").packageName);n!==t&&this.$(".icon img").attr({src:n.get("base_info").icon})},E=function(e,t){this.$(".button-uninstall").prop({disabled:!t})},S=c.extend({initialize:function(){S.__super__.initialize.apply(this,arguments),this.$content=s.template(h.get("wash","result-info"))(this.model.toJSON())}}),x=n.View.extend({className:"result-item vbox",tagName:"li",template:s.template(h.get("wash","result-item")),popups:[],initialize:function(){b=b||m.getInstance(),this.model.get("function").type==="AD"&&!this.model.get("candidateApks")&&(this.$el.addClass("uninstall"),this.listenTo(u,"change:isConnected",E)),this.listenTo(b,"refresh",w),this.listenToOnce(this.model,"remove",this.remove)},render:function(){var e=b.get(this.model.get("sourceApk").packageName);return this.$el.html(this.template({origin:e.toJSON(),result:this.model.toJSON()})),r.each(this.$("[data-title]"),function(e){this.popups.push(new l({$host:i(e)}))},this),this.$(".info").length>0&&this.popups.push(new S({$host:this.$(".info"),model:this.model})),this.$(".front").before(g.getInstance({model:this.model}).render().$el),this},clickButtonReplace:function(){var e=b.get(this.model.get("sourceApk").packageName),r=this.model.get("candidateApks")[0].apk,i=new n.Model({downloadUrl:r.downloadUrl,title:r.title,iconPath:e.get("base_info").icon,source:"app-wash",force:!0,packageName:r.packageName});v.addTask(f.enums.TASK_TYPE_INSTALL,f.enums.MODEL_TYPE_APPLICATION,i),e.set({isUpdating:!0}),this.model.collection.remove(this.model);var s=r.packageName,u=this.model.get("sourceApk").packageName;if(s!==u)var a=d.Backend.Device.onmessage({"data.channel":f.events.APP_INSTALLED},function(e){if(e.package_name===s){var n=u,r=b.get(n);r!==t&&r.uninstallAsync().done(function(){r=b.get(n),r!==t&&(b.remove(r,{silent:!0}),b.trigger("refresh",b))}),d.Backend.Device.offmessage(a)}},this);o({event:"ui.click.wash.button.item.replace",type:this.model.get("function").type,packageName:this.model.get("sourceApk").packageName,signature:e.get("signatures"),md5:e.get("fileMd5")})},clickButtonUninstall:function(){var e=b.get(this.model.get("sourceApk").packageName);e.uninstallAsync().done(function(t){(u.get("isWifi")||u.get("isInternet"))&&!e.isSystem&&y(a.app.ALERT_TIP_UNINSTALL_WIFI_CONFIRM);var n=t.body.failed;n&&n.length>0&&n[0].item===this.originalApp.id&&y(e.isSystem?a.app.UNINSTALL_FAILED+a.app.UNINSTALL_FAILED_SYSTEM_APP:a.app.UNINSTALL_FAILED)}.bind(this)).fail(function(){y(e.isSystem?a.app.UNINSTALL_FAILED+a.app.UNINSTALL_FAILED_SYSTEM_APP:a.app.UNINSTALL_FAILED)}.bind(this)),this.$(".button-uninstall").prop({disabled:!0}),this.model.collection.remove(this.model),o({event:"ui.click.wash.button.item.uninstall",packageName:this.model.get("sourceApk").packageName,signature:e.get("signatures"),md5:e.get("fileMd5")})},remove:function(){this.$el.fadeOut("slow",function(){r.each(this.popups,function(e){e.remove()}),delete this.popups,n.View.prototype.remove.call(this)}.bind(this))},clickButtonIgnore:function(){this.$el.addClass("flip");var e=b.get(this.model.get("sourceApk").packageName);o({event:"ui.click.wash.button.ignore",packageName:this.model.get("sourceApk").packageName,signature:e.get("signatures"),md5:e.get("fileMd5")})},clickButtonCancel:function(){var e=b.get(this.model.get("sourceApk").packageName);o({event:"ui.click.wash.button.cancel",from:this.$el.hasClass("replace")?"confirm":"ignore",packageName:this.model.get("sourceApk").packageName,signature:e.get("signatures"),md5:e.get("fileMd5")}),this.$el.removeClass("flip replace")},clickButtonConfirm:function(){this.$el.addClass("flip replace");var e=b.get(this.model.get("sourceApk").packageName);o({event:"ui.click.wash_button_confirm",packageName:this.model.get("sourceApk").packageName,signature:e.get("signatures"),md5:e.get("fileMd5")})},clickBUttonCloseAds:function(){var t=new e.AndroidIntent("android.settings.APPLICATION_DETAILS_SETTINGS","","package:"+this.model.get("sourceApk").packageName,"","","");t.startActivity();var n=new p({title:"关闭通知栏广告",height:550,width:715,$bodyContent:i(s.template(h.get("wash","close-notification"))({title:b.get(this.model.get("sourceApk").packageName).get("base_info").name})),buttonSet:"yes"});n.show(),n.once("remove",function(){this.$(".content").html("已经关闭了「显示通知」？"),this.$(".button-close-ads").html("关了").removeClass("button-close-ads").addClass("button-ignore-app"),this.$(".button-ignore").html("没有").removeClass("button-ignore").addClass("button-reset")},this);var r=b.get(this.model.get("sourceApk").packageName);o({event:"ui.click.wash_button_close_popup",packageName:this.model.get("sourceApk").packageName,signature:r.get("signatures"),md5:r.get("fileMd5")})},clickButtonIgnoreApp:function(){d.requestAsync({url:f.actions.APP_IGNORE_WASH,data:{package_name:this.model.get("sourceApk").packageName}}),this.model.collection.remove(this.model);var e=b.get(this.model.get("sourceApk").packageName);o({event:"ui.click.wash_button_ignore_app",packageName:this.model.get("sourceApk").packageName,signature:e.get("signatures"),md5:e.get("fileMd5")})},events:{"click .button-replace":"clickButtonReplace","click .button-uninstall":"clickButtonUninstall","click .button-ignore":"clickButtonIgnore","click .button-cancel":"clickButtonCancel","click .button-confirm":"clickButtonConfirm","click .button-close-ads":"clickBUttonCloseAds","click .button-reset":"render","click .button-ignore-app":"clickButtonIgnoreApp"}}),T=r.extend({getInstance:function(e){return new x(e)}});return T})})(this);