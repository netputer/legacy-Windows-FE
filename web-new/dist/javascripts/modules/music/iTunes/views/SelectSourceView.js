(function(e,t){define(["underscore","doT","jquery","ui/UIHelper","ui/Panel","ui/AlertWindow","Internationalization","ui/TemplateFactory","utilities/StringUtil","music/iTunes/iTunesData"],function(t,n,r,i,s,o,u,a,f,l){console.log("SelectSourceView - File loaded. ");var c=e.alert,h=0,p,d=s.extend({className:s.prototype.className+" w-iTunes-select-source-panel",initialize:function(){d.__super__.initialize.call(this);var e=[{$button:r("<button/>").addClass("primary next-step").html(u.common.NEXT_STEP),eventName:"NEXT_STEP"},{$button:r("<button/>").html(u.common.CANCEL),eventName:"CANCEL"}];this.sourceType=0,this.buttons=e,this.off("NEXT_STEP"),this.off("CANCEL"),this.on("NEXT_STEP",function(){this.playlistData.sourceType=this.sourceType,this.playlistData.songs=h,this.playlistData.capacity=p,this.trigger("_NEXT_STEP",this.playlistData),this.hide()},this),this.on("CANCEL",function(){this.trigger("_CANCEL"),this.close()},this)},render:function(){t.extend(this.events,d.__super__.events),this.delegateEvents(),d.__super__.render.call(this)},show:function(e){d.__super__.show.call(this);if(!!e){this.recovery(),this.createContent(),this.disableNextStep(!0),this.iTunesXMLdata=e;var t={path:this.iTunesXMLdata instanceof Array?this.iTunesXMLdata[0].path:this.iTunesXMLdata.path};l.parseSource(t).done(this.parseSourceSuccess.bind(this)).fail(this.parseSourceFail.bind(this))}},recovery:function(){r("input:first",this.$el).prop("checked","checked"),this.sourceType=0,this.$bodyContent=""},createContent:function(){var e=n.template(a.get("iTunes","select-source-content")),t=[{label:u.music.ALL_AUDIOS_AND_PLAYLIST},{label:u.music.SELECT_PLAYLIST},{label:u.music.SELECT_AUDIOS}];this.$bodyContent=e(t)},disableNextStep:function(e){this.$(".next-step").prop({disabled:e})},parseSourceSuccess:function(e){this.playlistData=e;if(!e||!e.play_lists||e.play_lists.length===0){this.trigger("CANCEL"),c(u.music.PARSE_EMPTY_LIST);return}var t=n.template(a.get("iTunes","iTunes-source-info")),r=e.songs;h=e.songs,p=e.total,this.disableNextStep(!1);var i={playlistCount:e.play_lists.length,audiosCount:r,capacitySize:f.readableSize(p)};this.$(".source-tip").html(t(i))},parseSourceFail:function(e){c(u.music.PARSE_ITUNES_SOURCE_FAIL),this.trigger("CANCEL")},events:{"change input":function(e){this.sourceType=e.target.value}}}),v,m=t.extend({getInstance:function(){return v||(v=new d({title:u.music.ITUNES_IMPORT,width:430,height:270,draggable:!0,disableX:!0})),v}});return m})})(this);