(function(e,t){define(["underscore","doT","jquery","Configuration","Internationalization","ui/Panel","ui/TemplateFactory","utilities/StringUtil","utilities/FormatString","music/iTunes/iTunesData"],function(e,t,n,r,i,s,o,u,a,f){var l,c,h=s.extend({className:s.prototype.className+" w-iTunes-audio-list-panel",initialize:function(){h.__super__.initialize.call(this);var s=[{$button:n("<button/>").html(i.common.PRE_STEP),eventName:"PRE_STEP"},{$button:n("<button/>").addClass("primary next-step").html(i.common.NEXT_STEP),eventName:"NEXT_STEP"},{$button:n("<button/>").html(i.common.CANCEL),eventName:"CANCEL"}];this.title=i.music.ITUNES_IMPORT,this.width=600,this.height=410,this.draggable=!0,this.disableX=!0,this.buttons=s,this.$bodyContent=t.template(o.get("iTunes","audio-list"))({}),this.off("NEXT_STEP"),this.off("PRE_STEP"),this.off("CANCEL"),this.on("PRE_STEP",function(){this.trigger("_PRE_STEP"),this.close()},this),this.on("NEXT_STEP",function(){var t={iTunesIds:e.pluck(l.getCheckedData(),"id"),sourceType:r.enums.ITUNES_IMPORT_AUDIOS,capacity:c};this.trigger("_NEXT_STEP",t),this.close()},this),this.on("CANCEL",function(){this.trigger("_CANCEL"),this.close()},this)},show:function(e){h.__super__.show.call(this),this.initAudioList(),f.queryAudios().done(this.queryAudiosSuccess.bind(this)).fail(this.queryAudiosFail.bind(this))},initAudioList:function(){this.disableNextStep(!1);var e=this.$(".audio-list-content");e.addClass("loading"),e.html(""),l=new wonder.ui.Grid({colModel:[{colLabel:i.music.SING_NAME_TEXT,index:"title",name:"title",width:160,resizable:!0,sortable:!0,sorttype:"text"},{colLabel:i.music.ARTIST_TEXT,index:"artist",name:"artist",width:140,resizable:!0,sortable:!0,sorttype:"text"},{colLabel:i.music.ALBUM_TEXT,index:"album",name:"album",width:150,resizable:!0},{colLabel:i.music.SING_SIZE_TEXT,index:"size",name:"size",width:70,resizable:!1,sortable:!0,sorttype:"number",dataType:"size"}],rowHeight:30,multiSelectable:!0,checkboxColWidth:25,isContentMultiSelected:!0}),l.render(e),l.bind(wonder.ui.Grid.Events.SELECT,this.showSelectCountText,this),l.bind(wonder.ui.Grid.Events.UNSELECT,this.showSelectCountText,this),l.bind(wonder.ui.Grid.Events.SELECT_ALL,this.showSelectCountText,this),l.bind(wonder.ui.Grid.Events.UNSELECT_ALL,this.showSelectCountText,this),this.showSelectCountText()},showSelectCountText:function(){var t=n(".select-count-wrap",this.$el);t.length||(t=n("<div/>").addClass("select-count-wrap"),t.appendTo(this.$(".w-ui-window-body")));var r=l.getCheckedData(),s=r.length;c=0,e.each(r,function(e){c+=parseInt(e.size,10)});var o=a(i.music.SELECT_AUDIOS_COUNT_TEXT,s,u.readableSize(c));t.html(o),r.length?this.disableNextStep(!1):this.disableNextStep(!0)},queryAudiosSuccess:function(e){this.$(".audio-list-content").removeClass("loading"),l.setData(e.audio)},queryAudiosFail:function(){this.$(".audio-list-content").removeClass("loading")},disableNextStep:function(e){n(".next-step",this.$el).prop("disabled",!!e)}}),p,d=e.extend({getInstance:function(){return p||(p=new h),p}});return d})})(this);