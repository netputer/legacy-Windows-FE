(function(e,t){define(["underscore","doT","jquery","Configuration","ui/UIHelper","ui/Panel","Internationalization","utilities/FormatString","ui/TemplateFactory","ui/behavior/ButtonSetMixin","utilities/StringUtil","music/iTunes/iTunesData"],function(e,t,n,r,i,s,o,u,a,f,l,c){var h=o.music,p,d,v=0,m=s.extend({className:s.prototype.className+" w-iTunes-playlist-panel",initialize:function(){m.__super__.initialize.call(this);var i=[{$button:n("<button/>").html(o.common.PRE_STEP),eventName:"PRE_STEP"},{$button:n("<button/>").addClass("primary next-step").html(o.common.NEXT_STEP),eventName:"NEXT_STEP"},{$button:n("<button/>").html(o.common.CANCEL),eventName:"CANCEL"}];this.title=h.ITUNES_IMPORT,this.width=600,this.height=410,this.draggable=!0,this.disableX=!0,this.buttons=i,this.$bodyContent=t.template(a.get("iTunes","playlist"))({}),this.off("NEXT_STEP"),this.off("PRE_STEP"),this.off("CANCEL"),this.on("NEXT_STEP",function(){var t=[],n=[],i=p.getCheckedData(),s={iTunesIds:[],playlistIds:[],sourceType:r.enums.ITUNES_IMPORT_PLAYLIST,capacity:d};e.each(i,function(e){s.iTunesIds=s.iTunesIds.concat(e.tracks_id),s.playlistIds.push(e.id)}),this.trigger("_NEXT_STEP",s),this.close()},this),this.on("PRE_STEP",function(){this.trigger("_PRE_STEP"),this.hide()},this),this.on("CANCEL",function(){this.trigger("_CANCEL"),this.close()},this)},show:function(e){m.__super__.show.call(this),this.addContent(e.play_lists)},addContent:function(t){this.initPlaylist(),e.each(t,function(e){e.count=e.tracks_id.length}),p.setData(t)},initPlaylist:function(){this.disableNextStep(!1);var e=n(".playlist-content",this.$el);e.html(""),p=new wonder.ui.Grid({colModel:[{colLabel:h.PLAYLIST_NAME,index:"name",name:"name",width:310,resizable:!0,sortable:!0,sorttype:"text"},{colLabel:h.AUDIOS_COUNT,index:"count",name:"count",width:200,resizable:!0,sortable:!0,sorttype:"number"}],rowHeight:30,multiSelectable:!0,checkboxColWidth:25,isContentMultiSelected:!0}),p.render(e),p.bind(wonder.ui.Grid.Events.SELECT,this.showSelectCountText,this),p.bind(wonder.ui.Grid.Events.UNSELECT,this.showSelectCountText,this),p.bind(wonder.ui.Grid.Events.SELECT_ALL,this.showSelectCountText,this),p.bind(wonder.ui.Grid.Events.UNSELECT_ALL,this.showSelectCountText,this),this.showSelectCountText()},showSelectCountText:function(){var t=n(".select-count-wrap",this.$el);t.length||(t=n("<div/>").addClass("select-count-wrap"),t.appendTo(this.$(".w-ui-window-body")));var r=p.getCheckedData(),i=r.length,s=0;d=0,e.each(r,function(e){s+=e.tracks_id.length,d+=parseInt(e.size,10)});var a=u(o.music.SELECT_PLAYLIST_COUNT_TEXT,i,s,l.readableSize(d));t.html(a),r.length?this.disableNextStep(!1):this.disableNextStep(!0)},disableNextStep:function(e){n(".next-step",this.$el).prop("disabled",!!e)}}),g,y=e.extend({getInstance:function(){return g||(g=new m),g}});return y})})(this);